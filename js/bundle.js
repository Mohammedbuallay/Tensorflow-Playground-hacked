!function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";function asPromise(fn,ctx){for(var params=new Array(arguments.length-1),offset=0,index=2,pending=!0;index<arguments.length;)params[offset++]=arguments[index++];return new Promise(function(resolve,reject){params[offset]=function(err){if(pending)if(pending=!1,err)reject(err);else{for(var params=new Array(arguments.length-1),offset=0;offset<params.length;)params[offset++]=arguments[offset];resolve.apply(null,params)}};try{fn.apply(ctx||null,params)}catch(err){pending&&(pending=!1,reject(err))}})}module.exports=asPromise},{}],2:[function(require,module,exports){"use strict";var base64=exports;base64.length=function(string){var p=string.length;if(!p)return 0;for(var n=0;--p%4>1&&"="===string.charAt(p);)++n;return Math.ceil(3*string.length)/4-n};for(var b64=new Array(64),s64=new Array(123),i=0;i<64;)s64[b64[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;base64.encode=function(buffer,start,end){for(var t,parts=null,chunk=[],i=0,j=0;start<end;){var b=buffer[start++];switch(j){case 0:chunk[i++]=b64[b>>2],t=(3&b)<<4,j=1;break;case 1:chunk[i++]=b64[t|b>>4],t=(15&b)<<2,j=2;break;case 2:chunk[i++]=b64[t|b>>6],chunk[i++]=b64[63&b],j=0}i>8191&&((parts||(parts=[])).push(String.fromCharCode.apply(String,chunk)),i=0)}return j&&(chunk[i++]=b64[t],chunk[i++]=61,1===j&&(chunk[i++]=61)),parts?(i&&parts.push(String.fromCharCode.apply(String,chunk.slice(0,i))),parts.join("")):String.fromCharCode.apply(String,chunk.slice(0,i))};base64.decode=function(string,buffer,offset){for(var t,start=offset,j=0,i=0;i<string.length;){var c=string.charCodeAt(i++);if(61===c&&j>1)break;if(void 0===(c=s64[c]))throw Error("invalid encoding");switch(j){case 0:t=c,j=1;break;case 1:buffer[offset++]=t<<2|(48&c)>>4,t=c,j=2;break;case 2:buffer[offset++]=(15&t)<<4|(60&c)>>2,t=c,j=3;break;case 3:buffer[offset++]=(3&t)<<6|c,j=0}}if(1===j)throw Error("invalid encoding");return offset-start},base64.test=function(string){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(string)}},{}],3:[function(require,module,exports){"use strict";function EventEmitter(){this._listeners={}}module.exports=EventEmitter,EventEmitter.prototype.on=function(evt,fn,ctx){return(this._listeners[evt]||(this._listeners[evt]=[])).push({fn:fn,ctx:ctx||this}),this},EventEmitter.prototype.off=function(evt,fn){if(void 0===evt)this._listeners={};else if(void 0===fn)this._listeners[evt]=[];else for(var listeners=this._listeners[evt],i=0;i<listeners.length;)listeners[i].fn===fn?listeners.splice(i,1):++i;return this},EventEmitter.prototype.emit=function(evt){var listeners=this._listeners[evt];if(listeners){for(var args=[],i=1;i<arguments.length;)args.push(arguments[i++]);for(i=0;i<listeners.length;)listeners[i].fn.apply(listeners[i++].ctx,args)}return this}},{}],4:[function(require,module,exports){"use strict";function factory(exports){return"undefined"!=typeof Float32Array?function(){function writeFloat_f32_cpy(val,buf,pos){f32[0]=val,buf[pos]=f8b[0],buf[pos+1]=f8b[1],buf[pos+2]=f8b[2],buf[pos+3]=f8b[3]}function writeFloat_f32_rev(val,buf,pos){f32[0]=val,buf[pos]=f8b[3],buf[pos+1]=f8b[2],buf[pos+2]=f8b[1],buf[pos+3]=f8b[0]}function readFloat_f32_cpy(buf,pos){return f8b[0]=buf[pos],f8b[1]=buf[pos+1],f8b[2]=buf[pos+2],f8b[3]=buf[pos+3],f32[0]}function readFloat_f32_rev(buf,pos){return f8b[3]=buf[pos],f8b[2]=buf[pos+1],f8b[1]=buf[pos+2],f8b[0]=buf[pos+3],f32[0]}var f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer),le=128===f8b[3];exports.writeFloatLE=le?writeFloat_f32_cpy:writeFloat_f32_rev,exports.writeFloatBE=le?writeFloat_f32_rev:writeFloat_f32_cpy,exports.readFloatLE=le?readFloat_f32_cpy:readFloat_f32_rev,exports.readFloatBE=le?readFloat_f32_rev:readFloat_f32_cpy}():function(){function writeFloat_ieee754(writeUint,val,buf,pos){var sign=val<0?1:0;if(sign&&(val=-val),0===val)writeUint(1/val>0?0:2147483648,buf,pos);else if(isNaN(val))writeUint(2143289344,buf,pos);else if(val>3.4028234663852886e38)writeUint((sign<<31|2139095040)>>>0,buf,pos);else if(val<1.1754943508222875e-38)writeUint((sign<<31|Math.round(val/1.401298464324817e-45))>>>0,buf,pos);else{var exponent=Math.floor(Math.log(val)/Math.LN2),mantissa=8388607&Math.round(val*Math.pow(2,-exponent)*8388608);writeUint((sign<<31|exponent+127<<23|mantissa)>>>0,buf,pos)}}function readFloat_ieee754(readUint,buf,pos){var uint=readUint(buf,pos),sign=2*(uint>>31)+1,exponent=uint>>>23&255,mantissa=8388607&uint;return 255===exponent?mantissa?NaN:sign*(1/0):0===exponent?1.401298464324817e-45*sign*mantissa:sign*Math.pow(2,exponent-150)*(mantissa+8388608)}exports.writeFloatLE=writeFloat_ieee754.bind(null,writeUintLE),exports.writeFloatBE=writeFloat_ieee754.bind(null,writeUintBE),exports.readFloatLE=readFloat_ieee754.bind(null,readUintLE),exports.readFloatBE=readFloat_ieee754.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){function writeDouble_f64_cpy(val,buf,pos){f64[0]=val,buf[pos]=f8b[0],buf[pos+1]=f8b[1],buf[pos+2]=f8b[2],buf[pos+3]=f8b[3],buf[pos+4]=f8b[4],buf[pos+5]=f8b[5],buf[pos+6]=f8b[6],buf[pos+7]=f8b[7]}function writeDouble_f64_rev(val,buf,pos){f64[0]=val,buf[pos]=f8b[7],buf[pos+1]=f8b[6],buf[pos+2]=f8b[5],buf[pos+3]=f8b[4],buf[pos+4]=f8b[3],buf[pos+5]=f8b[2],buf[pos+6]=f8b[1],buf[pos+7]=f8b[0]}function readDouble_f64_cpy(buf,pos){return f8b[0]=buf[pos],f8b[1]=buf[pos+1],f8b[2]=buf[pos+2],f8b[3]=buf[pos+3],f8b[4]=buf[pos+4],f8b[5]=buf[pos+5],f8b[6]=buf[pos+6],f8b[7]=buf[pos+7],f64[0]}function readDouble_f64_rev(buf,pos){return f8b[7]=buf[pos],f8b[6]=buf[pos+1],f8b[5]=buf[pos+2],f8b[4]=buf[pos+3],f8b[3]=buf[pos+4],f8b[2]=buf[pos+5],f8b[1]=buf[pos+6],f8b[0]=buf[pos+7],f64[0]}var f64=new Float64Array([-0]),f8b=new Uint8Array(f64.buffer),le=128===f8b[7];exports.writeDoubleLE=le?writeDouble_f64_cpy:writeDouble_f64_rev,exports.writeDoubleBE=le?writeDouble_f64_rev:writeDouble_f64_cpy,exports.readDoubleLE=le?readDouble_f64_cpy:readDouble_f64_rev,exports.readDoubleBE=le?readDouble_f64_rev:readDouble_f64_cpy}():function(){function writeDouble_ieee754(writeUint,off0,off1,val,buf,pos){var sign=val<0?1:0;if(sign&&(val=-val),0===val)writeUint(0,buf,pos+off0),writeUint(1/val>0?0:2147483648,buf,pos+off1);else if(isNaN(val))writeUint(0,buf,pos+off0),writeUint(2146959360,buf,pos+off1);else if(val>1.7976931348623157e308)writeUint(0,buf,pos+off0),writeUint((sign<<31|2146435072)>>>0,buf,pos+off1);else{var mantissa;if(val<2.2250738585072014e-308)mantissa=val/5e-324,writeUint(mantissa>>>0,buf,pos+off0),writeUint((sign<<31|mantissa/4294967296)>>>0,buf,pos+off1);else{var exponent=Math.floor(Math.log(val)/Math.LN2);1024===exponent&&(exponent=1023),mantissa=val*Math.pow(2,-exponent),writeUint(4503599627370496*mantissa>>>0,buf,pos+off0),writeUint((sign<<31|exponent+1023<<20|1048576*mantissa&1048575)>>>0,buf,pos+off1)}}}function readDouble_ieee754(readUint,off0,off1,buf,pos){var lo=readUint(buf,pos+off0),hi=readUint(buf,pos+off1),sign=2*(hi>>31)+1,exponent=hi>>>20&2047,mantissa=4294967296*(1048575&hi)+lo;return 2047===exponent?mantissa?NaN:sign*(1/0):0===exponent?5e-324*sign*mantissa:sign*Math.pow(2,exponent-1075)*(mantissa+4503599627370496)}exports.writeDoubleLE=writeDouble_ieee754.bind(null,writeUintLE,0,4),exports.writeDoubleBE=writeDouble_ieee754.bind(null,writeUintBE,4,0),exports.readDoubleLE=readDouble_ieee754.bind(null,readUintLE,0,4),exports.readDoubleBE=readDouble_ieee754.bind(null,readUintBE,4,0)}(),exports}function writeUintLE(val,buf,pos){buf[pos]=255&val,buf[pos+1]=val>>>8&255,buf[pos+2]=val>>>16&255,buf[pos+3]=val>>>24}function writeUintBE(val,buf,pos){buf[pos]=val>>>24,buf[pos+1]=val>>>16&255,buf[pos+2]=val>>>8&255,buf[pos+3]=255&val}function readUintLE(buf,pos){return(buf[pos]|buf[pos+1]<<8|buf[pos+2]<<16|buf[pos+3]<<24)>>>0}function readUintBE(buf,pos){return(buf[pos]<<24|buf[pos+1]<<16|buf[pos+2]<<8|buf[pos+3])>>>0}module.exports=factory(factory)},{}],5:[function(require,module,exports){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},{}],6:[function(require,module,exports){"use strict";function pool(alloc,slice,size){var SIZE=size||8192,MAX=SIZE>>>1,slab=null,offset=SIZE;return function(size){if(size<1||size>MAX)return alloc(size);offset+size>SIZE&&(slab=alloc(SIZE),offset=0);var buf=slice.call(slab,offset,offset+=size);return 7&offset&&(offset=1+(7|offset)),buf}}module.exports=pool},{}],7:[function(require,module,exports){"use strict";var utf8=exports;utf8.length=function(string){for(var len=0,c=0,i=0;i<string.length;++i)c=string.charCodeAt(i),c<128?len+=1:c<2048?len+=2:55296==(64512&c)&&56320==(64512&string.charCodeAt(i+1))?(++i,len+=4):len+=3;return len},utf8.read=function(buffer,start,end){if(end-start<1)return"";for(var t,parts=null,chunk=[],i=0;start<end;)t=buffer[start++],t<128?chunk[i++]=t:t>191&&t<224?chunk[i++]=(31&t)<<6|63&buffer[start++]:t>239&&t<365?(t=((7&t)<<18|(63&buffer[start++])<<12|(63&buffer[start++])<<6|63&buffer[start++])-65536,chunk[i++]=55296+(t>>10),chunk[i++]=56320+(1023&t)):chunk[i++]=(15&t)<<12|(63&buffer[start++])<<6|63&buffer[start++],i>8191&&((parts||(parts=[])).push(String.fromCharCode.apply(String,chunk)),i=0);return parts?(i&&parts.push(String.fromCharCode.apply(String,chunk.slice(0,i))),parts.join("")):String.fromCharCode.apply(String,chunk.slice(0,i))},utf8.write=function(string,buffer,offset){for(var c1,c2,start=offset,i=0;i<string.length;++i)c1=string.charCodeAt(i),c1<128?buffer[offset++]=c1:c1<2048?(buffer[offset++]=c1>>6|192,buffer[offset++]=63&c1|128):55296==(64512&c1)&&56320==(64512&(c2=string.charCodeAt(i+1)))?(c1=65536+((1023&c1)<<10)+(1023&c2),++i,buffer[offset++]=c1>>18|240,buffer[offset++]=c1>>12&63|128,buffer[offset++]=c1>>6&63|128,buffer[offset++]=63&c1|128):(buffer[offset++]=c1>>12|224,buffer[offset++]=c1>>6&63|128,buffer[offset++]=63&c1|128);return offset-start}},{}],8:[function(require,module,exports){"use strict";function getLens(b64){var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var validLen=b64.indexOf("=");return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function byteLength(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}function toByteArray(b64){for(var tmp,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(_byteLength(b64,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen,i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;return 2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp),1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));return 1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")),parts.join("")}exports.byteLength=byteLength,exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63},{}],9:[function(require,module,exports){},{}],10:[function(require,module,exports){"use strict";function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError('The value "'+length+'" is invalid for option "size"');var buf=new Uint8Array(length);return buf.__proto__=Buffer.prototype,buf}function Buffer(arg,encodingOrOffset,length){if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if("string"==typeof value)return fromString(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return fromArrayBuffer(value,encodingOrOffset,length);if("number"==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);var b=fromObject(value);if(b)return b;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function alloc(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?"string"==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromString(string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);return actual!==length&&(buf=buf.slice(0,actual)),buf}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;return buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),buf.__proto__=Buffer.prototype,buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}return void 0!==obj.length?"number"!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj):"Buffer"===obj.type&&Array.isArray(obj.data)?fromArrayLike(obj.data):void 0}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes");return 0|length}function SlowBuffer(length){return+length!=length&&(length=0),Buffer.alloc(+length)}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if("string"!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=arguments.length>2&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if(end>>>=0,start>>>=0,end<=start)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset=+byteOffset,numberIsNaN(byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if("string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if("number"==typeof val)return val&=255,"function"==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&("ucs2"===(encoding=String(encoding).toLowerCase())||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128==(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out="",i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=str.split("=")[0],str=str.trim().replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!=0;)str+="=";return str}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}var base64=require("base64-js"),ieee754=require("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim(),this.length>max&&(str+=" ... "),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{
if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return newBuf.__proto__=Buffer.prototype,newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,byteLength>>>=0,!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0)}var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(this===target&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding);if(1===val.length){var code=val.charCodeAt(0);("utf8"===encoding&&code<128||"latin1"===encoding)&&(val=code)}}else"number"==typeof val&&(val&=255);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g},{"base64-js":8,ieee754:12}],11:[function(require,module,exports){!function(){function d3_documentElement(node){return node&&(node.ownerDocument||node.document||node).documentElement}function d3_window(node){return node&&(node.ownerDocument&&node.ownerDocument.defaultView||node.document&&node||node.defaultView)}function d3_ascending(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}function d3_number(x){return null===x?NaN:+x}function d3_numeric(x){return!isNaN(x)}function d3_bisector(compare){return{left:function(a,x,lo,hi){for(arguments.length<3&&(lo=0),arguments.length<4&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)<0?lo=mid+1:hi=mid}return lo},right:function(a,x,lo,hi){for(arguments.length<3&&(lo=0),arguments.length<4&&(hi=a.length);lo<hi;){var mid=lo+hi>>>1;compare(a[mid],x)>0?hi=mid:lo=mid+1}return lo}}}function d3_transposeLength(d){return d.length}function d3_range_integerScale(x){for(var k=1;x*k%1;)k*=10;return k}function d3_class(ctor,properties){for(var key in properties)Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:!1})}function d3_Map(){this._=Object.create(null)}function d3_map_escape(key){return(key+="")===d3_map_proto||key[0]===d3_map_zero?d3_map_zero+key:key}function d3_map_unescape(key){return(key+="")[0]===d3_map_zero?key.slice(1):key}function d3_map_has(key){return d3_map_escape(key)in this._}function d3_map_remove(key){return(key=d3_map_escape(key))in this._&&delete this._[key]}function d3_map_keys(){var keys=[];for(var key in this._)keys.push(d3_map_unescape(key));return keys}function d3_map_size(){var size=0;for(var key in this._)++size;return size}function d3_map_empty(){for(var key in this._)return!1;return!0}function d3_Set(){this._=Object.create(null)}function d3_identity(d){return d}function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return value===source?target:value}}function d3_vendorSymbol(object,name){if(name in object)return name;name=name.charAt(0).toUpperCase()+name.slice(1);for(var i=0,n=d3_vendorPrefixes.length;i<n;++i){var prefixName=d3_vendorPrefixes[i]+name;if(prefixName in object)return prefixName}}function d3_noop(){}function d3_dispatch(){}function d3_dispatch_event(dispatch){function event(){for(var l,z=listeners,i=-1,n=z.length;++i<n;)(l=z[i].on)&&l.apply(this,arguments);return dispatch}var listeners=[],listenerByName=new d3_Map;return event.on=function(name,listener){var i,l=listenerByName.get(name);return arguments.length<2?l&&l.on:(l&&(l.on=null,listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1)),listenerByName.remove(name)),listener&&listeners.push(listenerByName.set(name,{on:listener})),dispatch)},event}function d3_eventPreventDefault(){d3.event.preventDefault()}function d3_eventSource(){for(var s,e=d3.event;s=e.sourceEvent;)e=s;return e}function d3_eventDispatch(target){for(var dispatch=new d3_dispatch,i=0,n=arguments.length;++i<n;)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target,d3.event=e1,dispatch[e1.type].apply(thiz,argumentz)}finally{d3.event=e0}}},dispatch}function d3_selection(groups){return d3_subclass(groups,d3_selectionPrototype),groups}function d3_selection_selector(selector){return"function"==typeof selector?selector:function(){return d3_select(selector,this)}}function d3_selection_selectorAll(selector){return"function"==typeof selector?selector:function(){return d3_selectAll(selector,this)}}function d3_selection_attr(name,value){function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrConstant(){this.setAttribute(name,value)}function attrConstantNS(){this.setAttributeNS(name.space,name.local,value)}function attrFunction(){var x=value.apply(this,arguments);null==x?this.removeAttribute(name):this.setAttribute(name,x)}function attrFunctionNS(){var x=value.apply(this,arguments);null==x?this.removeAttributeNS(name.space,name.local):this.setAttributeNS(name.space,name.local,x)}return name=d3.ns.qualify(name),null==value?name.local?attrNullNS:attrNull:"function"==typeof value?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant}function d3_collapse(s){return s.trim().replace(/\s+/g," ")}function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g")}function d3_selection_classes(name){return(name+"").trim().split(/^|\s+/)}function d3_selection_classed(name,value){function classedConstant(){for(var i=-1;++i<n;)name[i](this,value)}function classedFunction(){for(var i=-1,x=value.apply(this,arguments);++i<n;)name[i](this,x)}name=d3_selection_classes(name).map(d3_selection_classedName);var n=name.length;return"function"==typeof value?classedFunction:classedConstant}function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.getAttribute("class")||"";value?(re.lastIndex=0,re.test(c)||node.setAttribute("class",d3_collapse(c+" "+name))):node.setAttribute("class",d3_collapse(c.replace(re," ")))}}function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name)}function styleConstant(){this.style.setProperty(name,value,priority)}function styleFunction(){var x=value.apply(this,arguments);null==x?this.style.removeProperty(name):this.style.setProperty(name,x,priority)}return null==value?styleNull:"function"==typeof value?styleFunction:styleConstant}function d3_selection_property(name,value){function propertyNull(){delete this[name]}function propertyConstant(){this[name]=value}function propertyFunction(){var x=value.apply(this,arguments);null==x?delete this[name]:this[name]=x}return null==value?propertyNull:"function"==typeof value?propertyFunction:propertyConstant}function d3_selection_creator(name){function create(){var document=this.ownerDocument,namespace=this.namespaceURI;return namespace===d3_nsXhtml&&document.documentElement.namespaceURI===d3_nsXhtml?document.createElement(name):document.createElementNS(namespace,name)}function createNS(){return this.ownerDocument.createElementNS(name.space,name.local)}return"function"==typeof name?name:(name=d3.ns.qualify(name)).local?createNS:create}function d3_selectionRemove(){var parent=this.parentNode;parent&&parent.removeChild(this)}function d3_selection_dataNode(data){return{__data__:data}}function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector)}}function d3_selection_sortComparator(comparator){return arguments.length||(comparator=d3_ascending),function(a,b){return a&&b?comparator(a.__data__,b.__data__):!a-!b}}function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++)for(var node,group=groups[j],i=0,n=group.length;i<n;i++)(node=group[i])&&callback(node,i,j);return groups}function d3_selection_enter(selection){return d3_subclass(selection,d3_selection_enterPrototype),selection}function d3_selection_enterInsertBefore(enter){var i0,j0;return function(d,i,j){var node,group=enter[j].update,n=group.length;for(j!=j0&&(j0=j,i0=0),i>=i0&&(i0=i+1);!(node=group[i0])&&++i0<n;);return node}}function d3_selection_on(type,listener,capture){function onRemove(){var l=this[name];l&&(this.removeEventListener(type,l,l.$),delete this[name])}function onAdd(){var l=wrap(listener,d3_array(arguments));onRemove.call(this),this.addEventListener(type,this[name]=l,l.$=capture),l._=listener}function removeAll(){var match,re=new RegExp("^__on([^.]+)"+d3.requote(type)+"$");for(var name in this)if(match=name.match(re)){var l=this[name];this.removeEventListener(match[1],l,l.$),delete this[name]}}var name="__on"+type,i=type.indexOf("."),wrap=d3_selection_onListener;i>0&&(type=type.slice(0,i));var filter=d3_selection_onFilters.get(type);return filter&&(type=filter,wrap=d3_selection_onFilter),i?listener?onAdd:onRemove:listener?d3_noop:removeAll}function d3_selection_onListener(listener,argumentz){return function(e){var o=d3.event;d3.event=e,argumentz[0]=this.__data__;try{listener.apply(this,argumentz)}finally{d3.event=o}}}function d3_selection_onFilter(listener,argumentz){var l=d3_selection_onListener(listener,argumentz);return function(e){var target=this,related=e.relatedTarget;related&&(related===target||8&related.compareDocumentPosition(target))||l.call(target,e)}}function d3_event_dragSuppress(node){var name=".dragsuppress-"+ ++d3_event_dragId,click="click"+name,w=d3.select(d3_window(node)).on("touchmove"+name,d3_eventPreventDefault).on("dragstart"+name,d3_eventPreventDefault).on("selectstart"+name,d3_eventPreventDefault);if(null==d3_event_dragSelect&&(d3_event_dragSelect=!("onselectstart"in node)&&d3_vendorSymbol(node.style,"userSelect")),d3_event_dragSelect){var style=d3_documentElement(node).style,select=style[d3_event_dragSelect];style[d3_event_dragSelect]="none"}return function(suppressClick){if(w.on(name,null),d3_event_dragSelect&&(style[d3_event_dragSelect]=select),suppressClick){var off=function(){w.on(click,null)};w.on(click,function(){d3_eventPreventDefault(),off()},!0),setTimeout(off,0)}}}function d3_mousePoint(container,e){e.changedTouches&&(e=e.changedTouches[0]);var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0){var window=d3_window(container);if(window.scrollX||window.scrollY){svg=d3.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e),svg.remove()}}return d3_mouse_bug44083?(point.x=e.pageX,point.y=e.pageY):(point.x=e.clientX,point.y=e.clientY),point=point.matrixTransform(container.getScreenCTM().inverse()),[point.x,point.y]}var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop]}function d3_behavior_dragTouchId(){return d3.event.changedTouches[0].identifier}function d3_sgn(x){return x>0?1:x<0?-1:0}function d3_cross2d(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function d3_acos(x){return x>1?0:x<-1?π:Math.acos(x)}function d3_asin(x){return x>1?halfπ:x<-1?-halfπ:Math.asin(x)}function d3_sinh(x){return((x=Math.exp(x))-1/x)/2}function d3_cosh(x){return((x=Math.exp(x))+1/x)/2}function d3_tanh(x){return((x=Math.exp(2*x))-1)/(x+1)}function d3_haversin(x){return(x=Math.sin(x/2))*x}function d3_color(){}function d3_hsl(h,s,l){return this instanceof d3_hsl?(this.h=+h,this.s=+s,void(this.l=+l)):arguments.length<2?h instanceof d3_hsl?new d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):new d3_hsl(h,s,l)}function d3_hsl_rgb(h,s,l){function v(h){return h>360?h-=360:h<0&&(h+=360),h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1}function vv(h){return Math.round(255*v(h))}var m1,m2;return h=isNaN(h)?0:(h%=360)<0?h+360:h,s=isNaN(s)?0:s<0?0:s>1?1:s,l=l<0?0:l>1?1:l,m2=l<=.5?l*(1+s):l+s-l*s,m1=2*l-m2,new d3_rgb(vv(h+120),vv(h),vv(h-120))}function d3_hcl(h,c,l){return this instanceof d3_hcl?(this.h=+h,this.c=+c,void(this.l=+l)):arguments.length<2?h instanceof d3_hcl?new d3_hcl(h.h,h.c,h.l):h instanceof d3_lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):new d3_hcl(h,c,l)}function d3_hcl_lab(h,c,l){return isNaN(h)&&(h=0),isNaN(c)&&(c=0),new d3_lab(l,Math.cos(h*=d3_radians)*c,Math.sin(h)*c)}function d3_lab(l,a,b){return this instanceof d3_lab?(this.l=+l,this.a=+a,void(this.b=+b)):arguments.length<2?l instanceof d3_lab?new d3_lab(l.l,l.a,l.b):l instanceof d3_hcl?d3_hcl_lab(l.h,l.c,l.l):d3_rgb_lab((l=d3_rgb(l)).r,l.g,l.b):new d3_lab(l,a,b)}function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;return x=d3_lab_xyz(x)*d3_lab_X,y=d3_lab_xyz(y)*d3_lab_Y,z=d3_lab_xyz(z)*d3_lab_Z,new d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z))}function d3_lab_hcl(l,a,b){return l>0?new d3_hcl(Math.atan2(b,a)*d3_degrees,Math.sqrt(a*a+b*b),l):new d3_hcl(NaN,NaN,l)}function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037}function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29}function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055))}function d3_rgb(r,g,b){return this instanceof d3_rgb?(this.r=~~r,this.g=~~g,void(this.b=~~b)):arguments.length<2?r instanceof d3_rgb?new d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):new d3_rgb(r,g,b)}function d3_rgbNumber(value){return new d3_rgb(value>>16,value>>8&255,255&value)}function d3_rgbString(value){return d3_rgbNumber(value)+""}function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16)}function d3_rgb_parse(format,rgb,hsl){var m1,m2,color,r=0,g=0,b=0;if(m1=/([a-z]+)\((.*)\)/.exec(format=format.toLowerCase()))switch(m2=m1[2].split(","),m1[1]){case"hsl":return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);case"rgb":return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]))}return(color=d3_rgb_names.get(format))?rgb(color.r,color.g,color.b):(null==format||"#"!==format.charAt(0)||isNaN(color=parseInt(format.slice(1),16))||(4===format.length?(r=(3840&color)>>4,r|=r>>4,g=240&color,g|=g>>4,b=15&color,b|=b<<4):7===format.length&&(r=(16711680&color)>>16,g=(65280&color)>>8,b=255&color)),rgb(r,g,b))}function d3_rgb_hsl(r,g,b){var h,s,min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,l=(max+min)/2;return d?(s=l<.5?d/(max+min):d/(2-max-min),h=r==max?(g-b)/d+(g<b?6:0):g==max?(b-r)/d+2:(r-g)/d+4,h*=60):(h=NaN,s=l>0&&l<1?0:h),new d3_hsl(h,s,l)}function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r),g=d3_rgb_xyz(g),b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y);return d3_lab(116*y-16,500*(x-y),200*(y-d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z)))}function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function d3_rgb_parseNumber(c){var f=parseFloat(c);return"%"===c.charAt(c.length-1)?Math.round(2.55*f):f}function d3_functor(v){return"function"==typeof v?v:function(){return v}}function d3_xhrType(response){return function(url,mimeType,callback){return 2===arguments.length&&"function"==typeof mimeType&&(callback=mimeType,mimeType=null),d3_xhr(url,mimeType,response,callback)}}function d3_xhr(url,mimeType,response,callback){function respond(){var result,status=request.status;if(!status&&d3_xhrHasResponse(request)||status>=200&&status<300||304===status){try{result=response.call(xhr,request)}catch(e){return void dispatch.error.call(xhr,e)}dispatch.load.call(xhr,result)}else dispatch.error.call(xhr,request)}var xhr={},dispatch=d3.dispatch("beforesend","progress","load","error"),headers={},request=new XMLHttpRequest,responseType=null;return!this.XDomainRequest||"withCredentials"in request||!/^(http(s)?:)?\/\//.test(url)||(request=new XDomainRequest),"onload"in request?request.onload=request.onerror=respond:request.onreadystatechange=function(){request.readyState>3&&respond()},request.onprogress=function(event){var o=d3.event;d3.event=event;try{dispatch.progress.call(xhr,request)}finally{d3.event=o}},xhr.header=function(name,value){return name=(name+"").toLowerCase(),arguments.length<2?headers[name]:(null==value?delete headers[name]:headers[name]=value+"",xhr)},xhr.mimeType=function(value){return arguments.length?(mimeType=null==value?null:value+"",xhr):mimeType},xhr.responseType=function(value){return arguments.length?(responseType=value,xhr):responseType},xhr.response=function(value){return response=value,xhr},["get","post"].forEach(function(method){xhr[method]=function(){return xhr.send.apply(xhr,[method].concat(d3_array(arguments)))}}),xhr.send=function(method,data,callback){if(2===arguments.length&&"function"==typeof data&&(callback=data,data=null),request.open(method,url,!0),null==mimeType||"accept"in headers||(headers.accept=mimeType+",*/*"),request.setRequestHeader)for(var name in headers)request.setRequestHeader(name,headers[name]);return null!=mimeType&&request.overrideMimeType&&request.overrideMimeType(mimeType),null!=responseType&&(request.responseType=responseType),null!=callback&&xhr.on("error",callback).on("load",function(request){callback(null,request)}),dispatch.beforesend.call(xhr,request),request.send(null==data?null:data),xhr},xhr.abort=function(){return request.abort(),xhr},d3.rebind(xhr,dispatch,"on"),null==callback?xhr:xhr.get(d3_xhr_fixCallback(callback))}function d3_xhr_fixCallback(callback){return 1===callback.length?function(error,request){callback(null==error?request:null)}:callback}function d3_xhrHasResponse(request){var type=request.responseType;return type&&"text"!==type?request.response:request.responseText}function d3_timer(callback,delay,then){var n=arguments.length;n<2&&(delay=0),n<3&&(then=Date.now());var time=then+delay,timer={c:callback,t:time,n:null};return d3_timer_queueTail?d3_timer_queueTail.n=timer:d3_timer_queueHead=timer,d3_timer_queueTail=timer,d3_timer_interval||(d3_timer_timeout=clearTimeout(d3_timer_timeout),d3_timer_interval=1,d3_timer_frame(d3_timer_step)),timer}function d3_timer_step(){var now=d3_timer_mark(),delay=d3_timer_sweep()-now;delay>24?(isFinite(delay)&&(clearTimeout(d3_timer_timeout),d3_timer_timeout=setTimeout(d3_timer_step,delay)),d3_timer_interval=0):(d3_timer_interval=1,d3_timer_frame(d3_timer_step))}function d3_timer_mark(){for(var now=Date.now(),timer=d3_timer_queueHead;timer;)now>=timer.t&&timer.c(now-timer.t)&&(timer.c=null),timer=timer.n;return now}function d3_timer_sweep(){for(var t0,t1=d3_timer_queueHead,time=1/0;t1;)t1.c?(t1.t<time&&(time=t1.t),t1=(t0=t1).n):t1=t0?t0.n=t1.n:d3_timer_queueHead=t1.n;return d3_timer_queueTail=t0,time}function d3_format_precision(x,p){return p-(x?Math.ceil(Math.log(x)/Math.LN10):1)}function d3_formatPrefix(d,i){var k=Math.pow(10,3*abs(8-i));return{scale:i>8?function(d){return d/k}:function(d){return d*k},symbol:d}}function d3_locale_numberFormat(locale){var locale_decimal=locale.decimal,locale_thousands=locale.thousands,locale_grouping=locale.grouping,locale_currency=locale.currency,formatGroup=locale_grouping&&locale_thousands?function(value,width){for(var i=value.length,t=[],j=0,g=locale_grouping[0],length=0;i>0&&g>0&&(length+g+1>width&&(g=Math.max(1,width-length)),t.push(value.substring(i-=g,i+g)),!((length+=g+1)>width));)g=locale_grouping[j=(j+1)%locale_grouping.length];return t.reverse().join(locale_thousands)}:d3_identity;return function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"-",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=!1,exponent=!0;switch(precision&&(precision=+precision.substring(1)),(zfill||"0"===fill&&"="===align)&&(zfill=fill="0",align="="),type){case"n":comma=!0,type="g";break;case"%":scale=100,suffix="%",type="f";break;case"p":scale=100,suffix="%",type="r";break;case"b":case"o":case"x":case"X":"#"===symbol&&(prefix="0"+type.toLowerCase());case"c":exponent=!1;case"d":integer=!0,precision=0;break;case"s":scale=-1,type="r"}"$"===symbol&&(prefix=locale_currency[0],suffix=locale_currency[1]),"r"!=type||precision||(type="g"),null!=precision&&("g"==type?precision=Math.max(1,Math.min(21,precision)):"e"!=type&&"f"!=type||(precision=Math.max(0,Math.min(20,precision)))),type=d3_format_types.get(type)||d3_format_typeDefault;var zcomma=zfill&&comma;return function(value){var fullSuffix=suffix;if(integer&&value%1)return"";var negative=value<0||0===value&&1/value<0?(value=-value,"-"):"-"===sign?"":sign;if(scale<0){var unit=d3.formatPrefix(value,precision);value=unit.scale(value),fullSuffix=unit.symbol+suffix}else value*=scale;value=type(value,precision);var before,after,i=value.lastIndexOf(".");if(i<0){var j=exponent?value.lastIndexOf("e"):-1;j<0?(before=value,after=""):(before=value.substring(0,j),after=value.substring(j))}else before=value.substring(0,i),after=locale_decimal+value.substring(i+1);!zfill&&comma&&(before=formatGroup(before,1/0));var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";return zcomma&&(before=formatGroup(padding+before,padding.length?width-after.length:1/0)),negative+=prefix,value=before+after,("<"===align?negative+value+padding:">"===align?padding+negative+value:"^"===align?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix}}}function d3_format_typeDefault(x){return x+""}function d3_date_utc(){
this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1}function ceil(date){return step(date=local(new d3_date(date-1)),1),date}function offset(date,k){return step(date=new d3_date(+date),k),date}function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1)for(;time<t1;)number(time)%dt||times.push(new Date(+time)),step(time,1);else for(;time<t1;)times.push(new Date(+time)),step(time,1);return times}function range_utc(t0,t1,dt){try{d3_date=d3_date_utc;var utc=new d3_date_utc;return utc._=t0,range(utc,t1,dt)}finally{d3_date=Date}}local.floor=local,local.round=round,local.ceil=ceil,local.offset=offset,local.range=range;var utc=local.utc=d3_time_interval_utc(local);return utc.floor=utc,utc.round=d3_time_interval_utc(round),utc.ceil=d3_time_interval_utc(ceil),utc.offset=d3_time_interval_utc(offset),utc.range=range_utc,local}function d3_time_interval_utc(method){return function(date,k){try{d3_date=d3_date_utc;var utc=new d3_date_utc;return utc._=date,method(utc,k)._}finally{d3_date=Date}}}function d3_locale_timeFormat(locale){function d3_time_format(template){function format(date){for(var c,p,f,string=[],i=-1,j=0;++i<n;)37===template.charCodeAt(i)&&(string.push(template.slice(j,i)),null!=(p=d3_time_formatPads[c=template.charAt(++i)])&&(c=template.charAt(++i)),(f=d3_time_formats[c])&&(c=f(date,null==p?"e"===c?" ":"0":p)),string.push(c),j=i+1);return string.push(template.slice(j,i)),string.join("")}var n=template.length;return format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(d3_time_parse(d,template,string,0)!=string.length)return null;"p"in d&&(d.H=d.H%12+12*d.p);var localZ=null!=d.Z&&d3_date!==d3_date_utc,date=new(localZ?d3_date_utc:d3_date);return"j"in d?date.setFullYear(d.y,0,d.j):"W"in d||"U"in d?("w"in d||(d.w="W"in d?1:0),date.setFullYear(d.y,0,1),date.setFullYear(d.y,0,"W"in d?(d.w+6)%7+7*d.W-(date.getDay()+5)%7:d.w+7*d.U-(date.getDay()+6)%7)):date.setFullYear(d.y,d.m,d.d),date.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L),localZ?date._:date},format.toString=function(){return template},format}function d3_time_parse(date,template,string,j){for(var c,p,t,i=0,n=template.length,m=string.length;i<n;){if(j>=m)return-1;if(37===(c=template.charCodeAt(i++))){if(t=template.charAt(i++),!(p=d3_time_parsers[t in d3_time_formatPads?template.charAt(i++):t])||(j=p(date,string,j))<0)return-1}else if(c!=string.charCodeAt(j++))return-1}return j}function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.slice(i));return n?(date.w=d3_time_dayAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.slice(i));return n?(date.w=d3_time_dayLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.slice(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.slice(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+n[0].length):-1}function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i)}function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i)}function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i)}function d3_time_parseAmPm(date,string,i){var n=d3_time_periodLookup.get(string.slice(i,i+=2).toLowerCase());return null==n?-1:(date.p=n,i)}var locale_dateTime=locale.dateTime,locale_date=locale.date,locale_time=locale.time,locale_periods=locale.periods,locale_days=locale.days,locale_shortDays=locale.shortDays,locale_months=locale.months,locale_shortMonths=locale.shortMonths;d3_time_format.utc=function(template){function format(date){try{d3_date=d3_date_utc;var utc=new d3_date;return utc._=date,local(utc)}finally{d3_date=Date}}var local=d3_time_format(template);return format.parse=function(string){try{d3_date=d3_date_utc;var date=local.parse(string);return date&&date._}finally{d3_date=Date}},format.toString=local.toString,format},d3_time_format.multi=d3_time_format.utc.multi=d3_time_formatMulti;var d3_time_periodLookup=d3.map(),d3_time_dayRe=d3_time_formatRe(locale_days),d3_time_dayLookup=d3_time_formatLookup(locale_days),d3_time_dayAbbrevRe=d3_time_formatRe(locale_shortDays),d3_time_dayAbbrevLookup=d3_time_formatLookup(locale_shortDays),d3_time_monthRe=d3_time_formatRe(locale_months),d3_time_monthLookup=d3_time_formatLookup(locale_months),d3_time_monthAbbrevRe=d3_time_formatRe(locale_shortMonths),d3_time_monthAbbrevLookup=d3_time_formatLookup(locale_shortMonths);locale_periods.forEach(function(p,i){d3_time_periodLookup.set(p.toLowerCase(),i)});var d3_time_formats={a:function(d){return locale_shortDays[d.getDay()]},A:function(d){return locale_days[d.getDay()]},b:function(d){return locale_shortMonths[d.getMonth()]},B:function(d){return locale_months[d.getMonth()]},c:d3_time_format(locale_dateTime),d:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},e:function(d,p){return d3_time_formatPad(d.getDate(),p,2)},H:function(d,p){return d3_time_formatPad(d.getHours(),p,2)},I:function(d,p){return d3_time_formatPad(d.getHours()%12||12,p,2)},j:function(d,p){return d3_time_formatPad(1+d3_time.dayOfYear(d),p,3)},L:function(d,p){return d3_time_formatPad(d.getMilliseconds(),p,3)},m:function(d,p){return d3_time_formatPad(d.getMonth()+1,p,2)},M:function(d,p){return d3_time_formatPad(d.getMinutes(),p,2)},p:function(d){return locale_periods[+(d.getHours()>=12)]},S:function(d,p){return d3_time_formatPad(d.getSeconds(),p,2)},U:function(d,p){return d3_time_formatPad(d3_time.sundayOfYear(d),p,2)},w:function(d){return d.getDay()},W:function(d,p){return d3_time_formatPad(d3_time.mondayOfYear(d),p,2)},x:d3_time_format(locale_date),X:d3_time_format(locale_time),y:function(d,p){return d3_time_formatPad(d.getFullYear()%100,p,2)},Y:function(d,p){return d3_time_formatPad(d.getFullYear()%1e4,p,4)},Z:d3_time_zone,"%":function(){return"%"}},d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,j:d3_time_parseDayOfYear,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,U:d3_time_parseWeekNumberSunday,w:d3_time_parseWeekdayNumber,W:d3_time_parseWeekNumberMonday,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear,Z:d3_time_parseZone,"%":d3_time_parseLiteralPercent};return d3_time_format}function d3_time_formatPad(value,fill,width){var sign=value<0?"-":"",string=(sign?-value:value)+"",length=string.length;return sign+(length<width?new Array(width-length+1).join(fill)+string:string)}function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i")}function d3_time_formatLookup(names){for(var map=new d3_Map,i=-1,n=names.length;++i<n;)map.set(names[i].toLowerCase(),i);return map}function d3_time_parseWeekdayNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+1));return n?(date.w=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberSunday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.U=+n[0],i+n[0].length):-1}function d3_time_parseWeekNumberMonday(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i));return n?(date.W=+n[0],i+n[0].length):-1}function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+4));return n?(date.y=+n[0],i+n[0].length):-1}function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+n[0].length):-1}function d3_time_parseZone(date,string,i){return/^[+-]\d{4}$/.test(string=string.slice(i,i+5))?(date.Z=-string,i+5):-1}function d3_time_expandYear(d){return d+(d>68?1900:2e3)}function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.m=n[0]-1,i+n[0].length):-1}function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.d=+n[0],i+n[0].length):-1}function d3_time_parseDayOfYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.j=+n[0],i+n[0].length):-1}function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.H=+n[0],i+n[0].length):-1}function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.M=+n[0],i+n[0].length):-1}function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+2));return n?(date.S=+n[0],i+n[0].length):-1}function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.slice(i,i+3));return n?(date.L=+n[0],i+n[0].length):-1}function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=abs(z)/60|0,zm=abs(z)%60;return zs+d3_time_formatPad(zh,"0",2)+d3_time_formatPad(zm,"0",2)}function d3_time_parseLiteralPercent(date,string,i){d3_time_percentRe.lastIndex=0;var n=d3_time_percentRe.exec(string.slice(i,i+1));return n?i+n[0].length:-1}function d3_time_formatMulti(formats){for(var n=formats.length,i=-1;++i<n;)formats[i][0]=this(formats[i][0]);return function(date){for(var i=0,f=formats[i];!f[1](date);)f=formats[++i];return f[0](date)}}function d3_adder(){}function d3_adderSum(a,b,o){var x=o.s=a+b,bv=x-a,av=x-bv;o.t=a-av+(b-bv)}function d3_geo_streamGeometry(geometry,listener){geometry&&d3_geo_streamGeometryType.hasOwnProperty(geometry.type)&&d3_geo_streamGeometryType[geometry.type](geometry,listener)}function d3_geo_streamLine(coordinates,listener,closed){var coordinate,i=-1,n=coordinates.length-closed;for(listener.lineStart();++i<n;)coordinate=coordinates[i],listener.point(coordinate[0],coordinate[1],coordinate[2]);listener.lineEnd()}function d3_geo_streamPolygon(coordinates,listener){var i=-1,n=coordinates.length;for(listener.polygonStart();++i<n;)d3_geo_streamLine(coordinates[i],listener,1);listener.polygonEnd()}function d3_geo_areaRingStart(){function nextPoint(λ,φ){λ*=d3_radians,φ=φ*d3_radians/2+π/4;var dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,cosφ=Math.cos(φ),sinφ=Math.sin(φ),k=sinφ0*sinφ,u=cosφ0*cosφ+k*Math.cos(adλ),v=k*sdλ*Math.sin(adλ);d3_geo_areaRingSum.add(Math.atan2(v,u)),λ0=λ,cosφ0=cosφ,sinφ0=sinφ}var λ00,φ00,λ0,cosφ0,sinφ0;d3_geo_area.point=function(λ,φ){d3_geo_area.point=nextPoint,λ0=(λ00=λ)*d3_radians,cosφ0=Math.cos(φ=(φ00=φ)*d3_radians/2+π/4),sinφ0=Math.sin(φ)},d3_geo_area.lineEnd=function(){nextPoint(λ00,φ00)}}function d3_geo_cartesian(spherical){var λ=spherical[0],φ=spherical[1],cosφ=Math.cos(φ);return[cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ)]}function d3_geo_cartesianDot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function d3_geo_cartesianCross(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function d3_geo_cartesianAdd(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function d3_geo_cartesianScale(vector,k){return[vector[0]*k,vector[1]*k,vector[2]*k]}function d3_geo_cartesianNormalize(d){var l=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);d[0]/=l,d[1]/=l,d[2]/=l}function d3_geo_spherical(cartesian){return[Math.atan2(cartesian[1],cartesian[0]),d3_asin(cartesian[2])]}function d3_geo_sphericalEqual(a,b){return abs(a[0]-b[0])<ε&&abs(a[1]-b[1])<ε}function d3_geo_centroidPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);d3_geo_centroidPointXYZ(cosφ*Math.cos(λ),cosφ*Math.sin(λ),Math.sin(φ))}function d3_geo_centroidPointXYZ(x,y,z){++d3_geo_centroidW0,d3_geo_centroidX0+=(x-d3_geo_centroidX0)/d3_geo_centroidW0,d3_geo_centroidY0+=(y-d3_geo_centroidY0)/d3_geo_centroidW0,d3_geo_centroidZ0+=(z-d3_geo_centroidZ0)/d3_geo_centroidW0}function d3_geo_centroidLineStart(){function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),w=Math.atan2(Math.sqrt((w=y0*z-z0*y)*w+(w=z0*x-x0*z)*w+(w=x0*y-y0*x)*w),x0*x+y0*y+z0*z);d3_geo_centroidW1+=w,d3_geo_centroidX1+=w*(x0+(x0=x)),d3_geo_centroidY1+=w*(y0+(y0=y)),d3_geo_centroidZ1+=w*(z0+(z0=z)),d3_geo_centroidPointXYZ(x0,y0,z0)}var x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ),y0=cosφ*Math.sin(λ),z0=Math.sin(φ),d3_geo_centroid.point=nextPoint,d3_geo_centroidPointXYZ(x0,y0,z0)}}function d3_geo_centroidLineEnd(){d3_geo_centroid.point=d3_geo_centroidPoint}function d3_geo_centroidRingStart(){function nextPoint(λ,φ){λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians),x=cosφ*Math.cos(λ),y=cosφ*Math.sin(λ),z=Math.sin(φ),cx=y0*z-z0*y,cy=z0*x-x0*z,cz=x0*y-y0*x,m=Math.sqrt(cx*cx+cy*cy+cz*cz),u=x0*x+y0*y+z0*z,v=m&&-d3_acos(u)/m,w=Math.atan2(m,u);d3_geo_centroidX2+=v*cx,d3_geo_centroidY2+=v*cy,d3_geo_centroidZ2+=v*cz,d3_geo_centroidW1+=w,d3_geo_centroidX1+=w*(x0+(x0=x)),d3_geo_centroidY1+=w*(y0+(y0=y)),d3_geo_centroidZ1+=w*(z0+(z0=z)),d3_geo_centroidPointXYZ(x0,y0,z0)}var λ00,φ00,x0,y0,z0;d3_geo_centroid.point=function(λ,φ){λ00=λ,φ00=φ,d3_geo_centroid.point=nextPoint,λ*=d3_radians;var cosφ=Math.cos(φ*=d3_radians);x0=cosφ*Math.cos(λ),y0=cosφ*Math.sin(λ),z0=Math.sin(φ),d3_geo_centroidPointXYZ(x0,y0,z0)},d3_geo_centroid.lineEnd=function(){nextPoint(λ00,φ00),d3_geo_centroid.lineEnd=d3_geo_centroidLineEnd,d3_geo_centroid.point=d3_geo_centroidPoint}}function d3_geo_compose(a,b){function compose(x,y){return x=a(x,y),b(x[0],x[1])}return a.invert&&b.invert&&(compose.invert=function(x,y){return(x=b.invert(x,y))&&a.invert(x[0],x[1])}),compose}function d3_true(){return!0}function d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener){var subject=[],clip=[];if(segments.forEach(function(segment){if(!((n=segment.length-1)<=0)){var n,p0=segment[0],p1=segment[n];if(d3_geo_sphericalEqual(p0,p1)){listener.lineStart();for(var i=0;i<n;++i)listener.point((p0=segment[i])[0],p0[1]);return void listener.lineEnd()}var a=new d3_geo_clipPolygonIntersection(p0,segment,null,!0),b=new d3_geo_clipPolygonIntersection(p0,null,a,!1);a.o=b,subject.push(a),clip.push(b),a=new d3_geo_clipPolygonIntersection(p1,segment,null,!1),b=new d3_geo_clipPolygonIntersection(p1,null,a,!0),a.o=b,subject.push(a),clip.push(b)}}),clip.sort(compare),d3_geo_clipPolygonLinkCircular(subject),d3_geo_clipPolygonLinkCircular(clip),subject.length){for(var i=0,entry=clipStartInside,n=clip.length;i<n;++i)clip[i].e=entry=!entry;for(var points,point,start=subject[0];;){for(var current=start,isSubject=!0;current.v;)if((current=current.n)===start)return;points=current.z,listener.lineStart();do{if(current.v=current.o.v=!0,current.e){if(isSubject)for(var i=0,n=points.length;i<n;++i)listener.point((point=points[i])[0],point[1]);else interpolate(current.x,current.n.x,1,listener);current=current.n}else{if(isSubject){points=current.p.z;for(var i=points.length-1;i>=0;--i)listener.point((point=points[i])[0],point[1])}else interpolate(current.x,current.p.x,-1,listener);current=current.p}current=current.o,points=current.z,isSubject=!isSubject}while(!current.v);listener.lineEnd()}}}function d3_geo_clipPolygonLinkCircular(array){if(n=array.length){for(var n,b,i=0,a=array[0];++i<n;)a.n=b=array[i],b.p=a,a=b;a.n=b=array[0],b.p=a}}function d3_geo_clipPolygonIntersection(point,points,other,entry){this.x=point,this.z=points,this.o=other,this.e=entry,this.v=!1,this.n=this.p=null}function d3_geo_clip(pointVisible,clipLine,interpolate,clipStart){return function(rotate,listener){function point(λ,φ){var point=rotate(λ,φ);pointVisible(λ=point[0],φ=point[1])&&listener.point(λ,φ)}function pointLine(λ,φ){var point=rotate(λ,φ);line.point(point[0],point[1])}function lineStart(){clip.point=pointLine,line.lineStart()}function lineEnd(){clip.point=point,line.lineEnd()}function pointRing(λ,φ){ring.push([λ,φ]);var point=rotate(λ,φ);ringListener.point(point[0],point[1])}function ringStart(){ringListener.lineStart(),ring=[]}function ringEnd(){pointRing(ring[0][0],ring[0][1]),ringListener.lineEnd();var segment,clean=ringListener.clean(),ringSegments=buffer.buffer(),n=ringSegments.length;if(ring.pop(),polygon.push(ring),ring=null,n)if(1&clean){segment=ringSegments[0];var point,n=segment.length-1,i=-1;if(n>0){for(polygonStarted||(listener.polygonStart(),polygonStarted=!0),listener.lineStart();++i<n;)listener.point((point=segment[i])[0],point[1]);listener.lineEnd()}}else n>1&&2&clean&&ringSegments.push(ringSegments.pop().concat(ringSegments.shift())),segments.push(ringSegments.filter(d3_geo_clipSegmentLength1))}var segments,polygon,ring,line=clipLine(listener),rotatedClipStart=rotate.invert(clipStart[0],clipStart[1]),clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){clip.point=pointRing,clip.lineStart=ringStart,clip.lineEnd=ringEnd,segments=[],polygon=[]},polygonEnd:function(){clip.point=point,clip.lineStart=lineStart,clip.lineEnd=lineEnd,segments=d3.merge(segments);var clipStartInside=d3_geo_pointInPolygon(rotatedClipStart,polygon);segments.length?(polygonStarted||(listener.polygonStart(),polygonStarted=!0),d3_geo_clipPolygon(segments,d3_geo_clipSort,clipStartInside,interpolate,listener)):clipStartInside&&(polygonStarted||(listener.polygonStart(),polygonStarted=!0),listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd()),polygonStarted&&(listener.polygonEnd(),polygonStarted=!1),segments=polygon=null},sphere:function(){listener.polygonStart(),listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd(),listener.polygonEnd()}},buffer=d3_geo_clipBufferListener(),ringListener=clipLine(buffer),polygonStarted=!1;return clip}}function d3_geo_clipSegmentLength1(segment){return segment.length>1}function d3_geo_clipBufferListener(){var line,lines=[];return{lineStart:function(){lines.push(line=[])},point:function(λ,φ){line.push([λ,φ])},lineEnd:d3_noop,buffer:function(){var buffer=lines;return lines=[],line=null,buffer},rejoin:function(){lines.length>1&&lines.push(lines.pop().concat(lines.shift()))}}}function d3_geo_clipSort(a,b){return((a=a.x)[0]<0?a[1]-halfπ-ε:halfπ-a[1])-((b=b.x)[0]<0?b[1]-halfπ-ε:halfπ-b[1])}function d3_geo_clipAntimeridianLine(listener){var clean,λ0=NaN,φ0=NaN,sλ0=NaN;return{lineStart:function(){listener.lineStart(),clean=1},point:function(λ1,φ1){var sλ1=λ1>0?π:-π,dλ=abs(λ1-λ0);abs(dλ-π)<ε?(listener.point(λ0,φ0=(φ0+φ1)/2>0?halfπ:-halfπ),listener.point(sλ0,φ0),listener.lineEnd(),listener.lineStart(),listener.point(sλ1,φ0),listener.point(λ1,φ0),clean=0):sλ0!==sλ1&&dλ>=π&&(abs(λ0-sλ0)<ε&&(λ0-=sλ0*ε),abs(λ1-sλ1)<ε&&(λ1-=sλ1*ε),φ0=d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1),listener.point(sλ0,φ0),listener.lineEnd(),listener.lineStart(),listener.point(sλ1,φ0),clean=0),listener.point(λ0=λ1,φ0=φ1),sλ0=sλ1},lineEnd:function(){listener.lineEnd(),λ0=φ0=NaN},clean:function(){return 2-clean}}}function d3_geo_clipAntimeridianIntersect(λ0,φ0,λ1,φ1){var cosφ0,cosφ1,sinλ0_λ1=Math.sin(λ0-λ1);return abs(sinλ0_λ1)>ε?Math.atan((Math.sin(φ0)*(cosφ1=Math.cos(φ1))*Math.sin(λ1)-Math.sin(φ1)*(cosφ0=Math.cos(φ0))*Math.sin(λ0))/(cosφ0*cosφ1*sinλ0_λ1)):(φ0+φ1)/2}function d3_geo_clipAntimeridianInterpolate(from,to,direction,listener){var φ;if(null==from)φ=direction*halfπ,listener.point(-π,φ),listener.point(0,φ),listener.point(π,φ),listener.point(π,0),listener.point(π,-φ),listener.point(0,-φ),listener.point(-π,-φ),listener.point(-π,0),listener.point(-π,φ);else if(abs(from[0]-to[0])>ε){var s=from[0]<to[0]?π:-π;φ=direction*s/2,listener.point(-s,φ),listener.point(0,φ),listener.point(s,φ)}else listener.point(to[0],to[1])}function d3_geo_pointInPolygon(point,polygon){var meridian=point[0],parallel=point[1],meridianNormal=[Math.sin(meridian),-Math.cos(meridian),0],polarAngle=0,winding=0;d3_geo_areaRingSum.reset();for(var i=0,n=polygon.length;i<n;++i){var ring=polygon[i],m=ring.length;if(m)for(var point0=ring[0],λ0=point0[0],φ0=point0[1]/2+π/4,sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),j=1;;){j===m&&(j=0),point=ring[j];var λ=point[0],φ=point[1]/2+π/4,sinφ=Math.sin(φ),cosφ=Math.cos(φ),dλ=λ-λ0,sdλ=dλ>=0?1:-1,adλ=sdλ*dλ,antimeridian=adλ>π,k=sinφ0*sinφ;if(d3_geo_areaRingSum.add(Math.atan2(k*sdλ*Math.sin(adλ),cosφ0*cosφ+k*Math.cos(adλ))),polarAngle+=antimeridian?dλ+sdλ*τ:dλ,antimeridian^λ0>=meridian^λ>=meridian){var arc=d3_geo_cartesianCross(d3_geo_cartesian(point0),d3_geo_cartesian(point));d3_geo_cartesianNormalize(arc);var intersection=d3_geo_cartesianCross(meridianNormal,arc);d3_geo_cartesianNormalize(intersection);var φarc=(antimeridian^dλ>=0?-1:1)*d3_asin(intersection[2]);(parallel>φarc||parallel===φarc&&(arc[0]||arc[1]))&&(winding+=antimeridian^dλ>=0?1:-1)}if(!j++)break;λ0=λ,sinφ0=sinφ,cosφ0=cosφ,point0=point}}return(polarAngle<-ε||polarAngle<ε&&d3_geo_areaRingSum<-ε)^1&winding}function d3_geo_clipCircle(radius){function visible(λ,φ){return Math.cos(λ)*Math.cos(φ)>cr}function clipLine(listener){var point0,c0,v0,v00,clean;return{lineStart:function(){v00=v0=!1,clean=1},point:function(λ,φ){var point2,point1=[λ,φ],v=visible(λ,φ),c=smallRadius?v?0:code(λ,φ):v?code(λ+(λ<0?π:-π),φ):0;if(!point0&&(v00=v0=v)&&listener.lineStart(),v!==v0&&(point2=intersect(point0,point1),(d3_geo_sphericalEqual(point0,point2)||d3_geo_sphericalEqual(point1,point2))&&(point1[0]+=ε,point1[1]+=ε,v=visible(point1[0],point1[1]))),v!==v0)clean=0,v?(listener.lineStart(),point2=intersect(point1,point0),listener.point(point2[0],point2[1])):(point2=intersect(point0,point1),listener.point(point2[0],point2[1]),listener.lineEnd()),point0=point2;else if(notHemisphere&&point0&&smallRadius^v){var t;c&c0||!(t=intersect(point1,point0,!0))||(clean=0,smallRadius?(listener.lineStart(),listener.point(t[0][0],t[0][1]),listener.point(t[1][0],t[1][1]),listener.lineEnd()):(listener.point(t[1][0],t[1][1]),listener.lineEnd(),listener.lineStart(),listener.point(t[0][0],t[0][1])))}!v||point0&&d3_geo_sphericalEqual(point0,point1)||listener.point(point1[0],point1[1]),point0=point1,v0=v,c0=c},lineEnd:function(){v0&&listener.lineEnd(),point0=null},clean:function(){return clean|(v00&&v0)<<1}}}function intersect(a,b,two){var pa=d3_geo_cartesian(a),pb=d3_geo_cartesian(b),n1=[1,0,0],n2=d3_geo_cartesianCross(pa,pb),n2n2=d3_geo_cartesianDot(n2,n2),n1n2=n2[0],determinant=n2n2-n1n2*n1n2;if(!determinant)return!two&&a;var c1=cr*n2n2/determinant,c2=-cr*n1n2/determinant,n1xn2=d3_geo_cartesianCross(n1,n2),A=d3_geo_cartesianScale(n1,c1);d3_geo_cartesianAdd(A,d3_geo_cartesianScale(n2,c2));var u=n1xn2,w=d3_geo_cartesianDot(A,u),uu=d3_geo_cartesianDot(u,u),t2=w*w-uu*(d3_geo_cartesianDot(A,A)-1);if(!(t2<0)){var t=Math.sqrt(t2),q=d3_geo_cartesianScale(u,(-w-t)/uu);if(d3_geo_cartesianAdd(q,A),q=d3_geo_spherical(q),!two)return q;var z,λ0=a[0],λ1=b[0],φ0=a[1],φ1=b[1];λ1<λ0&&(z=λ0,λ0=λ1,λ1=z);var δλ=λ1-λ0,polar=abs(δλ-π)<ε,meridian=polar||δλ<ε;if(!polar&&φ1<φ0&&(z=φ0,φ0=φ1,φ1=z),meridian?polar?φ0+φ1>0^q[1]<(abs(q[0]-λ0)<ε?φ0:φ1):φ0<=q[1]&&q[1]<=φ1:δλ>π^(λ0<=q[0]&&q[0]<=λ1)){var q1=d3_geo_cartesianScale(u,(-w+t)/uu);return d3_geo_cartesianAdd(q1,A),[q,d3_geo_spherical(q1)]}}}function code(λ,φ){var r=smallRadius?radius:π-radius,code=0;return λ<-r?code|=1:λ>r&&(code|=2),φ<-r?code|=4:φ>r&&(code|=8),code}var cr=Math.cos(radius),smallRadius=cr>0,notHemisphere=abs(cr)>ε;return d3_geo_clip(visible,clipLine,d3_geo_circleInterpolate(radius,6*d3_radians),smallRadius?[0,-radius]:[-π,radius-π])}function d3_geom_clipLine(x0,y0,x1,y1){return function(line){var r,a=line.a,b=line.b,ax=a.x,ay=a.y,bx=b.x,by=b.y,t0=0,t1=1,dx=bx-ax,dy=by-ay;if(r=x0-ax,dx||!(r>0)){if(r/=dx,dx<0){if(r<t0)return;r<t1&&(t1=r)}else if(dx>0){if(r>t1)return;r>t0&&(t0=r)}if(r=x1-ax,dx||!(r<0)){if(r/=dx,dx<0){if(r>t1)return;r>t0&&(t0=r)}else if(dx>0){if(r<t0)return;r<t1&&(t1=r)}if(r=y0-ay,dy||!(r>0)){if(r/=dy,dy<0){if(r<t0)return;r<t1&&(t1=r)}else if(dy>0){if(r>t1)return;r>t0&&(t0=r)}if(r=y1-ay,dy||!(r<0)){if(r/=dy,dy<0){if(r>t1)return;r>t0&&(t0=r)}else if(dy>0){if(r<t0)return;r<t1&&(t1=r)}return t0>0&&(line.a={x:ax+t0*dx,y:ay+t0*dy}),t1<1&&(line.b={x:ax+t1*dx,y:ay+t1*dy}),line}}}}}}function d3_geo_clipExtent(x0,y0,x1,y1){function corner(p,direction){return abs(p[0]-x0)<ε?direction>0?0:3:abs(p[0]-x1)<ε?direction>0?2:1:abs(p[1]-y0)<ε?direction>0?1:0:direction>0?3:2}function compare(a,b){return comparePoints(a.x,b.x)}function comparePoints(a,b){var ca=corner(a,1),cb=corner(b,1);return ca!==cb?ca-cb:0===ca?b[1]-a[1]:1===ca?a[0]-b[0]:2===ca?a[1]-b[1]:b[0]-a[0]}return function(listener){function insidePolygon(p){for(var wn=0,n=polygon.length,y=p[1],i=0;i<n;++i)for(var b,j=1,v=polygon[i],m=v.length,a=v[0];j<m;++j)b=v[j],a[1]<=y?b[1]>y&&d3_cross2d(a,b,p)>0&&++wn:b[1]<=y&&d3_cross2d(a,b,p)<0&&--wn,a=b;return 0!==wn}function interpolate(from,to,direction,listener){var a=0,a1=0;if(null==from||(a=corner(from,direction))!==(a1=corner(to,direction))||comparePoints(from,to)<0^direction>0)do{listener.point(0===a||3===a?x0:x1,a>1?y1:y0)}while((a=(a+direction+4)%4)!==a1);else listener.point(to[0],to[1])}function pointVisible(x,y){return x0<=x&&x<=x1&&y0<=y&&y<=y1}function point(x,y){pointVisible(x,y)&&listener.point(x,y)}function lineStart(){clip.point=linePoint,polygon&&polygon.push(ring=[]),first=!0,v_=!1,x_=y_=NaN}function lineEnd(){segments&&(linePoint(x__,y__),v__&&v_&&bufferListener.rejoin(),segments.push(bufferListener.buffer())),clip.point=point,v_&&listener.lineEnd()}function linePoint(x,y){x=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,x)),y=Math.max(-d3_geo_clipExtentMAX,Math.min(d3_geo_clipExtentMAX,y));var v=pointVisible(x,y);if(polygon&&ring.push([x,y]),first)x__=x,y__=y,v__=v,first=!1,v&&(listener.lineStart(),listener.point(x,y));else if(v&&v_)listener.point(x,y);else{var l={a:{x:x_,y:y_},b:{x:x,y:y}};clipLine(l)?(v_||(listener.lineStart(),listener.point(l.a.x,l.a.y)),listener.point(l.b.x,l.b.y),v||listener.lineEnd(),clean=!1):v&&(listener.lineStart(),listener.point(x,y),clean=!1)}x_=x,y_=y,v_=v}var segments,polygon,ring,x__,y__,v__,x_,y_,v_,first,clean,listener_=listener,bufferListener=d3_geo_clipBufferListener(),clipLine=d3_geom_clipLine(x0,y0,x1,y1),clip={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){listener=bufferListener,segments=[],polygon=[],clean=!0},polygonEnd:function(){listener=listener_,segments=d3.merge(segments);var clipStartInside=insidePolygon([x0,y1]),inside=clean&&clipStartInside,visible=segments.length;(inside||visible)&&(listener.polygonStart(),inside&&(listener.lineStart(),interpolate(null,null,1,listener),listener.lineEnd()),visible&&d3_geo_clipPolygon(segments,compare,clipStartInside,interpolate,listener),listener.polygonEnd()),segments=polygon=ring=null}};return clip}}function d3_geo_conic(projectAt){var φ0=0,φ1=π/3,m=d3_geo_projectionMutator(projectAt),p=m(φ0,φ1);return p.parallels=function(_){return arguments.length?m(φ0=_[0]*π/180,φ1=_[1]*π/180):[φ0/π*180,φ1/π*180]},p}function d3_geo_conicEqualArea(φ0,φ1){function forward(λ,φ){var ρ=Math.sqrt(C-2*n*Math.sin(φ))/n;return[ρ*Math.sin(λ*=n),ρ0-ρ*Math.cos(λ)]}var sinφ0=Math.sin(φ0),n=(sinφ0+Math.sin(φ1))/2,C=1+sinφ0*(2*n-sinφ0),ρ0=Math.sqrt(C)/n;return forward.invert=function(x,y){var ρ0_y=ρ0-y;return[Math.atan2(x,ρ0_y)/n,d3_asin((C-(x*x+ρ0_y*ρ0_y)*n*n)/(2*n))]},forward}function d3_geo_pathAreaRingStart(){function nextPoint(x,y){d3_geo_pathAreaPolygon+=y0*x-x0*y,x0=x,y0=y}var x00,y00,x0,y0;d3_geo_pathArea.point=function(x,y){d3_geo_pathArea.point=nextPoint,x00=x0=x,y00=y0=y},d3_geo_pathArea.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathBoundsPoint(x,y){x<d3_geo_pathBoundsX0&&(d3_geo_pathBoundsX0=x),x>d3_geo_pathBoundsX1&&(d3_geo_pathBoundsX1=x),y<d3_geo_pathBoundsY0&&(d3_geo_pathBoundsY0=y),y>d3_geo_pathBoundsY1&&(d3_geo_pathBoundsY1=y)}function d3_geo_pathBuffer(){function point(x,y){buffer.push("M",x,",",y,pointCircle)}function pointLineStart(x,y){buffer.push("M",x,",",y),stream.point=pointLine}function pointLine(x,y){buffer.push("L",x,",",y)}function lineEnd(){stream.point=point}function lineEndPolygon(){buffer.push("Z")}var pointCircle=d3_geo_pathBufferCircle(4.5),buffer=[],stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd,stream.point=point},pointRadius:function(_){return pointCircle=d3_geo_pathBufferCircle(_),stream},result:function(){if(buffer.length){var result=buffer.join("");return buffer=[],result}}};return stream}function d3_geo_pathBufferCircle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+2*radius+"z"}function d3_geo_pathCentroidPoint(x,y){d3_geo_centroidX0+=x,d3_geo_centroidY0+=y,++d3_geo_centroidZ0}function d3_geo_pathCentroidLineStart(){function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2,d3_geo_centroidY1+=z*(y0+y)/2,d3_geo_centroidZ1+=z,d3_geo_pathCentroidPoint(x0=x,y0=y)}var x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint,d3_geo_pathCentroidPoint(x0=x,y0=y)}}function d3_geo_pathCentroidLineEnd(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint}function d3_geo_pathCentroidRingStart(){function nextPoint(x,y){var dx=x-x0,dy=y-y0,z=Math.sqrt(dx*dx+dy*dy);d3_geo_centroidX1+=z*(x0+x)/2,d3_geo_centroidY1+=z*(y0+y)/2,d3_geo_centroidZ1+=z,z=y0*x-x0*y,d3_geo_centroidX2+=z*(x0+x),d3_geo_centroidY2+=z*(y0+y),d3_geo_centroidZ2+=3*z,d3_geo_pathCentroidPoint(x0=x,y0=y)}var x00,y00,x0,y0;d3_geo_pathCentroid.point=function(x,y){d3_geo_pathCentroid.point=nextPoint,d3_geo_pathCentroidPoint(x00=x0=x,y00=y0=y)},d3_geo_pathCentroid.lineEnd=function(){nextPoint(x00,y00)}}function d3_geo_pathContext(context){function point(x,y){context.moveTo(x+pointRadius,y),context.arc(x,y,pointRadius,0,τ)}function pointLineStart(x,y){context.moveTo(x,y),stream.point=pointLine}function pointLine(x,y){context.lineTo(x,y)}function lineEnd(){stream.point=point}function lineEndPolygon(){context.closePath()}var pointRadius=4.5,stream={point:point,lineStart:function(){stream.point=pointLineStart},lineEnd:lineEnd,polygonStart:function(){stream.lineEnd=lineEndPolygon},polygonEnd:function(){stream.lineEnd=lineEnd,stream.point=point},pointRadius:function(_){return pointRadius=_,stream},result:d3_noop};return stream}function d3_geo_resample(project){function resample(stream){return(maxDepth?resampleRecursive:resampleNone)(stream)}function resampleNone(stream){return d3_geo_transformPoint(stream,function(x,y){x=project(x,y),stream.point(x[0],x[1])})}function resampleRecursive(stream){function point(x,y){x=project(x,y),stream.point(x[0],x[1])}function lineStart(){x0=NaN,resample.point=linePoint,stream.lineStart()}function linePoint(λ,φ){var c=d3_geo_cartesian([λ,φ]),p=project(λ,φ);resampleLineTo(x0,y0,λ0,a0,b0,c0,x0=p[0],y0=p[1],λ0=λ,a0=c[0],b0=c[1],c0=c[2],maxDepth,stream),stream.point(x0,y0)}function lineEnd(){resample.point=point,stream.lineEnd()}function ringStart(){lineStart(),resample.point=ringPoint,resample.lineEnd=ringEnd}function ringPoint(λ,φ){linePoint(λ00=λ,φ00=φ),x00=x0,y00=y0,a00=a0,b00=b0,c00=c0,resample.point=linePoint}function ringEnd(){resampleLineTo(x0,y0,λ0,a0,b0,c0,x00,y00,λ00,a00,b00,c00,maxDepth,stream),resample.lineEnd=lineEnd,lineEnd()}var λ00,φ00,x00,y00,a00,b00,c00,λ0,x0,y0,a0,b0,c0,resample={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){stream.polygonStart(),
resample.lineStart=ringStart},polygonEnd:function(){stream.polygonEnd(),resample.lineStart=lineStart}};return resample}function resampleLineTo(x0,y0,λ0,a0,b0,c0,x1,y1,λ1,a1,b1,c1,depth,stream){var dx=x1-x0,dy=y1-y0,d2=dx*dx+dy*dy;if(d2>4*δ2&&depth--){var a=a0+a1,b=b0+b1,c=c0+c1,m=Math.sqrt(a*a+b*b+c*c),φ2=Math.asin(c/=m),λ2=abs(abs(c)-1)<ε||abs(λ0-λ1)<ε?(λ0+λ1)/2:Math.atan2(b,a),p=project(λ2,φ2),x2=p[0],y2=p[1],dx2=x2-x0,dy2=y2-y0,dz=dy*dx2-dx*dy2;(dz*dz/d2>δ2||abs((dx*dx2+dy*dy2)/d2-.5)>.3||a0*a1+b0*b1+c0*c1<cosMinDistance)&&(resampleLineTo(x0,y0,λ0,a0,b0,c0,x2,y2,λ2,a/=m,b/=m,c,depth,stream),stream.point(x2,y2),resampleLineTo(x2,y2,λ2,a,b,c,x1,y1,λ1,a1,b1,c1,depth,stream))}}var δ2=.5,cosMinDistance=Math.cos(30*d3_radians),maxDepth=16;return resample.precision=function(_){return arguments.length?(maxDepth=(δ2=_*_)>0&&16,resample):Math.sqrt(δ2)},resample}function d3_geo_pathProjectStream(project){var resample=d3_geo_resample(function(x,y){return project([x*d3_degrees,y*d3_degrees])});return function(stream){return d3_geo_projectionRadians(resample(stream))}}function d3_geo_transform(stream){this.stream=stream}function d3_geo_transformPoint(stream,point){return{point:point,sphere:function(){stream.sphere()},lineStart:function(){stream.lineStart()},lineEnd:function(){stream.lineEnd()},polygonStart:function(){stream.polygonStart()},polygonEnd:function(){stream.polygonEnd()}}}function d3_geo_projection(project){return d3_geo_projectionMutator(function(){return project})()}function d3_geo_projectionMutator(projectAt){function projection(point){return point=projectRotate(point[0]*d3_radians,point[1]*d3_radians),[point[0]*k+δx,δy-point[1]*k]}function invert(point){return(point=projectRotate.invert((point[0]-δx)/k,(δy-point[1])/k))&&[point[0]*d3_degrees,point[1]*d3_degrees]}function reset(){projectRotate=d3_geo_compose(rotate=d3_geo_rotation(δλ,δφ,δγ),project);var center=project(λ,φ);return δx=x-center[0]*k,δy=y+center[1]*k,invalidate()}function invalidate(){return stream&&(stream.valid=!1,stream=null),projection}var project,rotate,projectRotate,δx,δy,stream,projectResample=d3_geo_resample(function(x,y){return x=project(x,y),[x[0]*k+δx,δy-x[1]*k]}),k=150,x=480,y=250,λ=0,φ=0,δλ=0,δφ=0,δγ=0,preclip=d3_geo_clipAntimeridian,postclip=d3_identity,clipAngle=null,clipExtent=null;return projection.stream=function(output){return stream&&(stream.valid=!1),stream=d3_geo_projectionRadians(preclip(rotate,projectResample(postclip(output)))),stream.valid=!0,stream},projection.clipAngle=function(_){return arguments.length?(preclip=null==_?(clipAngle=_,d3_geo_clipAntimeridian):d3_geo_clipCircle((clipAngle=+_)*d3_radians),invalidate()):clipAngle},projection.clipExtent=function(_){return arguments.length?(clipExtent=_,postclip=_?d3_geo_clipExtent(_[0][0],_[0][1],_[1][0],_[1][1]):d3_identity,invalidate()):clipExtent},projection.scale=function(_){return arguments.length?(k=+_,reset()):k},projection.translate=function(_){return arguments.length?(x=+_[0],y=+_[1],reset()):[x,y]},projection.center=function(_){return arguments.length?(λ=_[0]%360*d3_radians,φ=_[1]%360*d3_radians,reset()):[λ*d3_degrees,φ*d3_degrees]},projection.rotate=function(_){return arguments.length?(δλ=_[0]%360*d3_radians,δφ=_[1]%360*d3_radians,δγ=_.length>2?_[2]%360*d3_radians:0,reset()):[δλ*d3_degrees,δφ*d3_degrees,δγ*d3_degrees]},d3.rebind(projection,projectResample,"precision"),function(){return project=projectAt.apply(this,arguments),projection.invert=project.invert&&invert,reset()}}function d3_geo_projectionRadians(stream){return d3_geo_transformPoint(stream,function(x,y){stream.point(x*d3_radians,y*d3_radians)})}function d3_geo_equirectangular(λ,φ){return[λ,φ]}function d3_geo_identityRotation(λ,φ){return[λ>π?λ-τ:λ<-π?λ+τ:λ,φ]}function d3_geo_rotation(δλ,δφ,δγ){return δλ?δφ||δγ?d3_geo_compose(d3_geo_rotationλ(δλ),d3_geo_rotationφγ(δφ,δγ)):d3_geo_rotationλ(δλ):δφ||δγ?d3_geo_rotationφγ(δφ,δγ):d3_geo_identityRotation}function d3_geo_forwardRotationλ(δλ){return function(λ,φ){return λ+=δλ,[λ>π?λ-τ:λ<-π?λ+τ:λ,φ]}}function d3_geo_rotationλ(δλ){var rotation=d3_geo_forwardRotationλ(δλ);return rotation.invert=d3_geo_forwardRotationλ(-δλ),rotation}function d3_geo_rotationφγ(δφ,δγ){function rotation(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδφ+x*sinδφ;return[Math.atan2(y*cosδγ-k*sinδγ,x*cosδφ-z*sinδφ),d3_asin(k*cosδγ+y*sinδγ)]}var cosδφ=Math.cos(δφ),sinδφ=Math.sin(δφ),cosδγ=Math.cos(δγ),sinδγ=Math.sin(δγ);return rotation.invert=function(λ,φ){var cosφ=Math.cos(φ),x=Math.cos(λ)*cosφ,y=Math.sin(λ)*cosφ,z=Math.sin(φ),k=z*cosδγ-y*sinδγ;return[Math.atan2(y*cosδγ+z*sinδγ,x*cosδφ+k*sinδφ),d3_asin(k*cosδφ-x*sinδφ)]},rotation}function d3_geo_circleInterpolate(radius,precision){var cr=Math.cos(radius),sr=Math.sin(radius);return function(from,to,direction,listener){var step=direction*precision;null!=from?(from=d3_geo_circleAngle(cr,from),to=d3_geo_circleAngle(cr,to),(direction>0?from<to:from>to)&&(from+=direction*τ)):(from=radius+direction*τ,to=radius-.5*step);for(var point,t=from;direction>0?t>to:t<to;t-=step)listener.point((point=d3_geo_spherical([cr,-sr*Math.cos(t),-sr*Math.sin(t)]))[0],point[1])}}function d3_geo_circleAngle(cr,point){var a=d3_geo_cartesian(point);a[0]-=cr,d3_geo_cartesianNormalize(a);var angle=d3_acos(-a[1]);return((-a[2]<0?-angle:angle)+2*Math.PI-ε)%(2*Math.PI)}function d3_geo_graticuleX(y0,y1,dy){var y=d3.range(y0,y1-ε,dy).concat(y1);return function(x){return y.map(function(y){return[x,y]})}}function d3_geo_graticuleY(x0,x1,dx){var x=d3.range(x0,x1-ε,dx).concat(x1);return function(y){return x.map(function(x){return[x,y]})}}function d3_source(d){return d.source}function d3_target(d){return d.target}function d3_geo_interpolate(x0,y0,x1,y1){var cy0=Math.cos(y0),sy0=Math.sin(y0),cy1=Math.cos(y1),sy1=Math.sin(y1),kx0=cy0*Math.cos(x0),ky0=cy0*Math.sin(x0),kx1=cy1*Math.cos(x1),ky1=cy1*Math.sin(x1),d=2*Math.asin(Math.sqrt(d3_haversin(y1-y0)+cy0*cy1*d3_haversin(x1-x0))),k=1/Math.sin(d),interpolate=d?function(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)*d3_degrees,Math.atan2(z,Math.sqrt(x*x+y*y))*d3_degrees]}:function(){return[x0*d3_degrees,y0*d3_degrees]};return interpolate.distance=d,interpolate}function d3_geo_lengthLineStart(){function nextPoint(λ,φ){var sinφ=Math.sin(φ*=d3_radians),cosφ=Math.cos(φ),t=abs((λ*=d3_radians)-λ0),cosΔλ=Math.cos(t);d3_geo_lengthSum+=Math.atan2(Math.sqrt((t=cosφ*Math.sin(t))*t+(t=cosφ0*sinφ-sinφ0*cosφ*cosΔλ)*t),sinφ0*sinφ+cosφ0*cosφ*cosΔλ),λ0=λ,sinφ0=sinφ,cosφ0=cosφ}var λ0,sinφ0,cosφ0;d3_geo_length.point=function(λ,φ){λ0=λ*d3_radians,sinφ0=Math.sin(φ*=d3_radians),cosφ0=Math.cos(φ),d3_geo_length.point=nextPoint},d3_geo_length.lineEnd=function(){d3_geo_length.point=d3_geo_length.lineEnd=d3_noop}}function d3_geo_azimuthal(scale,angle){function azimuthal(λ,φ){var cosλ=Math.cos(λ),cosφ=Math.cos(φ),k=scale(cosλ*cosφ);return[k*cosφ*Math.sin(λ),k*Math.sin(φ)]}return azimuthal.invert=function(x,y){var ρ=Math.sqrt(x*x+y*y),c=angle(ρ),sinc=Math.sin(c),cosc=Math.cos(c);return[Math.atan2(x*sinc,ρ*cosc),Math.asin(ρ&&y*sinc/ρ)]},azimuthal}function d3_geo_conicConformal(φ0,φ1){function forward(λ,φ){F>0?φ<-halfπ+ε&&(φ=-halfπ+ε):φ>halfπ-ε&&(φ=halfπ-ε);var ρ=F/Math.pow(t(φ),n);return[ρ*Math.sin(n*λ),F-ρ*Math.cos(n*λ)]}var cosφ0=Math.cos(φ0),t=function(φ){return Math.tan(π/4+φ/2)},n=φ0===φ1?Math.sin(φ0):Math.log(cosφ0/Math.cos(φ1))/Math.log(t(φ1)/t(φ0)),F=cosφ0*Math.pow(t(φ0),n)/n;return n?(forward.invert=function(x,y){var ρ0_y=F-y,ρ=d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y);return[Math.atan2(x,ρ0_y)/n,2*Math.atan(Math.pow(F/ρ,1/n))-halfπ]},forward):d3_geo_mercator}function d3_geo_conicEquidistant(φ0,φ1){function forward(λ,φ){var ρ=G-φ;return[ρ*Math.sin(n*λ),G-ρ*Math.cos(n*λ)]}var cosφ0=Math.cos(φ0),n=φ0===φ1?Math.sin(φ0):(cosφ0-Math.cos(φ1))/(φ1-φ0),G=cosφ0/n+φ0;return abs(n)<ε?d3_geo_equirectangular:(forward.invert=function(x,y){var ρ0_y=G-y;return[Math.atan2(x,ρ0_y)/n,G-d3_sgn(n)*Math.sqrt(x*x+ρ0_y*ρ0_y)]},forward)}function d3_geo_mercator(λ,φ){return[λ,Math.log(Math.tan(π/4+φ/2))]}function d3_geo_mercatorProjection(project){var clipAuto,m=d3_geo_projection(project),scale=m.scale,translate=m.translate,clipExtent=m.clipExtent;return m.scale=function(){var v=scale.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v},m.translate=function(){var v=translate.apply(m,arguments);return v===m?clipAuto?m.clipExtent(null):m:v},m.clipExtent=function(_){var v=clipExtent.apply(m,arguments);if(v===m){if(clipAuto=null==_){var k=π*scale(),t=translate();clipExtent([[t[0]-k,t[1]-k],[t[0]+k,t[1]+k]])}}else clipAuto&&(v=null);return v},m.clipExtent(null)}function d3_geo_transverseMercator(λ,φ){return[Math.log(Math.tan(π/4+φ/2)),-λ]}function d3_geom_pointX(d){return d[0]}function d3_geom_pointY(d){return d[1]}function d3_geom_hullUpper(points){for(var n=points.length,hull=[0,1],hs=2,i=2;i<n;i++){for(;hs>1&&d3_cross2d(points[hull[hs-2]],points[hull[hs-1]],points[i])<=0;)--hs;hull[hs++]=i}return hull.slice(0,hs)}function d3_geom_hullOrder(a,b){return a[0]-b[0]||a[1]-b[1]}function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0])}function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x3=a[0],x21=d[0]-x1,x43=b[0]-x3,y1=c[1],y3=a[1],y21=d[1]-y1,y43=b[1]-y3,ua=(x43*(y1-y3)-y43*(x1-x3))/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21]}function d3_geom_polygonClosed(coordinates){var a=coordinates[0],b=coordinates[coordinates.length-1];return!(a[0]-b[0]||a[1]-b[1])}function d3_geom_voronoiBeach(){d3_geom_voronoiRedBlackNode(this),this.edge=this.site=this.circle=null}function d3_geom_voronoiCreateBeach(site){var beach=d3_geom_voronoiBeachPool.pop()||new d3_geom_voronoiBeach;return beach.site=site,beach}function d3_geom_voronoiDetachBeach(beach){d3_geom_voronoiDetachCircle(beach),d3_geom_voronoiBeaches.remove(beach),d3_geom_voronoiBeachPool.push(beach),d3_geom_voronoiRedBlackNode(beach)}function d3_geom_voronoiRemoveBeach(beach){var circle=beach.circle,x=circle.x,y=circle.cy,vertex={x:x,y:y},previous=beach.P,next=beach.N,disappearing=[beach];d3_geom_voronoiDetachBeach(beach);for(var lArc=previous;lArc.circle&&abs(x-lArc.circle.x)<ε&&abs(y-lArc.circle.cy)<ε;)previous=lArc.P,disappearing.unshift(lArc),d3_geom_voronoiDetachBeach(lArc),lArc=previous;disappearing.unshift(lArc),d3_geom_voronoiDetachCircle(lArc);for(var rArc=next;rArc.circle&&abs(x-rArc.circle.x)<ε&&abs(y-rArc.circle.cy)<ε;)next=rArc.N,disappearing.push(rArc),d3_geom_voronoiDetachBeach(rArc),rArc=next;disappearing.push(rArc),d3_geom_voronoiDetachCircle(rArc);var iArc,nArcs=disappearing.length;for(iArc=1;iArc<nArcs;++iArc)rArc=disappearing[iArc],lArc=disappearing[iArc-1],d3_geom_voronoiSetEdgeEnd(rArc.edge,lArc.site,rArc.site,vertex);lArc=disappearing[0],rArc=disappearing[nArcs-1],rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,rArc.site,null,vertex),d3_geom_voronoiAttachCircle(lArc),d3_geom_voronoiAttachCircle(rArc)}function d3_geom_voronoiAddBeach(site){for(var lArc,rArc,dxl,dxr,x=site.x,directrix=site.y,node=d3_geom_voronoiBeaches._;node;)if((dxl=d3_geom_voronoiLeftBreakPoint(node,directrix)-x)>ε)node=node.L;else{if(!((dxr=x-d3_geom_voronoiRightBreakPoint(node,directrix))>ε)){dxl>-ε?(lArc=node.P,rArc=node):dxr>-ε?(lArc=node,rArc=node.N):lArc=rArc=node;break}if(!node.R){lArc=node;break}node=node.R}var newArc=d3_geom_voronoiCreateBeach(site);if(d3_geom_voronoiBeaches.insert(lArc,newArc),lArc||rArc){if(lArc===rArc)return d3_geom_voronoiDetachCircle(lArc),rArc=d3_geom_voronoiCreateBeach(lArc.site),d3_geom_voronoiBeaches.insert(newArc,rArc),newArc.edge=rArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site),d3_geom_voronoiAttachCircle(lArc),void d3_geom_voronoiAttachCircle(rArc);if(!rArc)return void(newArc.edge=d3_geom_voronoiCreateEdge(lArc.site,newArc.site));d3_geom_voronoiDetachCircle(lArc),d3_geom_voronoiDetachCircle(rArc);var lSite=lArc.site,ax=lSite.x,ay=lSite.y,bx=site.x-ax,by=site.y-ay,rSite=rArc.site,cx=rSite.x-ax,cy=rSite.y-ay,d=2*(bx*cy-by*cx),hb=bx*bx+by*by,hc=cx*cx+cy*cy,vertex={x:(cy*hb-by*hc)/d+ax,y:(bx*hc-cx*hb)/d+ay};d3_geom_voronoiSetEdgeEnd(rArc.edge,lSite,rSite,vertex),newArc.edge=d3_geom_voronoiCreateEdge(lSite,site,null,vertex),rArc.edge=d3_geom_voronoiCreateEdge(site,rSite,null,vertex),d3_geom_voronoiAttachCircle(lArc),d3_geom_voronoiAttachCircle(rArc)}}function d3_geom_voronoiLeftBreakPoint(arc,directrix){var site=arc.site,rfocx=site.x,rfocy=site.y,pby2=rfocy-directrix;if(!pby2)return rfocx;var lArc=arc.P;if(!lArc)return-1/0;site=lArc.site;var lfocx=site.x,lfocy=site.y,plby2=lfocy-directrix;if(!plby2)return lfocx;var hl=lfocx-rfocx,aby2=1/pby2-1/plby2,b=hl/plby2;return aby2?(-b+Math.sqrt(b*b-2*aby2*(hl*hl/(-2*plby2)-lfocy+plby2/2+rfocy-pby2/2)))/aby2+rfocx:(rfocx+lfocx)/2}function d3_geom_voronoiRightBreakPoint(arc,directrix){var rArc=arc.N;if(rArc)return d3_geom_voronoiLeftBreakPoint(rArc,directrix);var site=arc.site;return site.y===directrix?site.x:1/0}function d3_geom_voronoiCell(site){this.site=site,this.edges=[]}function d3_geom_voronoiCloseCells(extent){for(var x2,y2,x3,y3,cell,iHalfEdge,halfEdges,nHalfEdges,start,end,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],cells=d3_geom_voronoiCells,iCell=cells.length;iCell--;)if((cell=cells[iCell])&&cell.prepare())for(halfEdges=cell.edges,nHalfEdges=halfEdges.length,iHalfEdge=0;iHalfEdge<nHalfEdges;)end=halfEdges[iHalfEdge].end(),x3=end.x,y3=end.y,start=halfEdges[++iHalfEdge%nHalfEdges].start(),x2=start.x,y2=start.y,(abs(x3-x2)>ε||abs(y3-y2)>ε)&&(halfEdges.splice(iHalfEdge,0,new d3_geom_voronoiHalfEdge(d3_geom_voronoiCreateBorderEdge(cell.site,end,abs(x3-x0)<ε&&y1-y3>ε?{x:x0,y:abs(x2-x0)<ε?y2:y1}:abs(y3-y1)<ε&&x1-x3>ε?{x:abs(y2-y1)<ε?x2:x1,y:y1}:abs(x3-x1)<ε&&y3-y0>ε?{x:x1,y:abs(x2-x1)<ε?y2:y0}:abs(y3-y0)<ε&&x3-x0>ε?{x:abs(y2-y0)<ε?x2:x0,y:y0}:null),cell.site,null)),++nHalfEdges)}function d3_geom_voronoiHalfEdgeOrder(a,b){return b.angle-a.angle}function d3_geom_voronoiCircle(){d3_geom_voronoiRedBlackNode(this),this.x=this.y=this.arc=this.site=this.cy=null}function d3_geom_voronoiAttachCircle(arc){var lArc=arc.P,rArc=arc.N;if(lArc&&rArc){var lSite=lArc.site,cSite=arc.site,rSite=rArc.site;if(lSite!==rSite){var bx=cSite.x,by=cSite.y,ax=lSite.x-bx,ay=lSite.y-by,cx=rSite.x-bx,cy=rSite.y-by,d=2*(ax*cy-ay*cx);if(!(d>=-ε2)){var ha=ax*ax+ay*ay,hc=cx*cx+cy*cy,x=(cy*ha-ay*hc)/d,y=(ax*hc-cx*ha)/d,cy=y+by,circle=d3_geom_voronoiCirclePool.pop()||new d3_geom_voronoiCircle;circle.arc=arc,circle.site=cSite,circle.x=x+bx,circle.y=cy+Math.sqrt(x*x+y*y),circle.cy=cy,arc.circle=circle;for(var before=null,node=d3_geom_voronoiCircles._;node;)if(circle.y<node.y||circle.y===node.y&&circle.x<=node.x){if(!node.L){before=node.P;break}node=node.L}else{if(!node.R){before=node;break}node=node.R}d3_geom_voronoiCircles.insert(before,circle),before||(d3_geom_voronoiFirstCircle=circle)}}}}function d3_geom_voronoiDetachCircle(arc){var circle=arc.circle;circle&&(circle.P||(d3_geom_voronoiFirstCircle=circle.N),d3_geom_voronoiCircles.remove(circle),d3_geom_voronoiCirclePool.push(circle),d3_geom_voronoiRedBlackNode(circle),arc.circle=null)}function d3_geom_voronoiClipEdges(extent){for(var e,edges=d3_geom_voronoiEdges,clip=d3_geom_clipLine(extent[0][0],extent[0][1],extent[1][0],extent[1][1]),i=edges.length;i--;)e=edges[i],(!d3_geom_voronoiConnectEdge(e,extent)||!clip(e)||abs(e.a.x-e.b.x)<ε&&abs(e.a.y-e.b.y)<ε)&&(e.a=e.b=null,edges.splice(i,1))}function d3_geom_voronoiConnectEdge(edge,extent){var vb=edge.b;if(vb)return!0;var fm,fb,va=edge.a,x0=extent[0][0],x1=extent[1][0],y0=extent[0][1],y1=extent[1][1],lSite=edge.l,rSite=edge.r,lx=lSite.x,ly=lSite.y,rx=rSite.x,ry=rSite.y,fx=(lx+rx)/2,fy=(ly+ry)/2;if(ry===ly){if(fx<x0||fx>=x1)return;if(lx>rx){if(va){if(va.y>=y1)return}else va={x:fx,y:y0};vb={x:fx,y:y1}}else{if(va){if(va.y<y0)return}else va={x:fx,y:y1};vb={x:fx,y:y0}}}else if(fm=(lx-rx)/(ry-ly),fb=fy-fm*fx,fm<-1||fm>1)if(lx>rx){if(va){if(va.y>=y1)return}else va={x:(y0-fb)/fm,y:y0};vb={x:(y1-fb)/fm,y:y1}}else{if(va){if(va.y<y0)return}else va={x:(y1-fb)/fm,y:y1};vb={x:(y0-fb)/fm,y:y0}}else if(ly<ry){if(va){if(va.x>=x1)return}else va={x:x0,y:fm*x0+fb};vb={x:x1,y:fm*x1+fb}}else{if(va){if(va.x<x0)return}else va={x:x1,y:fm*x1+fb};vb={x:x0,y:fm*x0+fb}}return edge.a=va,edge.b=vb,!0}function d3_geom_voronoiEdge(lSite,rSite){this.l=lSite,this.r=rSite,this.a=this.b=null}function d3_geom_voronoiCreateEdge(lSite,rSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,rSite);return d3_geom_voronoiEdges.push(edge),va&&d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,va),vb&&d3_geom_voronoiSetEdgeEnd(edge,rSite,lSite,vb),d3_geom_voronoiCells[lSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,lSite,rSite)),d3_geom_voronoiCells[rSite.i].edges.push(new d3_geom_voronoiHalfEdge(edge,rSite,lSite)),edge}function d3_geom_voronoiCreateBorderEdge(lSite,va,vb){var edge=new d3_geom_voronoiEdge(lSite,null);return edge.a=va,edge.b=vb,d3_geom_voronoiEdges.push(edge),edge}function d3_geom_voronoiSetEdgeEnd(edge,lSite,rSite,vertex){edge.a||edge.b?edge.l===rSite?edge.b=vertex:edge.a=vertex:(edge.a=vertex,edge.l=lSite,edge.r=rSite)}function d3_geom_voronoiHalfEdge(edge,lSite,rSite){var va=edge.a,vb=edge.b;this.edge=edge,this.site=lSite,this.angle=rSite?Math.atan2(rSite.y-lSite.y,rSite.x-lSite.x):edge.l===lSite?Math.atan2(vb.x-va.x,va.y-vb.y):Math.atan2(va.x-vb.x,vb.y-va.y)}function d3_geom_voronoiRedBlackTree(){this._=null}function d3_geom_voronoiRedBlackNode(node){node.U=node.C=node.L=node.R=node.P=node.N=null}function d3_geom_voronoiRedBlackRotateLeft(tree,node){var p=node,q=node.R,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.R=q.L,p.R&&(p.R.U=p),q.L=p}function d3_geom_voronoiRedBlackRotateRight(tree,node){var p=node,q=node.L,parent=p.U;parent?parent.L===p?parent.L=q:parent.R=q:tree._=q,q.U=parent,p.U=q,p.L=q.R,p.L&&(p.L.U=p),q.R=p}function d3_geom_voronoiRedBlackFirst(node){for(;node.L;)node=node.L;return node}function d3_geom_voronoi(sites,bbox){var x0,y0,circle,site=sites.sort(d3_geom_voronoiVertexOrder).pop();for(d3_geom_voronoiEdges=[],d3_geom_voronoiCells=new Array(sites.length),d3_geom_voronoiBeaches=new d3_geom_voronoiRedBlackTree,d3_geom_voronoiCircles=new d3_geom_voronoiRedBlackTree;;)if(circle=d3_geom_voronoiFirstCircle,site&&(!circle||site.y<circle.y||site.y===circle.y&&site.x<circle.x))site.x===x0&&site.y===y0||(d3_geom_voronoiCells[site.i]=new d3_geom_voronoiCell(site),d3_geom_voronoiAddBeach(site),x0=site.x,y0=site.y),site=sites.pop();else{if(!circle)break;d3_geom_voronoiRemoveBeach(circle.arc)}bbox&&(d3_geom_voronoiClipEdges(bbox),d3_geom_voronoiCloseCells(bbox));var diagram={cells:d3_geom_voronoiCells,edges:d3_geom_voronoiEdges};return d3_geom_voronoiBeaches=d3_geom_voronoiCircles=d3_geom_voronoiEdges=d3_geom_voronoiCells=null,diagram}function d3_geom_voronoiVertexOrder(a,b){return b.y-a.y||b.x-a.x}function d3_geom_voronoiTriangleArea(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y)}function d3_geom_quadtreeCompatX(d){return d.x}function d3_geom_quadtreeCompatY(d){return d.y}function d3_geom_quadtreeNode(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=.5*(x1+x2),sy=.5*(y1+y2),children=node.nodes;children[0]&&d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy),children[1]&&d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy),children[2]&&d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2),children[3]&&d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2)}}function d3_geom_quadtreeFind(root,x,y,x0,y0,x3,y3){var closestPoint,minDistance2=1/0;return function find(node,x1,y1,x2,y2){if(!(x1>x3||y1>y3||x2<x0||y2<y0)){if(point=node.point){var point,dx=x-node.x,dy=y-node.y,distance2=dx*dx+dy*dy;if(distance2<minDistance2){var distance=Math.sqrt(minDistance2=distance2);x0=x-distance,y0=y-distance,x3=x+distance,y3=y+distance,closestPoint=point}}for(var children=node.nodes,xm=.5*(x1+x2),ym=.5*(y1+y2),right=x>=xm,below=y>=ym,i=below<<1|right,j=i+4;i<j;++i)if(node=children[3&i])switch(3&i){case 0:find(node,x1,y1,xm,ym);break;case 1:find(node,xm,y1,x2,ym);break;case 2:find(node,x1,ym,xm,y2);break;case 3:find(node,xm,ym,x2,y2)}}}(root,x0,y0,x3,y3),closestPoint}function d3_interpolateRgb(a,b){a=d3.rgb(a),b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t))}}function d3_interpolateObject(a,b){var k,i={},c={};for(k in a)k in b?i[k]=d3_interpolate(a[k],b[k]):c[k]=a[k];for(k in b)k in a||(c[k]=b[k]);return function(t){for(k in i)c[k]=i[k](t);return c}}function d3_interpolateNumber(a,b){return a=+a,b=+b,function(t){return a*(1-t)+b*t}}function d3_interpolateString(a,b){var am,bm,bs,bi=d3_interpolate_numberA.lastIndex=d3_interpolate_numberB.lastIndex=0,i=-1,s=[],q=[];for(a+="",b+="";(am=d3_interpolate_numberA.exec(a))&&(bm=d3_interpolate_numberB.exec(b));)(bs=bm.index)>bi&&(bs=b.slice(bi,bs),s[i]?s[i]+=bs:s[++i]=bs),(am=am[0])===(bm=bm[0])?s[i]?s[i]+=bm:s[++i]=bm:(s[++i]=null,q.push({i:i,x:d3_interpolateNumber(am,bm)})),bi=d3_interpolate_numberB.lastIndex;return bi<b.length&&(bs=b.slice(bi),s[i]?s[i]+=bs:s[++i]=bs),s.length<2?q[0]?(b=q[0].x,function(t){return b(t)+""}):function(){return b}:(b=q.length,function(t){for(var o,i=0;i<b;++i)s[(o=q[i]).i]=o.x(t);return s.join("")})}function d3_interpolate(a,b){for(var f,i=d3.interpolators.length;--i>=0&&!(f=d3.interpolators[i](a,b)););return f}function d3_interpolateArray(a,b){var i,x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length);for(i=0;i<n0;++i)x.push(d3_interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c}}function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t)}}function d3_ease_reverse(f){return function(t){return 1-f(1-t)}}function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t))}}function d3_ease_quad(t){return t*t}function d3_ease_cubic(t){return t*t*t}function d3_ease_cubicInOut(t){if(t<=0)return 0;if(t>=1)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)}function d3_ease_poly(e){return function(t){return Math.pow(t,e)}}function d3_ease_sin(t){return 1-Math.cos(t*halfπ)}function d3_ease_exp(t){return Math.pow(2,10*(t-1))}function d3_ease_circle(t){return 1-Math.sqrt(1-t*t)}function d3_ease_elastic(a,p){var s;return arguments.length<2&&(p=.45),arguments.length?s=p/τ*Math.asin(1/a):(a=1,s=p/4),function(t){return 1+a*Math.pow(2,-10*t)*Math.sin((t-s)*τ/p)}}function d3_ease_back(s){return s||(s=1.70158),function(t){return t*t*((s+1)*t-s)}}function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function d3_interpolateHcl(a,b){a=d3.hcl(a),b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;return isNaN(bc)&&(bc=0,ac=isNaN(ac)?b.c:ac),isNaN(bh)?(bh=0,ah=isNaN(ah)?b.h:ah):bh>180?bh-=360:bh<-180&&(bh+=360),function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+""}}function d3_interpolateHsl(a,b){a=d3.hsl(a),b=d3.hsl(b);var ah=a.h,as=a.s,al=a.l,bh=b.h-ah,bs=b.s-as,bl=b.l-al;return isNaN(bs)&&(bs=0,as=isNaN(as)?b.s:as),isNaN(bh)?(bh=0,ah=isNaN(ah)?b.h:ah):bh>180?bh-=360:bh<-180&&(bh+=360),function(t){return d3_hsl_rgb(ah+bh*t,as+bs*t,al+bl*t)+""}}function d3_interpolateLab(a,b){a=d3.lab(a),b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+""}}function d3_interpolateRound(a,b){return b-=a,function(t){return Math.round(a+b*t)}}function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;r0[0]*r1[1]<r1[0]*r0[1]&&(r0[0]*=-1,r0[1]*=-1,kx*=-1,kz*=-1),this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_degrees,this.translate=[m.e,m.f],this.scale=[kx,ky],this.skew=ky?Math.atan2(kz,ky)*d3_degrees:0}function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1]}function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));return k&&(a[0]/=k,a[1]/=k),k}function d3_transformCombine(a,b,k){return a[0]+=k*b[0],a[1]+=k*b[1],a}function d3_interpolateTransformPop(s){return s.length?s.pop()+",":""}function d3_interpolateTranslate(ta,tb,s,q){if(ta[0]!==tb[0]||ta[1]!==tb[1]){var i=s.push("translate(",null,",",null,")");q.push({i:i-4,x:d3_interpolateNumber(ta[0],tb[0])},{i:i-2,x:d3_interpolateNumber(ta[1],tb[1])})}else(tb[0]||tb[1])&&s.push("translate("+tb+")")}function d3_interpolateRotate(ra,rb,s,q){ra!==rb?(ra-rb>180?rb+=360:rb-ra>180&&(ra+=360),q.push({i:s.push(d3_interpolateTransformPop(s)+"rotate(",null,")")-2,x:d3_interpolateNumber(ra,rb)})):rb&&s.push(d3_interpolateTransformPop(s)+"rotate("+rb+")")}function d3_interpolateSkew(wa,wb,s,q){wa!==wb?q.push({i:s.push(d3_interpolateTransformPop(s)+"skewX(",null,")")-2,x:d3_interpolateNumber(wa,wb)}):wb&&s.push(d3_interpolateTransformPop(s)+"skewX("+wb+")")}function d3_interpolateScale(ka,kb,s,q){if(ka[0]!==kb[0]||ka[1]!==kb[1]){var i=s.push(d3_interpolateTransformPop(s)+"scale(",null,",",null,")");q.push({i:i-4,x:d3_interpolateNumber(ka[0],kb[0])},{i:i-2,x:d3_interpolateNumber(ka[1],kb[1])})}else 1===kb[0]&&1===kb[1]||s.push(d3_interpolateTransformPop(s)+"scale("+kb+")")}function d3_interpolateTransform(a,b){var s=[],q=[];return a=d3.transform(a),b=d3.transform(b),d3_interpolateTranslate(a.translate,b.translate,s,q),d3_interpolateRotate(a.rotate,b.rotate,s,q),d3_interpolateSkew(a.skew,b.skew,s,q),d3_interpolateScale(a.scale,b.scale,s,q),a=b=null,function(t){for(var o,i=-1,n=q.length;++i<n;)s[(o=q[i]).i]=o.x(t);return s.join("")}}function d3_uninterpolateNumber(a,b){return b=(b-=a=+a)||1/b,function(x){return(x-a)/b}}function d3_uninterpolateClamp(a,b){return b=(b-=a=+a)||1/b,function(x){return Math.max(0,Math.min(1,(x-a)/b))}}function d3_layout_bundlePath(link){for(var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];start!==lca;)start=start.parent,points.push(start);for(var k=points.length;end!==lca;)points.splice(k,0,end),end=end.parent;return points}function d3_layout_bundleAncestors(node){for(var ancestors=[],parent=node.parent;null!=parent;)ancestors.push(node),node=parent,parent=parent.parent;return ancestors.push(node),ancestors}function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;for(var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;aNode===bNode;)sharedNode=aNode,aNode=aNodes.pop(),bNode=bNodes.pop();return sharedNode}function d3_layout_forceDragstart(d){d.fixed|=2}function d3_layout_forceDragend(d){d.fixed&=-7}function d3_layout_forceMouseover(d){d.fixed|=4,d.px=d.x,d.py=d.y}function d3_layout_forceMouseout(d){d.fixed&=-5}function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;if(quad.charge=0,!quad.leaf)for(var c,nodes=quad.nodes,n=nodes.length,i=-1;++i<n;)null!=(c=nodes[i])&&(d3_layout_forceAccumulate(c,alpha,charges),quad.charge+=c.charge,cx+=c.charge*c.cx,cy+=c.charge*c.cy);if(quad.point){quad.leaf||(quad.point.x+=Math.random()-.5,quad.point.y+=Math.random()-.5);var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k,cx+=k*quad.point.x,cy+=k*quad.point.y}quad.cx=cx/quad.charge,quad.cy=cy/quad.charge}function d3_layout_hierarchyRebind(object,hierarchy){return d3.rebind(object,hierarchy,"sort","children","value"),object.nodes=object,object.links=d3_layout_hierarchyLinks,object}function d3_layout_hierarchyVisitBefore(node,callback){for(var nodes=[node];null!=(node=nodes.pop());)if(callback(node),(children=node.children)&&(n=children.length))for(var n,children;--n>=0;)nodes.push(children[n])}function d3_layout_hierarchyVisitAfter(node,callback){for(var nodes=[node],nodes2=[];null!=(node=nodes.pop());)if(nodes2.push(node),(children=node.children)&&(n=children.length))for(var n,children,i=-1;++i<n;)nodes.push(children[i]);for(;null!=(node=nodes2.pop());)callback(node)}function d3_layout_hierarchyChildren(d){return d.children}function d3_layout_hierarchyValue(d){return d.value}function d3_layout_hierarchySort(a,b){return b.value-a.value}function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child}})}))}function d3_layout_stackX(d){return d.x}function d3_layout_stackY(d){return d.y}function d3_layout_stackOut(d,y0,y){d.y0=y0,d.y=y}function d3_layout_stackOrderDefault(data){return d3.range(data.length)}function d3_layout_stackOffsetZero(data){for(var j=-1,m=data[0].length,y0=[];++j<m;)y0[j]=0;return y0}function d3_layout_stackMaxIndex(array){for(var k,i=1,j=0,v=array[0][1],n=array.length;i<n;++i)(k=array[i][1])>v&&(j=i,v=k);return j}function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0)}function d3_layout_stackSum(p,d){return p+d[1]}function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1))}function d3_layout_histogramBinFixed(range,n){for(var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];++x<=n;)f[x]=m*x+b;return f}function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)]}function d3_layout_packSort(a,b){return a.value-b.value}function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b,b._pack_prev=a,b._pack_next=c,c._pack_prev=b}function d3_layout_packSplice(a,b){a._pack_next=b,b._pack_prev=a}function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return.999*dr*dr>dx*dx+dy*dy}function d3_layout_packSiblings(node){function bound(node){xMin=Math.min(node.x-node.r,xMin),xMax=Math.max(node.x+node.r,xMax),yMin=Math.min(node.y-node.r,yMin),yMax=Math.max(node.y+node.r,yMax)}if((nodes=node.children)&&(n=nodes.length)){var nodes,a,b,c,i,j,k,n,xMin=1/0,xMax=-1/0,yMin=1/0,yMax=-1/0;if(nodes.forEach(d3_layout_packLink),a=nodes[0],a.x=-a.r,a.y=0,bound(a),n>1&&(b=nodes[1],b.x=b.r,b.y=0,bound(b),n>2))for(c=nodes[2],d3_layout_packPlace(a,b,c),bound(c),d3_layout_packInsert(a,c),a._pack_prev=c,d3_layout_packInsert(c,b),b=a._pack_next,i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++)if(d3_layout_packIntersects(j,c)){isect=1;break}if(1==isect)for(k=a._pack_prev;k!==j._pack_prev&&!d3_layout_packIntersects(k,c);k=k._pack_prev,s2++);isect?(s1<s2||s1==s2&&b.r<a.r?d3_layout_packSplice(a,b=j):d3_layout_packSplice(a=k,b),i--):(d3_layout_packInsert(a,c),b=c,bound(c))}var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++)c=nodes[i],c.x-=cx,c.y-=cy,cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));node.r=cr,nodes.forEach(d3_layout_packUnlink)}}function d3_layout_packLink(node){node._pack_next=node._pack_prev=node}function d3_layout_packUnlink(node){delete node._pack_next,delete node._pack_prev}function d3_layout_packTransform(node,x,y,k){var children=node.children;if(node.x=x+=k*node.x,node.y=y+=k*node.y,node.r*=k,children)for(var i=-1,n=children.length;++i<n;)d3_layout_packTransform(children[i],x,y,k)}function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da,db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy,c.y=a.y+x*dy-y*dx}else c.x=a.x+db,c.y=a.y}function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2}function d3_layout_treeLeft(v){var children=v.children;return children.length?children[0]:v.t}function d3_layout_treeRight(v){var n,children=v.children;return(n=children.length)?children[n-1]:v.t}function d3_layout_treeMove(wm,wp,shift){var change=shift/(wp.i-wm.i);wp.c-=change,wp.s+=shift,wm.c+=change,wp.z+=shift,wp.m+=shift}function d3_layout_treeShift(v){for(var w,shift=0,change=0,children=v.children,i=children.length;--i>=0;)w=children[i],w.z+=shift,w.m+=shift,
shift+=w.s+(change+=w.c)}function d3_layout_treeAncestor(vim,v,ancestor){return vim.a.parent===v.parent?vim.a:ancestor}function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y})}function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x},0)/children.length}function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node}function d3_layout_clusterRight(node){var n,children=node.children;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node}function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy}}function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];return dx<0&&(x+=dx/2,dx=0),dy<0&&(y+=dy/2,dy=0),{x:x,y:y,dx:dx,dy:dy}}function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start]}function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range())}function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x))}}function d3_scale_nice(domain,nice){var dx,i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1];return x1<x0&&(dx=i0,i0=i1,i1=dx,dx=x0,x0=x1,x1=dx),domain[i0]=nice.floor(x0),domain[i1]=nice.ceil(x1),domain}function d3_scale_niceStep(step){return step?{floor:function(x){return Math.floor(x/step)*step},ceil:function(x){return Math.ceil(x/step)*step}}:d3_scale_niceIdentity}function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;for(domain[k]<domain[0]&&(domain=domain.slice().reverse(),range=range.slice().reverse());++j<=k;)u.push(uninterpolate(domain[j-1],domain[j])),i.push(interpolate(range[j-1],range[j]));return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x))}}function d3_scale_linear(domain,range,interpolate,clamp){function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;return output=linear(domain,range,uninterpolate,interpolate),input=linear(range,domain,uninterpolate,d3_interpolate),scale}function scale(x){return output(x)}var output,input;return scale.invert=function(y){return input(y)},scale.domain=function(x){return arguments.length?(domain=x.map(Number),rescale()):domain},scale.range=function(x){return arguments.length?(range=x,rescale()):range},scale.rangeRound=function(x){return scale.range(x).interpolate(d3_interpolateRound)},scale.clamp=function(x){return arguments.length?(clamp=x,rescale()):clamp},scale.interpolate=function(x){return arguments.length?(interpolate=x,rescale()):interpolate},scale.ticks=function(m){return d3_scale_linearTicks(domain,m)},scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)},scale.nice=function(m){return d3_scale_linearNice(domain,m),rescale()},scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp)},rescale()}function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp")}function d3_scale_linearNice(domain,m){return d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2])),d3_scale_nice(domain,d3_scale_niceStep(d3_scale_linearTickRange(domain,m)[2])),domain}function d3_scale_linearTickRange(domain,m){null==m&&(m=10);var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;return err<=.15?step*=10:err<=.35?step*=5:err<=.75&&(step*=2),extent[0]=Math.ceil(extent[0]/step)*step,extent[1]=Math.floor(extent[1]/step)*step+.5*step,extent[2]=step,extent}function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m))}function d3_scale_linearTickFormat(domain,m,format){var range=d3_scale_linearTickRange(domain,m);if(format){var match=d3_format_re.exec(format);if(match.shift(),"s"===match[8]){var prefix=d3.formatPrefix(Math.max(abs(range[0]),abs(range[1])));return match[7]||(match[7]="."+d3_scale_linearPrecision(prefix.scale(range[2]))),match[8]="f",format=d3.format(match.join("")),function(d){return format(prefix.scale(d))+prefix.symbol}}match[7]||(match[7]="."+d3_scale_linearFormatPrecision(match[8],range)),format=match.join("")}else format=",."+d3_scale_linearPrecision(range[2])+"f";return d3.format(format)}function d3_scale_linearPrecision(value){return-Math.floor(Math.log(value)/Math.LN10+.01)}function d3_scale_linearFormatPrecision(type,range){var p=d3_scale_linearPrecision(range[2]);return type in d3_scale_linearFormatSignificant?Math.abs(p-d3_scale_linearPrecision(Math.max(abs(range[0]),abs(range[1]))))+ +("e"!==type):p-2*("%"===type)}function d3_scale_log(linear,base,positive,domain){function log(x){return(positive?Math.log(x<0?0:x):-Math.log(x>0?0:-x))/Math.log(base)}function pow(x){return positive?Math.pow(base,x):-Math.pow(base,-x)}function scale(x){return linear(log(x))}return scale.invert=function(x){return pow(linear.invert(x))},scale.domain=function(x){return arguments.length?(positive=x[0]>=0,linear.domain((domain=x.map(Number)).map(log)),scale):domain},scale.base=function(_){return arguments.length?(base=+_,linear.domain(domain.map(log)),scale):base},scale.nice=function(){var niced=d3_scale_nice(domain.map(log),positive?Math:d3_scale_logNiceNegative);return linear.domain(niced),domain=niced.map(pow),scale},scale.ticks=function(){var extent=d3_scaleExtent(domain),ticks=[],u=extent[0],v=extent[1],i=Math.floor(log(u)),j=Math.ceil(log(v)),n=base%1?2:base;if(isFinite(j-i)){if(positive){for(;i<j;i++)for(var k=1;k<n;k++)ticks.push(pow(i)*k);ticks.push(pow(i))}else for(ticks.push(pow(i));i++<j;)for(var k=n-1;k>0;k--)ticks.push(pow(i)*k);for(i=0;ticks[i]<u;i++);for(j=ticks.length;ticks[j-1]>v;j--);ticks=ticks.slice(i,j)}return ticks},scale.tickFormat=function(n,format){if(!arguments.length)return d3_scale_logFormat;arguments.length<2?format=d3_scale_logFormat:"function"!=typeof format&&(format=d3.format(format));var k=Math.max(1,base*n/scale.ticks().length);return function(d){var i=d/pow(Math.round(log(d)));return i*base<base-.5&&(i*=base),i<=k?format(d):""}},scale.copy=function(){return d3_scale_log(linear.copy(),base,positive,domain)},d3_scale_linearRebind(scale,linear)}function d3_scale_pow(linear,exponent,domain){function scale(x){return linear(powp(x))}var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);return scale.invert=function(x){return powb(linear.invert(x))},scale.domain=function(x){return arguments.length?(linear.domain((domain=x.map(Number)).map(powp)),scale):domain},scale.ticks=function(m){return d3_scale_linearTicks(domain,m)},scale.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)},scale.nice=function(m){return scale.domain(d3_scale_linearNice(domain,m))},scale.exponent=function(x){return arguments.length?(powp=d3_scale_powPow(exponent=x),powb=d3_scale_powPow(1/exponent),linear.domain(domain.map(powp)),scale):exponent},scale.copy=function(){return d3_scale_pow(linear.copy(),exponent,domain)},d3_scale_linearRebind(scale,linear)}function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e)}}function d3_scale_ordinal(domain,ranger){function scale(x){return range[((index.get(x)||("range"===ranger.t?index.set(x,domain.push(x)):NaN))-1)%range.length]}function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i})}var index,range,rangeBand;return scale.domain=function(x){if(!arguments.length)return domain;domain=[],index=new d3_Map;for(var xi,i=-1,n=x.length;++i<n;)index.has(xi=x[i])||index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a)},scale.range=function(x){return arguments.length?(range=x,rangeBand=0,ranger={t:"range",a:arguments},scale):range},scale.rangePoints=function(x,padding){arguments.length<2&&(padding=0);var start=x[0],stop=x[1],step=domain.length<2?(start=(start+stop)/2,0):(stop-start)/(domain.length-1+padding);return range=steps(start+step*padding/2,step),rangeBand=0,ranger={t:"rangePoints",a:arguments},scale},scale.rangeRoundPoints=function(x,padding){arguments.length<2&&(padding=0);var start=x[0],stop=x[1],step=domain.length<2?(start=stop=Math.round((start+stop)/2),0):(stop-start)/(domain.length-1+padding)|0;return range=steps(start+Math.round(step*padding/2+(stop-start-(domain.length-1+padding)*step)/2),step),rangeBand=0,ranger={t:"rangeRoundPoints",a:arguments},scale},scale.rangeBands=function(x,padding,outerPadding){arguments.length<2&&(padding=0),arguments.length<3&&(outerPadding=padding);var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);return range=steps(start+step*outerPadding,step),reverse&&range.reverse(),rangeBand=step*(1-padding),ranger={t:"rangeBands",a:arguments},scale},scale.rangeRoundBands=function(x,padding,outerPadding){arguments.length<2&&(padding=0),arguments.length<3&&(outerPadding=padding);var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding));return range=steps(start+Math.round((stop-start-(domain.length-padding)*step)/2),step),reverse&&range.reverse(),rangeBand=Math.round(step*(1-padding)),ranger={t:"rangeRoundBands",a:arguments},scale},scale.rangeBand=function(){return rangeBand},scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0])},scale.copy=function(){return d3_scale_ordinal(domain,ranger)},scale.domain(domain)}function d3_scale_quantile(domain,range){function rescale(){var k=0,q=range.length;for(thresholds=[];++k<q;)thresholds[k-1]=d3.quantile(domain,k/q);return scale}function scale(x){if(!isNaN(x=+x))return range[d3.bisect(thresholds,x)]}var thresholds;return scale.domain=function(x){return arguments.length?(domain=x.map(d3_number).filter(d3_numeric).sort(d3_ascending),rescale()):domain},scale.range=function(x){return arguments.length?(range=x,rescale()):range},scale.quantiles=function(){return thresholds},scale.invertExtent=function(y){return y=range.indexOf(y),y<0?[NaN,NaN]:[y>0?thresholds[y-1]:domain[0],y<thresholds.length?thresholds[y]:domain[domain.length-1]]},scale.copy=function(){return d3_scale_quantile(domain,range)},rescale()}function d3_scale_quantize(x0,x1,range){function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))]}function rescale(){return kx=range.length/(x1-x0),i=range.length-1,scale}var kx,i;return scale.domain=function(x){return arguments.length?(x0=+x[0],x1=+x[x.length-1],rescale()):[x0,x1]},scale.range=function(x){return arguments.length?(range=x,rescale()):range},scale.invertExtent=function(y){return y=range.indexOf(y),y=y<0?NaN:y/kx+x0,[y,y+1/kx]},scale.copy=function(){return d3_scale_quantize(x0,x1,range)},rescale()}function d3_scale_threshold(domain,range){function scale(x){if(x<=x)return range[d3.bisect(domain,x)]}return scale.domain=function(_){return arguments.length?(domain=_,scale):domain},scale.range=function(_){return arguments.length?(range=_,scale):range},scale.invertExtent=function(y){return y=range.indexOf(y),[domain[y-1],domain[y]]},scale.copy=function(){return d3_scale_threshold(domain,range)},scale}function d3_scale_identity(domain){function identity(x){return+x}return identity.invert=identity,identity.domain=identity.range=function(x){return arguments.length?(domain=x.map(identity),identity):domain},identity.ticks=function(m){return d3_scale_linearTicks(domain,m)},identity.tickFormat=function(m,format){return d3_scale_linearTickFormat(domain,m,format)},identity.copy=function(){return d3_scale_identity(domain)},identity}function d3_zero(){return 0}function d3_svg_arcInnerRadius(d){return d.innerRadius}function d3_svg_arcOuterRadius(d){return d.outerRadius}function d3_svg_arcStartAngle(d){return d.startAngle}function d3_svg_arcEndAngle(d){return d.endAngle}function d3_svg_arcPadAngle(d){return d&&d.padAngle}function d3_svg_arcSweep(x0,y0,x1,y1){return(x0-x1)*y0-(y0-y1)*x0>0?0:1}function d3_svg_arcCornerTangents(p0,p1,r1,rc,cw){var x01=p0[0]-p1[0],y01=p0[1]-p1[1],lo=(cw?rc:-rc)/Math.sqrt(x01*x01+y01*y01),ox=lo*y01,oy=-lo*x01,x1=p0[0]+ox,y1=p0[1]+oy,x2=p1[0]+ox,y2=p1[1]+oy,x3=(x1+x2)/2,y3=(y1+y2)/2,dx=x2-x1,dy=y2-y1,d2=dx*dx+dy*dy,r=r1-rc,D=x1*y2-x2*y1,d=(dy<0?-1:1)*Math.sqrt(Math.max(0,r*r*d2-D*D)),cx0=(D*dy-dx*d)/d2,cy0=(-D*dx-dy*d)/d2,cx1=(D*dy+dx*d)/d2,cy1=(-D*dx+dy*d)/d2,dx0=cx0-x3,dy0=cy0-y3,dx1=cx1-x3,dy1=cy1-y3;return dx0*dx0+dy0*dy0>dx1*dx1+dy1*dy1&&(cx0=cx1,cy0=cy1),[[cx0-ox,cy0-oy],[cx0*r1/r,cy0*r1/r]]}function d3_svg_line(projection){function line(data){function segment(){segments.push("M",interpolate(projection(points),tension))}for(var d,segments=[],points=[],i=-1,n=data.length,fx=d3_functor(x),fy=d3_functor(y);++i<n;)defined.call(this,d=data[i],i)?points.push([+fx.call(this,d,i),+fy.call(this,d,i)]):points.length&&(segment(),points=[]);return points.length&&segment(),segments.length?segments.join(""):null}var x=d3_geom_pointX,y=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;return line.x=function(_){return arguments.length?(x=_,line):x},line.y=function(_){return arguments.length?(y=_,line):y},line.defined=function(_){return arguments.length?(defined=_,line):defined},line.interpolate=function(_){return arguments.length?(interpolateKey="function"==typeof _?interpolate=_:(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key,line):interpolateKey},line.tension=function(_){return arguments.length?(tension=_,line):tension},line}function d3_svg_lineLinear(points){return points.length>1?points.join("L"):points+"Z"}function d3_svg_lineLinearClosed(points){return points.join("L")+"Z"}function d3_svg_lineStep(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("H",(p[0]+(p=points[i])[0])/2,"V",p[1]);return n>1&&path.push("H",p[0]),path.join("")}function d3_svg_lineStepBefore(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("")}function d3_svg_lineStepAfter(points){for(var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];++i<n;)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("")}function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,-1),d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinearClosed(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension))}function d3_svg_lineCardinal(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension))}function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2)return d3_svg_lineLinear(points);var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad&&(path+="Q"+(p[0]-2*t0[0]/3)+","+(p[1]-2*t0[1]/3)+","+p[0]+","+p[1],p0=points[1],pi=2),tangents.length>1){t=tangents[1],p=points[pi],pi++,path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++)p=points[pi],t=tangents[i],path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1]}if(quad){var lp=points[pi];path+="Q"+(p[0]+2*t[0]/3)+","+(p[1]+2*t[1]/3)+","+lp[0]+","+lp[1]}return path}function d3_svg_lineCardinalTangents(points,tension){for(var p0,tangents=[],a=(1-tension)/2,p1=points[0],p2=points[1],i=1,n=points.length;++i<n;)p0=p1,p1=p2,p2=points[i],tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);return tangents}function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0,"L",d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];for(points.push(points[n-1]);++i<=n;)pi=points[i],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return points.pop(),path.push("L",pi),path.join("")}function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);for(var pi,path=[],i=-1,n=points.length,px=[0],py=[0];++i<3;)pi=points[i],px.push(pi[0]),py.push(pi[1]);for(path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)),--i;++i<n;)pi=points[i],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return path.join("")}function d3_svg_lineBasisClosed(points){for(var path,pi,i=-1,n=points.length,m=n+4,px=[],py=[];++i<4;)pi=points[i%n],px.push(pi[0]),py.push(pi[1]);for(path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)],--i;++i<m;)pi=points[i%n],px.shift(),px.push(pi[0]),py.shift(),py.push(pi[1]),d3_svg_lineBasisBezier(path,px,py);return path.join("")}function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n)for(var p,t,x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1;++i<=n;)p=points[i],t=i/n,p[0]=tension*p[0]+(1-tension)*(x0+t*dx),p[1]=tension*p[1]+(1-tension)*(y0+t*dy);return d3_svg_lineBasis(points)}function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y))}function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0])}function d3_svg_lineFiniteDifferences(points){for(var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);++i<j;)m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;return m[i]=d,m}function d3_svg_lineMonotoneTangents(points){for(var d,a,b,s,tangents=[],m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;++i<j;)d=d3_svg_lineSlope(points[i],points[i+1]),abs(d)<ε?m[i]=m[i+1]=0:(a=m[i]/d,b=m[i+1]/d,(s=a*a+b*b)>9&&(s=3*d/Math.sqrt(s),m[i]=s*a,m[i+1]=s*b));for(i=-1;++i<=j;)s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i])),tangents.push([s||0,m[i]*s||0]);return tangents}function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points))}function d3_svg_lineRadial(points){for(var point,r,a,i=-1,n=points.length;++i<n;)point=points[i],r=point[0],a=point[1]-halfπ,point[0]=r*Math.cos(a),point[1]=r*Math.sin(a);return points}function d3_svg_area(projection){function area(data){function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z")}for(var d,x,y,segments=[],points0=[],points1=[],i=-1,n=data.length,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x}:d3_functor(x1),fy1=y0===y1?function(){return y}:d3_functor(y1);++i<n;)defined.call(this,d=data[i],i)?(points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]),points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)])):points0.length&&(segment(),points0=[],points1=[]);return points0.length&&segment(),segments.length?segments.join(""):null}var x0=d3_geom_pointX,x1=d3_geom_pointX,y0=0,y1=d3_geom_pointY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;return area.x=function(_){return arguments.length?(x0=x1=_,area):x1},area.x0=function(_){return arguments.length?(x0=_,area):x0},area.x1=function(_){return arguments.length?(x1=_,area):x1},area.y=function(_){return arguments.length?(y0=y1=_,area):y1},area.y0=function(_){return arguments.length?(y0=_,area):y0},area.y1=function(_){return arguments.length?(y1=_,area):y1},area.defined=function(_){return arguments.length?(defined=_,area):defined},area.interpolate=function(_){return arguments.length?(interpolateKey="function"==typeof _?interpolate=_:(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key,interpolateReverse=interpolate.reverse||interpolate,L=interpolate.closed?"M":"L",area):interpolateKey},area.tension=function(_){return arguments.length?(tension=_,area):tension},area}function d3_svg_chordRadius(d){return d.radius}function d3_svg_diagonalProjection(d){return[d.x,d.y]}function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]-halfπ;return[r*Math.cos(a),r*Math.sin(a)]}}function d3_svg_symbolSize(){return 64}function d3_svg_symbolType(){return"circle"}function d3_svg_symbolCircle(size){var r=Math.sqrt(size/π);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z"}function d3_selection_interruptNS(ns){return function(){var lock,activeId,active;(lock=this[ns])&&(active=lock[activeId=lock.active])&&(active.timer.c=null,active.timer.t=NaN,--lock.count?delete lock[activeId]:delete this[ns],lock.active+=.5,active.event&&active.event.interrupt.call(this,this.__data__,active.index))}}function d3_transition(groups,ns,id){return d3_subclass(groups,d3_transitionPrototype),groups.namespace=ns,groups.id=id,groups}function d3_transition_tween(groups,name,value,tween){var id=groups.id,ns=groups.namespace;return d3_selection_each(groups,"function"==typeof value?function(node,i,j){node[ns][id].tween.set(name,tween(value.call(node,node.__data__,i,j)))}:(value=tween(value),function(node){node[ns][id].tween.set(name,value)}))}function d3_transition_text(b){return null==b&&(b=""),function(){this.textContent=b}}function d3_transitionNamespace(name){return null==name?"__transition__":"__transition_"+name+"__"}function d3_transitionNode(node,i,ns,id,inherit){function schedule(elapsed){var delay=transition.delay;if(timer.t=delay+time,delay<=elapsed)return start(elapsed-delay);timer.c=start}function start(elapsed){var activeId=lock.active,active=lock[activeId];active&&(active.timer.c=null,active.timer.t=NaN,--lock.count,delete lock[activeId],active.event&&active.event.interrupt.call(node,node.__data__,active.index));for(var cancelId in lock)if(+cancelId<id){var cancel=lock[cancelId];cancel.timer.c=null,cancel.timer.t=NaN,--lock.count,delete lock[cancelId]}timer.c=tick,d3_timer(function(){return timer.c&&tick(elapsed||1)&&(timer.c=null,timer.t=NaN),1},0,time),lock.active=id,transition.event&&transition.event.start.call(node,node.__data__,i),tweens=[],transition.tween.forEach(function(key,value){(value=value.call(node,node.__data__,i))&&tweens.push(value)}),ease=transition.ease,duration=transition.duration}function tick(elapsed){for(var t=elapsed/duration,e=ease(t),n=tweens.length;n>0;)tweens[--n].call(node,e);if(t>=1)return transition.event&&transition.event.end.call(node,node.__data__,i),--lock.count?delete lock[id]:delete node[ns],1}var time,timer,duration,ease,tweens,lock=node[ns]||(node[ns]={active:0,count:0}),transition=lock[id];transition||(time=inherit.time,timer=d3_timer(schedule,0,time),transition=lock[id]={tween:new d3_Map,time:time,timer:timer,delay:inherit.delay,duration:inherit.duration,ease:inherit.ease,index:i},inherit=null,++lock.count)}function d3_svg_axisX(selection,x0,x1){selection.attr("transform",function(d){var v0=x0(d);return"translate("+(isFinite(v0)?v0:x1(d))+",0)"})}function d3_svg_axisY(selection,y0,y1){selection.attr("transform",function(d){var v0=y0(d);return"translate(0,"+(isFinite(v0)?v0:y1(d))+")"})}function d3_time_formatIsoNative(date){return date.toISOString()}function d3_time_scale(linear,methods,format){function scale(x){return linear(x)}function tickMethod(extent,count){var span=extent[1]-extent[0],target=span/count,i=d3.bisect(d3_time_scaleSteps,target);return i==d3_time_scaleSteps.length?[methods.year,d3_scale_linearTickRange(extent.map(function(d){return d/31536e6}),count)[2]]:i?methods[target/d3_time_scaleSteps[i-1]<d3_time_scaleSteps[i]/target?i-1:i]:[d3_time_scaleMilliseconds,d3_scale_linearTickRange(extent,count)[2]]}return scale.invert=function(x){return d3_time_scaleDate(linear.invert(x))},scale.domain=function(x){return arguments.length?(linear.domain(x),scale):linear.domain().map(d3_time_scaleDate)},scale.nice=function(interval,skip){function skipped(date){return!isNaN(date)&&!interval.range(date,d3_time_scaleDate(+date+1),skip).length}var domain=scale.domain(),extent=d3_scaleExtent(domain),method=null==interval?tickMethod(extent,10):"number"==typeof interval&&tickMethod(extent,interval);return method&&(interval=method[0],skip=method[1]),scale.domain(d3_scale_nice(domain,skip>1?{floor:function(date){for(;skipped(date=interval.floor(date));)date=d3_time_scaleDate(date-1);return date},ceil:function(date){for(;skipped(date=interval.ceil(date));)date=d3_time_scaleDate(+date+1);return date}}:interval))},scale.ticks=function(interval,skip){var extent=d3_scaleExtent(scale.domain()),method=null==interval?tickMethod(extent,10):"number"==typeof interval?tickMethod(extent,interval):!interval.range&&[{range:interval},skip];return method&&(interval=method[0],skip=method[1]),interval.range(extent[0],d3_time_scaleDate(+extent[1]+1),skip<1?1:skip)},scale.tickFormat=function(){return format},scale.copy=function(){return d3_time_scale(linear.copy(),methods,format)},d3_scale_linearRebind(scale,linear)}function d3_time_scaleDate(t){return new Date(t)}function d3_json(request){return JSON.parse(request.responseText)}function d3_html(request){var range=d3_document.createRange();return range.selectNode(d3_document.body),range.createContextualFragment(request.responseText)}var d3={version:"3.5.17"},d3_arraySlice=[].slice,d3_array=function(list){return d3_arraySlice.call(list)},d3_document=this.document;if(d3_document)try{d3_array(d3_document.documentElement.childNodes)[0].nodeType}catch(e){d3_array=function(list){for(var i=list.length,array=new Array(i);i--;)array[i]=list[i];return array}}if(Date.now||(Date.now=function(){return+new Date}),d3_document)try{d3_document.createElement("DIV").style.setProperty("opacity",0,"")}catch(error){var d3_element_prototype=this.Element.prototype,d3_element_setAttribute=d3_element_prototype.setAttribute,d3_element_setAttributeNS=d3_element_prototype.setAttributeNS,d3_style_prototype=this.CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_element_prototype.setAttribute=function(name,value){d3_element_setAttribute.call(this,name,value+"")},d3_element_prototype.setAttributeNS=function(space,local,value){d3_element_setAttributeNS.call(this,space,local,value+"")},d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority)}}d3.ascending=d3_ascending,d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN},d3.min=function(array,f){var a,b,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b>=b){a=b;break}for(;++i<n;)null!=(b=array[i])&&a>b&&(a=b)}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b>=b){a=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&a>b&&(a=b)}return a},d3.max=function(array,f){var a,b,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b>=b){a=b;break}for(;++i<n;)null!=(b=array[i])&&b>a&&(a=b)}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b>=b){a=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&b>a&&(a=b)}return a},d3.extent=function(array,f){var a,b,c,i=-1,n=array.length;if(1===arguments.length){for(;++i<n;)if(null!=(b=array[i])&&b>=b){a=c=b;break}for(;++i<n;)null!=(b=array[i])&&(a>b&&(a=b),c<b&&(c=b))}else{for(;++i<n;)if(null!=(b=f.call(array,array[i],i))&&b>=b){a=c=b;break}for(;++i<n;)null!=(b=f.call(array,array[i],i))&&(a>b&&(a=b),c<b&&(c=b))}return[a,c]},d3.sum=function(array,f){var a,s=0,n=array.length,i=-1;if(1===arguments.length)for(;++i<n;)d3_numeric(a=+array[i])&&(s+=a);else for(;++i<n;)d3_numeric(a=+f.call(array,array[i],i))&&(s+=a);return s},d3.mean=function(array,f){var a,s=0,n=array.length,i=-1,j=n;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))?s+=a:--j;else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))?s+=a:--j;if(j)return s/j},d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=+values[h-1],e=H-h;return e?v+e*(values[h]-v):v},d3.median=function(array,f){var a,numbers=[],n=array.length,i=-1;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))&&numbers.push(a);else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))&&numbers.push(a);if(numbers.length)return d3.quantile(numbers.sort(d3_ascending),.5)},d3.variance=function(array,f){var a,d,n=array.length,m=0,s=0,i=-1,j=0;if(1===arguments.length)for(;++i<n;)d3_numeric(a=d3_number(array[i]))&&(d=a-m,m+=d/++j,s+=d*(a-m));else for(;++i<n;)d3_numeric(a=d3_number(f.call(array,array[i],i)))&&(d=a-m,m+=d/++j,s+=d*(a-m));if(j>1)return s/(j-1)},d3.deviation=function(){var v=d3.variance.apply(this,arguments);return v?Math.sqrt(v):v};var d3_bisect=d3_bisector(d3_ascending);d3.bisectLeft=d3_bisect.left,d3.bisect=d3.bisectRight=d3_bisect.right,d3.bisector=function(f){return d3_bisector(1===f.length?function(d,x){return d3_ascending(f(d),x)}:f)},d3.shuffle=function(array,i0,i1){(m=arguments.length)<3&&(i1=array.length,m<2&&(i0=0));for(var t,i,m=i1-i0;m;)i=Math.random()*m--|0,t=array[m+i0],array[m+i0]=array[i+i0],array[i+i0]=t;return array},d3.permute=function(array,indexes){for(var i=indexes.length,permutes=new Array(i);i--;)permutes[i]=array[indexes[i]];return permutes},d3.pairs=function(array){for(var i=0,n=array.length-1,p1=array[0],pairs=new Array(n<0?0:n);i<n;)pairs[i]=[p1,p1=array[++i]];return pairs},d3.transpose=function(matrix){if(!(n=matrix.length))return[];for(var i=-1,m=d3.min(matrix,d3_transposeLength),transpose=new Array(m);++i<m;)for(var n,j=-1,row=transpose[i]=new Array(n);++j<n;)row[j]=matrix[j][i];return transpose},d3.zip=function(){return d3.transpose(arguments)},d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys},d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values},d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries},d3.merge=function(arrays){for(var m,merged,array,n=arrays.length,i=-1,j=0;++i<n;)j+=arrays[i].length;for(merged=new Array(j);--n>=0;)for(array=arrays[n],m=array.length;--m>=0;)merged[--j]=array[m];return merged};var abs=Math.abs;d3.range=function(start,stop,step){if(arguments.length<3&&(step=1,arguments.length<2&&(stop=start,start=0)),(stop-start)/step==1/0)throw new Error("infinite range");var j,range=[],k=d3_range_integerScale(abs(step)),i=-1;if(start*=k,stop*=k,step*=k,step<0)for(;(j=start+step*++i)>stop;)range.push(j/k);else for(;(j=start+step*++i)<stop;)range.push(j/k);return range},d3.map=function(object,f){var map=new d3_Map;if(object instanceof d3_Map)object.forEach(function(key,value){map.set(key,value)});else if(Array.isArray(object)){var o,i=-1,n=object.length;if(1===arguments.length)for(;++i<n;)map.set(i,object[i]);else for(;++i<n;)map.set(f.call(object,o=object[i],i),o)}else for(var key in object)map.set(key,object[key]);return map};var d3_map_proto="__proto__",d3_map_zero="\0";d3_class(d3_Map,{has:d3_map_has,get:function(key){return this._[d3_map_escape(key)]},set:function(key,value){return this._[d3_map_escape(key)]=value},remove:d3_map_remove,keys:d3_map_keys,values:function(){
var values=[];for(var key in this._)values.push(this._[key]);return values},entries:function(){var entries=[];for(var key in this._)entries.push({key:d3_map_unescape(key),value:this._[key]});return entries},size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key),this._[key])}}),d3.nest=function(){function map(mapType,array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;for(var keyValue,object,setter,values,i=-1,n=array.length,key=keys[depth++],valuesByKey=new d3_Map;++i<n;)(values=valuesByKey.get(keyValue=key(object=array[i])))?values.push(object):valuesByKey.set(keyValue,[object]);return mapType?(object=mapType(),setter=function(keyValue,values){object.set(keyValue,map(mapType,values,depth))}):(object={},setter=function(keyValue,values){object[keyValue]=map(mapType,values,depth)}),valuesByKey.forEach(setter),object}function entries(map,depth){if(depth>=keys.length)return map;var array=[],sortKey=sortKeys[depth++];return map.forEach(function(key,keyMap){array.push({key:key,values:entries(keyMap,depth)})}),sortKey?array.sort(function(a,b){return sortKey(a.key,b.key)}):array}var sortValues,rollup,nest={},keys=[],sortKeys=[];return nest.map=function(array,mapType){return map(mapType,array,0)},nest.entries=function(array){return entries(map(d3.map,array,0),0)},nest.key=function(d){return keys.push(d),nest},nest.sortKeys=function(order){return sortKeys[keys.length-1]=order,nest},nest.sortValues=function(order){return sortValues=order,nest},nest.rollup=function(f){return rollup=f,nest},nest},d3.set=function(array){var set=new d3_Set;if(array)for(var i=0,n=array.length;i<n;++i)set.add(array[i]);return set},d3_class(d3_Set,{has:d3_map_has,add:function(key){return this._[d3_map_escape(key+="")]=!0,key},remove:d3_map_remove,values:d3_map_keys,size:d3_map_size,empty:d3_map_empty,forEach:function(f){for(var key in this._)f.call(this,d3_map_unescape(key))}}),d3.behavior={},d3.rebind=function(target,source){for(var method,i=1,n=arguments.length;++i<n;)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target};var d3_vendorPrefixes=["webkit","ms","moz","Moz","o","O"];d3.dispatch=function(){for(var dispatch=new d3_dispatch,i=-1,n=arguments.length;++i<n;)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch},d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>=0&&(name=type.slice(i+1),type=type.slice(0,i)),type)return arguments.length<2?this[type].on(name):this[type].on(name,listener);if(2===arguments.length){if(null==listener)for(type in this)this.hasOwnProperty(type)&&this[type].on(name,null);return this}},d3.event=null,d3.requote=function(s){return s.replace(d3_requote_re,"\\$&")};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,d3_subclass={}.__proto__?function(object,prototype){object.__proto__=prototype}:function(object,prototype){for(var property in prototype)object[property]=prototype[property]},d3_select=function(s,n){return n.querySelector(s)},d3_selectAll=function(s,n){return n.querySelectorAll(s)},d3_selectMatches=function(n,s){var d3_selectMatcher=n.matches||n[d3_vendorSymbol(n,"matchesSelector")];return(d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s)})(n,s)};"function"==typeof Sizzle&&(d3_select=function(s,n){return Sizzle(s,n)[0]||null},d3_selectAll=Sizzle,d3_selectMatches=Sizzle.matchesSelector),d3.selection=function(){return d3.select(d3_document.documentElement)};var d3_selectionPrototype=d3.selection.prototype=[];d3_selectionPrototype.select=function(selector){var subgroup,subnode,group,node,subgroups=[];selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]),subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;)(node=group[i])?(subgroup.push(subnode=selector.call(node,node.__data__,i,j)),subnode&&"__data__"in node&&(subnode.__data__=node.__data__)):subgroup.push(null)}return d3_selection(subgroups)},d3_selectionPrototype.selectAll=function(selector){var subgroup,node,subgroups=[];selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;)for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&(subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i,j))),subgroup.parentNode=node);return d3_selection(subgroups)};var d3_nsXhtml="http://www.w3.org/1999/xhtml",d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:d3_nsXhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;return i>=0&&"xmlns"!==(prefix=name.slice(0,i))&&(name=name.slice(i+1)),d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name}},d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if("string"==typeof name){var node=this.node();return name=d3.ns.qualify(name),name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name)}for(value in name)this.each(d3_selection_attr(value,name[value]));return this}return this.each(d3_selection_attr(name,value))},d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if("string"==typeof name){var node=this.node(),n=(name=d3_selection_classes(name)).length,i=-1;if(value=node.classList){for(;++i<n;)if(!value.contains(name[i]))return!1}else for(value=node.getAttribute("class");++i<n;)if(!d3_selection_classedRe(name[i]).test(value))return!1;return!0}for(value in name)this.each(d3_selection_classed(value,name[value]));return this}return this.each(d3_selection_classed(name,value))},d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if("string"!=typeof name){n<2&&(value="");for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this}if(n<2){var node=this.node();return d3_window(node).getComputedStyle(node,null).getPropertyValue(name)}priority=""}return this.each(d3_selection_style(name,value,priority))},d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if("string"==typeof name)return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this}return this.each(d3_selection_property(name,value))},d3_selectionPrototype.text=function(value){return arguments.length?this.each("function"==typeof value?function(){var v=value.apply(this,arguments);this.textContent=null==v?"":v}:null==value?function(){this.textContent=""}:function(){this.textContent=value}):this.node().textContent},d3_selectionPrototype.html=function(value){return arguments.length?this.each("function"==typeof value?function(){var v=value.apply(this,arguments);this.innerHTML=null==v?"":v}:null==value?function(){this.innerHTML=""}:function(){this.innerHTML=value}):this.node().innerHTML},d3_selectionPrototype.append=function(name){return name=d3_selection_creator(name),this.select(function(){return this.appendChild(name.apply(this,arguments))})},d3_selectionPrototype.insert=function(name,before){return name=d3_selection_creator(name),before=d3_selection_selector(before),this.select(function(){return this.insertBefore(name.apply(this,arguments),before.apply(this,arguments)||null)})},d3_selectionPrototype.remove=function(){return this.each(d3_selectionRemove)},d3_selectionPrototype.data=function(value,key){function bind(group,groupData){var i,node,nodeData,n=group.length,m=groupData.length,n0=Math.min(n,m),updateNodes=new Array(m),enterNodes=new Array(m),exitNodes=new Array(n);if(key){var keyValue,nodeByKeyValue=new d3_Map,keyValues=new Array(n);for(i=-1;++i<n;)(node=group[i])&&(nodeByKeyValue.has(keyValue=key.call(node,node.__data__,i))?exitNodes[i]=node:nodeByKeyValue.set(keyValue,node),keyValues[i]=keyValue);for(i=-1;++i<m;)(node=nodeByKeyValue.get(keyValue=key.call(groupData,nodeData=groupData[i],i)))?!0!==node&&(updateNodes[i]=node,node.__data__=nodeData):enterNodes[i]=d3_selection_dataNode(nodeData),nodeByKeyValue.set(keyValue,!0);for(i=-1;++i<n;)i in keyValues&&!0!==nodeByKeyValue.get(keyValues[i])&&(exitNodes[i]=group[i])}else{for(i=-1;++i<n0;)node=group[i],nodeData=groupData[i],node?(node.__data__=nodeData,updateNodes[i]=node):enterNodes[i]=d3_selection_dataNode(nodeData);for(;i<m;++i)enterNodes[i]=d3_selection_dataNode(groupData[i]);for(;i<n;++i)exitNodes[i]=group[i]}enterNodes.update=updateNodes,enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode,enter.push(enterNodes),update.push(updateNodes),exit.push(exitNodes)}var group,node,i=-1,n=this.length;if(!arguments.length){for(value=new Array(n=(group=this[0]).length);++i<n;)(node=group[i])&&(value[i]=node.__data__);return value}var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if("function"==typeof value)for(;++i<n;)bind(group=this[i],value.call(group,group.parentNode.__data__,i));else for(;++i<n;)bind(group=this[i],value);return update.enter=function(){return enter},update.exit=function(){return exit},update},d3_selectionPrototype.datum=function(value){return arguments.length?this.property("__data__",value):this.property("__data__")},d3_selectionPrototype.filter=function(filter){var subgroup,group,node,subgroups=[];"function"!=typeof filter&&(filter=d3_selection_filter(filter));for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]),subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++)(node=group[i])&&filter.call(node,node.__data__,i,j)&&subgroup.push(node)}return d3_selection(subgroups)},d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;)for(var node,group=this[j],i=group.length-1,next=group[i];--i>=0;)(node=group[i])&&(next&&next!==node.nextSibling&&next.parentNode.insertBefore(node,next),next=node);return this},d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order()},d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j)})},d3_selectionPrototype.call=function(callback){var args=d3_array(arguments);return callback.apply(args[0]=this,args),this},d3_selectionPrototype.empty=function(){return!this.node()},d3_selectionPrototype.node=function(){for(var j=0,m=this.length;j<m;j++)for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node}return null},d3_selectionPrototype.size=function(){var n=0;return d3_selection_each(this,function(){++n}),n};var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter,d3.selection.enter.prototype=d3_selection_enterPrototype,d3_selection_enterPrototype.append=d3_selectionPrototype.append,d3_selection_enterPrototype.empty=d3_selectionPrototype.empty,d3_selection_enterPrototype.node=d3_selectionPrototype.node,d3_selection_enterPrototype.call=d3_selectionPrototype.call,d3_selection_enterPrototype.size=d3_selectionPrototype.size,d3_selection_enterPrototype.select=function(selector){for(var subgroup,subnode,upgroup,group,node,subgroups=[],j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update,subgroups.push(subgroup=[]),subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;)(node=group[i])?(subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i,j)),subnode.__data__=node.__data__):subgroup.push(null)}return d3_selection(subgroups)},d3_selection_enterPrototype.insert=function(name,before){return arguments.length<2&&(before=d3_selection_enterInsertBefore(this)),d3_selectionPrototype.insert.call(this,name,before)},d3.select=function(node){var group;return"string"==typeof node?(group=[d3_select(node,d3_document)],group.parentNode=d3_document.documentElement):(group=[node],group.parentNode=d3_documentElement(node)),d3_selection([group])},d3.selectAll=function(nodes){var group;return"string"==typeof nodes?(group=d3_array(d3_selectAll(nodes,d3_document)),group.parentNode=d3_document.documentElement):(group=d3_array(nodes),group.parentNode=null),d3_selection([group])},d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if("string"!=typeof type){n<2&&(listener=!1);for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this}if(n<2)return(n=this.node()["__on"+type])&&n._;capture=!1}return this.each(d3_selection_on(type,listener,capture))};var d3_selection_onFilters=d3.map({mouseenter:"mouseover",mouseleave:"mouseout"});d3_document&&d3_selection_onFilters.forEach(function(k){"on"+k in d3_document&&d3_selection_onFilters.remove(k)});var d3_event_dragSelect,d3_event_dragId=0;d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource())};var d3_mouse_bug44083=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;d3.touch=function(container,touches,identifier){if(arguments.length<3&&(identifier=touches,touches=d3_eventSource().changedTouches),touches)for(var touch,i=0,n=touches.length;i<n;++i)if((touch=touches[i]).identifier===identifier)return d3_mousePoint(container,touch)},d3.behavior.drag=function(){function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",touchstart)}function dragstart(id,position,subject,move,end){return function(){function moved(){var dx,dy,position1=position(parent,dragId);position1&&(dx=position1[0]-position0[0],dy=position1[1]-position0[1],dragged|=dx|dy,position0=position1,dispatch({type:"drag",x:position1[0]+dragOffset[0],y:position1[1]+dragOffset[1],dx:dx,dy:dy}))}function ended(){position(parent,dragId)&&(dragSubject.on(move+dragName,null).on(end+dragName,null),dragRestore(dragged),dispatch({type:"dragend"}))}var dragOffset,that=this,target=d3.event.target.correspondingElement||d3.event.target,parent=that.parentNode,dispatch=event.of(that,arguments),dragged=0,dragId=id(),dragName=".drag"+(null==dragId?"":"-"+dragId),dragSubject=d3.select(subject(target)).on(move+dragName,moved).on(end+dragName,ended),dragRestore=d3_event_dragSuppress(target),position0=position(parent,dragId);origin?(dragOffset=origin.apply(that,arguments),dragOffset=[dragOffset.x-position0[0],dragOffset.y-position0[1]]):dragOffset=[0,0],dispatch({type:"dragstart"})}}var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null,mousedown=dragstart(d3_noop,d3.mouse,d3_window,"mousemove","mouseup"),touchstart=dragstart(d3_behavior_dragTouchId,d3.touch,d3_identity,"touchmove","touchend");return drag.origin=function(x){return arguments.length?(origin=x,drag):origin},d3.rebind(drag,event,"on")},d3.touches=function(container,touches){return arguments.length<2&&(touches=d3_eventSource().touches),touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);return point.identifier=touch.identifier,point}):[]};var ε=1e-6,ε2=ε*ε,π=Math.PI,τ=2*π,τε=τ-ε,halfπ=π/2,d3_radians=π/180,d3_degrees=180/π,ρ=Math.SQRT2;d3.interpolateZoom=function(p0,p1){var i,S,ux0=p0[0],uy0=p0[1],w0=p0[2],ux1=p1[0],uy1=p1[1],w1=p1[2],dx=ux1-ux0,dy=uy1-uy0,d2=dx*dx+dy*dy;if(d2<ε2)S=Math.log(w1/w0)/ρ,i=function(t){return[ux0+t*dx,uy0+t*dy,w0*Math.exp(ρ*t*S)]};else{var d1=Math.sqrt(d2),b0=(w1*w1-w0*w0+4*d2)/(2*w0*2*d1),b1=(w1*w1-w0*w0-4*d2)/(2*w1*2*d1),r0=Math.log(Math.sqrt(b0*b0+1)-b0),r1=Math.log(Math.sqrt(b1*b1+1)-b1);S=(r1-r0)/ρ,i=function(t){var s=t*S,coshr0=d3_cosh(r0),u=w0/(2*d1)*(coshr0*d3_tanh(ρ*s+r0)-d3_sinh(r0));return[ux0+u*dx,uy0+u*dy,w0*coshr0/d3_cosh(ρ*s+r0)]}}return i.duration=1e3*S,i},d3.behavior.zoom=function(){function zoom(g){g.on(mousedown,mousedowned).on(d3_behavior_zoomWheel+".zoom",mousewheeled).on("dblclick.zoom",dblclicked).on(touchstart,touchstarted)}function location(p){return[(p[0]-view.x)/view.k,(p[1]-view.y)/view.k]}function point(l){return[l[0]*view.k+view.x,l[1]*view.k+view.y]}function scaleTo(s){view.k=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s))}function translateTo(p,l){l=point(l),view.x+=p[0]-l[0],view.y+=p[1]-l[1]}function zoomTo(that,p,l,k){that.__chart__={x:view.x,y:view.y,k:view.k},scaleTo(Math.pow(2,k)),translateTo(center0=p,l),that=d3.select(that),duration>0&&(that=that.transition().duration(duration)),that.call(zoom.event)}function rescale(){x1&&x1.domain(x0.range().map(function(x){return(x-view.x)/view.k}).map(x0.invert)),y1&&y1.domain(y0.range().map(function(y){return(y-view.y)/view.k}).map(y0.invert))}function zoomstarted(dispatch){zooming++||dispatch({type:"zoomstart"})}function zoomed(dispatch){rescale(),dispatch({type:"zoom",scale:view.k,translate:[view.x,view.y]})}function zoomended(dispatch){--zooming||(dispatch({type:"zoomend"}),center0=null)}function mousedowned(){function moved(){dragged=1,translateTo(d3.mouse(that),location0),zoomed(dispatch)}function ended(){subject.on(mousemove,null).on(mouseup,null),dragRestore(dragged),zoomended(dispatch)}var that=this,dispatch=event.of(that,arguments),dragged=0,subject=d3.select(d3_window(that)).on(mousemove,moved).on(mouseup,ended),location0=location(d3.mouse(that)),dragRestore=d3_event_dragSuppress(that);d3_selection_interrupt.call(that),zoomstarted(dispatch)}function touchstarted(){function relocate(){var touches=d3.touches(that);return scale0=view.k,touches.forEach(function(t){t.identifier in locations0&&(locations0[t.identifier]=location(t))}),touches}function started(){var target=d3.event.target;d3.select(target).on(touchmove,moved).on(touchend,ended),targets.push(target);for(var changed=d3.event.changedTouches,i=0,n=changed.length;i<n;++i)locations0[changed[i].identifier]=null;var touches=relocate(),now=Date.now();if(1===touches.length){if(now-touchtime<500){var p=touches[0];zoomTo(that,p,locations0[p.identifier],Math.floor(Math.log(view.k)/Math.LN2)+1),d3_eventPreventDefault()}touchtime=now}else if(touches.length>1){var p=touches[0],q=touches[1],dx=p[0]-q[0],dy=p[1]-q[1];distance0=dx*dx+dy*dy}}function moved(){var p0,l0,p1,l1,touches=d3.touches(that);d3_selection_interrupt.call(that);for(var i=0,n=touches.length;i<n;++i,l1=null)if(p1=touches[i],l1=locations0[p1.identifier]){if(l0)break;p0=p1,l0=l1}if(l1){var distance1=(distance1=p1[0]-p0[0])*distance1+(distance1=p1[1]-p0[1])*distance1,scale1=distance0&&Math.sqrt(distance1/distance0);p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2],l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2],scaleTo(scale1*scale0)}touchtime=null,translateTo(p0,l0),zoomed(dispatch)}function ended(){if(d3.event.touches.length){for(var changed=d3.event.changedTouches,i=0,n=changed.length;i<n;++i)delete locations0[changed[i].identifier];for(var identifier in locations0)return void relocate()}d3.selectAll(targets).on(zoomName,null),subject.on(mousedown,mousedowned).on(touchstart,touchstarted),dragRestore(),zoomended(dispatch)}var scale0,that=this,dispatch=event.of(that,arguments),locations0={},distance0=0,zoomName=".zoom-"+d3.event.changedTouches[0].identifier,touchmove="touchmove"+zoomName,touchend="touchend"+zoomName,targets=[],subject=d3.select(that),dragRestore=d3_event_dragSuppress(that);started(),zoomstarted(dispatch),subject.on(mousedown,null).on(touchstart,started)}function mousewheeled(){var dispatch=event.of(this,arguments);mousewheelTimer?clearTimeout(mousewheelTimer):(d3_selection_interrupt.call(this),translate0=location(center0=center||d3.mouse(this)),zoomstarted(dispatch)),mousewheelTimer=setTimeout(function(){mousewheelTimer=null,zoomended(dispatch)},50),d3_eventPreventDefault(),scaleTo(Math.pow(2,.002*d3_behavior_zoomDelta())*view.k),translateTo(center0,translate0),zoomed(dispatch)}function dblclicked(){var p=d3.mouse(this),k=Math.log(view.k)/Math.LN2;zoomTo(this,p,location(p),d3.event.shiftKey?Math.ceil(k)-1:Math.floor(k)+1)}var translate0,center0,center,mousewheelTimer,touchtime,x0,x1,y0,y1,view={x:0,y:0,k:1},size=[960,500],scaleExtent=d3_behavior_zoomInfinity,duration=250,zooming=0,mousedown="mousedown.zoom",mousemove="mousemove.zoom",mouseup="mouseup.zoom",touchstart="touchstart.zoom",event=d3_eventDispatch(zoom,"zoomstart","zoom","zoomend");return d3_behavior_zoomWheel||(d3_behavior_zoomWheel="onwheel"in d3_document?(d3_behavior_zoomDelta=function(){return-d3.event.deltaY*(d3.event.deltaMode?120:1)},"wheel"):"onmousewheel"in d3_document?(d3_behavior_zoomDelta=function(){return d3.event.wheelDelta},"mousewheel"):(d3_behavior_zoomDelta=function(){return-d3.event.detail},"MozMousePixelScroll")),zoom.event=function(g){g.each(function(){var dispatch=event.of(this,arguments),view1=view;d3_transitionInheritId?d3.select(this).transition().each("start.zoom",function(){view=this.__chart__||{x:0,y:0,k:1},zoomstarted(dispatch)}).tween("zoom:zoom",function(){var dx=size[0],dy=size[1],cx=center0?center0[0]:dx/2,cy=center0?center0[1]:dy/2,i=d3.interpolateZoom([(cx-view.x)/view.k,(cy-view.y)/view.k,dx/view.k],[(cx-view1.x)/view1.k,(cy-view1.y)/view1.k,dx/view1.k]);return function(t){var l=i(t),k=dx/l[2];this.__chart__=view={x:cx-l[0]*k,y:cy-l[1]*k,k:k},zoomed(dispatch)}}).each("interrupt.zoom",function(){zoomended(dispatch)}).each("end.zoom",function(){zoomended(dispatch)}):(this.__chart__=view,zoomstarted(dispatch),zoomed(dispatch),zoomended(dispatch))})},zoom.translate=function(_){return arguments.length?(view={x:+_[0],y:+_[1],k:view.k},rescale(),zoom):[view.x,view.y]},zoom.scale=function(_){return arguments.length?(view={x:view.x,y:view.y,k:null},scaleTo(+_),rescale(),zoom):view.k},zoom.scaleExtent=function(_){return arguments.length?(scaleExtent=null==_?d3_behavior_zoomInfinity:[+_[0],+_[1]],zoom):scaleExtent},zoom.center=function(_){return arguments.length?(center=_&&[+_[0],+_[1]],zoom):center},zoom.size=function(_){return arguments.length?(size=_&&[+_[0],+_[1]],zoom):size},zoom.duration=function(_){return arguments.length?(duration=+_,zoom):duration},zoom.x=function(z){return arguments.length?(x1=z,x0=z.copy(),view={x:0,y:0,k:1},zoom):x1},zoom.y=function(z){return arguments.length?(y1=z,y0=z.copy(),view={x:0,y:0,k:1},zoom):y1},d3.rebind(zoom,event,"on")};var d3_behavior_zoomDelta,d3_behavior_zoomWheel,d3_behavior_zoomInfinity=[0,1/0];d3.color=d3_color,d3_color.prototype.toString=function(){return this.rgb()+""},d3.hsl=d3_hsl;var d3_hslPrototype=d3_hsl.prototype=new d3_color;d3_hslPrototype.brighter=function(k){return k=Math.pow(.7,arguments.length?k:1),new d3_hsl(this.h,this.s,this.l/k)},d3_hslPrototype.darker=function(k){return k=Math.pow(.7,arguments.length?k:1),new d3_hsl(this.h,this.s,k*this.l)},d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l)},d3.hcl=d3_hcl;var d3_hclPrototype=d3_hcl.prototype=new d3_color;d3_hclPrototype.brighter=function(k){return new d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)))},d3_hclPrototype.darker=function(k){return new d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)))},d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb()},d3.lab=d3_lab;var d3_lab_K=18,d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883,d3_labPrototype=d3_lab.prototype=new d3_color;d3_labPrototype.brighter=function(k){return new d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b)},d3_labPrototype.darker=function(k){return new d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b)},d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b)},d3.rgb=d3_rgb;var d3_rgbPrototype=d3_rgb.prototype=new d3_color;d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;return r||g||b?(r&&r<i&&(r=i),g&&g<i&&(g=i),b&&b<i&&(b=i),new d3_rgb(Math.min(255,r/k),Math.min(255,g/k),Math.min(255,b/k))):new d3_rgb(i,i,i)},d3_rgbPrototype.darker=function(k){return k=Math.pow(.7,arguments.length?k:1),new d3_rgb(k*this.r,k*this.g,k*this.b)},d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b)},d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b)};var d3_rgb_names=d3.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgbNumber(value))}),d3.functor=d3_functor,d3.xhr=d3_xhrType(d3_identity),d3.dsv=function(delimiter,mimeType){function dsv(url,row,callback){arguments.length<3&&(callback=row,row=null);var xhr=d3_xhr(url,mimeType,null==row?response:typedResponse(row),callback);return xhr.row=function(_){return arguments.length?xhr.response(null==(row=_)?response:typedResponse(_)):row},xhr}function response(request){return dsv.parse(request.responseText)}function typedResponse(f){return function(request){return dsv.parse(request.responseText,f)}}function formatRow(row){return row.map(formatValue).join(delimiter)}function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text}var reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);return dsv.parse=function(text,f){var o;return dsv.parseRows(text,function(row,i){if(o)return o(row,i-1);var a=new Function("d","return {"+row.map(function(name,i){return JSON.stringify(name)+": d["+i+"]"}).join(",")+"}");o=f?function(row,i){return f(a(row),i)}:a})},dsv.parseRows=function(text,f){function token(){if(I>=N)return EOF;if(eol)return eol=!1,EOL;var j=I;if(34===text.charCodeAt(j)){for(var i=j;i++<N;)if(34===text.charCodeAt(i)){if(34!==text.charCodeAt(i+1))break;++i}I=i+2;var c=text.charCodeAt(i+1);return 13===c?(eol=!0,10===text.charCodeAt(i+2)&&++I):10===c&&(eol=!0),text.slice(j+1,i).replace(/""/g,'"')}for(;I<N;){var c=text.charCodeAt(I++),k=1;if(10===c)eol=!0;else if(13===c)eol=!0,10===text.charCodeAt(I)&&(++I,++k);else if(c!==delimiterCode)continue;return text.slice(j,I-k)}return text.slice(j)}for(var t,eol,EOL={},EOF={},rows=[],N=text.length,I=0,n=0;(t=token())!==EOF;){for(var a=[];t!==EOL&&t!==EOF;)a.push(t),t=token();f&&null==(a=f(a,n++))||rows.push(a)}return rows},dsv.format=function(rows){if(Array.isArray(rows[0]))return dsv.formatRows(rows);var fieldSet=new d3_Set,fields=[];return rows.forEach(function(row){for(var field in row)fieldSet.has(field)||fields.push(fieldSet.add(field))}),[fields.map(formatValue).join(delimiter)].concat(rows.map(function(row){return fields.map(function(field){return formatValue(row[field])}).join(delimiter)})).join("\n")},dsv.formatRows=function(rows){return rows.map(formatRow).join("\n")},dsv},d3.csv=d3.dsv(",","text/csv"),d3.tsv=d3.dsv("\t","text/tab-separated-values");var d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_frame=this[d3_vendorSymbol(this,"requestAnimationFrame")]||function(callback){setTimeout(callback,17)};d3.timer=function(){d3_timer.apply(this,arguments)},d3.timer.flush=function(){d3_timer_mark(),d3_timer_sweep()},d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x)};var d3_formatPrefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;return(value=+value)&&(value<0&&(value*=-1),precision&&(value=d3.round(value,d3_format_precision(value,precision))),i=1+Math.floor(1e-12+Math.log(value)/Math.LN10),i=Math.max(-24,Math.min(24,3*Math.floor((i-1)/3)))),d3_formatPrefixes[8+i/3]};var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,d3_format_types=d3.map({b:function(x){return x.toString(2)},c:function(x){return String.fromCharCode(x)},o:function(x){return x.toString(8)},x:function(x){return x.toString(16)},X:function(x){return x.toString(16).toUpperCase()},g:function(x,p){return x.toPrecision(p)},e:function(x,p){return x.toExponential(p)},f:function(x,p){return x.toFixed(p)},r:function(x,p){return(x=d3.round(x,d3_format_precision(x,p))).toFixed(Math.max(0,Math.min(20,d3_format_precision(x*(1+1e-15),p))))}}),d3_time=d3.time={},d3_date=Date;d3_date_utc.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments)},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments)},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments)},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments)},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments)},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments)},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments)}};var d3_time_prototype=Date.prototype;d3_time.year=d3_time_interval(function(date){return date=d3_time.day(date),date.setMonth(0,1),date},function(date,offset){date.setFullYear(date.getFullYear()+offset)},function(date){return date.getFullYear()}),d3_time.years=d3_time.year.range,
d3_time.years.utc=d3_time.year.utc.range,d3_time.day=d3_time_interval(function(date){var day=new d3_date(2e3,0);return day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate()),day},function(date,offset){date.setDate(date.getDate()+offset)},function(date){return date.getDate()-1}),d3_time.days=d3_time.day.range,d3_time.days.utc=d3_time.day.utc.range,d3_time.dayOfYear=function(date){var year=d3_time.year(date);return Math.floor((date-year-6e4*(date.getTimezoneOffset()-year.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(day,i){i=7-i;var interval=d3_time[day]=d3_time_interval(function(date){return(date=d3_time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7),date},function(date,offset){date.setDate(date.getDate()+7*Math.floor(offset))},function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)-(day!==i)});d3_time[day+"s"]=interval.range,d3_time[day+"s"].utc=interval.utc.range,d3_time[day+"OfYear"]=function(date){var day=d3_time.year(date).getDay();return Math.floor((d3_time.dayOfYear(date)+(day+i)%7)/7)}}),d3_time.week=d3_time.sunday,d3_time.weeks=d3_time.sunday.range,d3_time.weeks.utc=d3_time.sunday.utc.range,d3_time.weekOfYear=d3_time.sundayOfYear;var d3_time_formatPads={"-":"",_:" ",0:"0"},d3_time_numberRe=/^\s*\d+/,d3_time_percentRe=/^%/;d3.locale=function(locale){return{numberFormat:d3_locale_numberFormat(locale),timeFormat:d3_locale_timeFormat(locale)}};var d3_locale_enUS=d3.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});d3.format=d3_locale_enUS.numberFormat,d3.geo={},d3_adder.prototype={s:0,t:0,add:function(y){d3_adderSum(y,this.t,d3_adderTemp),d3_adderSum(d3_adderTemp.s,this.s,this),this.s?this.t+=d3_adderTemp.t:this.s=d3_adderTemp.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var d3_adderTemp=new d3_adder;d3.geo.stream=function(object,listener){object&&d3_geo_streamObjectType.hasOwnProperty(object.type)?d3_geo_streamObjectType[object.type](object,listener):d3_geo_streamGeometry(object,listener)};var d3_geo_streamObjectType={Feature:function(feature,listener){d3_geo_streamGeometry(feature.geometry,listener)},FeatureCollection:function(object,listener){for(var features=object.features,i=-1,n=features.length;++i<n;)d3_geo_streamGeometry(features[i].geometry,listener)}},d3_geo_streamGeometryType={Sphere:function(object,listener){listener.sphere()},Point:function(object,listener){object=object.coordinates,listener.point(object[0],object[1],object[2])},MultiPoint:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)object=coordinates[i],listener.point(object[0],object[1],object[2])},LineString:function(object,listener){d3_geo_streamLine(object.coordinates,listener,0)},MultiLineString:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)d3_geo_streamLine(coordinates[i],listener,0)},Polygon:function(object,listener){d3_geo_streamPolygon(object.coordinates,listener)},MultiPolygon:function(object,listener){for(var coordinates=object.coordinates,i=-1,n=coordinates.length;++i<n;)d3_geo_streamPolygon(coordinates[i],listener)},GeometryCollection:function(object,listener){for(var geometries=object.geometries,i=-1,n=geometries.length;++i<n;)d3_geo_streamGeometry(geometries[i],listener)}};d3.geo.area=function(object){return d3_geo_areaSum=0,d3.geo.stream(object,d3_geo_area),d3_geo_areaSum};var d3_geo_areaSum,d3_geo_areaRingSum=new d3_adder,d3_geo_area={sphere:function(){d3_geo_areaSum+=4*π},point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_areaRingSum.reset(),d3_geo_area.lineStart=d3_geo_areaRingStart},polygonEnd:function(){var area=2*d3_geo_areaRingSum;d3_geo_areaSum+=area<0?4*π+area:area,d3_geo_area.lineStart=d3_geo_area.lineEnd=d3_geo_area.point=d3_noop}};d3.geo.bounds=function(){function point(λ,φ){ranges.push(range=[λ0=λ,λ1=λ]),φ<φ0&&(φ0=φ),φ>φ1&&(φ1=φ)}function linePoint(λ,φ){var p=d3_geo_cartesian([λ*d3_radians,φ*d3_radians]);if(p0){var normal=d3_geo_cartesianCross(p0,p),equatorial=[normal[1],-normal[0],0],inflection=d3_geo_cartesianCross(equatorial,normal);d3_geo_cartesianNormalize(inflection),inflection=d3_geo_spherical(inflection);var dλ=λ-λ_,s=dλ>0?1:-1,λi=inflection[0]*d3_degrees*s,antimeridian=abs(dλ)>180;if(antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=inflection[1]*d3_degrees;φi>φ1&&(φ1=φi)}else if(λi=(λi+360)%360-180,antimeridian^(s*λ_<λi&&λi<s*λ)){var φi=-inflection[1]*d3_degrees;φi<φ0&&(φ0=φi)}else φ<φ0&&(φ0=φ),φ>φ1&&(φ1=φ);antimeridian?λ<λ_?angle(λ0,λ)>angle(λ0,λ1)&&(λ1=λ):angle(λ,λ1)>angle(λ0,λ1)&&(λ0=λ):λ1>=λ0?(λ<λ0&&(λ0=λ),λ>λ1&&(λ1=λ)):λ>λ_?angle(λ0,λ)>angle(λ0,λ1)&&(λ1=λ):angle(λ,λ1)>angle(λ0,λ1)&&(λ0=λ)}else point(λ,φ);p0=p,λ_=λ}function lineStart(){bound.point=linePoint}function lineEnd(){range[0]=λ0,range[1]=λ1,bound.point=point,p0=null}function ringPoint(λ,φ){if(p0){var dλ=λ-λ_;dλSum+=abs(dλ)>180?dλ+(dλ>0?360:-360):dλ}else λ__=λ,φ__=φ;d3_geo_area.point(λ,φ),linePoint(λ,φ)}function ringStart(){d3_geo_area.lineStart()}function ringEnd(){ringPoint(λ__,φ__),d3_geo_area.lineEnd(),abs(dλSum)>ε&&(λ0=-(λ1=180)),range[0]=λ0,range[1]=λ1,p0=null}function angle(λ0,λ1){return(λ1-=λ0)<0?λ1+360:λ1}function compareRanges(a,b){return a[0]-b[0]}function withinRange(x,range){return range[0]<=range[1]?range[0]<=x&&x<=range[1]:x<range[0]||range[1]<x}var λ0,φ0,λ1,φ1,λ_,λ__,φ__,p0,dλSum,ranges,range,bound={point:point,lineStart:lineStart,lineEnd:lineEnd,polygonStart:function(){bound.point=ringPoint,bound.lineStart=ringStart,bound.lineEnd=ringEnd,dλSum=0,d3_geo_area.polygonStart()},polygonEnd:function(){d3_geo_area.polygonEnd(),bound.point=point,bound.lineStart=lineStart,bound.lineEnd=lineEnd,d3_geo_areaRingSum<0?(λ0=-(λ1=180),φ0=-(φ1=90)):dλSum>ε?φ1=90:dλSum<-ε&&(φ0=-90),range[0]=λ0,range[1]=λ1}};return function(feature){φ1=λ1=-(λ0=φ0=1/0),ranges=[],d3.geo.stream(feature,bound);var n=ranges.length;if(n){ranges.sort(compareRanges);for(var b,i=1,a=ranges[0],merged=[a];i<n;++i)b=ranges[i],withinRange(b[0],a)||withinRange(b[1],a)?(angle(a[0],b[1])>angle(a[0],a[1])&&(a[1]=b[1]),angle(b[0],a[1])>angle(a[0],a[1])&&(a[0]=b[0])):merged.push(a=b);for(var dλ,b,best=-1/0,n=merged.length-1,i=0,a=merged[n];i<=n;a=b,++i)b=merged[i],(dλ=angle(a[1],b[0]))>best&&(best=dλ,λ0=b[0],λ1=a[1])}return ranges=range=null,λ0===1/0||φ0===1/0?[[NaN,NaN],[NaN,NaN]]:[[λ0,φ0],[λ1,φ1]]}}(),d3.geo.centroid=function(object){d3_geo_centroidW0=d3_geo_centroidW1=d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0,d3.geo.stream(object,d3_geo_centroid);var x=d3_geo_centroidX2,y=d3_geo_centroidY2,z=d3_geo_centroidZ2,m=x*x+y*y+z*z;return m<ε2&&(x=d3_geo_centroidX1,y=d3_geo_centroidY1,z=d3_geo_centroidZ1,d3_geo_centroidW1<ε&&(x=d3_geo_centroidX0,y=d3_geo_centroidY0,z=d3_geo_centroidZ0),(m=x*x+y*y+z*z)<ε2)?[NaN,NaN]:[Math.atan2(y,x)*d3_degrees,d3_asin(z/Math.sqrt(m))*d3_degrees]};var d3_geo_centroidW0,d3_geo_centroidW1,d3_geo_centroidX0,d3_geo_centroidY0,d3_geo_centroidZ0,d3_geo_centroidX1,d3_geo_centroidY1,d3_geo_centroidZ1,d3_geo_centroidX2,d3_geo_centroidY2,d3_geo_centroidZ2,d3_geo_centroid={sphere:d3_noop,point:d3_geo_centroidPoint,lineStart:d3_geo_centroidLineStart,lineEnd:d3_geo_centroidLineEnd,polygonStart:function(){d3_geo_centroid.lineStart=d3_geo_centroidRingStart},polygonEnd:function(){d3_geo_centroid.lineStart=d3_geo_centroidLineStart}},d3_geo_clipAntimeridian=d3_geo_clip(d3_true,d3_geo_clipAntimeridianLine,d3_geo_clipAntimeridianInterpolate,[-π,-π/2]),d3_geo_clipExtentMAX=1e9;d3.geo.clipExtent=function(){var x0,y0,x1,y1,stream,clip,clipExtent={stream:function(output){return stream&&(stream.valid=!1),stream=clip(output),stream.valid=!0,stream},extent:function(_){return arguments.length?(clip=d3_geo_clipExtent(x0=+_[0][0],y0=+_[0][1],x1=+_[1][0],y1=+_[1][1]),stream&&(stream.valid=!1,stream=null),clipExtent):[[x0,y0],[x1,y1]]}};return clipExtent.extent([[0,0],[960,500]])},(d3.geo.conicEqualArea=function(){return d3_geo_conic(d3_geo_conicEqualArea)}).raw=d3_geo_conicEqualArea,d3.geo.albers=function(){return d3.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},d3.geo.albersUsa=function(){function albersUsa(coordinates){var x=coordinates[0],y=coordinates[1];return point=null,lower48Point(x,y),point||(alaskaPoint(x,y),point)||hawaiiPoint(x,y),point}var point,lower48Point,alaskaPoint,hawaiiPoint,lower48=d3.geo.albers(),alaska=d3.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),hawaii=d3.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),pointStream={point:function(x,y){point=[x,y]}};return albersUsa.invert=function(coordinates){var k=lower48.scale(),t=lower48.translate(),x=(coordinates[0]-t[0])/k,y=(coordinates[1]-t[1])/k;return(y>=.12&&y<.234&&x>=-.425&&x<-.214?alaska:y>=.166&&y<.234&&x>=-.214&&x<-.115?hawaii:lower48).invert(coordinates)},albersUsa.stream=function(stream){var lower48Stream=lower48.stream(stream),alaskaStream=alaska.stream(stream),hawaiiStream=hawaii.stream(stream);return{point:function(x,y){lower48Stream.point(x,y),alaskaStream.point(x,y),hawaiiStream.point(x,y)},sphere:function(){lower48Stream.sphere(),alaskaStream.sphere(),hawaiiStream.sphere()},lineStart:function(){lower48Stream.lineStart(),alaskaStream.lineStart(),hawaiiStream.lineStart()},lineEnd:function(){lower48Stream.lineEnd(),alaskaStream.lineEnd(),hawaiiStream.lineEnd()},polygonStart:function(){lower48Stream.polygonStart(),alaskaStream.polygonStart(),hawaiiStream.polygonStart()},polygonEnd:function(){lower48Stream.polygonEnd(),alaskaStream.polygonEnd(),hawaiiStream.polygonEnd()}}},albersUsa.precision=function(_){return arguments.length?(lower48.precision(_),alaska.precision(_),hawaii.precision(_),albersUsa):lower48.precision()},albersUsa.scale=function(_){return arguments.length?(lower48.scale(_),alaska.scale(.35*_),hawaii.scale(_),albersUsa.translate(lower48.translate())):lower48.scale()},albersUsa.translate=function(_){if(!arguments.length)return lower48.translate();var k=lower48.scale(),x=+_[0],y=+_[1];return lower48Point=lower48.translate(_).clipExtent([[x-.455*k,y-.238*k],[x+.455*k,y+.238*k]]).stream(pointStream).point,alaskaPoint=alaska.translate([x-.307*k,y+.201*k]).clipExtent([[x-.425*k+ε,y+.12*k+ε],[x-.214*k-ε,y+.234*k-ε]]).stream(pointStream).point,hawaiiPoint=hawaii.translate([x-.205*k,y+.212*k]).clipExtent([[x-.214*k+ε,y+.166*k+ε],[x-.115*k-ε,y+.234*k-ε]]).stream(pointStream).point,albersUsa},albersUsa.scale(1070)};var d3_geo_pathAreaSum,d3_geo_pathAreaPolygon,d3_geo_pathBoundsX0,d3_geo_pathBoundsY0,d3_geo_pathBoundsX1,d3_geo_pathBoundsY1,d3_geo_pathArea={point:d3_noop,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:function(){d3_geo_pathAreaPolygon=0,d3_geo_pathArea.lineStart=d3_geo_pathAreaRingStart},polygonEnd:function(){d3_geo_pathArea.lineStart=d3_geo_pathArea.lineEnd=d3_geo_pathArea.point=d3_noop,d3_geo_pathAreaSum+=abs(d3_geo_pathAreaPolygon/2)}},d3_geo_pathBounds={point:d3_geo_pathBoundsPoint,lineStart:d3_noop,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop},d3_geo_pathCentroid={point:d3_geo_pathCentroidPoint,lineStart:d3_geo_pathCentroidLineStart,lineEnd:d3_geo_pathCentroidLineEnd,polygonStart:function(){d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidRingStart},polygonEnd:function(){d3_geo_pathCentroid.point=d3_geo_pathCentroidPoint,d3_geo_pathCentroid.lineStart=d3_geo_pathCentroidLineStart,d3_geo_pathCentroid.lineEnd=d3_geo_pathCentroidLineEnd}};d3.geo.path=function(){function path(object){return object&&("function"==typeof pointRadius&&contextStream.pointRadius(+pointRadius.apply(this,arguments)),cacheStream&&cacheStream.valid||(cacheStream=projectStream(contextStream)),d3.geo.stream(object,cacheStream)),contextStream.result()}function reset(){return cacheStream=null,path}var projection,context,projectStream,contextStream,cacheStream,pointRadius=4.5;return path.area=function(object){return d3_geo_pathAreaSum=0,d3.geo.stream(object,projectStream(d3_geo_pathArea)),d3_geo_pathAreaSum},path.centroid=function(object){return d3_geo_centroidX0=d3_geo_centroidY0=d3_geo_centroidZ0=d3_geo_centroidX1=d3_geo_centroidY1=d3_geo_centroidZ1=d3_geo_centroidX2=d3_geo_centroidY2=d3_geo_centroidZ2=0,d3.geo.stream(object,projectStream(d3_geo_pathCentroid)),d3_geo_centroidZ2?[d3_geo_centroidX2/d3_geo_centroidZ2,d3_geo_centroidY2/d3_geo_centroidZ2]:d3_geo_centroidZ1?[d3_geo_centroidX1/d3_geo_centroidZ1,d3_geo_centroidY1/d3_geo_centroidZ1]:d3_geo_centroidZ0?[d3_geo_centroidX0/d3_geo_centroidZ0,d3_geo_centroidY0/d3_geo_centroidZ0]:[NaN,NaN]},path.bounds=function(object){return d3_geo_pathBoundsX1=d3_geo_pathBoundsY1=-(d3_geo_pathBoundsX0=d3_geo_pathBoundsY0=1/0),d3.geo.stream(object,projectStream(d3_geo_pathBounds)),[[d3_geo_pathBoundsX0,d3_geo_pathBoundsY0],[d3_geo_pathBoundsX1,d3_geo_pathBoundsY1]]},path.projection=function(_){return arguments.length?(projectStream=(projection=_)?_.stream||d3_geo_pathProjectStream(_):d3_identity,reset()):projection},path.context=function(_){return arguments.length?(contextStream=null==(context=_)?new d3_geo_pathBuffer:new d3_geo_pathContext(_),"function"!=typeof pointRadius&&contextStream.pointRadius(pointRadius),reset()):context},path.pointRadius=function(_){return arguments.length?(pointRadius="function"==typeof _?_:(contextStream.pointRadius(+_),+_),path):pointRadius},path.projection(d3.geo.albersUsa()).context(null)},d3.geo.transform=function(methods){return{stream:function(stream){var transform=new d3_geo_transform(stream);for(var k in methods)transform[k]=methods[k];return transform}}},d3_geo_transform.prototype={point:function(x,y){this.stream.point(x,y)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},d3.geo.projection=d3_geo_projection,d3.geo.projectionMutator=d3_geo_projectionMutator,(d3.geo.equirectangular=function(){return d3_geo_projection(d3_geo_equirectangular)}).raw=d3_geo_equirectangular.invert=d3_geo_equirectangular,d3.geo.rotation=function(rotate){function forward(coordinates){return coordinates=rotate(coordinates[0]*d3_radians,coordinates[1]*d3_radians),coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates}return rotate=d3_geo_rotation(rotate[0]%360*d3_radians,rotate[1]*d3_radians,rotate.length>2?rotate[2]*d3_radians:0),forward.invert=function(coordinates){return coordinates=rotate.invert(coordinates[0]*d3_radians,coordinates[1]*d3_radians),coordinates[0]*=d3_degrees,coordinates[1]*=d3_degrees,coordinates},forward},d3_geo_identityRotation.invert=d3_geo_equirectangular,d3.geo.circle=function(){function circle(){var center="function"==typeof origin?origin.apply(this,arguments):origin,rotate=d3_geo_rotation(-center[0]*d3_radians,-center[1]*d3_radians,0).invert,ring=[];return interpolate(null,null,1,{point:function(x,y){ring.push(x=rotate(x,y)),x[0]*=d3_degrees,x[1]*=d3_degrees}}),{type:"Polygon",coordinates:[ring]}}var angle,interpolate,origin=[0,0],precision=6;return circle.origin=function(x){return arguments.length?(origin=x,circle):origin},circle.angle=function(x){return arguments.length?(interpolate=d3_geo_circleInterpolate((angle=+x)*d3_radians,precision*d3_radians),circle):angle},circle.precision=function(_){return arguments.length?(interpolate=d3_geo_circleInterpolate(angle*d3_radians,(precision=+_)*d3_radians),circle):precision},circle.angle(90)},d3.geo.distance=function(a,b){var t,Δλ=(b[0]-a[0])*d3_radians,φ0=a[1]*d3_radians,φ1=b[1]*d3_radians,sinΔλ=Math.sin(Δλ),cosΔλ=Math.cos(Δλ),sinφ0=Math.sin(φ0),cosφ0=Math.cos(φ0),sinφ1=Math.sin(φ1),cosφ1=Math.cos(φ1);return Math.atan2(Math.sqrt((t=cosφ1*sinΔλ)*t+(t=cosφ0*sinφ1-sinφ0*cosφ1*cosΔλ)*t),sinφ0*sinφ1+cosφ0*cosφ1*cosΔλ)},d3.geo.graticule=function(){function graticule(){return{type:"MultiLineString",coordinates:lines()}}function lines(){return d3.range(Math.ceil(X0/DX)*DX,X1,DX).map(X).concat(d3.range(Math.ceil(Y0/DY)*DY,Y1,DY).map(Y)).concat(d3.range(Math.ceil(x0/dx)*dx,x1,dx).filter(function(x){return abs(x%DX)>ε}).map(x)).concat(d3.range(Math.ceil(y0/dy)*dy,y1,dy).filter(function(y){return abs(y%DY)>ε}).map(y))}var x1,x0,X1,X0,y1,y0,Y1,Y0,x,y,X,Y,dx=10,dy=dx,DX=90,DY=360,precision=2.5;return graticule.lines=function(){return lines().map(function(coordinates){return{type:"LineString",coordinates:coordinates}})},graticule.outline=function(){return{type:"Polygon",coordinates:[X(X0).concat(Y(Y1).slice(1),X(X1).reverse().slice(1),Y(Y0).reverse().slice(1))]}},graticule.extent=function(_){return arguments.length?graticule.majorExtent(_).minorExtent(_):graticule.minorExtent()},graticule.majorExtent=function(_){return arguments.length?(X0=+_[0][0],X1=+_[1][0],Y0=+_[0][1],Y1=+_[1][1],X0>X1&&(_=X0,X0=X1,X1=_),Y0>Y1&&(_=Y0,Y0=Y1,Y1=_),graticule.precision(precision)):[[X0,Y0],[X1,Y1]]},graticule.minorExtent=function(_){return arguments.length?(x0=+_[0][0],x1=+_[1][0],y0=+_[0][1],y1=+_[1][1],x0>x1&&(_=x0,x0=x1,x1=_),y0>y1&&(_=y0,y0=y1,y1=_),graticule.precision(precision)):[[x0,y0],[x1,y1]]},graticule.step=function(_){return arguments.length?graticule.majorStep(_).minorStep(_):graticule.minorStep()},graticule.majorStep=function(_){return arguments.length?(DX=+_[0],DY=+_[1],graticule):[DX,DY]},graticule.minorStep=function(_){return arguments.length?(dx=+_[0],dy=+_[1],graticule):[dx,dy]},graticule.precision=function(_){return arguments.length?(precision=+_,x=d3_geo_graticuleX(y0,y1,90),y=d3_geo_graticuleY(x0,x1,precision),X=d3_geo_graticuleX(Y0,Y1,90),Y=d3_geo_graticuleY(X0,X1,precision),graticule):precision},graticule.majorExtent([[-180,-90+ε],[180,90-ε]]).minorExtent([[-180,-80-ε],[180,80+ε]])},d3.geo.greatArc=function(){function greatArc(){return{type:"LineString",coordinates:[source_||source.apply(this,arguments),target_||target.apply(this,arguments)]}}var source_,target_,source=d3_source,target=d3_target;return greatArc.distance=function(){return d3.geo.distance(source_||source.apply(this,arguments),target_||target.apply(this,arguments))},greatArc.source=function(_){return arguments.length?(source=_,source_="function"==typeof _?null:_,greatArc):source},greatArc.target=function(_){return arguments.length?(target=_,target_="function"==typeof _?null:_,greatArc):target},greatArc.precision=function(){return arguments.length?greatArc:0},greatArc},d3.geo.interpolate=function(source,target){return d3_geo_interpolate(source[0]*d3_radians,source[1]*d3_radians,target[0]*d3_radians,target[1]*d3_radians)},d3.geo.length=function(object){return d3_geo_lengthSum=0,d3.geo.stream(object,d3_geo_length),d3_geo_lengthSum};var d3_geo_lengthSum,d3_geo_length={sphere:d3_noop,point:d3_noop,lineStart:d3_geo_lengthLineStart,lineEnd:d3_noop,polygonStart:d3_noop,polygonEnd:d3_noop},d3_geo_azimuthalEqualArea=d3_geo_azimuthal(function(cosλcosφ){return Math.sqrt(2/(1+cosλcosφ))},function(ρ){return 2*Math.asin(ρ/2)});(d3.geo.azimuthalEqualArea=function(){return d3_geo_projection(d3_geo_azimuthalEqualArea)}).raw=d3_geo_azimuthalEqualArea;var d3_geo_azimuthalEquidistant=d3_geo_azimuthal(function(cosλcosφ){var c=Math.acos(cosλcosφ);return c&&c/Math.sin(c)},d3_identity);(d3.geo.azimuthalEquidistant=function(){return d3_geo_projection(d3_geo_azimuthalEquidistant)}).raw=d3_geo_azimuthalEquidistant,(d3.geo.conicConformal=function(){return d3_geo_conic(d3_geo_conicConformal)}).raw=d3_geo_conicConformal,(d3.geo.conicEquidistant=function(){return d3_geo_conic(d3_geo_conicEquidistant)}).raw=d3_geo_conicEquidistant;var d3_geo_gnomonic=d3_geo_azimuthal(function(cosλcosφ){return 1/cosλcosφ},Math.atan);(d3.geo.gnomonic=function(){return d3_geo_projection(d3_geo_gnomonic)}).raw=d3_geo_gnomonic,d3_geo_mercator.invert=function(x,y){return[x,2*Math.atan(Math.exp(y))-halfπ]},(d3.geo.mercator=function(){return d3_geo_mercatorProjection(d3_geo_mercator)}).raw=d3_geo_mercator;var d3_geo_orthographic=d3_geo_azimuthal(function(){return 1},Math.asin);(d3.geo.orthographic=function(){return d3_geo_projection(d3_geo_orthographic)}).raw=d3_geo_orthographic;var d3_geo_stereographic=d3_geo_azimuthal(function(cosλcosφ){return 1/(1+cosλcosφ)},function(ρ){return 2*Math.atan(ρ)});(d3.geo.stereographic=function(){return d3_geo_projection(d3_geo_stereographic)}).raw=d3_geo_stereographic,d3_geo_transverseMercator.invert=function(x,y){return[-y,2*Math.atan(Math.exp(x))-halfπ]},(d3.geo.transverseMercator=function(){var projection=d3_geo_mercatorProjection(d3_geo_transverseMercator),center=projection.center,rotate=projection.rotate;return projection.center=function(_){return _?center([-_[1],_[0]]):(_=center(),[_[1],-_[0]])},projection.rotate=function(_){return _?rotate([_[0],_[1],_.length>2?_[2]+90:90]):(_=rotate(),[_[0],_[1],_[2]-90])},rotate([0,0,90])}).raw=d3_geo_transverseMercator,d3.geom={},d3.geom.hull=function(vertices){function hull(data){if(data.length<3)return[];var i,fx=d3_functor(x),fy=d3_functor(y),n=data.length,points=[],flippedPoints=[];for(i=0;i<n;i++)points.push([+fx.call(this,data[i],i),+fy.call(this,data[i],i),i]);for(points.sort(d3_geom_hullOrder),i=0;i<n;i++)flippedPoints.push([points[i][0],-points[i][1]]);var upper=d3_geom_hullUpper(points),lower=d3_geom_hullUpper(flippedPoints),skipLeft=lower[0]===upper[0],skipRight=lower[lower.length-1]===upper[upper.length-1],polygon=[];for(i=upper.length-1;i>=0;--i)polygon.push(data[points[upper[i]][2]]);for(i=+skipLeft;i<lower.length-skipRight;++i)polygon.push(data[points[lower[i]][2]]);return polygon}var x=d3_geom_pointX,y=d3_geom_pointY;return arguments.length?hull(vertices):(hull.x=function(_){return arguments.length?(x=_,hull):x},hull.y=function(_){return arguments.length?(y=_,hull):y},hull)},d3.geom.polygon=function(coordinates){return d3_subclass(coordinates,d3_geom_polygonPrototype),coordinates};var d3_geom_polygonPrototype=d3.geom.polygon.prototype=[];d3_geom_polygonPrototype.area=function(){for(var a,i=-1,n=this.length,b=this[n-1],area=0;++i<n;)a=b,b=this[i],area+=a[1]*b[0]-a[0]*b[1];return.5*area},d3_geom_polygonPrototype.centroid=function(k){var a,c,i=-1,n=this.length,x=0,y=0,b=this[n-1];for(arguments.length||(k=-1/(6*this.area()));++i<n;)a=b,b=this[i],c=a[0]*b[1]-b[0]*a[1],x+=(a[0]+b[0])*c,y+=(a[1]+b[1])*c;return[x*k,y*k]},d3_geom_polygonPrototype.clip=function(subject){for(var input,j,m,b,c,d,closed=d3_geom_polygonClosed(subject),i=-1,n=this.length-d3_geom_polygonClosed(this),a=this[n-1];++i<n;){for(input=subject.slice(),subject.length=0,b=this[i],c=input[(m=input.length-closed)-1],j=-1;++j<m;)d=input[j],d3_geom_polygonInside(d,a,b)?(d3_geom_polygonInside(c,a,b)||subject.push(d3_geom_polygonIntersect(c,d,a,b)),subject.push(d)):d3_geom_polygonInside(c,a,b)&&subject.push(d3_geom_polygonIntersect(c,d,a,b)),c=d;closed&&subject.push(subject[0]),a=b}return subject};var d3_geom_voronoiEdges,d3_geom_voronoiCells,d3_geom_voronoiBeaches,d3_geom_voronoiFirstCircle,d3_geom_voronoiCircles,d3_geom_voronoiBeachPool=[],d3_geom_voronoiCirclePool=[];d3_geom_voronoiCell.prototype.prepare=function(){for(var edge,halfEdges=this.edges,iHalfEdge=halfEdges.length;iHalfEdge--;)edge=halfEdges[iHalfEdge].edge,edge.b&&edge.a||halfEdges.splice(iHalfEdge,1);return halfEdges.sort(d3_geom_voronoiHalfEdgeOrder),halfEdges.length},d3_geom_voronoiHalfEdge.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},d3_geom_voronoiRedBlackTree.prototype={insert:function(after,node){var parent,grandpa,uncle;if(after){if(node.P=after,node.N=after.N,after.N&&(after.N.P=node),after.N=node,after.R){for(after=after.R;after.L;)after=after.L;after.L=node}else after.R=node;parent=after}else this._?(after=d3_geom_voronoiRedBlackFirst(this._),node.P=null,node.N=after,after.P=after.L=node,parent=after):(node.P=node.N=null,this._=node,parent=null);for(node.L=node.R=null,node.U=parent,node.C=!0,after=node;parent&&parent.C;)grandpa=parent.U,parent===grandpa.L?(uncle=grandpa.R,uncle&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.R&&(d3_geom_voronoiRedBlackRotateLeft(this,parent),after=parent,parent=after.U),parent.C=!1,grandpa.C=!0,d3_geom_voronoiRedBlackRotateRight(this,grandpa))):(uncle=grandpa.L,uncle&&uncle.C?(parent.C=uncle.C=!1,grandpa.C=!0,after=grandpa):(after===parent.L&&(d3_geom_voronoiRedBlackRotateRight(this,parent),after=parent,parent=after.U),parent.C=!1,grandpa.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,grandpa))),parent=after.U;this._.C=!1},remove:function(node){node.N&&(node.N.P=node.P),node.P&&(node.P.N=node.N),node.N=node.P=null;var sibling,next,red,parent=node.U,left=node.L,right=node.R;if(next=left?right?d3_geom_voronoiRedBlackFirst(right):left:right,parent?parent.L===node?parent.L=next:parent.R=next:this._=next,left&&right?(red=next.C,next.C=node.C,next.L=left,left.U=next,next!==right?(parent=next.U,next.U=node.U,node=next.R,parent.L=node,next.R=right,right.U=next):(next.U=parent,parent=next,node=next.R)):(red=node.C,node=next),node&&(node.U=parent),!red){if(node&&node.C)return void(node.C=!1);do{if(node===this._)break;if(node===parent.L){if(sibling=parent.R,sibling.C&&(sibling.C=!1,parent.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,parent),sibling=parent.R),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.R&&sibling.R.C||(sibling.L.C=!1,sibling.C=!0,d3_geom_voronoiRedBlackRotateRight(this,sibling),sibling=parent.R),sibling.C=parent.C,parent.C=sibling.R.C=!1,d3_geom_voronoiRedBlackRotateLeft(this,parent),node=this._;break}}else if(sibling=parent.L,sibling.C&&(sibling.C=!1,parent.C=!0,d3_geom_voronoiRedBlackRotateRight(this,parent),sibling=parent.L),sibling.L&&sibling.L.C||sibling.R&&sibling.R.C){sibling.L&&sibling.L.C||(sibling.R.C=!1,sibling.C=!0,d3_geom_voronoiRedBlackRotateLeft(this,sibling),sibling=parent.L),sibling.C=parent.C,parent.C=sibling.L.C=!1,d3_geom_voronoiRedBlackRotateRight(this,parent),node=this._;break}sibling.C=!0,node=parent,parent=parent.U}while(!node.C);node&&(node.C=!1)}}},d3.geom.voronoi=function(points){function voronoi(data){var polygons=new Array(data.length),x0=clipExtent[0][0],y0=clipExtent[0][1],x1=clipExtent[1][0],y1=clipExtent[1][1];return d3_geom_voronoi(sites(data),clipExtent).cells.forEach(function(cell,i){var edges=cell.edges,site=cell.site;(polygons[i]=edges.length?edges.map(function(e){var s=e.start();return[s.x,s.y]}):site.x>=x0&&site.x<=x1&&site.y>=y0&&site.y<=y1?[[x0,y1],[x1,y1],[x1,y0],[x0,y0]]:[]).point=data[i]}),polygons}function sites(data){return data.map(function(d,i){return{x:Math.round(fx(d,i)/ε)*ε,y:Math.round(fy(d,i)/ε)*ε,i:i}})}var x=d3_geom_pointX,y=d3_geom_pointY,fx=x,fy=y,clipExtent=d3_geom_voronoiClipExtent;return points?voronoi(points):(voronoi.links=function(data){return d3_geom_voronoi(sites(data)).edges.filter(function(edge){return edge.l&&edge.r}).map(function(edge){return{source:data[edge.l.i],target:data[edge.r.i]}})},voronoi.triangles=function(data){var triangles=[];return d3_geom_voronoi(sites(data)).cells.forEach(function(cell,i){for(var s0,site=cell.site,edges=cell.edges.sort(d3_geom_voronoiHalfEdgeOrder),j=-1,m=edges.length,e1=edges[m-1].edge,s1=e1.l===site?e1.r:e1.l;++j<m;)e1,s0=s1,e1=edges[j].edge,s1=e1.l===site?e1.r:e1.l,i<s0.i&&i<s1.i&&d3_geom_voronoiTriangleArea(site,s0,s1)<0&&triangles.push([data[i],data[s0.i],data[s1.i]])}),triangles},voronoi.x=function(_){return arguments.length?(fx=d3_functor(x=_),voronoi):x},voronoi.y=function(_){return arguments.length?(fy=d3_functor(y=_),voronoi):y},voronoi.clipExtent=function(_){return arguments.length?(clipExtent=null==_?d3_geom_voronoiClipExtent:_,voronoi):clipExtent===d3_geom_voronoiClipExtent?null:clipExtent},voronoi.size=function(_){return arguments.length?voronoi.clipExtent(_&&[[0,0],_]):clipExtent===d3_geom_voronoiClipExtent?null:clipExtent&&clipExtent[1]},voronoi)};var d3_geom_voronoiClipExtent=[[-1e6,-1e6],[1e6,1e6]];d3.geom.delaunay=function(vertices){return d3.geom.voronoi().triangles(vertices)},d3.geom.quadtree=function(points,x1,y1,x2,y2){function quadtree(data){function insert(n,d,x,y,x1,y1,x2,y2){if(!isNaN(x)&&!isNaN(y))if(n.leaf){var nx=n.x,ny=n.y;if(null!=nx)if(abs(nx-x)+abs(ny-y)<.01)insertChild(n,d,x,y,x1,y1,x2,y2);else{var nPoint=n.point;n.x=n.y=n.point=null,insertChild(n,nPoint,nx,ny,x1,y1,x2,y2),insertChild(n,d,x,y,x1,y1,x2,y2)}else n.x=x,n.y=y,n.point=d}else insertChild(n,d,x,y,x1,y1,x2,y2)}function insertChild(n,d,x,y,x1,y1,x2,y2){var xm=.5*(x1+x2),ym=.5*(y1+y2),right=x>=xm,below=y>=ym,i=below<<1|right;n.leaf=!1,n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode()),right?x1=xm:x2=xm,below?y1=ym:y2=ym,insert(n,d,x,y,x1,y1,x2,y2)}var d,xs,ys,i,n,x1_,y1_,x2_,y2_,fx=d3_functor(x),fy=d3_functor(y);if(null!=x1)x1_=x1,y1_=y1,x2_=x2,y2_=y2;else if(x2_=y2_=-(x1_=y1_=1/0),xs=[],ys=[],n=data.length,compat)for(i=0;i<n;++i)d=data[i],d.x<x1_&&(x1_=d.x),d.y<y1_&&(y1_=d.y),d.x>x2_&&(x2_=d.x),d.y>y2_&&(y2_=d.y),xs.push(d.x),ys.push(d.y);else for(i=0;i<n;++i){var x_=+fx(d=data[i],i),y_=+fy(d,i);x_<x1_&&(x1_=x_),y_<y1_&&(y1_=y_),x_>x2_&&(x2_=x_),y_>y2_&&(y2_=y_),xs.push(x_),ys.push(y_)}var dx=x2_-x1_,dy=y2_-y1_;dx>dy?y2_=y1_+dx:x2_=x1_+dy;var root=d3_geom_quadtreeNode();if(root.add=function(d){insert(root,d,+fx(d,++i),+fy(d,i),x1_,y1_,x2_,y2_)},root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1_,y1_,x2_,y2_)},root.find=function(point){return d3_geom_quadtreeFind(root,point[0],point[1],x1_,y1_,x2_,y2_)},i=-1,null==x1){for(;++i<n;)insert(root,data[i],xs[i],ys[i],x1_,y1_,x2_,y2_);--i}else data.forEach(root.add);return xs=ys=data=d=null,root}var compat,x=d3_geom_pointX,y=d3_geom_pointY;return(compat=arguments.length)?(x=d3_geom_quadtreeCompatX,y=d3_geom_quadtreeCompatY,3===compat&&(y2=y1,x2=x1,y1=x1=0),quadtree(points)):(quadtree.x=function(_){return arguments.length?(x=_,quadtree):x},quadtree.y=function(_){return arguments.length?(y=_,quadtree):y},quadtree.extent=function(_){return arguments.length?(null==_?x1=y1=x2=y2=null:(x1=+_[0][0],y1=+_[0][1],x2=+_[1][0],y2=+_[1][1]),quadtree):null==x1?null:[[x1,y1],[x2,y2]]},quadtree.size=function(_){return arguments.length?(null==_?x1=y1=x2=y2=null:(x1=y1=0,x2=+_[0],y2=+_[1]),quadtree):null==x1?null:[x2-x1,y2-y1]},quadtree)},d3.interpolateRgb=d3_interpolateRgb,d3.interpolateObject=d3_interpolateObject,d3.interpolateNumber=d3_interpolateNumber,d3.interpolateString=d3_interpolateString;var d3_interpolate_numberA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d3_interpolate_numberB=new RegExp(d3_interpolate_numberA.source,"g");d3.interpolate=d3_interpolate,d3.interpolators=[function(a,b){var t=typeof b;return("string"===t?d3_rgb_names.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?d3_interpolateRgb:d3_interpolateString:b instanceof d3_color?d3_interpolateRgb:Array.isArray(b)?d3_interpolateArray:"object"===t&&isNaN(b)?d3_interpolateObject:d3_interpolateNumber)(a,b)}],d3.interpolateArray=d3_interpolateArray;var d3_ease_default=function(){return d3_identity},d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad},cubic:function(){return d3_ease_cubic},sin:function(){return d3_ease_sin},exp:function(){return d3_ease_exp},circle:function(){return d3_ease_circle},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce}}),d3_ease_mode=d3.map({in:d3_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f))}});d3.ease=function(name){
var i=name.indexOf("-"),t=i>=0?name.slice(0,i):name,m=i>=0?name.slice(i+1):"in";return t=d3_ease.get(t)||d3_ease_default,m=d3_ease_mode.get(m)||d3_identity,d3_ease_clamp(m(t.apply(null,d3_arraySlice.call(arguments,1))))},d3.interpolateHcl=d3_interpolateHcl,d3.interpolateHsl=d3_interpolateHsl,d3.interpolateLab=d3_interpolateLab,d3.interpolateRound=d3_interpolateRound,d3.transform=function(string){var g=d3_document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){if(null!=string){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate()}return new d3_transform(t?t.matrix:d3_transformIdentity)})(string)},d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolateTransform=d3_interpolateTransform,d3.layout={},d3.layout.bundle=function(){return function(links){for(var paths=[],i=-1,n=links.length;++i<n;)paths.push(d3_layout_bundlePath(links[i]));return paths}},d3.layout.chord=function(){function relayout(){var k,x,x0,i,j,subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[];for(chords=[],groups=[],k=0,i=-1;++i<n;){for(x=0,j=-1;++j<n;)x+=matrix[i][j];groupSums.push(x),subgroupIndex.push(d3.range(n)),k+=x}for(sortGroups&&groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b])}),sortSubgroups&&subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b])})}),k=(τ-padding*n)/k,x=0,i=-1;++i<n;){for(x0=x,j=-1;++j<n;){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v}}groups[di]={index:di,startAngle:x0,endAngle:x,value:groupSums[di]},x+=padding}for(i=-1;++i<n;)for(j=i-1;++j<n;){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];(source.value||target.value)&&chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target})}sortChords&&resort()}function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}var chords,groups,matrix,n,sortGroups,sortSubgroups,sortChords,chord={},padding=0;return chord.matrix=function(x){return arguments.length?(n=(matrix=x)&&matrix.length,chords=groups=null,chord):matrix},chord.padding=function(x){return arguments.length?(padding=x,chords=groups=null,chord):padding},chord.sortGroups=function(x){return arguments.length?(sortGroups=x,chords=groups=null,chord):sortGroups},chord.sortSubgroups=function(x){return arguments.length?(sortSubgroups=x,chords=null,chord):sortSubgroups},chord.sortChords=function(x){return arguments.length?(sortChords=x,chords&&resort(),chord):sortChords},chord.chords=function(){return chords||relayout(),chords},chord.groups=function(){return groups||relayout(),groups},chord},d3.layout.force=function(){function repulse(node){return function(quad,x1,_,x2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dw=x2-x1,dn=dx*dx+dy*dy;if(dw*dw/theta2<dn){if(dn<chargeDistance2){var k=quad.charge/dn;node.px-=dx*k,node.py-=dy*k}return!0}if(quad.point&&dn&&dn<chargeDistance2){var k=quad.pointCharge/dn;node.px-=dx*k,node.py-=dy*k}}return!quad.charge}}function dragmove(d){d.px=d3.event.x,d.py=d3.event.y,force.resume()}var timer,drag,alpha,distances,strengths,charges,force={},event=d3.dispatch("start","tick","end"),size=[1,1],friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,chargeDistance2=d3_layout_forceChargeDistance2,gravity=.1,theta2=.64,nodes=[],links=[];return force.tick=function(){if((alpha*=.99)<.005)return timer=null,event.end({type:"end",alpha:alpha=0}),!0;var q,i,o,s,t,l,k,x,y,n=nodes.length,m=links.length;for(i=0;i<m;++i)o=links[i],s=o.source,t=o.target,x=t.x-s.x,y=t.y-s.y,(l=x*x+y*y)&&(l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l,x*=l,y*=l,t.x-=x*(k=s.weight+t.weight?s.weight/(s.weight+t.weight):.5),t.y-=y*k,s.x+=x*(k=1-k),s.y+=y*k);if((k=alpha*gravity)&&(x=size[0]/2,y=size[1]/2,i=-1,k))for(;++i<n;)o=nodes[i],o.x+=(x-o.x)*k,o.y+=(y-o.y)*k;if(charge)for(d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges),i=-1;++i<n;)(o=nodes[i]).fixed||q.visit(repulse(o));for(i=-1;++i<n;)o=nodes[i],o.fixed?(o.x=o.px,o.y=o.py):(o.x-=(o.px-(o.px=o.x))*friction,o.y-=(o.py-(o.py=o.y))*friction);event.tick({type:"tick",alpha:alpha})},force.nodes=function(x){return arguments.length?(nodes=x,force):nodes},force.links=function(x){return arguments.length?(links=x,force):links},force.size=function(x){return arguments.length?(size=x,force):size},force.linkDistance=function(x){return arguments.length?(linkDistance="function"==typeof x?x:+x,force):linkDistance},force.distance=force.linkDistance,force.linkStrength=function(x){return arguments.length?(linkStrength="function"==typeof x?x:+x,force):linkStrength},force.friction=function(x){return arguments.length?(friction=+x,force):friction},force.charge=function(x){return arguments.length?(charge="function"==typeof x?x:+x,force):charge},force.chargeDistance=function(x){return arguments.length?(chargeDistance2=x*x,force):Math.sqrt(chargeDistance2)},force.gravity=function(x){return arguments.length?(gravity=+x,force):gravity},force.theta=function(x){return arguments.length?(theta2=x*x,force):Math.sqrt(theta2)},force.alpha=function(x){return arguments.length?(x=+x,alpha?x>0?alpha=x:(timer.c=null,timer.t=NaN,timer=null,event.end({type:"end",alpha:alpha=0})):x>0&&(event.start({type:"start",alpha:alpha=x}),timer=d3_timer(force.tick)),force):alpha},force.start=function(){function position(dimension,size){if(!neighbors){for(neighbors=new Array(n),j=0;j<n;++j)neighbors[j]=[];for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target),neighbors[o.target.index].push(o.source)}}for(var x,candidates=neighbors[i],j=-1,l=candidates.length;++j<l;)if(!isNaN(x=candidates[j][dimension]))return x;return Math.random()*size}var i,neighbors,o,n=nodes.length,m=links.length,w=size[0],h=size[1];for(i=0;i<n;++i)(o=nodes[i]).index=i,o.weight=0;for(i=0;i<m;++i)o=links[i],"number"==typeof o.source&&(o.source=nodes[o.source]),"number"==typeof o.target&&(o.target=nodes[o.target]),++o.source.weight,++o.target.weight;for(i=0;i<n;++i)o=nodes[i],isNaN(o.x)&&(o.x=position("x",w)),isNaN(o.y)&&(o.y=position("y",h)),isNaN(o.px)&&(o.px=o.x),isNaN(o.py)&&(o.py=o.y);if(distances=[],"function"==typeof linkDistance)for(i=0;i<m;++i)distances[i]=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)distances[i]=linkDistance;if(strengths=[],"function"==typeof linkStrength)for(i=0;i<m;++i)strengths[i]=+linkStrength.call(this,links[i],i);else for(i=0;i<m;++i)strengths[i]=linkStrength;if(charges=[],"function"==typeof charge)for(i=0;i<n;++i)charges[i]=+charge.call(this,nodes[i],i);else for(i=0;i<n;++i)charges[i]=charge;return force.resume()},force.resume=function(){return force.alpha(.1)},force.stop=function(){return force.alpha(0)},force.drag=function(){if(drag||(drag=d3.behavior.drag().origin(d3_identity).on("dragstart.force",d3_layout_forceDragstart).on("drag.force",dragmove).on("dragend.force",d3_layout_forceDragend)),!arguments.length)return drag;this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag)},d3.rebind(force,event,"on")};var d3_layout_forceLinkDistance=20,d3_layout_forceLinkStrength=1,d3_layout_forceChargeDistance2=1/0;d3.layout.hierarchy=function(){function hierarchy(root){var node,stack=[root],nodes=[];for(root.depth=0;null!=(node=stack.pop());)if(nodes.push(node),(childs=children.call(hierarchy,node,node.depth))&&(n=childs.length)){for(var n,childs,child;--n>=0;)stack.push(child=childs[n]),child.parent=node,child.depth=node.depth+1;value&&(node.value=0),node.children=childs}else value&&(node.value=+value.call(hierarchy,node,node.depth)||0),delete node.children;return d3_layout_hierarchyVisitAfter(root,function(node){var childs,parent;sort&&(childs=node.children)&&childs.sort(sort),value&&(parent=node.parent)&&(parent.value+=node.value)}),nodes}var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;return hierarchy.sort=function(x){return arguments.length?(sort=x,hierarchy):sort},hierarchy.children=function(x){return arguments.length?(children=x,hierarchy):children},hierarchy.value=function(x){return arguments.length?(value=x,hierarchy):value},hierarchy.revalue=function(root){return value&&(d3_layout_hierarchyVisitBefore(root,function(node){node.children&&(node.value=0)}),d3_layout_hierarchyVisitAfter(root,function(node){var parent;node.children||(node.value=+value.call(hierarchy,node,node.depth)||0),(parent=node.parent)&&(parent.value+=node.value)})),root},hierarchy},d3.layout.partition=function(){function position(node,x,dx,dy){var children=node.children;if(node.x=x,node.y=node.depth*dy,node.dx=dx,node.dy=dy,children&&(n=children.length)){var n,c,d,i=-1;for(dx=node.value?dx/node.value:0;++i<n;)position(c=children[i],x,d=c.value*dx,dy),x+=d}}function depth(node){var children=node.children,d=0;if(children&&(n=children.length))for(var n,i=-1;++i<n;)d=Math.max(d,depth(children[i]));return 1+d}function partition(d,i){var nodes=hierarchy.call(this,d,i);return position(nodes[0],0,size[0],size[1]/depth(nodes[0])),nodes}var hierarchy=d3.layout.hierarchy(),size=[1,1];return partition.size=function(x){return arguments.length?(size=x,partition):size},d3_layout_hierarchyRebind(partition,hierarchy)},d3.layout.pie=function(){function pie(data){var v,n=data.length,values=data.map(function(d,i){return+value.call(pie,d,i)}),a=+("function"==typeof startAngle?startAngle.apply(this,arguments):startAngle),da=("function"==typeof endAngle?endAngle.apply(this,arguments):endAngle)-a,p=Math.min(Math.abs(da)/n,+("function"==typeof padAngle?padAngle.apply(this,arguments):padAngle)),pa=p*(da<0?-1:1),sum=d3.sum(values),k=sum?(da-n*pa)/sum:0,index=d3.range(n),arcs=[];return null!=sort&&index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i]}:function(i,j){return sort(data[i],data[j])}),index.forEach(function(i){arcs[i]={data:data[i],value:v=values[i],startAngle:a,endAngle:a+=v*k+pa,padAngle:p}}),arcs}var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=τ,padAngle=0;return pie.value=function(_){return arguments.length?(value=_,pie):value},pie.sort=function(_){return arguments.length?(sort=_,pie):sort},pie.startAngle=function(_){return arguments.length?(startAngle=_,pie):startAngle},pie.endAngle=function(_){return arguments.length?(endAngle=_,pie):endAngle},pie.padAngle=function(_){return arguments.length?(padAngle=_,pie):padAngle},pie};var d3_layout_pieSortByValue={};d3.layout.stack=function(){function stack(data,index){if(!(n=data.length))return data;var series=data.map(function(d,i){return values.call(stack,d,i)}),points=series.map(function(d){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)]})}),orders=order.call(stack,points,index);series=d3.permute(series,orders),points=d3.permute(points,orders);var n,i,j,o,offsets=offset.call(stack,points,index),m=series[0].length;for(j=0;j<m;++j)for(out.call(stack,series[0][j],o=offsets[j],points[0][j][1]),i=1;i<n;++i)out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);return data}var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;return stack.values=function(x){return arguments.length?(values=x,stack):values},stack.order=function(x){return arguments.length?(order="function"==typeof x?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault,stack):order},stack.offset=function(x){return arguments.length?(offset="function"==typeof x?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero,stack):offset},stack.x=function(z){return arguments.length?(x=z,stack):x},stack.y=function(z){return arguments.length?(y=z,stack):y},stack.out=function(z){return arguments.length?(out=z,stack):out},stack};var d3_layout_stackOrders=d3.map({"inside-out":function(data){var i,j,n=data.length,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b]}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i)j=index[i],top<bottom?(top+=sums[j],tops.push(j)):(bottom+=sums[j],bottoms.push(j));return bottoms.reverse().concat(tops)},reverse:function(data){return d3.range(data.length).reverse()},default:d3_layout_stackOrderDefault}),d3_layout_stackOffsets=d3.map({silhouette:function(data){var i,j,o,n=data.length,m=data[0].length,sums=[],max=0,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];o>max&&(max=o),sums.push(o)}for(j=0;j<m;++j)y0[j]=(max-sums[j])/2;return y0},wiggle:function(data){var i,j,k,s1,s2,s3,dx,o,o0,n=data.length,x=data[0],m=x.length,y0=[];for(y0[0]=o=o0=0,j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k)s3+=(data[k][j][1]-data[k][j-1][1])/dx;s2+=s3*data[i][j][1]}y0[j]=o-=s1?s2/s1*dx:0,o<o0&&(o0=o)}for(j=0;j<m;++j)y0[j]-=o0;return y0},expand:function(data){var i,j,o,n=data.length,m=data[0].length,k=1/n,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k}for(j=0;j<m;++j)y0[j]=0;return y0},zero:d3_layout_stackOffsetZero});d3.layout.histogram=function(){function histogram(data,i){for(var bin,x,bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n;++i<m;)bin=bins[i]=[],bin.dx=thresholds[i+1]-(bin.x=thresholds[i]),bin.y=0;if(m>0)for(i=-1;++i<n;)(x=values[i])>=range[0]&&x<=range[1]&&(bin=bins[d3.bisect(thresholds,x,1,m)-1],bin.y+=k,bin.push(data[i]));return bins}var frequency=!0,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;return histogram.value=function(x){return arguments.length?(valuer=x,histogram):valuer},histogram.range=function(x){return arguments.length?(ranger=d3_functor(x),histogram):ranger},histogram.bins=function(x){return arguments.length?(binner="number"==typeof x?function(range){return d3_layout_histogramBinFixed(range,x)}:d3_functor(x),histogram):binner},histogram.frequency=function(x){return arguments.length?(frequency=!!x,histogram):frequency},histogram},d3.layout.pack=function(){function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],w=size[0],h=size[1],r=null==radius?Math.sqrt:"function"==typeof radius?radius:function(){return radius};if(root.x=root.y=0,d3_layout_hierarchyVisitAfter(root,function(d){d.r=+r(d.value)}),d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings),padding){var dr=padding*(radius?1:Math.max(2*root.r/w,2*root.r/h))/2;d3_layout_hierarchyVisitAfter(root,function(d){d.r+=dr}),d3_layout_hierarchyVisitAfter(root,d3_layout_packSiblings),d3_layout_hierarchyVisitAfter(root,function(d){d.r-=dr})}return d3_layout_packTransform(root,w/2,h/2,radius?1:1/Math.max(2*root.r/w,2*root.r/h)),nodes}var radius,hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1];return pack.size=function(_){return arguments.length?(size=_,pack):size},pack.radius=function(_){return arguments.length?(radius=null==_||"function"==typeof _?_:+_,pack):radius},pack.padding=function(_){return arguments.length?(padding=+_,pack):padding},d3_layout_hierarchyRebind(pack,hierarchy)},d3.layout.tree=function(){function tree(d,i){var nodes=hierarchy.call(this,d,i),root0=nodes[0],root1=wrapTree(root0);if(d3_layout_hierarchyVisitAfter(root1,firstWalk),root1.parent.m=-root1.z,d3_layout_hierarchyVisitBefore(root1,secondWalk),nodeSize)d3_layout_hierarchyVisitBefore(root0,sizeNode);else{var left=root0,right=root0,bottom=root0;d3_layout_hierarchyVisitBefore(root0,function(node){node.x<left.x&&(left=node),node.x>right.x&&(right=node),node.depth>bottom.depth&&(bottom=node)});var tx=separation(left,right)/2-left.x,kx=size[0]/(right.x+separation(right,left)/2+tx),ky=size[1]/(bottom.depth||1);d3_layout_hierarchyVisitBefore(root0,function(node){node.x=(node.x+tx)*kx,node.y=node.depth*ky})}return nodes}function wrapTree(root0){for(var node1,root1={A:null,children:[root0]},queue=[root1];null!=(node1=queue.pop());)for(var child,children=node1.children,i=0,n=children.length;i<n;++i)queue.push((children[i]=child={_:children[i],parent:node1,children:(child=children[i].children)&&child.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:i}).a=child);return root1.children[0]}function firstWalk(v){var children=v.children,siblings=v.parent.children,w=v.i?siblings[v.i-1]:null;if(children.length){d3_layout_treeShift(v);var midpoint=(children[0].z+children[children.length-1].z)/2;w?(v.z=w.z+separation(v._,w._),v.m=v.z-midpoint):v.z=midpoint}else w&&(v.z=w.z+separation(v._,w._));v.parent.A=apportion(v,w,v.parent.A||siblings[0])}function secondWalk(v){v._.x=v.z+v.parent.m,v.m+=v.parent.m}function apportion(v,w,ancestor){if(w){for(var shift,vip=v,vop=v,vim=w,vom=vip.parent.children[0],sip=vip.m,sop=vop.m,sim=vim.m,som=vom.m;vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip;)vom=d3_layout_treeLeft(vom),vop=d3_layout_treeRight(vop),vop.a=v,shift=vim.z+sim-vip.z-sip+separation(vim._,vip._),shift>0&&(d3_layout_treeMove(d3_layout_treeAncestor(vim,v,ancestor),v,shift),sip+=shift,sop+=shift),sim+=vim.m,sip+=vip.m,som+=vom.m,sop+=vop.m;vim&&!d3_layout_treeRight(vop)&&(vop.t=vim,vop.m+=sim-sop),vip&&!d3_layout_treeLeft(vom)&&(vom.t=vip,vom.m+=sip-som,ancestor=v)}return ancestor}function sizeNode(node){node.x*=size[0],node.y=node.depth*size[1]}var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=null;return tree.separation=function(x){return arguments.length?(separation=x,tree):separation},tree.size=function(x){return arguments.length?(nodeSize=null==(size=x)?sizeNode:null,tree):nodeSize?null:size},tree.nodeSize=function(x){return arguments.length?(nodeSize=null==(size=x)?null:sizeNode,tree):nodeSize?size:null},d3_layout_hierarchyRebind(tree,hierarchy)},d3.layout.cluster=function(){function cluster(d,i){var previousNode,nodes=hierarchy.call(this,d,i),root=nodes[0],x=0;d3_layout_hierarchyVisitAfter(root,function(node){var children=node.children;children&&children.length?(node.x=d3_layout_clusterX(children),node.y=d3_layout_clusterY(children)):(node.x=previousNode?x+=separation(node,previousNode):0,node.y=0,previousNode=node)});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;return d3_layout_hierarchyVisitAfter(root,nodeSize?function(node){node.x=(node.x-root.x)*size[0],node.y=(root.y-node.y)*size[1]}:function(node){node.x=(node.x-x0)/(x1-x0)*size[0],node.y=(1-(root.y?node.y/root.y:1))*size[1]}),nodes}var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1],nodeSize=!1;return cluster.separation=function(x){return arguments.length?(separation=x,cluster):separation},cluster.size=function(x){return arguments.length?(nodeSize=null==(size=x),cluster):nodeSize?null:size},cluster.nodeSize=function(x){return arguments.length?(nodeSize=null!=(size=x),cluster):nodeSize?size:null},d3_layout_hierarchyRebind(cluster,hierarchy)},d3.layout.treemap=function(){function scale(children,k){for(var child,area,i=-1,n=children.length;++i<n;)area=(child=children[i]).value*(k<0?0:k),child.area=isNaN(area)||area<=0?0:area}function squarify(node){var children=node.children;if(children&&children.length){var child,score,n,rect=pad(node),row=[],remaining=children.slice(),best=1/0,u="slice"===mode?rect.dx:"dice"===mode?rect.dy:"slice-dice"===mode?1&node.depth?rect.dy:rect.dx:Math.min(rect.dx,rect.dy);for(scale(remaining,rect.dx*rect.dy/node.value),row.area=0;(n=remaining.length)>0;)row.push(child=remaining[n-1]),row.area+=child.area,"squarify"!==mode||(score=worst(row,u))<=best?(remaining.pop(),best=score):(row.area-=row.pop().area,position(row,u,rect,!1),u=Math.min(rect.dx,rect.dy),row.length=row.area=0,best=1/0);row.length&&(position(row,u,rect,!0),row.length=row.area=0),children.forEach(squarify)}}function stickify(node){var children=node.children;if(children&&children.length){var child,rect=pad(node),remaining=children.slice(),row=[];for(scale(remaining,rect.dx*rect.dy/node.value),row.area=0;child=remaining.pop();)row.push(child),row.area+=child.area,null!=child.z&&(position(row,child.z?rect.dx:rect.dy,rect,!remaining.length),row.length=row.area=0);children.forEach(stickify)}}function worst(row,u){for(var r,s=row.area,rmax=0,rmin=1/0,i=-1,n=row.length;++i<n;)(r=row[i].area)&&(r<rmin&&(rmin=r),r>rmax&&(rmax=r));return s*=s,u*=u,s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):1/0}function position(row,u,rect,flush){var o,i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0;if(u==rect.dx){for((flush||v>rect.dy)&&(v=rect.dy);++i<n;)o=row[i],o.x=x,o.y=y,o.dy=v,x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);o.z=!0,o.dx+=rect.x+rect.dx-x,rect.y+=v,rect.dy-=v}else{for((flush||v>rect.dx)&&(v=rect.dx);++i<n;)o=row[i],o.x=x,o.y=y,o.dx=v,y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);o.z=!1,o.dy+=rect.y+rect.dy-y,rect.x+=v,rect.dx-=v}}function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];return root.x=root.y=0,root.value?(root.dx=size[0],root.dy=size[1]):root.dx=root.dy=0,stickies&&hierarchy.revalue(root),scale([root],root.dx*root.dy/root.value),(stickies?stickify:squarify)(root),sticky&&(stickies=nodes),nodes}var stickies,hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=!1,mode="squarify",ratio=.5*(1+Math.sqrt(5));return treemap.size=function(x){return arguments.length?(size=x,treemap):size},treemap.padding=function(x){function padFunction(node){var p=x.call(treemap,node,node.depth);return null==p?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,"number"==typeof p?[p,p,p,p]:p)}function padConstant(node){return d3_layout_treemapPad(node,x)}if(!arguments.length)return padding;var type;return pad=null==(padding=x)?d3_layout_treemapPadNull:"function"==(type=typeof x)?padFunction:"number"===type?(x=[x,x,x,x],padConstant):padConstant,treemap},treemap.round=function(x){return arguments.length?(round=x?Math.round:Number,treemap):round!=Number},treemap.sticky=function(x){return arguments.length?(sticky=x,stickies=null,treemap):sticky},treemap.ratio=function(x){return arguments.length?(ratio=x,treemap):ratio},treemap.mode=function(x){return arguments.length?(mode=x+"",treemap):mode},d3_layout_hierarchyRebind(treemap,hierarchy)},d3.random={normal:function(µ,σ){var n=arguments.length;return n<2&&(σ=1),n<1&&(µ=0),function(){var x,y,r;do{x=2*Math.random()-1,y=2*Math.random()-1,r=x*x+y*y}while(!r||r>1);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var random=d3.random.normal.apply(d3,arguments);return function(){return Math.exp(random())}},bates:function(m){var random=d3.random.irwinHall(m);return function(){return random()/m}},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s}}},d3.scale={};var d3_scale_niceIdentity={floor:d3_identity,ceil:d3_identity};d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3_interpolate,!1)};var d3_scale_linearFormatSignificant={s:1,g:1,p:1,r:1,e:1};d3.scale.log=function(){return d3_scale_log(d3.scale.linear().domain([0,1]),10,!0,[1,10])};var d3_scale_logFormat=d3.format(".0e"),d3_scale_logNiceNegative={floor:function(x){return-Math.ceil(-x)},ceil:function(x){return-Math.floor(-x)}};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1,[0,1])},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]})},d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10)},d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20)},d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b)},d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c)};var d3_category10=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(d3_rgbString),d3_category20=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(d3_rgbString),d3_category20b=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(d3_rgbString),d3_category20c=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(d3_rgbString);d3.scale.quantile=function(){return d3_scale_quantile([],[])},d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1])},d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1])},d3.scale.identity=function(){return d3_scale_identity([0,1])},d3.svg={},d3.svg.arc=function(){function arc(){var r0=Math.max(0,+innerRadius.apply(this,arguments)),r1=Math.max(0,+outerRadius.apply(this,arguments)),a0=startAngle.apply(this,arguments)-halfπ,a1=endAngle.apply(this,arguments)-halfπ,da=Math.abs(a1-a0),cw=a0>a1?0:1;if(r1<r0&&(rc=r1,r1=r0,r0=rc),da>=τε)return circleSegment(r1,cw)+(r0?circleSegment(r0,1-cw):"")+"Z";var rc,cr,rp,ap,x0,y0,x1,y1,x2,y2,x3,y3,p0=0,p1=0,path=[];if((ap=(+padAngle.apply(this,arguments)||0)/2)&&(rp=padRadius===d3_svg_arcAuto?Math.sqrt(r0*r0+r1*r1):+padRadius.apply(this,arguments),cw||(p1*=-1),r1&&(p1=d3_asin(rp/r1*Math.sin(ap))),r0&&(p0=d3_asin(rp/r0*Math.sin(ap)))),r1){x0=r1*Math.cos(a0+p1),y0=r1*Math.sin(a0+p1),x1=r1*Math.cos(a1-p1),y1=r1*Math.sin(a1-p1);var l1=Math.abs(a1-a0-2*p1)<=π?0:1;if(p1&&d3_svg_arcSweep(x0,y0,x1,y1)===cw^l1){var h1=(a0+a1)/2;x0=r1*Math.cos(h1),y0=r1*Math.sin(h1),x1=y1=null}}else x0=y0=0;if(r0){x2=r0*Math.cos(a1-p0),y2=r0*Math.sin(a1-p0),x3=r0*Math.cos(a0+p0),y3=r0*Math.sin(a0+p0);var l0=Math.abs(a0-a1+2*p0)<=π?0:1;if(p0&&d3_svg_arcSweep(x2,y2,x3,y3)===1-cw^l0){var h0=(a0+a1)/2;x2=r0*Math.cos(h0),y2=r0*Math.sin(h0),x3=y3=null}}else x2=y2=0;if(da>ε&&(rc=Math.min(Math.abs(r1-r0)/2,+cornerRadius.apply(this,arguments)))>.001){cr=r0<r1^cw?0:1;var rc1=rc,rc0=rc;if(da<π){var oc=null==x3?[x2,y2]:null==x1?[x0,y0]:d3_geom_polygonIntersect([x0,y0],[x3,y3],[x1,y1],[x2,y2]),ax=x0-oc[0],ay=y0-oc[1],bx=x1-oc[0],by=y1-oc[1],kc=1/Math.sin(Math.acos((ax*bx+ay*by)/(Math.sqrt(ax*ax+ay*ay)*Math.sqrt(bx*bx+by*by)))/2),lc=Math.sqrt(oc[0]*oc[0]+oc[1]*oc[1]);rc0=Math.min(rc,(r0-lc)/(kc-1)),rc1=Math.min(rc,(r1-lc)/(kc+1))}if(null!=x1){var t30=d3_svg_arcCornerTangents(null==x3?[x2,y2]:[x3,y3],[x0,y0],r1,rc1,cw),t12=d3_svg_arcCornerTangents([x1,y1],[x2,y2],r1,rc1,cw);rc===rc1?path.push("M",t30[0],"A",rc1,",",rc1," 0 0,",cr," ",t30[1],"A",r1,",",r1," 0 ",1-cw^d3_svg_arcSweep(t30[1][0],t30[1][1],t12[1][0],t12[1][1]),",",cw," ",t12[1],"A",rc1,",",rc1," 0 0,",cr," ",t12[0]):path.push("M",t30[0],"A",rc1,",",rc1," 0 1,",cr," ",t12[0])}else path.push("M",x0,",",y0);if(null!=x3){var t03=d3_svg_arcCornerTangents([x0,y0],[x3,y3],r0,-rc0,cw),t21=d3_svg_arcCornerTangents([x2,y2],null==x1?[x0,y0]:[x1,y1],r0,-rc0,cw);rc===rc0?path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t21[1],"A",r0,",",r0," 0 ",cw^d3_svg_arcSweep(t21[1][0],t21[1][1],t03[1][0],t03[1][1]),",",1-cw," ",t03[1],"A",rc0,",",rc0," 0 0,",cr," ",t03[0]):path.push("L",t21[0],"A",rc0,",",rc0," 0 0,",cr," ",t03[0])}else path.push("L",x2,",",y2)}else path.push("M",x0,",",y0),null!=x1&&path.push("A",r1,",",r1," 0 ",l1,",",cw," ",x1,",",y1),path.push("L",x2,",",y2),null!=x3&&path.push("A",r0,",",r0," 0 ",l0,",",1-cw," ",x3,",",y3);return path.push("Z"),path.join("")}function circleSegment(r1,cw){return"M0,"+r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+-r1+"A"+r1+","+r1+" 0 1,"+cw+" 0,"+r1}var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,cornerRadius=d3_zero,padRadius=d3_svg_arcAuto,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle,padAngle=d3_svg_arcPadAngle;return arc.innerRadius=function(v){return arguments.length?(innerRadius=d3_functor(v),arc):innerRadius},arc.outerRadius=function(v){return arguments.length?(outerRadius=d3_functor(v),arc):outerRadius},arc.cornerRadius=function(v){return arguments.length?(cornerRadius=d3_functor(v),arc):cornerRadius},arc.padRadius=function(v){return arguments.length?(padRadius=v==d3_svg_arcAuto?d3_svg_arcAuto:d3_functor(v),arc):padRadius},arc.startAngle=function(v){return arguments.length?(startAngle=d3_functor(v),arc):startAngle},arc.endAngle=function(v){return arguments.length?(endAngle=d3_functor(v),arc):endAngle},arc.padAngle=function(v){return arguments.length?(padAngle=d3_functor(v),arc):padAngle},arc.centroid=function(){var r=(+innerRadius.apply(this,arguments)+ +outerRadius.apply(this,arguments))/2,a=(+startAngle.apply(this,arguments)+ +endAngle.apply(this,arguments))/2-halfπ;return[Math.cos(a)*r,Math.sin(a)*r]},arc};var d3_svg_arcAuto="auto";d3.svg.line=function(){return d3_svg_line(d3_identity)};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,step:d3_svg_lineStep,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key,value.closed=/-closed$/.test(key)});var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);return line.radius=line.x,delete line.x,line.angle=line.y,delete line.y,line},d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter,d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore,d3.svg.area=function(){return d3_svg_area(d3_identity)},d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);return area.radius=area.x,delete area.x,area.innerRadius=area.x0,delete area.x0,area.outerRadius=area.x1,delete area.x1,area.angle=area.y,delete area.y,area.startAngle=area.y0,delete area.y0,area.endAngle=area.y1,delete area.y1,area},d3.svg.chord=function(){function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z"}function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)-halfπ,a1=endAngle.call(self,subgroup,i)-halfπ;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]}}function equals(a,b){return a.a0==b.a0&&a.a1==b.a1}function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>π)+",1 "+p}function curve(r0,p0,r1,p1){return"Q 0,0 "+p1}var source=d3_source,target=d3_target,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;return chord.radius=function(v){return arguments.length?(radius=d3_functor(v),chord):radius},chord.source=function(v){return arguments.length?(source=d3_functor(v),chord):source},chord.target=function(v){return arguments.length?(target=d3_functor(v),chord):target},chord.startAngle=function(v){return arguments.length?(startAngle=d3_functor(v),chord):startAngle},chord.endAngle=function(v){return arguments.length?(endAngle=d3_functor(v),chord):endAngle},chord},d3.svg.diagonal=function(){function diagonal(d,i){
var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];return p=p.map(projection),"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3]}var source=d3_source,target=d3_target,projection=d3_svg_diagonalProjection;return diagonal.source=function(x){return arguments.length?(source=d3_functor(x),diagonal):source},diagonal.target=function(x){return arguments.length?(target=d3_functor(x),diagonal):target},diagonal.projection=function(x){return arguments.length?(projection=x,diagonal):projection},diagonal},d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;return diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection},diagonal},d3.svg.symbol=function(){function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i))}var type=d3_svg_symbolType,size=d3_svg_symbolSize;return symbol.type=function(x){return arguments.length?(type=d3_functor(x),symbol):type},symbol.size=function(x){return arguments.length?(size=d3_functor(x),symbol):size},symbol};var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z"},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0 0,"+ry+" "+-rx+",0Z"},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z"},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z"},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z"}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*d3_radians);d3_selectionPrototype.transition=function(name){for(var subgroup,node,id=d3_transitionInheritId||++d3_transitionId,ns=d3_transitionNamespace(name),subgroups=[],transition=d3_transitionInherit||{time:Date.now(),ease:d3_ease_cubicInOut,delay:0,duration:250},j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&d3_transitionNode(node,i,ns,id,transition),subgroup.push(node)}return d3_transition(subgroups,ns,id)},d3_selectionPrototype.interrupt=function(name){return this.each(null==name?d3_selection_interrupt:d3_selection_interruptNS(d3_transitionNamespace(name)))};var d3_transitionInheritId,d3_transitionInherit,d3_selection_interrupt=d3_selection_interruptNS(d3_transitionNamespace()),d3_transitionPrototype=[],d3_transitionId=0;d3_transitionPrototype.call=d3_selectionPrototype.call,d3_transitionPrototype.empty=d3_selectionPrototype.empty,d3_transitionPrototype.node=d3_selectionPrototype.node,d3_transitionPrototype.size=d3_selectionPrototype.size,d3.transition=function(selection,name){return selection&&selection.transition?d3_transitionInheritId?selection.transition(name):selection:d3.selection().transition(selection)},d3.transition.prototype=d3_transitionPrototype,d3_transitionPrototype.select=function(selector){var subgroup,subnode,node,id=this.id,ns=this.namespace,subgroups=[];selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;)(node=group[i])&&(subnode=selector.call(node,node.__data__,i,j))?("__data__"in node&&(subnode.__data__=node.__data__),d3_transitionNode(subnode,i,ns,id,node[ns][id]),subgroup.push(subnode)):subgroup.push(null)}return d3_transition(subgroups,ns,id)},d3_transitionPrototype.selectAll=function(selector){var subgroup,subnodes,node,subnode,transition,id=this.id,ns=this.namespace,subgroups=[];selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;)for(var group=this[j],i=-1,n=group.length;++i<n;)if(node=group[i]){transition=node[ns][id],subnodes=selector.call(node,node.__data__,i,j),subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;)(subnode=subnodes[k])&&d3_transitionNode(subnode,k,ns,id,transition),subgroup.push(subnode)}return d3_transition(subgroups,ns,id)},d3_transitionPrototype.filter=function(filter){var subgroup,group,node,subgroups=[];"function"!=typeof filter&&(filter=d3_selection_filter(filter));for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++)(node=group[i])&&filter.call(node,node.__data__,i,j)&&subgroup.push(node)}return d3_transition(subgroups,this.namespace,this.id)},d3_transitionPrototype.tween=function(name,tween){var id=this.id,ns=this.namespace;return arguments.length<2?this.node()[ns][id].tween.get(name):d3_selection_each(this,null==tween?function(node){node[ns][id].tween.remove(name)}:function(node){node[ns][id].tween.set(name,tween)})},d3_transitionPrototype.attr=function(nameNS,value){function attrNull(){this.removeAttribute(name)}function attrNullNS(){this.removeAttributeNS(name.space,name.local)}function attrTween(b){return null==b?attrNull:(b+="",function(){var i,a=this.getAttribute(name);return a!==b&&(i=interpolate(a,b),function(t){this.setAttribute(name,i(t))})})}function attrTweenNS(b){return null==b?attrNullNS:(b+="",function(){var i,a=this.getAttributeNS(name.space,name.local);return a!==b&&(i=interpolate(a,b),function(t){this.setAttributeNS(name.space,name.local,i(t))})})}if(arguments.length<2){for(value in nameNS)this.attr(value,nameNS[value]);return this}var interpolate="transform"==nameNS?d3_interpolateTransform:d3_interpolate,name=d3.ns.qualify(nameNS);return d3_transition_tween(this,"attr."+nameNS,value,name.local?attrTweenNS:attrTween)},d3_transitionPrototype.attrTween=function(nameNS,tween){function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f&&function(t){this.setAttribute(name,f(t))}}function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f&&function(t){this.setAttributeNS(name.space,name.local,f(t))}}var name=d3.ns.qualify(nameNS);return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween)},d3_transitionPrototype.style=function(name,value,priority){function styleNull(){this.style.removeProperty(name)}function styleString(b){return null==b?styleNull:(b+="",function(){var i,a=d3_window(this).getComputedStyle(this,null).getPropertyValue(name);return a!==b&&(i=d3_interpolate(a,b),function(t){this.style.setProperty(name,i(t),priority)})})}var n=arguments.length;if(n<3){if("string"!=typeof name){n<2&&(value="");for(priority in name)this.style(priority,name[priority],value);return this}priority=""}return d3_transition_tween(this,"style."+name,value,styleString)},d3_transitionPrototype.styleTween=function(name,tween,priority){function styleTween(d,i){var f=tween.call(this,d,i,d3_window(this).getComputedStyle(this,null).getPropertyValue(name));return f&&function(t){this.style.setProperty(name,f(t),priority)}}return arguments.length<3&&(priority=""),this.tween("style."+name,styleTween)},d3_transitionPrototype.text=function(value){return d3_transition_tween(this,"text",value,d3_transition_text)},d3_transitionPrototype.remove=function(){var ns=this.namespace;return this.each("end.transition",function(){var p;this[ns].count<2&&(p=this.parentNode)&&p.removeChild(this)})},d3_transitionPrototype.ease=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].ease:("function"!=typeof value&&(value=d3.ease.apply(d3,arguments)),d3_selection_each(this,function(node){node[ns][id].ease=value}))},d3_transitionPrototype.delay=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].delay:d3_selection_each(this,"function"==typeof value?function(node,i,j){node[ns][id].delay=+value.call(node,node.__data__,i,j)}:(value=+value,function(node){node[ns][id].delay=value}))},d3_transitionPrototype.duration=function(value){var id=this.id,ns=this.namespace;return arguments.length<1?this.node()[ns][id].duration:d3_selection_each(this,"function"==typeof value?function(node,i,j){node[ns][id].duration=Math.max(1,value.call(node,node.__data__,i,j))}:(value=Math.max(1,value),function(node){node[ns][id].duration=value}))},d3_transitionPrototype.each=function(type,listener){var id=this.id,ns=this.namespace;if(arguments.length<2){var inherit=d3_transitionInherit,inheritId=d3_transitionInheritId;try{d3_transitionInheritId=id,d3_selection_each(this,function(node,i,j){d3_transitionInherit=node[ns][id],type.call(node,node.__data__,i,j)})}finally{d3_transitionInherit=inherit,d3_transitionInheritId=inheritId}}else d3_selection_each(this,function(node){var transition=node[ns][id];(transition.event||(transition.event=d3.dispatch("start","end","interrupt"))).on(type,listener)});return this},d3_transitionPrototype.transition=function(){for(var subgroup,group,node,transition,id0=this.id,id1=++d3_transitionId,ns=this.namespace,subgroups=[],j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++)(node=group[i])&&(transition=node[ns][id0],d3_transitionNode(node,i,ns,id1,{time:transition.time,ease:transition.ease,delay:transition.delay+transition.duration,duration:transition.duration})),subgroup.push(node)}return d3_transition(subgroups,ns,id1)},d3.svg.axis=function(){function axis(g){g.each(function(){var tickTransform,g=d3.select(this),scale0=this.__chart__||scale,scale1=this.__chart__=scale.copy(),ticks=null==tickValues?scale1.ticks?scale1.ticks.apply(scale1,tickArguments_):scale1.domain():tickValues,tickFormat=null==tickFormat_?scale1.tickFormat?scale1.tickFormat.apply(scale1,tickArguments_):d3_identity:tickFormat_,tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",ε),tickExit=d3.transition(tick.exit()).style("opacity",ε).remove(),tickUpdate=d3.transition(tick.order()).style("opacity",1),tickSpacing=Math.max(innerTickSize,0)+tickPadding,range=d3_scaleRange(scale1),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),d3.transition(path));tickEnter.append("line"),tickEnter.append("text");var x1,x2,y1,y2,lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text"),sign="top"===orient||"left"===orient?-1:1;if("bottom"===orient||"top"===orient?(tickTransform=d3_svg_axisX,x1="x",y1="y",x2="x2",y2="y2",text.attr("dy",sign<0?"0em":".71em").style("text-anchor","middle"),pathUpdate.attr("d","M"+range[0]+","+sign*outerTickSize+"V0H"+range[1]+"V"+sign*outerTickSize)):(tickTransform=d3_svg_axisY,x1="y",y1="x",x2="y2",y2="x2",text.attr("dy",".32em").style("text-anchor",sign<0?"end":"start"),pathUpdate.attr("d","M"+sign*outerTickSize+","+range[0]+"H0V"+range[1]+"H"+sign*outerTickSize)),lineEnter.attr(y2,sign*innerTickSize),textEnter.attr(y1,sign*tickSpacing),lineUpdate.attr(x2,0).attr(y2,sign*innerTickSize),textUpdate.attr(x1,0).attr(y1,sign*tickSpacing),scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx}}else scale0.rangeBand?scale0=scale1:tickExit.call(tickTransform,scale1,scale0);tickEnter.call(tickTransform,scale0,scale1),tickUpdate.call(tickTransform,scale1,scale1)})}var tickFormat_,scale=d3.scale.linear(),orient=d3_svg_axisDefaultOrient,innerTickSize=6,outerTickSize=6,tickPadding=3,tickArguments_=[10],tickValues=null;return axis.scale=function(x){return arguments.length?(scale=x,axis):scale},axis.orient=function(x){return arguments.length?(orient=x in d3_svg_axisOrients?x+"":d3_svg_axisDefaultOrient,axis):orient},axis.ticks=function(){return arguments.length?(tickArguments_=d3_array(arguments),axis):tickArguments_},axis.tickValues=function(x){return arguments.length?(tickValues=x,axis):tickValues},axis.tickFormat=function(x){return arguments.length?(tickFormat_=x,axis):tickFormat_},axis.tickSize=function(x){var n=arguments.length;return n?(innerTickSize=+x,outerTickSize=+arguments[n-1],axis):innerTickSize},axis.innerTickSize=function(x){return arguments.length?(innerTickSize=+x,axis):innerTickSize},axis.outerTickSize=function(x){return arguments.length?(outerTickSize=+x,axis):outerTickSize},axis.tickPadding=function(x){return arguments.length?(tickPadding=+x,axis):tickPadding},axis.tickSubdivide=function(){return arguments.length&&axis},axis};var d3_svg_axisDefaultOrient="bottom",d3_svg_axisOrients={top:1,right:1,bottom:1,left:1};d3.svg.brush=function(){function brush(g){g.each(function(){var g=d3.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart),background=g.selectAll(".background").data([0]);background.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),g.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var resize=g.selectAll(".resize").data(resizes,d3_identity);resize.exit().remove(),resize.enter().append("g").attr("class",function(d){return"resize "+d}).style("cursor",function(d){return d3_svg_brushCursor[d]}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null}).attr("y",function(d){return/^[ns]/.test(d)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),resize.style("display",brush.empty()?"none":null);var range,gUpdate=d3.transition(g),backgroundUpdate=d3.transition(background);x&&(range=d3_scaleRange(x),backgroundUpdate.attr("x",range[0]).attr("width",range[1]-range[0]),redrawX(gUpdate)),y&&(range=d3_scaleRange(y),backgroundUpdate.attr("y",range[0]).attr("height",range[1]-range[0]),redrawY(gUpdate)),redraw(gUpdate)})}function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+xExtent[+/e$/.test(d)]+","+yExtent[+/^s/.test(d)]+")"})}function redrawX(g){g.select(".extent").attr("x",xExtent[0]),g.selectAll(".extent,.n>rect,.s>rect").attr("width",xExtent[1]-xExtent[0])}function redrawY(g){g.select(".extent").attr("y",yExtent[0]),g.selectAll(".extent,.e>rect,.w>rect").attr("height",yExtent[1]-yExtent[0])}function brushstart(){function keydown(){32==d3.event.keyCode&&(dragging||(center=null,origin[0]-=xExtent[1],origin[1]-=yExtent[1],dragging=2),d3_eventPreventDefault())}function keyup(){32==d3.event.keyCode&&2==dragging&&(origin[0]+=xExtent[1],origin[1]+=yExtent[1],dragging=0,d3_eventPreventDefault())}function brushmove(){var point=d3.mouse(target),moved=!1;offset&&(point[0]+=offset[0],point[1]+=offset[1]),dragging||(d3.event.altKey?(center||(center=[(xExtent[0]+xExtent[1])/2,(yExtent[0]+yExtent[1])/2]),origin[0]=xExtent[+(point[0]<center[0])],origin[1]=yExtent[+(point[1]<center[1])]):center=null),resizingX&&move1(point,x,0)&&(redrawX(g),moved=!0),resizingY&&move1(point,y,1)&&(redrawY(g),moved=!0),moved&&(redraw(g),event_({type:"brush",mode:dragging?"move":"resize"}))}function move1(point,scale,i){var min,max,range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],extent=i?yExtent:xExtent,size=extent[1]-extent[0];if(dragging&&(r0-=position,r1-=size+position),min=(i?yClamp:xClamp)?Math.max(r0,Math.min(r1,point[i])):point[i],dragging?max=(min+=position)+size:(center&&(position=Math.max(r0,Math.min(r1,2*center[i]-min))),position<min?(max=min,min=position):max=position),extent[0]!=min||extent[1]!=max)return i?yExtentDomain=null:xExtentDomain=null,extent[0]=min,extent[1]=max,!0}function brushend(){brushmove(),g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null),d3.select("body").style("cursor",null),w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),dragRestore(),event_({type:"brushend"})}var center,offset,target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),dragRestore=d3_event_dragSuppress(target),origin=d3.mouse(target),w=d3.select(d3_window(target)).on("keydown.brush",keydown).on("keyup.brush",keyup);if(d3.event.changedTouches?w.on("touchmove.brush",brushmove).on("touchend.brush",brushend):w.on("mousemove.brush",brushmove).on("mouseup.brush",brushend),g.interrupt().selectAll("*").interrupt(),dragging)origin[0]=xExtent[0]-origin[0],origin[1]=yExtent[0]-origin[1];else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[xExtent[1-ex]-origin[0],yExtent[1-ey]-origin[1]],origin[0]=xExtent[ex],origin[1]=yExtent[ey]}else d3.event.altKey&&(center=origin.slice());g.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",eventTarget.style("cursor")),event_({type:"brushstart"}),brushmove()}var xExtentDomain,yExtentDomain,event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,xExtent=[0,0],yExtent=[0,0],xClamp=!0,yClamp=!0,resizes=d3_svg_brushResizes[0];return brush.event=function(g){g.each(function(){var event_=event.of(this,arguments),extent1={x:xExtent,y:yExtent,i:xExtentDomain,j:yExtentDomain},extent0=this.__chart__||extent1;this.__chart__=extent1,d3_transitionInheritId?d3.select(this).transition().each("start.brush",function(){xExtentDomain=extent0.i,yExtentDomain=extent0.j,xExtent=extent0.x,yExtent=extent0.y,event_({type:"brushstart"})}).tween("brush:brush",function(){var xi=d3_interpolateArray(xExtent,extent1.x),yi=d3_interpolateArray(yExtent,extent1.y);return xExtentDomain=yExtentDomain=null,function(t){xExtent=extent1.x=xi(t),yExtent=extent1.y=yi(t),event_({type:"brush",mode:"resize"})}}).each("end.brush",function(){xExtentDomain=extent1.i,yExtentDomain=extent1.j,event_({type:"brush",mode:"resize"}),event_({type:"brushend"})}):(event_({type:"brushstart"}),event_({type:"brush",mode:"resize"}),event_({type:"brushend"}))})},brush.x=function(z){return arguments.length?(x=z,resizes=d3_svg_brushResizes[!x<<1|!y],brush):x},brush.y=function(z){return arguments.length?(y=z,resizes=d3_svg_brushResizes[!x<<1|!y],brush):y},brush.clamp=function(z){return arguments.length?(x&&y?(xClamp=!!z[0],yClamp=!!z[1]):x?xClamp=!!z:y&&(yClamp=!!z),brush):x&&y?[xClamp,yClamp]:x?xClamp:y?yClamp:null},brush.extent=function(z){var x0,x1,y0,y1,t;return arguments.length?(x&&(x0=z[0],x1=z[1],y&&(x0=x0[0],x1=x1[0]),xExtentDomain=[x0,x1],x.invert&&(x0=x(x0),x1=x(x1)),x1<x0&&(t=x0,x0=x1,x1=t),x0==xExtent[0]&&x1==xExtent[1]||(xExtent=[x0,x1])),y&&(y0=z[0],y1=z[1],x&&(y0=y0[1],y1=y1[1]),yExtentDomain=[y0,y1],y.invert&&(y0=y(y0),y1=y(y1)),y1<y0&&(t=y0,y0=y1,y1=t),y0==yExtent[0]&&y1==yExtent[1]||(yExtent=[y0,y1])),brush):(x&&(xExtentDomain?(x0=xExtentDomain[0],x1=xExtentDomain[1]):(x0=xExtent[0],x1=xExtent[1],x.invert&&(x0=x.invert(x0),x1=x.invert(x1)),x1<x0&&(t=x0,x0=x1,x1=t))),y&&(yExtentDomain?(y0=yExtentDomain[0],y1=yExtentDomain[1]):(y0=yExtent[0],y1=yExtent[1],y.invert&&(y0=y.invert(y0),y1=y.invert(y1)),y1<y0&&(t=y0,y0=y1,y1=t))),x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1])},brush.clear=function(){return brush.empty()||(xExtent=[0,0],yExtent=[0,0],xExtentDomain=yExtentDomain=null),brush},brush.empty=function(){return!!x&&xExtent[0]==xExtent[1]||!!y&&yExtent[0]==yExtent[1]},d3.rebind(brush,event,"on")};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],d3_time_format=d3_time.format=d3_locale_enUS.timeFormat,d3_time_formatUtc=d3_time_format.utc,d3_time_formatIso=d3_time_formatUtc("%Y-%m-%dT%H:%M:%S.%LZ");d3_time_format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?d3_time_formatIsoNative:d3_time_formatIso,d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date},d3_time_formatIsoNative.toString=d3_time_formatIso.toString,d3_time.second=d3_time_interval(function(date){return new d3_date(1e3*Math.floor(date/1e3))},function(date,offset){date.setTime(date.getTime()+1e3*Math.floor(offset))},function(date){return date.getSeconds()}),d3_time.seconds=d3_time.second.range,d3_time.seconds.utc=d3_time.second.utc.range,d3_time.minute=d3_time_interval(function(date){return new d3_date(6e4*Math.floor(date/6e4))},function(date,offset){date.setTime(date.getTime()+6e4*Math.floor(offset))},function(date){return date.getMinutes()}),d3_time.minutes=d3_time.minute.range,d3_time.minutes.utc=d3_time.minute.utc.range,d3_time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_date(36e5*(Math.floor(date/36e5-timezone)+timezone))},function(date,offset){date.setTime(date.getTime()+36e5*Math.floor(offset))},function(date){return date.getHours()}),d3_time.hours=d3_time.hour.range,d3_time.hours.utc=d3_time.hour.utc.range,d3_time.month=d3_time_interval(function(date){return date=d3_time.day(date),date.setDate(1),date},function(date,offset){date.setMonth(date.getMonth()+offset)},function(date){return date.getMonth()}),d3_time.months=d3_time.month.range,d3_time.months.utc=d3_time.month.utc.range;var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],d3_time_scaleLocalMethods=[[d3_time.second,1],[d3_time.second,5],[d3_time.second,15],[d3_time.second,30],[d3_time.minute,1],[d3_time.minute,5],[d3_time.minute,15],[d3_time.minute,30],[d3_time.hour,1],[d3_time.hour,3],[d3_time.hour,6],[d3_time.hour,12],[d3_time.day,1],[d3_time.day,2],[d3_time.week,1],[d3_time.month,1],[d3_time.month,3],[d3_time.year,1]],d3_time_scaleLocalFormat=d3_time_format.multi([[".%L",function(d){return d.getMilliseconds()}],[":%S",function(d){return d.getSeconds()}],["%I:%M",function(d){return d.getMinutes()}],["%I %p",function(d){return d.getHours()}],["%a %d",function(d){return d.getDay()&&1!=d.getDate()}],["%b %d",function(d){return 1!=d.getDate()}],["%B",function(d){return d.getMonth()}],["%Y",d3_true]]),d3_time_scaleMilliseconds={range:function(start,stop,step){return d3.range(Math.ceil(start/step)*step,+stop,step).map(d3_time_scaleDate)},floor:d3_identity,ceil:d3_identity};d3_time_scaleLocalMethods.year=d3_time.year,d3_time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat)};var d3_time_scaleUtcMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]]}),d3_time_scaleUtcFormat=d3_time_formatUtc.multi([[".%L",function(d){return d.getUTCMilliseconds()}],[":%S",function(d){return d.getUTCSeconds()}],["%I:%M",function(d){return d.getUTCMinutes()}],["%I %p",function(d){return d.getUTCHours()}],["%a %d",function(d){return d.getUTCDay()&&1!=d.getUTCDate()}],["%b %d",function(d){return 1!=d.getUTCDate()}],["%B",function(d){return d.getUTCMonth()}],["%Y",d3_true]]);d3_time_scaleUtcMethods.year=d3_time.year.utc,d3_time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUtcMethods,d3_time_scaleUtcFormat)},d3.text=d3_xhrType(function(request){return request.responseText}),d3.json=function(url,callback){return d3_xhr(url,"application/json",d3_json,callback)},d3.html=function(url,callback){return d3_xhr(url,"text/html",d3_html,callback)},d3.xml=d3_xhrType(function(request){return request.responseXML}),"function"==typeof define&&define.amd?(this.d3=d3,define(d3)):"object"==typeof module&&module.exports?module.exports=d3:this.d3=d3}()},{}],12:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],13:[function(require,module,exports){(function(global){(function(){function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){for(var index=-1,length=null==array?0:array.length;++index<length;){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){for(var index=-1,length=null==array?0:array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}function arrayEachRight(array,iteratee){for(var length=null==array?0:array.length;length--&&!1!==iteratee(array[length],length,array););return array}function arrayEvery(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}function arrayFilter(array,predicate){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}function arrayIncludes(array,value){return!!(null==array?0:array.length)&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){for(var index=-1,length=null==array?0:array.length;++index<length;)if(comparator(value,array[index]))return!0;return!1}function arrayMap(array,iteratee){for(var index=-1,length=null==array?0:array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=null==array?0:array.length;for(initAccum&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=null==array?0:array.length;for(initAccum&&length&&(accumulator=array[--length]);length--;)accumulator=iteratee(accumulator,array[length],length,array);return accumulator}function arraySome(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}function asciiToArray(string){return string.split("")}function asciiWords(string){return string.match(reAsciiWord)||[]}function baseFindKey(collection,predicate,eachFunc){var result;return eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection))return result=key,!1}),result}function baseFindIndex(array,predicate,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?1:-1);fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}function baseIndexOfWith(array,value,fromIndex,comparator){for(var index=fromIndex-1,length=array.length;++index<length;)if(comparator(array[index],value))return index;return-1}function baseIsNaN(value){return value!==value}function baseMean(array,iteratee){var length=null==array?0:array.length;return length?baseSum(array,iteratee)/length:NAN}function baseProperty(key){return function(object){return null==object?undefined:object[key]}}function basePropertyOf(object){return function(key){return null==object?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}function baseSortBy(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}function baseSum(array,iteratee){for(var result,index=-1,length=array.length;++index<length;){var current=iteratee(array[index]);current!==undefined&&(result=result===undefined?current:result+current)}return result}function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){for(var index=-1,length=strSymbols.length;++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1;);return index}function charsEndIndex(strSymbols,chrSymbols){for(var index=strSymbols.length;index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1;);return index}function countHolders(array,placeholder){for(var length=array.length,result=0;length--;)array[length]===placeholder&&++result;return result}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function getValue(object,key){return null==object?undefined:object[key]}function hasUnicode(string){return reHasUnicode.test(string)}function hasUnicodeWord(string){return reHasUnicodeWord.test(string)}function iteratorToArray(iterator){for(var data,result=[];!(data=iterator.next()).done;)result.push(data.value);return result}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach(function(value,key){result[++index]=[key,value]}),result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=0,result=[];++index<length;){var value=array[index];value!==placeholder&&value!==PLACEHOLDER||(array[index]=PLACEHOLDER,result[resIndex++]=index)}return result}function safeGet(object,key){return"__proto__"==key?undefined:object[key]}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=value}),result}function setToPairs(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=[value,value]}),result}function strictIndexOf(array,value,fromIndex){for(var index=fromIndex-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}function strictLastIndexOf(array,value,fromIndex){for(var index=fromIndex+1;index--;)if(array[index]===value)return index;return index}function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}function stringToArray(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string)}function unicodeSize(string){
for(var result=reUnicode.lastIndex=0;reUnicode.test(string);)++result;return result}function unicodeToArray(string){return string.match(reUnicode)||[]}function unicodeWords(string){return string.match(reUnicodeWord)||[]}var undefined,LARGE_ARRAY_SIZE=200,CORE_ERROR_TEXT="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",FUNC_ERROR_TEXT="Expected a function",HASH_UNDEFINED="__lodash_hash_undefined__",MAX_MEMOIZE_SIZE=500,PLACEHOLDER="__lodash_placeholder__",CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2,WRAP_BIND_FLAG=1,WRAP_BIND_KEY_FLAG=2,WRAP_CURRY_BOUND_FLAG=4,WRAP_CURRY_FLAG=8,WRAP_CURRY_RIGHT_FLAG=16,WRAP_PARTIAL_FLAG=32,WRAP_PARTIAL_RIGHT_FLAG=64,WRAP_ARY_FLAG=128,WRAP_REARG_FLAG=256,WRAP_FLIP_FLAG=512,DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...",HOT_COUNT=800,HOT_SPAN=16,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=NaN,MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1,wrapFlags=[["ary",WRAP_ARY_FLAG],["bind",WRAP_BIND_FLAG],["bindKey",WRAP_BIND_KEY_FLAG],["curry",WRAP_CURRY_FLAG],["curryRight",WRAP_CURRY_RIGHT_FLAG],["flip",WRAP_FLIP_FLAG],["partial",WRAP_PARTIAL_FLAG],["partialRight",WRAP_PARTIAL_RIGHT_FLAG],["rearg",WRAP_REARG_FLAG]],argsTag="[object Arguments]",arrayTag="[object Array]",asyncTag="[object AsyncFunction]",boolTag="[object Boolean]",dateTag="[object Date]",domExcTag="[object DOMException]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",nullTag="[object Null]",objectTag="[object Object]",proxyTag="[object Proxy]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",undefinedTag="[object Undefined]",weakMapTag="[object WeakMap]",weakSetTag="[object WeakSet]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source),reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/,reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /,reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,reEscapeChar=/\\(\\)?/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsOctal=/^0o[0-7]+$/i,reIsUint=/^(?:0|[1-9]\d*)$/,reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,rsComboRange="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",rsBreakRange="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsLower="[a-z\\xdf-\\xf6\\xf8-\\xff]",rsMisc="[^\\ud800-\\udfff"+rsBreakRange+"\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",reOptMod="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",rsOptJoin="(?:\\u200d(?:"+["[^\\ud800-\\udfff]",rsRegional,rsSurrPair].join("|")+")[\\ufe0e\\ufe0f]?"+reOptMod+")*",rsSeq="[\\ufe0e\\ufe0f]?"+reOptMod+rsOptJoin,rsEmoji="(?:"+["[\\u2700-\\u27bf]",rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+["[^\\ud800-\\udfff]"+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,"[\\ud800-\\udfff]"].join("|")+")",reApos=RegExp("['’]","g"),reComboMark=RegExp(rsCombo,"g"),reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g"),reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[rsBreak,rsUpper,"$"].join("|")+")","(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+(?:['’](?:d|ll|m|re|s|t|ve))?",rsUpper+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",rsEmoji].join("|"),"g"),reHasUnicode=RegExp("[\\u200d\\ud800-\\udfff"+rsComboRange+"\\ufe0e\\ufe0f]"),reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],templateCounter=-1,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},freeParseFloat=parseFloat,freeParseInt=parseInt,freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,freeProcess=moduleExports&&freeGlobal.process,nodeUtil=function(){try{var types=freeModule&&freeModule.require&&freeModule.require("util").types;return types||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,asciiSize=baseProperty("length"),deburrLetter=basePropertyOf(deburredLetters),escapeHtmlChar=basePropertyOf(htmlEscapes),unescapeHtmlChar=basePropertyOf(htmlUnescapes),_=function runInContext(context){function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value,this.__actions__=[],this.__chain__=!!chainAll,this.__index__=0,this.__values__=undefined}function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=MAX_ARRAY_LENGTH,this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);return result.__actions__=copyArray(this.__actions__),result.__dir__=this.__dir__,result.__filtered__=this.__filtered__,result.__iteratees__=copyArray(this.__iteratees__),result.__takeCount__=this.__takeCount__,result.__views__=copyArray(this.__views__),result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1,result.__filtered__=!0}else result=this.clone(),result.__dir__*=-1;return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length)return baseWrapperValue(array,this.__actions__);var result=[];outer:for(;length--&&resIndex<takeCount;){index+=dir;for(var iterIndex=-1,value=array[index];++iterIndex<iterLength;){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG)value=computed;else if(!computed){if(type==LAZY_FILTER_FLAG)continue outer;break outer}}result[resIndex++]=value}return result}function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value,this}function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[],this.size=0}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,!0)}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this}function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){var result=getMapData(this,key).delete(key);return this.size-=result?1:0,result}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this}function SetCache(values){var index=-1,length=null==values?0:values.length;for(this.__data__=new MapCache;++index<length;)this.add(values[index])}function setCacheAdd(value){return this.__data__.set(value,HASH_UNDEFINED),this}function setCacheHas(value){return this.__data__.has(value)}function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(key){var data=this.__data__,result=data.delete(key);return this.size=data.size,result}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new MapCache(pairs)}return data.set(key,value),this.size=data.size,this}function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:undefined}function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length))}function arrayShuffle(array){return shuffleSelf(copyArray(array))}function assignMergeValue(object,key,value){(value===undefined||eq(object[key],value))&&(value!==undefined||key in object)||baseAssignValue(object,key,value)}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(value!==undefined||key in object)||baseAssignValue(object,key,value)}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseAggregator(collection,setter,iteratee,accumulator){return baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)}),accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignIn(object,source){return object&&copyObject(source,keysIn(source),object)}function baseAssignValue(object,key,value){"__proto__"==key&&defineProperty?defineProperty(object,key,{configurable:!0,enumerable:!0,value:value,writable:!0}):object[key]=value}function baseAt(object,paths){for(var index=-1,length=paths.length,result=Array(length),skip=null==object;++index<length;)result[index]=skip?undefined:get(object,paths[index]);return result}function baseClamp(number,lower,upper){return number===number&&(upper!==undefined&&(number=number<=upper?number:upper),lower!==undefined&&(number=number>=lower?number:lower)),number}function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),result!==undefined)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=initCloneArray(value),!isDeep)return copyArray(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value))return cloneBuffer(value,isDeep);if(tag==objectTag||tag==argsTag||isFunc&&!object){if(result=isFlat||isFunc?{}:initCloneObject(value),!isDeep)return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=initCloneByTag(value,tag,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked)return stacked;if(stack.set(value,result),isSet(value))return value.forEach(function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))}),result;if(isMap(value))return value.forEach(function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))}),result;var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys,props=isArr?undefined:keysFunc(value);return arrayEach(props||value,function(subValue,key){props&&(key=subValue,subValue=value[key]),assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))}),result}function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}function baseConformsTo(object,source,props){var length=props.length;if(null==object)return!length;for(object=Object(object);length--;){var key=props[length],predicate=source[key],value=object[key];if(value===undefined&&!(key in object)||!predicate(value))return!1}return!0}function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=!0,length=array.length,result=[],valuesLength=values.length;if(!length)return result;iteratee&&(values=arrayMap(values,baseUnary(iteratee))),comparator?(includes=arrayIncludesWith,isCommon=!1):values.length>=LARGE_ARRAY_SIZE&&(includes=cacheHas,isCommon=!1,values=new SetCache(values));outer:for(;++index<length;){var value=array[index],computed=null==iteratee?value:iteratee(value);if(value=comparator||0!==value?value:0,isCommon&&computed===computed){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===computed)continue outer;result.push(value)}else includes(values,computed,comparator)||result.push(value)}return result}function baseEvery(collection,predicate){var result=!0;return baseEach(collection,function(value,index,collection){return result=!!predicate(value,index,collection)}),result}function baseExtremum(array,iteratee,comparator){for(var index=-1,length=array.length;++index<length;){var value=array[index],current=iteratee(value);if(null!=current&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed)))var computed=current,result=value}return result}function baseFill(array,value,start,end){var length=array.length;for(start=toInteger(start),start<0&&(start=-start>length?0:length+start),end=end===undefined||end>length?length:toInteger(end),end<0&&(end+=length),end=start>end?0:toLength(end);start<end;)array[start++]=value;return array}function baseFilter(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate||(predicate=isFlattenable),result||(result=[]);++index<length;){var value=array[index];depth>0&&predicate(value)?depth>1?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=castPath(path,object);for(var index=0,length=path.length;null!=object&&index<length;)object=object[toKey(path[index++])];return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){return null==value?value===undefined?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return null!=object&&hasOwnProperty.call(object,key)}function baseHasIn(object,key){return null!=object&&key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){for(var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=1/0,result=[];othIndex--;){var array=arrays[othIndex];othIndex&&iteratee&&(array=arrayMap(array,baseUnary(iteratee))),maxLength=nativeMin(array.length,maxLength),caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:for(;++index<length&&result.length<maxLength;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){for(othIndex=othLength;--othIndex;){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator)))continue outer}seen&&seen.push(computed),result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){return baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)}),accumulator}function baseInvoke(object,path,args){path=castPath(path,object),object=parent(object,path);var func=null==object?object:object[toKey(last(path))];return null==func?undefined:apply(func,object,args)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsArrayBuffer(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag}function baseIsDate(value){return isObjectLike(value)&&baseGetTag(value)==dateTag}function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack))}function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag,othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other))return!1;objIsArr=!0,objIsObj=!1}if(isSameTag&&!objIsObj)return stack||(stack=new Stack),objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;return stack||(stack=new Stack),equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}return!!isSameTag&&(stack||(stack=new Stack),equalObjects(object,other,bitmask,customizer,equalFunc,stack))}function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=Object(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object))return!1}else{var stack=new Stack;if(customizer)var result=customizer(objValue,srcValue,key,object,source,stack);if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result))return!1}}return!0}function baseIsNative(value){return!(!isObject(value)||isMasked(value))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value))}function baseIsRegExp(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag}function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}function baseIteratee(value){return"function"==typeof value?value:null==value?identity:"object"==typeof value?isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}function baseKeys(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}function baseKeysIn(object){if(!isObject(object))return nativeKeysIn(object);var isProto=isPrototype(object),result=[];for(var key in object)("constructor"!=key||!isProto&&hasOwnProperty.call(object,key))&&result.push(key);return result}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}function baseMatches(source){var matchData=getMatchData(source);return 1==matchData.length&&matchData[0][2]?matchesStrictComparable(matchData[0][0],matchData[0][1]):function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){return isKey(path)&&isStrictComparable(srcValue)?matchesStrictComparable(toKey(path),srcValue):function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){object!==source&&baseFor(source,function(srcValue,key){if(isObject(srcValue))stack||(stack=new Stack),baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack);else{var newValue=customizer?customizer(safeGet(object,key),srcValue,key+"",object,source,stack):undefined;newValue===undefined&&(newValue=srcValue),assignMergeValue(object,key,newValue)}},keysIn)}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=safeGet(object,key),srcValue=safeGet(source,key),stacked=stack.get(srcValue);if(stacked)return void assignMergeValue(object,key,stacked);var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined,isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue,isArr||isBuff||isTyped?isArray(objValue)?newValue=objValue:isArrayLikeObject(objValue)?newValue=copyArray(objValue):isBuff?(isCommon=!1,newValue=cloneBuffer(srcValue,!0)):isTyped?(isCommon=!1,newValue=cloneTypedArray(srcValue,!0)):newValue=[]:isPlainObject(srcValue)||isArguments(srcValue)?(newValue=objValue,isArguments(objValue)?newValue=toPlainObject(objValue):(!isObject(objValue)||srcIndex&&isFunction(objValue))&&(newValue=initCloneObject(srcValue))):isCommon=!1}isCommon&&(stack.set(srcValue,newValue),mergeFunc(newValue,srcValue,srcIndex,customizer,stack),stack.delete(srcValue)),assignMergeValue(object,key,newValue)}function baseNth(array,n){var length=array.length;if(length)return n+=n<0?length:0,isIndex(n,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){var index=-1;return iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee())),baseSortBy(baseMap(collection,function(value,key,collection){return{criteria:arrayMap(iteratees,function(iteratee){return iteratee(value)}),index:++index,value:value}}),function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,paths){return basePickBy(object,paths,function(value,path){return hasIn(object,path)})}function basePickBy(object,paths,predicate){for(var index=-1,length=paths.length,result={};++index<length;){var path=paths[index],value=baseGet(object,path);predicate(value,path)&&baseSet(result,castPath(path,object),value)}return result}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;for(array===values&&(values=copyArray(values)),iteratee&&(seen=arrayMap(array,baseUnary(iteratee)));++index<length;)for(var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;(fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1;)seen!==array&&splice.call(seen,fromIndex,1),splice.call(array,fromIndex,1);return array}function basePullAt(array,indexes){for(var length=array?indexes.length:0,lastIndex=length-1;length--;){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;isIndex(index)?splice.call(array,index,1):baseUnset(array,index)}}return array}function baseRandom(lower,upper){
return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){for(var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);length--;)result[fromRight?length:++index]=start,start+=step;return result}function baseRepeat(string,n){var result="";if(!string||n<1||n>MAX_SAFE_INTEGER)return result;do{n%2&&(result+=string),(n=nativeFloor(n/2))&&(string+=string)}while(n);return result}function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}function baseSample(collection){return arraySample(values(collection))}function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length))}function baseSet(object,path,value,customizer){if(!isObject(object))return object;path=castPath(path,object);for(var index=-1,length=path.length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined,newValue===undefined&&(newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object}function baseShuffle(collection){return shuffleSelf(values(collection))}function baseSlice(array,start,end){var index=-1,length=array.length;start<0&&(start=-start>length?0:length+start),end=end>length?length:end,end<0&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}function baseSome(collection,predicate){var result;return baseEach(collection,function(value,index,collection){return!(result=predicate(value,index,collection))}),!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=null==array?low:array.length;if("number"==typeof value&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){for(;low<high;){var mid=low+high>>>1,computed=array[mid];null!==computed&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)?low=mid+1:high=mid}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);for(var low=0,high=null==array?0:array.length,valIsNaN=value!==value,valIsNull=null===value,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;low<high;){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=null===computed,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN)var setLow=retHighest||othIsReflexive;else setLow=valIsUndefined?othIsReflexive&&(retHighest||othIsDefined):valIsNull?othIsReflexive&&othIsDefined&&(retHighest||!othIsNull):valIsSymbol?othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol):!othIsNull&&!othIsSymbol&&(retHighest?computed<=value:computed<value);setLow?low=mid+1:high=mid}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array,iteratee){for(var index=-1,length=array.length,resIndex=0,result=[];++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=0===value?0:value}}return result}function baseToNumber(value){return"number"==typeof value?value:isSymbol(value)?NAN:+value}function baseToString(value){if("string"==typeof value)return value;if(isArray(value))return arrayMap(value,baseToString)+"";if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=!0,result=[],seen=result;if(comparator)isCommon=!1,includes=arrayIncludesWith;else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set)return setToArray(set);isCommon=!1,includes=cacheHas,seen=new SetCache}else seen=iteratee?[]:result;outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,isCommon&&computed===computed){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else includes(seen,computed,comparator)||(seen!==result&&seen.push(computed),result.push(value))}return result}function baseUnset(object,path){return path=castPath(path,object),null==(object=parent(object,path))||delete object[toKey(last(path))]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){for(var length=array.length,index=fromRight?length:-1;(fromRight?index--:++index<length)&&predicate(array[index],index,array););return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;return result instanceof LazyWrapper&&(result=result.value()),arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2)return length?baseUniq(arrays[0]):[];for(var index=-1,result=Array(length);++index<length;)for(var array=arrays[index],othIndex=-1;++othIndex<length;)othIndex!=index&&(result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator));return baseUniq(baseFlatten(result,1),iteratee,comparator)}function baseZipObject(props,values,assignFunc){for(var index=-1,length=props.length,valsLength=values.length,result={};++index<length;){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return"function"==typeof value?value:identity}function castPath(value,object){return isArray(value)?value:isKey(value,object)?[value]:stringToPath(toString(value))}function castSlice(array,start,end){var length=array.length;return end=end===undefined?length:end,!start&&end>=length?array:baseSlice(array,start,end)}function cloneBuffer(buffer,isDeep){if(isDeep)return buffer.slice();var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);return buffer.copy(result),result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array(result).set(new Uint8Array(arrayBuffer)),result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=null===value,valIsReflexive=value===value,valIsSymbol=isSymbol(value),othIsDefined=other!==undefined,othIsNull=null===other,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive)return 1;if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive)return-1}return 0}function compareMultiple(object,other,orders){for(var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;++index<length;){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength)return result;return result*("desc"==orders[index]?-1:1)}}return object.index-other.index}function composeArgs(args,partials,holders,isCurried){for(var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)(isUncurried||argsIndex<argsLength)&&(result[holders[argsIndex]]=args[argsIndex]);for(;rangeLength--;)result[leftIndex++]=args[argsIndex++];return result}function composeArgsRight(args,partials,holders,isCurried){for(var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;++argsIndex<rangeLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)(isUncurried||argsIndex<argsLength)&&(result[offset+holders[holdersIndex]]=args[argsIndex++]);return result}function copyArray(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;newValue===undefined&&(newValue=source[key]),isNew?baseAssignValue(object,key,newValue):assignValue(object,key,newValue)}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;for(customizer=assigner.length>3&&"function"==typeof customizer?(length--,customizer):undefined,guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?undefined:customizer,length=1),object=Object(object);++index<length;){var source=sources[index];source&&assigner(object,source,index,customizer)}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}function createBind(func,bitmask,thisArg){function wrapper(){return(this&&this!==root&&this instanceof wrapper?Ctor:func).apply(isBind?thisArg:this,arguments)}var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=hasUnicode(string)?stringToArray(string):undefined,chr=strSymbols?strSymbols[0]:string.charAt(0),trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(func,bitmask,arity){function wrapper(){for(var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);index--;)args[index]=arguments[index];var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);return(length-=holders.length)<arity?createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length):apply(this&&this!==root&&this instanceof wrapper?Ctor:func,this,args)}var Ctor=createCtor(func);return wrapper}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection),predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return flatRest(function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;for(fromRight&&funcs.reverse();index--;){var func=funcs[index];if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(prereq&&!wrapper&&"wrapper"==getFuncName(func))var wrapper=new LodashWrapper([],!0)}for(index=wrapper?index:length;++index<length;){func=funcs[index];var funcName=getFuncName(func),data="wrapper"==funcName?getData(func):undefined;wrapper=data&&isLaziable(data[0])&&data[1]==(WRAP_ARY_FLAG|WRAP_CURRY_FLAG|WRAP_PARTIAL_FLAG|WRAP_REARG_FLAG)&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments,value=args[0];if(wrapper&&1==args.length&&isArray(value))return wrapper.plant(value).value();for(var index=0,result=length?funcs[index].apply(this,args):value;++index<length;)result=funcs[index].call(this,result);return result}})}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){function wrapper(){for(var length=arguments.length,args=Array(length),index=length;index--;)args[index]=arguments[index];if(isCurried)var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder);if(partials&&(args=composeArgs(args,partials,holders,isCurried)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight,isCurried)),length-=holdersCount,isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return length=args.length,argPos?args=reorder(args,argPos):isFlip&&length>1&&args.reverse(),isAry&&ary<length&&(args.length=ary),this&&this!==root&&this instanceof wrapper&&(fn=Ctor||createCtor(fn)),fn.apply(thisBinding,args)}var isAry=bitmask&WRAP_ARY_FLAG,isBind=bitmask&WRAP_BIND_FLAG,isBindKey=bitmask&WRAP_BIND_KEY_FLAG,isCurried=bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG),isFlip=bitmask&WRAP_FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined)return defaultValue;if(value!==undefined&&(result=value),other!==undefined){if(result===undefined)return other;"string"==typeof value||"string"==typeof other?(value=baseToString(value),other=baseToString(other)):(value=baseToNumber(value),other=baseToNumber(other)),result=operator(value,other)}return result}}function createOver(arrayFunc){return flatRest(function(iteratees){return iteratees=arrayMap(iteratees,baseUnary(getIteratee())),baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(length,chars){chars=chars===undefined?" ":baseToString(chars);var charsLength=chars.length;if(charsLength<2)return charsLength?baseRepeat(chars,length):chars;var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createPartial(func,bitmask,thisArg,partials){function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];return apply(fn,isBind?thisArg:this,args)}var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);return wrapper}function createRange(fromRight){return function(start,end,step){return step&&"number"!=typeof step&&isIterateeCall(start,end,step)&&(end=step=undefined),start=toFinite(start),end===undefined?(end=start,start=0):end=toFinite(end),step=step===undefined?start<end?1:-1:toFinite(step),baseRange(start,end,step,fromRight)}}function createRelationalOperation(operator){return function(value,other){return"string"==typeof value&&"string"==typeof other||(value=toNumber(value),other=toNumber(other)),operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&WRAP_CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?WRAP_PARTIAL_FLAG:WRAP_PARTIAL_RIGHT_FLAG,(bitmask&=~(isCurry?WRAP_PARTIAL_RIGHT_FLAG:WRAP_PARTIAL_FLAG))&WRAP_CURRY_BOUND_FLAG||(bitmask&=~(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG));var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity],result=wrapFunc.apply(undefined,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){if(number=toNumber(number),precision=null==precision?0:nativeMin(toInteger(precision),292)){var pair=(toString(number)+"e").split("e");return pair=(toString(func(pair[0]+"e"+(+pair[1]+precision)))+"e").split("e"),+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}function createToPairs(keysFunc){return function(object){var tag=getTag(object);return tag==mapTag?mapToArray(object):tag==setTag?setToPairs(object):baseToPairs(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&WRAP_BIND_KEY_FLAG;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=~(WRAP_PARTIAL_FLAG|WRAP_PARTIAL_RIGHT_FLAG),partials=holders=undefined),ary=ary===undefined?ary:nativeMax(toInteger(ary),0),arity=arity===undefined?arity:toInteger(arity),length-=holders?holders.length:0,bitmask&WRAP_PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&mergeData(newData,data),func=newData[0],bitmask=newData[1],thisArg=newData[2],partials=newData[3],holders=newData[4],arity=newData[9]=newData[9]===undefined?isBindKey?0:func.length:nativeMax(newData[9]-length,0),!arity&&bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)&&(bitmask&=~(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)),bitmask&&bitmask!=WRAP_BIND_FLAG)result=bitmask==WRAP_CURRY_FLAG||bitmask==WRAP_CURRY_RIGHT_FLAG?createCurry(func,bitmask,arity):bitmask!=WRAP_PARTIAL_FLAG&&bitmask!=(WRAP_BIND_FLAG|WRAP_PARTIAL_FLAG)||holders.length?createHybrid.apply(undefined,newData):createPartial(func,bitmask,thisArg,partials);else var result=createBind(func,bitmask,thisArg);return setWrapToString((data?baseSetData:setData)(result,newData),func,bitmask)}function customDefaultsAssignIn(objValue,srcValue,key,object){return objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)?srcValue:objValue}function customDefaultsMerge(objValue,srcValue,key,object,source,stack){return isObject(objValue)&&isObject(srcValue)&&(stack.set(srcValue,objValue),baseMerge(objValue,srcValue,undefined,customDefaultsMerge,stack),stack.delete(srcValue)),objValue}function customOmitClone(value){return isPlainObject(value)?undefined:value}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var stacked=stack.get(array);if(stacked&&stack.get(other))return stacked==other;var index=-1,result=!0,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:undefined;for(stack.set(array,other),stack.set(other,array);++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(compared!==undefined){if(compared)continue;result=!1;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex)})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack.delete(array),stack.delete(other),result}function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case arrayBufferTag:return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;if(convert||(convert=setToArray),object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=COMPARE_UNORDERED_FLAG,stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack.delete(object),result;case symbolTag:if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length;if(objLength!=getAllKeys(other).length&&!isPartial)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key)))return!1}var stacked=stack.get(object);if(stacked&&stack.get(other))return stacked==other;var result=!0;stack.set(object,other),stack.set(other,object);for(var skipCtor=isPartial;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor)&&(result=!1)}return stack.delete(object),stack.delete(other),result}function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}function getFuncName(func){for(var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}function getHolder(func){return(hasOwnProperty.call(lodash,"placeholder")?lodash:func).placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;return result=result===iteratee?baseIteratee:result,arguments.length?result(arguments[0],arguments[1]):result}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data["string"==typeof key?"string":"hash"]:data.map}function getMatchData(object){for(var result=keys(object),length=result.length;length--;){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);return unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]),result}function getView(start,end,transforms){for(var index=-1,length=transforms.length;++index<length;){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size)}}return{start:start,end:end}}function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}function hasPath(object,path,hasFunc){path=castPath(path,object);for(var index=-1,length=path.length,result=!1;++index<length;){var key=toKey(path[index]);if(!(result=null!=object&&hasFunc(object,key)))break;object=object[key]}return result||++index!=length?result:!!(length=null==object?0:object.length)&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}function initCloneArray(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}function initCloneObject(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:baseCreate(getPrototype(object))}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return new Ctor;case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return new Ctor;case symbolTag:return cloneSymbol(object)}}function insertWrapDetails(source,details){var length=details.length;if(!length)return source;var lastIndex=length-1;return details[lastIndex]=(length>1?"& ":"")+details[lastIndex],details=details.join(length>2?", ":" "),source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){var type=typeof value;return!!(length=null==length?MAX_SAFE_INTEGER:length)&&("number"==type||"symbol"!=type&&reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;return!!("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}function isKey(value,object){if(isArray(value))return!1;var type=typeof value;return!("number"!=type&&"symbol"!=type&&"boolean"!=type&&null!=value&&!isSymbol(value))||(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))}function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if("function"!=typeof other||!(funcName in LazyWrapper.prototype))return!1;if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}function isStrictComparable(value){return value===value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){return null!=object&&(object[key]===srcValue&&(srcValue!==undefined||key in Object(object)))}}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG|WRAP_ARY_FLAG),isCombo=srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_CURRY_FLAG||srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(WRAP_ARY_FLAG|WRAP_REARG_FLAG)&&source[7].length<=source[8]&&bitmask==WRAP_CURRY_FLAG;if(!isCommon&&!isCombo)return data;srcBitmask&WRAP_BIND_FLAG&&(data[2]=source[2],newBitmask|=bitmask&WRAP_BIND_FLAG?0:WRAP_CURRY_BOUND_FLAG);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value,data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}return value=source[5],value&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):value,data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]),value=source[7],value&&(data[7]=value),srcBitmask&WRAP_ARY_FLAG&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8])),null==data[9]&&(data[9]=source[9]),data[0]=source[0],data[1]=newBitmask,data}function nativeKeysIn(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result}function objectToString(value){return nativeObjectToString.call(value)}function overRest(func,start,transform){return start=nativeMax(start===undefined?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),apply(func,this,otherArgs)}}function parent(object,path){
return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}function setWrapToString(wrapper,reference,bitmask){var source=reference+"";return setToString(wrapper,insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)))}function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=HOT_COUNT)return arguments[0]}else count=0;return func.apply(undefined,arguments)}}function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;for(size=size===undefined?length:size;++index<size;){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index],array[index]=value}return array.length=size,array}function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function updateWrapDetails(details,bitmask){return arrayEach(wrapFlags,function(pair){var value="_."+pair[0];bitmask&pair[1]&&!arrayIncludes(details,value)&&details.push(value)}),details.sort()}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper)return wrapper.clone();var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);return result.__actions__=copyArray(wrapper.__actions__),result.__index__=wrapper.__index__,result.__values__=wrapper.__values__,result}function chunk(array,size,guard){size=(guard?isIterateeCall(array,size,guard):size===undefined)?1:nativeMax(toInteger(size),0);var length=null==array?0:array.length;if(!length||size<1)return[];for(var index=0,resIndex=0,result=Array(nativeCeil(length/size));index<length;)result[resIndex++]=baseSlice(array,index,index+=size);return result}function compact(array){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];value&&(result[resIndex++]=value)}return result}function concat(){var length=arguments.length;if(!length)return[];for(var args=Array(length-1),array=arguments[0],index=length;index--;)args[index-1]=arguments[index];return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1))}function drop(array,n,guard){var length=null==array?0:array.length;return length?(n=guard||n===undefined?1:toInteger(n),baseSlice(array,n<0?0:n,length)):[]}function dropRight(array,n,guard){var length=null==array?0:array.length;return length?(n=guard||n===undefined?1:toInteger(n),n=length-n,baseSlice(array,0,n<0?0:n)):[]}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0,!0):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!0):[]}function fill(array,value,start,end){var length=null==array?0:array.length;return length?(start&&"number"!=typeof start&&isIterateeCall(array,value,start)&&(start=0,end=length),baseFill(array,value,start,end)):[]}function findIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length-1;return fromIndex!==undefined&&(index=toInteger(fromIndex),index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)),baseFindIndex(array,getIteratee(predicate,3),index,!0)}function flatten(array){return(null==array?0:array.length)?baseFlatten(array,1):[]}function flattenDeep(array){return(null==array?0:array.length)?baseFlatten(array,INFINITY):[]}function flattenDepth(array,depth){return(null==array?0:array.length)?(depth=depth===undefined?1:toInteger(depth),baseFlatten(array,depth)):[]}function fromPairs(pairs){for(var index=-1,length=null==pairs?0:pairs.length,result={};++index<length;){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array&&array.length?array[0]:undefined}function indexOf(array,value,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=null==fromIndex?0:toInteger(fromIndex);return index<0&&(index=nativeMax(length+index,0)),baseIndexOf(array,value,index)}function initial(array){return(null==array?0:array.length)?baseSlice(array,0,-1):[]}function join(array,separator){return null==array?"":nativeJoin.call(array,separator)}function last(array){var length=null==array?0:array.length;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=null==array?0:array.length;if(!length)return-1;var index=length;return fromIndex!==undefined&&(index=toInteger(fromIndex),index=index<0?nativeMax(length+index,0):nativeMin(index,length-1)),value===value?strictLastIndexOf(array,value,index):baseFindIndex(array,baseIsNaN,index,!0)}function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined}function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array}function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array}function remove(array,predicate){var result=[];if(!array||!array.length)return result;var index=-1,indexes=[],length=array.length;for(predicate=getIteratee(predicate,3);++index<length;){var value=array[index];predicate(value,index,array)&&(result.push(value),indexes.push(index))}return basePullAt(array,indexes),result}function reverse(array){return null==array?array:nativeReverse.call(array)}function slice(array,start,end){var length=null==array?0:array.length;return length?(end&&"number"!=typeof end&&isIterateeCall(array,start,end)?(start=0,end=length):(start=null==start?0:toInteger(start),end=end===undefined?length:toInteger(end)),baseSlice(array,start,end)):[]}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))}function sortedIndexOf(array,value){var length=null==array?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value))return index}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,!0)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),!0)}function sortedLastIndexOf(array,value){if(null==array?0:array.length){var index=baseSortedIndex(array,value,!0)-1;if(eq(array[index],value))return index}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]}function tail(array){var length=null==array?0:array.length;return length?baseSlice(array,1,length):[]}function take(array,n,guard){return array&&array.length?(n=guard||n===undefined?1:toInteger(n),baseSlice(array,0,n<0?0:n)):[]}function takeRight(array,n,guard){var length=null==array?0:array.length;return length?(n=guard||n===undefined?1:toInteger(n),n=length-n,baseSlice(array,n<0?0:n,length)):[]}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),!1,!0):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]}function uniqWith(array,comparator){return comparator="function"==typeof comparator?comparator:undefined,array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!array||!array.length)return[];var length=0;return array=arrayFilter(array,function(group){if(isArrayLikeObject(group))return length=nativeMax(group.length,length),!0}),baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!array||!array.length)return[];var result=unzip(array);return null==iteratee?result:arrayMap(result,function(group){return apply(iteratee,undefined,group)})}function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}function chain(value){var result=lodash(value);return result.__chain__=!0,result}function tap(value,interceptor){return interceptor(value),value}function thru(value,interceptor){return interceptor(value)}function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){this.__values__===undefined&&(this.__values__=toArray(this.value()));var done=this.__index__>=this.__values__.length;return{done:done,value:done?undefined:this.__values__[this.__index__++]}}function wrapperToIterator(){return this}function wrapperPlant(value){for(var result,parent=this;parent instanceof baseLodash;){var clone=wrapperClone(parent);clone.__index__=0,clone.__values__=undefined,result?previous.__wrapped__=clone:result=clone;var previous=clone;parent=parent.__wrapped__}return previous.__wrapped__=value,result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;return this.__actions__.length&&(wrapped=new LazyWrapper(this)),wrapped=wrapped.reverse(),wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined}),new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=undefined),func(collection,getIteratee(predicate,3))}function filter(collection,predicate){return(isArray(collection)?arrayFilter:baseFilter)(collection,getIteratee(predicate,3))}function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1)}function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY)}function flatMapDepth(collection,iteratee,depth){return depth=depth===undefined?1:toInteger(depth),baseFlatten(map(collection,iteratee),depth)}function forEach(collection,iteratee){return(isArray(collection)?arrayEach:baseEach)(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){return(isArray(collection)?arrayEachRight:baseEachRight)(collection,getIteratee(iteratee,3))}function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection),fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;return fromIndex<0&&(fromIndex=nativeMax(length+fromIndex,0)),isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}function map(collection,iteratee){return(isArray(collection)?arrayMap:baseMap)(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){return null==collection?[]:(isArray(iteratees)||(iteratees=null==iteratees?[]:[iteratees]),orders=guard?undefined:orders,isArray(orders)||(orders=null==orders?[]:[orders]),baseOrderBy(collection,iteratees,orders))}function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){return(isArray(collection)?arrayFilter:baseFilter)(collection,negate(getIteratee(predicate,3)))}function sample(collection){return(isArray(collection)?arraySample:baseSample)(collection)}function sampleSize(collection,n,guard){return n=(guard?isIterateeCall(collection,n,guard):n===undefined)?1:toInteger(n),(isArray(collection)?arraySampleSize:baseSampleSize)(collection,n)}function shuffle(collection){return(isArray(collection)?arrayShuffle:baseShuffle)(collection)}function size(collection){if(null==collection)return 0;if(isArrayLike(collection))return isString(collection)?stringSize(collection):collection.length;var tag=getTag(collection);return tag==mapTag||tag==setTag?collection.size:baseKeys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;return guard&&isIterateeCall(collection,predicate,guard)&&(predicate=undefined),func(collection,getIteratee(predicate,3))}function after(n,func){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){if(--n<1)return func.apply(this,arguments)}}function ary(func,n,guard){return n=guard?undefined:n,n=func&&null==n?func.length:n,createWrap(func,WRAP_ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return n=toInteger(n),function(){return--n>0&&(result=func.apply(this,arguments)),n<=1&&(func=undefined),result}}function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);return result.placeholder=curry.placeholder,result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);return result.placeholder=curryRight.placeholder,result}function debounce(func,wait,options){function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=undefined,lastInvokeTime=time,result=func.apply(thisArg,args)}function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,timeWaiting=wait-timeSinceLastCall;return maxing?nativeMin(timeWaiting,maxWait-timeSinceLastInvoke):timeWaiting}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){return timerId=undefined,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=undefined,result)}function cancel(){timerId!==undefined&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(timerId===undefined)return leadingEdge(lastCallTime);if(maxing)return timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return timerId===undefined&&(timerId=setTimeout(timerExpired,wait)),result}var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxing="maxWait"in options,maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=cancel,debounced.flush=flush,debounced}function flip(func){return createWrap(func,WRAP_FLIP_FLAG)}function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result)||cache,result};return memoized.cache=new(memoize.Cache||MapCache),memoized}function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}function once(func){return before(2,func)}function rest(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=start===undefined?start:toInteger(start),baseRest(func,start)}function spread(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=null==start?0:nativeMax(toInteger(start),0),baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);return array&&arrayPush(otherArgs,array),apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){return partial(castFunction(wrapper),value)}function castArray(){if(!arguments.length)return[];var value=arguments[0];return isArray(value)?value:[value]}function clone(value){return baseClone(value,CLONE_SYMBOLS_FLAG)}function cloneWith(value,customizer){return customizer="function"==typeof customizer?customizer:undefined,baseClone(value,CLONE_SYMBOLS_FLAG,customizer)}function cloneDeep(value){return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}function cloneDeepWith(value,customizer){return customizer="function"==typeof customizer?customizer:undefined,baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,customizer)}function conformsTo(object,source){return null==source||baseConformsTo(object,source,keys(source))}function eq(value,other){return value===other||value!==value&&other!==other}function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return!0===value||!1===value||isObjectLike(value)&&baseGetTag(value)==boolTag}function isElement(value){return isObjectLike(value)&&1===value.nodeType&&!isPlainObject(value)}function isEmpty(value){if(null==value)return!0;if(isArrayLike(value)&&(isArray(value)||"string"==typeof value||"function"==typeof value.splice||isBuffer(value)||isTypedArray(value)||isArguments(value)))return!value.length;var tag=getTag(value);if(tag==mapTag||tag==setTag)return!value.size;if(isPrototype(value))return!baseKeys(value).length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer="function"==typeof customizer?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,undefined,customizer):!!result}function isError(value){if(!isObjectLike(value))return!1;var tag=baseGetTag(value);return tag==errorTag||tag==domExcTag||"string"==typeof value.message&&"string"==typeof value.name&&!isPlainObject(value)}function isFinite(value){return"number"==typeof value&&nativeIsFinite(value)}function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}function isInteger(value){return"number"==typeof value&&value==toInteger(value)}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}function isObjectLike(value){return null!=value&&"object"==typeof value}function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){return customizer="function"==typeof customizer?customizer:undefined,baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(isMaskable(value))throw new Error(CORE_ERROR_TEXT);return baseIsNative(value)}function isNull(value){return null===value}function isNil(value){return null==value}function isNumber(value){return"number"==typeof value||isObjectLike(value)&&baseGetTag(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag)return!1;var proto=getPrototype(value);if(null===proto)return!0;var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}function isString(value){return"string"==typeof value||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&baseGetTag(value)==symbolTag}function isUndefined(value){return value===undefined}function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag}function isWeakSet(value){return isObjectLike(value)&&baseGetTag(value)==weakSetTag}function toArray(value){if(!value)return[];if(isArrayLike(value))return isString(value)?stringToArray(value):copyArray(value);if(symIterator&&value[symIterator])return iteratorToArray(value[symIterator]());var tag=getTag(value);return(tag==mapTag?mapToArray:tag==setTag?setToArray:values)(value)}function toFinite(value){if(!value)return 0===value?value:0;if((value=toNumber(value))===INFINITY||value===-INFINITY){return(value<0?-1:1)*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if("number"==typeof value)return value;if(isSymbol(value))return NAN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return value?baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER):0===value?value:0}function toString(value){return null==value?"":baseToString(value)}function create(prototype,properties){var result=baseCreate(prototype);return null==properties?result:baseAssign(result,properties)}function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)}function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)}function forIn(object,iteratee){return null==object?object:baseFor(object,getIteratee(iteratee,3),keysIn)}function forInRight(object,iteratee){return null==object?object:baseForRight(object,getIteratee(iteratee,3),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))}function functions(object){return null==object?[]:baseFunctions(object,keys(object))}function functionsIn(object){return null==object?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=null==object?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return null!=object&&hasPath(object,path,baseHas)}function hasIn(object,path){return null!=object&&hasPath(object,path,baseHasIn)}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,!0):baseKeysIn(object)}function mapKeys(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value)}),result}function mapValues(object,iteratee){var result={};return iteratee=getIteratee(iteratee,3),baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))}),result}function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)))}function pickBy(object,predicate){if(null==object)return{};var props=arrayMap(getAllKeysIn(object),function(prop){return[prop]});return predicate=getIteratee(predicate),basePickBy(object,props,function(value,path){return predicate(value,path[0])})}function result(object,path,defaultValue){path=castPath(path,object);var index=-1,length=path.length;for(length||(length=1,object=undefined);++index<length;){var value=null==object?undefined:object[toKey(path[index])];value===undefined&&(index=length,value=defaultValue),object=isFunction(value)?value.call(object):value}return object}function set(object,path,value){return null==object?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){return customizer="function"==typeof customizer?customizer:undefined,null==object?object:baseSet(object,path,value,customizer)}function transform(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);if(iteratee=getIteratee(iteratee,4),null==accumulator){var Ctor=object&&object.constructor;accumulator=isArrLike?isArr?new Ctor:[]:isObject(object)&&isFunction(Ctor)?baseCreate(getPrototype(object)):{}}return(isArrLike?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)}),accumulator}function unset(object,path){return null==object||baseUnset(object,path)}function update(object,path,updater){return null==object?object:baseUpdate(object,path,castFunction(updater))}function updateWith(object,path,updater,customizer){return customizer="function"==typeof customizer?customizer:undefined,null==object?object:baseUpdate(object,path,castFunction(updater),customizer)}function values(object){return null==object?[]:baseValues(object,keys(object))}function valuesIn(object){return null==object?[]:baseValues(object,keysIn(object))}function clamp(number,lower,upper){return upper===undefined&&(upper=lower,lower=undefined),upper!==undefined&&(upper=toNumber(upper),upper=upper===upper?upper:0),lower!==undefined&&(lower=toNumber(lower),lower=lower===lower?lower:0),baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){return start=toFinite(start),end===undefined?(end=start,start=0):end=toFinite(end),number=toNumber(number),baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&"boolean"!=typeof floating&&isIterateeCall(lower,upper,floating)&&(upper=floating=undefined),floating===undefined&&("boolean"==typeof upper?(floating=upper,upper=undefined):"boolean"==typeof lower&&(floating=lower,lower=undefined)),lower===undefined&&upper===undefined?(lower=0,upper=1):(lower=toFinite(lower),upper===undefined?(upper=lower,lower=0):upper=toFinite(upper)),lower>upper){var temp=lower;lower=upper,upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){return(string=toString(string))&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string),target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;return(position-=target.length)>=0&&string.slice(position,end)==target}function escape(string){return string=toString(string),string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){return string=toString(string),string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}function pad(string,length,chars){string=toString(string),length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length)return string;var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)}function padEnd(string,length,chars){string=toString(string),length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}function padStart(string,length,chars){string=toString(string),length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}function parseInt(string,radix,guard){return guard||null==radix?radix=0:radix&&(radix=+radix),nativeParseInt(toString(string).replace(reTrimStart,""),radix||0)}function repeat(string,n,guard){return n=(guard?isIterateeCall(string,n,guard):n===undefined)?1:toInteger(n),baseRepeat(toString(string),n)}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])}function split(string,separator,limit){return limit&&"number"!=typeof limit&&isIterateeCall(string,separator,limit)&&(separator=limit=undefined),(limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0)?(string=toString(string),string&&("string"==typeof separator||null!=separator&&!isRegExp(separator))&&!(separator=baseToString(separator))&&hasUnicode(string)?castSlice(stringToArray(string),0,limit):string.split(separator,limit)):[]}function startsWith(string,target,position){return string=toString(string),position=null==position?0:baseClamp(toInteger(position),0,string.length),target=baseToString(target),string.slice(position,position+target.length)==target}function template(string,options,guard){var settings=lodash.templateSettings;guard&&isIterateeCall(string,options,guard)&&(options=undefined),string=toString(string),options=assignInWith({},options,settings,customDefaultsAssignIn);var isEscaping,isEvaluating,imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n"
;string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n";var variable=options.variable;variable||(source="with (obj) {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});if(result.source=source,isError(result))throw result;return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){if((string=toString(string))&&(guard||chars===undefined))return string.replace(reTrim,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars);return castSlice(strSymbols,charsStartIndex(strSymbols,chrSymbols),charsEndIndex(strSymbols,chrSymbols)+1).join("")}function trimEnd(string,chars,guard){if((string=toString(string))&&(guard||chars===undefined))return string.replace(reTrimEnd,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string);return castSlice(strSymbols,0,charsEndIndex(strSymbols,stringToArray(chars))+1).join("")}function trimStart(string,chars,guard){if((string=toString(string))&&(guard||chars===undefined))return string.replace(reTrimStart,"");if(!string||!(chars=baseToString(chars)))return string;var strSymbols=stringToArray(string);return castSlice(strSymbols,charsStartIndex(strSymbols,stringToArray(chars))).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length,omission="omission"in options?baseToString(options.omission):omission}string=toString(string);var strLength=string.length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength)return string;var end=length-stringSize(omission);if(end<1)return omission;var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(separator===undefined)return result+omission;if(strSymbols&&(end+=result.length-end),isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;for(separator.global||(separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")),separator.lastIndex=0;match=separator.exec(substring);)var newEnd=match.index;result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);index>-1&&(result=result.slice(0,index))}return result+omission}function unescape(string){return string=toString(string),string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}function words(string,pattern,guard){return string=toString(string),pattern=guard?undefined:pattern,pattern===undefined?hasUnicodeWord(string)?unicodeWords(string):asciiWords(string):string.match(pattern)||[]}function cond(pairs){var length=null==pairs?0:pairs.length,toIteratee=getIteratee();return pairs=length?arrayMap(pairs,function(pair){if("function"!=typeof pair[1])throw new TypeError(FUNC_ERROR_TEXT);return[toIteratee(pair[0]),pair[1]]}):[],baseRest(function(args){for(var index=-1;++index<length;){var pair=pairs[index];if(apply(pair[0],this,args))return apply(pair[1],this,args)}})}function conforms(source){return baseConforms(baseClone(source,CLONE_DEEP_FLAG))}function constant(value){return function(){return value}}function defaultTo(value,defaultValue){return null==value||value!==value?defaultValue:value}function identity(value){return value}function iteratee(func){return baseIteratee("function"==typeof func?func:baseClone(func,CLONE_DEEP_FLAG))}function matches(source){return baseMatches(baseClone(source,CLONE_DEEP_FLAG))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,CLONE_DEEP_FLAG))}function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);null!=options||isObject(source)&&(methodNames.length||!props.length)||(options=source,source=object,object=this,methodNames=baseFunctions(source,keys(source)));var chain=!(isObject(options)&&"chain"in options&&!options.chain),isFunc=isFunction(object);return arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func,isFunc&&(object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__);return(result.__actions__=copyArray(this.__actions__)).push({func:func,args:arguments,thisArg:object}),result.__chain__=chainAll,result}return func.apply(object,arrayPush([this.value()],arguments))})}),object}function noConflict(){return root._===this&&(root._=oldDash),this}function noop(){}function nthArg(n){return n=toInteger(n),baseRest(function(args){return baseNth(args,n)})}function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function propertyOf(object){return function(path){return null==object?undefined:baseGet(object,path)}}function stubArray(){return[]}function stubFalse(){return!1}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return!0}function times(n,iteratee){if((n=toInteger(n))<1||n>MAX_SAFE_INTEGER)return[];var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee),n-=MAX_ARRAY_LENGTH;for(var result=baseTimes(length,iteratee);++index<n;)iteratee(index);return result}function toPath(value){return isArray(value)?arrayMap(value,toKey):isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined}function mean(array){return baseMean(array,identity)}function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2))}function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined}function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0}context=null==context?root:_.defaults(root.Object(),context,_.pick(root,contextProps));var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=context["__core-js_shared__"],funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,idCounter=0,maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}(),nativeObjectToString=objectProto.toString,objectCtorString=funcToString.call(Object),oldDash=root._,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?context.Buffer:undefined,Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined,symIterator=Symbol?Symbol.iterator:undefined,symToStringTag=Symbol?Symbol.toStringTag:undefined,defineProperty=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}(),ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout,nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse,DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create"),metaMap=WeakMap&&new WeakMap,realNames={},dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined,baseCreate=function(){function object(){}return function(proto){if(!isObject(proto))return{};if(objectCreate)return objectCreate(proto);object.prototype=proto;var result=new object;return object.prototype=undefined,result}}();lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}},lodash.prototype=baseLodash.prototype,lodash.prototype.constructor=lodash,LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var baseEach=createBaseEach(baseForOwn),baseEachRight=createBaseEach(baseForOwnRight,!0),baseFor=createBaseFor(),baseForRight=createBaseFor(!0),baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity,baseSetToString=defineProperty?function(func,string){return defineProperty(func,"toString",{configurable:!0,enumerable:!1,value:constant(string),writable:!0})}:identity,castRest=baseRest,clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id)},createSet=Set&&1/setToArray(new Set([,-0]))[1]==INFINITY?function(values){return new Set(values)}:noop,getData=metaMap?function(func){return metaMap.get(func)}:noop,getSymbols=nativeGetSymbols?function(object){return null==object?[]:(object=Object(object),arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)}))}:stubArray,getSymbolsIn=nativeGetSymbols?function(object){for(var result=[];object;)arrayPush(result,getSymbols(object)),object=getPrototype(object);return result}:stubArray,getTag=baseGetTag;(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag)&&(getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return"[object Promise]";case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return result});var isMaskable=coreJsData?isFunction:stubFalse,setData=shortOut(baseSetData),setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait)},setToString=shortOut(baseSetToString),stringToPath=function(func){var result=memoize(func,function(key){return cache.size===MAX_MEMOIZE_SIZE&&cache.clear(),key}),cache=result.cache;return result}(function(string){var result=[];return 46===string.charCodeAt(0)&&result.push(""),string.replace(rePropName,function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)}),result}),difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0)):[]}),differenceBy=baseRest(function(array,values){var iteratee=last(values);return isArrayLikeObject(iteratee)&&(iteratee=undefined),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0),getIteratee(iteratee,2)):[]}),differenceWith=baseRest(function(array,values){var comparator=last(values);return isArrayLikeObject(comparator)&&(comparator=undefined),isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0),undefined,comparator):[]}),intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]}),intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);return iteratee===last(mapped)?iteratee=undefined:mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]}),intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);return comparator="function"==typeof comparator?comparator:undefined,comparator&&mapped.pop(),mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]}),pull=baseRest(pullAll),pullAt=flatRest(function(array,indexes){var length=null==array?0:array.length,result=baseAt(array,indexes);return basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending)),result}),union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0))}),unionBy=baseRest(function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=undefined),baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0),getIteratee(iteratee,2))}),unionWith=baseRest(function(arrays){var comparator=last(arrays);return comparator="function"==typeof comparator?comparator:undefined,baseUniq(baseFlatten(arrays,1,isArrayLikeObject,!0),undefined,comparator)}),without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]}),xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))}),xorBy=baseRest(function(arrays){var iteratee=last(arrays);return isArrayLikeObject(iteratee)&&(iteratee=undefined),baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))}),xorWith=baseRest(function(arrays){var comparator=last(arrays);return comparator="function"==typeof comparator?comparator:undefined,baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)}),zip=baseRest(unzip),zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;return iteratee="function"==typeof iteratee?(arrays.pop(),iteratee):undefined,unzipWith(arrays,iteratee)}),wrapperAt=flatRest(function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};return!(length>1||this.__actions__.length)&&value instanceof LazyWrapper&&isIndex(start)?(value=value.slice(start,+start+(length?1:0)),value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(value,this.__chain__).thru(function(array){return length&&!array.length&&array.push(undefined),array})):this.thru(interceptor)}),countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:baseAssignValue(result,key,1)}),find=createFind(findIndex),findLast=createFind(findLastIndex),groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):baseAssignValue(result,key,[value])}),invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc="function"==typeof path,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args)}),result}),keyBy=createAggregator(function(result,value,key){baseAssignValue(result,key,value)}),partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]}),sortBy=baseRest(function(collection,iteratees){if(null==collection)return[];var length=iteratees.length;return length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])?iteratees=[]:length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])&&(iteratees=[iteratees[0]]),baseOrderBy(collection,baseFlatten(iteratees,1),[])}),now=ctxNow||function(){return root.Date.now()},bind=baseRest(function(func,thisArg,partials){var bitmask=WRAP_BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(func,bitmask,thisArg,partials,holders)}),bindKey=baseRest(function(object,key,partials){var bitmask=WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(key,bitmask,object,partials,holders)}),defer=baseRest(function(func,args){return baseDelay(func,1,args)}),delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)});memoize.Cache=MapCache;var overArgs=castRest(function(func,transforms){transforms=1==transforms.length&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){for(var index=-1,length=nativeMin(args.length,funcsLength);++index<length;)args[index]=transforms[index].call(this,args[index]);return apply(func,this,args)})}),partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,WRAP_PARTIAL_FLAG,undefined,partials,holders)}),partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,WRAP_PARTIAL_RIGHT_FLAG,undefined,partials,holders)}),rearg=flatRest(function(func,indexes){return createWrap(func,WRAP_REARG_FLAG,undefined,undefined,undefined,indexes)}),gt=createRelationalOperation(baseGt),gte=createRelationalOperation(function(value,other){return value>=other}),isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")},isArray=Array.isArray,isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer,isBuffer=nativeIsBuffer||stubFalse,isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp,isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,lt=createRelationalOperation(baseLt),lte=createRelationalOperation(function(value,other){return value<=other}),assign=createAssigner(function(object,source){if(isPrototype(source)||isArrayLike(source))return void copyObject(source,keys(source),object);for(var key in source)hasOwnProperty.call(source,key)&&assignValue(object,key,source[key])}),assignIn=createAssigner(function(object,source){copyObject(source,keysIn(source),object)}),assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)}),assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)}),at=flatRest(baseAt),defaults=baseRest(function(object,sources){object=Object(object);var index=-1,length=sources.length,guard=length>2?sources[2]:undefined;for(guard&&isIterateeCall(sources[0],sources[1],guard)&&(length=1);++index<length;)for(var source=sources[index],props=keysIn(source),propsIndex=-1,propsLength=props.length;++propsIndex<propsLength;){var key=props[propsIndex],value=object[key];(value===undefined||eq(value,objectProto[key])&&!hasOwnProperty.call(object,key))&&(object[key]=source[key])}return object}),defaultsDeep=baseRest(function(args){return args.push(undefined,customDefaultsMerge),apply(mergeWith,undefined,args)}),invert=createInverter(function(result,value,key){null!=value&&"function"!=typeof value.toString&&(value=nativeObjectToString.call(value)),result[value]=key},constant(identity)),invertBy=createInverter(function(result,value,key){null!=value&&"function"!=typeof value.toString&&(value=nativeObjectToString.call(value)),hasOwnProperty.call(result,value)?result[value].push(key):result[value]=[key]},getIteratee),invoke=baseRest(baseInvoke),merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)}),mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)}),omit=flatRest(function(object,paths){var result={};if(null==object)return result;var isDeep=!1;paths=arrayMap(paths,function(path){return path=castPath(path,object),isDeep||(isDeep=path.length>1),path}),copyObject(object,getAllKeysIn(object),result),isDeep&&(result=baseClone(result,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone));for(var length=paths.length;length--;)baseUnset(result,paths[length]);return result}),pick=flatRest(function(object,paths){return null==object?{}:basePick(object,paths)}),toPairs=createToPairs(keys),toPairsIn=createToPairs(keysIn),camelCase=createCompounder(function(result,word,index){return word=word.toLowerCase(),result+(index?capitalize(word):word)}),kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()}),lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()}),lowerFirst=createCaseFirst("toLowerCase"),snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()}),startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+upperFirst(word)}),upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()}),upperFirst=createCaseFirst("toUpperCase"),attempt=baseRest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}}),bindAll=flatRest(function(object,methodNames){return arrayEach(methodNames,function(key){key=toKey(key),baseAssignValue(object,key,bind(object[key],object))}),object}),flow=createFlow(),flowRight=createFlow(!0),method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args)}}),methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args)}}),over=createOver(arrayMap),overEvery=createOver(arrayEvery),overSome=createOver(arraySome),range=createRange(),rangeRight=createRange(!0),add=createMathOperation(function(augend,addend){return augend+addend},0),ceil=createRound("ceil"),divide=createMathOperation(function(dividend,divisor){return dividend/divisor},1),floor=createRound("floor"),multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand},1),round=createRound("round"),subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend},0);return lodash.after=after,lodash.ary=ary,lodash.assign=assign,lodash.assignIn=assignIn,lodash.assignInWith=assignInWith,lodash.assignWith=assignWith,lodash.at=at,lodash.before=before,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.castArray=castArray,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.concat=concat,lodash.cond=cond,lodash.conforms=conforms,lodash.constant=constant,lodash.countBy=countBy,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defaultsDeep=defaultsDeep,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.differenceBy=differenceBy,lodash.differenceWith=differenceWith,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatMap=flatMap,lodash.flatMapDeep=flatMapDeep,lodash.flatMapDepth=flatMapDepth,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flattenDepth=flattenDepth,lodash.flip=flip,lodash.flow=flow,lodash.flowRight=flowRight,lodash.fromPairs=fromPairs,lodash.functions=functions,lodash.functionsIn=functionsIn,lodash.groupBy=groupBy,lodash.initial=initial,lodash.intersection=intersection,lodash.intersectionBy=intersectionBy,lodash.intersectionWith=intersectionWith,lodash.invert=invert,lodash.invertBy=invertBy,lodash.invokeMap=invokeMap,lodash.iteratee=iteratee,lodash.keyBy=keyBy,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=merge,lodash.mergeWith=mergeWith,lodash.method=method,lodash.methodOf=methodOf,lodash.mixin=mixin,lodash.negate=negate,lodash.nthArg=nthArg,lodash.omit=omit,lodash.omitBy=omitBy,lodash.once=once,lodash.orderBy=orderBy,lodash.over=over,lodash.overArgs=overArgs,lodash.overEvery=overEvery,lodash.overSome=overSome,lodash.partial=partial,lodash.partialRight=partialRight,lodash.partition=partition,lodash.pick=pick,lodash.pickBy=pickBy,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=pull,lodash.pullAll=pullAll,lodash.pullAllBy=pullAllBy,lodash.pullAllWith=pullAllWith,lodash.pullAt=pullAt,lodash.range=range,lodash.rangeRight=rangeRight,lodash.rearg=rearg,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.reverse=reverse,lodash.sampleSize=sampleSize,lodash.set=set,lodash.setWith=setWith,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=sortBy,lodash.sortedUniq=sortedUniq,lodash.sortedUniqBy=sortedUniqBy,lodash.split=split,lodash.spread=spread,lodash.tail=tail,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.toArray=toArray,lodash.toPairs=toPairs,lodash.toPairsIn=toPairsIn,lodash.toPath=toPath,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.unary=unary,lodash.union=union,lodash.unionBy=unionBy,lodash.unionWith=unionWith,lodash.uniq=uniq,lodash.uniqBy=uniqBy,lodash.uniqWith=uniqWith,lodash.unset=unset,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.update=update,lodash.updateWith=updateWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.without=without,lodash.words=words,lodash.wrap=wrap,lodash.xor=xor,lodash.xorBy=xorBy,lodash.xorWith=xorWith,lodash.zip=zip,lodash.zipObject=zipObject,lodash.zipObjectDeep=zipObjectDeep,lodash.zipWith=zipWith,lodash.entries=toPairs,lodash.entriesIn=toPairsIn,lodash.extend=assignIn,lodash.extendWith=assignInWith,mixin(lodash,lodash),lodash.add=add,lodash.attempt=attempt,lodash.camelCase=camelCase,lodash.capitalize=capitalize,lodash.ceil=ceil,lodash.clamp=clamp,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.cloneDeepWith=cloneDeepWith,lodash.cloneWith=cloneWith,lodash.conformsTo=conformsTo,lodash.deburr=deburr,lodash.defaultTo=defaultTo,lodash.divide=divide,lodash.endsWith=endsWith,lodash.eq=eq,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.floor=floor,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.get=get,lodash.gt=gt,lodash.gte=gte,lodash.has=has,lodash.hasIn=hasIn,lodash.head=head,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.invoke=invoke,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isArrayBuffer=isArrayBuffer,lodash.isArrayLike=isArrayLike,lodash.isArrayLikeObject=isArrayLikeObject,lodash.isBoolean=isBoolean,lodash.isBuffer=isBuffer,lodash.isDate=isDate,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isEqualWith=isEqualWith,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isInteger=isInteger,lodash.isLength=isLength,lodash.isMap=isMap,lodash.isMatch=isMatch,lodash.isMatchWith=isMatchWith,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNil=isNil,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isObjectLike=isObjectLike,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isSafeInteger=isSafeInteger,lodash.isSet=isSet,lodash.isString=isString,lodash.isSymbol=isSymbol,lodash.isTypedArray=isTypedArray,lodash.isUndefined=isUndefined,lodash.isWeakMap=isWeakMap,lodash.isWeakSet=isWeakSet,lodash.join=join,lodash.kebabCase=kebabCase,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.lowerCase=lowerCase,lodash.lowerFirst=lowerFirst,lodash.lt=lt,lodash.lte=lte,lodash.max=max,lodash.maxBy=maxBy,lodash.mean=mean,lodash.meanBy=meanBy,lodash.min=min,lodash.minBy=minBy,lodash.stubArray=stubArray,lodash.stubFalse=stubFalse,lodash.stubObject=stubObject,lodash.stubString=stubString,lodash.stubTrue=stubTrue,lodash.multiply=multiply,lodash.nth=nth,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=now,lodash.pad=pad,lodash.padEnd=padEnd,lodash.padStart=padStart,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.replace=replace,lodash.result=result,lodash.round=round,lodash.runInContext=runInContext,lodash.sample=sample,lodash.size=size,lodash.snakeCase=snakeCase,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedIndexBy=sortedIndexBy,lodash.sortedIndexOf=sortedIndexOf,lodash.sortedLastIndex=sortedLastIndex,lodash.sortedLastIndexBy=sortedLastIndexBy,lodash.sortedLastIndexOf=sortedLastIndexOf,lodash.startCase=startCase,lodash.startsWith=startsWith,lodash.subtract=subtract,lodash.sum=sum,lodash.sumBy=sumBy,lodash.template=template,lodash.times=times,lodash.toFinite=toFinite,lodash.toInteger=toInteger,lodash.toLength=toLength,lodash.toLower=toLower,lodash.toNumber=toNumber,
lodash.toSafeInteger=toSafeInteger,lodash.toString=toString,lodash.toUpper=toUpper,lodash.trim=trim,lodash.trimEnd=trimEnd,lodash.trimStart=trimStart,lodash.truncate=truncate,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.upperCase=upperCase,lodash.upperFirst=upperFirst,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.first=head,mixin(lodash,function(){var source={};return baseForOwn(lodash,function(func,methodName){hasOwnProperty.call(lodash.prototype,methodName)||(source[methodName]=func)}),source}(),{chain:!1}),lodash.VERSION="4.17.10",arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash}),arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();return result.__filtered__?result.__takeCount__=nativeMin(n,result.__takeCount__):result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")}),result},LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}}),arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||3==type;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();return result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type}),result.__filtered__=result.__filtered__||isFilter,result}}),arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}}),arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}}),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()},LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)},LazyWrapper.prototype.invokeMap=baseRest(function(path,args){return"function"==typeof path?new LazyWrapper(this):this.map(function(value){return baseInvoke(value,path,args)})}),LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))},LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;return result.__filtered__&&(start>0||end<0)?new LazyWrapper(result):(start<0?result=result.takeRight(-start):start&&(result=result.drop(start)),end!==undefined&&(end=toInteger(end),result=end<0?result.dropRight(-end):result.take(end-start)),result)},LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)},baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+("last"==methodName?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);lodashFunc&&(lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value),interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};useLazy&&checkIteratee&&"function"==typeof iteratee&&1!=iteratee.length&&(isLazy=useLazy=!1);var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);return result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(result,chainAll)}return isUnwrapped&&onlyLazy?func.apply(this,args):(result=this.thru(interceptor),isUnwrapped?isTaker?result.value()[0]:result.value():result)})}),arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args)})}}),baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"";(realNames[key]||(realNames[key]=[])).push({name:methodName,func:lodashFunc})}}),realNames[createHybrid(undefined,WRAP_BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.at=wrapperAt,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.next=wrapperNext,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,lodash.prototype.first=lodash.prototype.head,symIterator&&(lodash.prototype[symIterator]=wrapperToIterator),lodash}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(root._=_,define(function(){return _})):freeModule?((freeModule.exports=_)._=_,freeExports._=_):root._=_}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(require,module,exports){"use strict";var $protobuf=require("protobufjs/minimal"),$Reader=$protobuf.Reader,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={});$root.tensorflow=function(){var tensorflow={};return tensorflow.Any=function(){function Any(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return Any.prototype.typeUrl="",Any.prototype.value=$util.newBuffer([]),Any.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.Any;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.typeUrl=r.string();break;case 2:m.value=r.bytes();break;default:r.skipType(7&t)}}return m},Any}(),tensorflow.DataType=function(){var valuesById={},values=Object.create(valuesById);return values[valuesById[0]="DT_INVALID"]=0,values[valuesById[1]="DT_FLOAT"]=1,values[valuesById[2]="DT_DOUBLE"]=2,values[valuesById[3]="DT_INT32"]=3,values[valuesById[4]="DT_UINT8"]=4,values[valuesById[5]="DT_INT16"]=5,values[valuesById[6]="DT_INT8"]=6,values[valuesById[7]="DT_STRING"]=7,values[valuesById[8]="DT_COMPLEX64"]=8,values[valuesById[9]="DT_INT64"]=9,values[valuesById[10]="DT_BOOL"]=10,values[valuesById[11]="DT_QINT8"]=11,values[valuesById[12]="DT_QUINT8"]=12,values[valuesById[13]="DT_QINT32"]=13,values[valuesById[14]="DT_BFLOAT16"]=14,values[valuesById[101]="DT_FLOAT_REF"]=101,values[valuesById[102]="DT_DOUBLE_REF"]=102,values[valuesById[103]="DT_INT32_REF"]=103,values[valuesById[104]="DT_UINT8_REF"]=104,values[valuesById[105]="DT_INT16_REF"]=105,values[valuesById[106]="DT_INT8_REF"]=106,values[valuesById[107]="DT_STRING_REF"]=107,values[valuesById[108]="DT_COMPLEX64_REF"]=108,values[valuesById[109]="DT_INT64_REF"]=109,values[valuesById[110]="DT_BOOL_REF"]=110,values[valuesById[111]="DT_QINT8_REF"]=111,values[valuesById[112]="DT_QUINT8_REF"]=112,values[valuesById[113]="DT_QINT32_REF"]=113,values[valuesById[114]="DT_BFLOAT16_REF"]=114,values}(),tensorflow.TensorShape=function(){function TensorShape(p){if(this.dim=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return TensorShape.prototype.dim=$util.emptyArray,TensorShape.prototype.unknownRank=!1,TensorShape.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.TensorShape;r.pos<c;){var t=r.uint32();switch(t>>>3){case 2:m.dim&&m.dim.length||(m.dim=[]),m.dim.push($root.tensorflow.TensorShape.Dim.decode(r,r.uint32()));break;case 3:m.unknownRank=r.bool();break;default:r.skipType(7&t)}}return m},TensorShape.Dim=function(){function Dim(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return Dim.prototype.size=$util.Long?$util.Long.fromBits(0,0,!1):0,Dim.prototype.name="",Dim.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.TensorShape.Dim;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.size=r.int64();break;case 2:m.name=r.string();break;default:r.skipType(7&t)}}return m},Dim}(),TensorShape}(),tensorflow.Tensor=function(){function Tensor(p){if(this.floatVal=[],this.doubleVal=[],this.intVal=[],this.stringVal=[],this.scomplexVal=[],this.int64Val=[],this.boolVal=[],this.uint32Val=[],this.uint64Val=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return Tensor.prototype.dtype=0,Tensor.prototype.tensorShape=null,Tensor.prototype.versionNumber=0,Tensor.prototype.tensorContent=$util.newBuffer([]),Tensor.prototype.floatVal=$util.emptyArray,Tensor.prototype.doubleVal=$util.emptyArray,Tensor.prototype.intVal=$util.emptyArray,Tensor.prototype.stringVal=$util.emptyArray,Tensor.prototype.scomplexVal=$util.emptyArray,Tensor.prototype.int64Val=$util.emptyArray,Tensor.prototype.boolVal=$util.emptyArray,Tensor.prototype.uint32Val=$util.emptyArray,Tensor.prototype.uint64Val=$util.emptyArray,Tensor.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.Tensor;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.dtype=r.int32();break;case 2:m.tensorShape=$root.tensorflow.TensorShape.decode(r,r.uint32());break;case 3:m.versionNumber=r.int32();break;case 4:m.tensorContent=r.bytes();break;case 5:if(m.floatVal&&m.floatVal.length||(m.floatVal=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.floatVal.push(r.float());else m.floatVal.push(r.float());break;case 6:if(m.doubleVal&&m.doubleVal.length||(m.doubleVal=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.doubleVal.push(r.double());else m.doubleVal.push(r.double());break;case 7:if(m.intVal&&m.intVal.length||(m.intVal=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.intVal.push(r.int32());else m.intVal.push(r.int32());break;case 8:m.stringVal&&m.stringVal.length||(m.stringVal=[]),m.stringVal.push(r.bytes());break;case 9:if(m.scomplexVal&&m.scomplexVal.length||(m.scomplexVal=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.scomplexVal.push(r.float());else m.scomplexVal.push(r.float());break;case 10:if(m.int64Val&&m.int64Val.length||(m.int64Val=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.int64Val.push(r.int64());else m.int64Val.push(r.int64());break;case 11:if(m.boolVal&&m.boolVal.length||(m.boolVal=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.boolVal.push(r.bool());else m.boolVal.push(r.bool());break;case 16:if(m.uint32Val&&m.uint32Val.length||(m.uint32Val=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.uint32Val.push(r.uint32());else m.uint32Val.push(r.uint32());break;case 17:if(m.uint64Val&&m.uint64Val.length||(m.uint64Val=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.uint64Val.push(r.uint64());else m.uint64Val.push(r.uint64());break;default:r.skipType(7&t)}}return m},Tensor}(),tensorflow.AttrValue=function(){function AttrValue(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}AttrValue.prototype.list=null,AttrValue.prototype.s=$util.newBuffer([]),AttrValue.prototype.i=$util.Long?$util.Long.fromBits(0,0,!1):0,AttrValue.prototype.f=0,AttrValue.prototype.b=!1,AttrValue.prototype.type=0,AttrValue.prototype.shape=null,AttrValue.prototype.tensor=null,AttrValue.prototype.placeholder="",AttrValue.prototype.func=null;var $oneOfFields;return Object.defineProperty(AttrValue.prototype,"value",{get:$util.oneOfGetter($oneOfFields=["list","s","i","f","b","type","shape","tensor","placeholder","func"]),set:$util.oneOfSetter($oneOfFields)}),AttrValue.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.AttrValue;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.list=$root.tensorflow.AttrValue.ListValue.decode(r,r.uint32());break;case 2:m.s=r.bytes();break;case 3:m.i=r.int64();break;case 4:m.f=r.float();break;case 5:m.b=r.bool();break;case 6:m.type=r.int32();break;case 7:m.shape=$root.tensorflow.TensorShape.decode(r,r.uint32());break;case 8:m.tensor=$root.tensorflow.Tensor.decode(r,r.uint32());break;case 9:m.placeholder=r.string();break;case 10:m.func=$root.tensorflow.NameAttrList.decode(r,r.uint32());break;default:r.skipType(7&t)}}return m},AttrValue.ListValue=function(){function ListValue(p){if(this.s=[],this.i=[],this.f=[],this.b=[],this.type=[],this.shape=[],this.tensor=[],this.func=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return ListValue.prototype.s=$util.emptyArray,ListValue.prototype.i=$util.emptyArray,ListValue.prototype.f=$util.emptyArray,ListValue.prototype.b=$util.emptyArray,ListValue.prototype.type=$util.emptyArray,ListValue.prototype.shape=$util.emptyArray,ListValue.prototype.tensor=$util.emptyArray,ListValue.prototype.func=$util.emptyArray,ListValue.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.AttrValue.ListValue;r.pos<c;){var t=r.uint32();switch(t>>>3){case 2:m.s&&m.s.length||(m.s=[]),m.s.push(r.bytes());break;case 3:if(m.i&&m.i.length||(m.i=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.i.push(r.int64());else m.i.push(r.int64());break;case 4:if(m.f&&m.f.length||(m.f=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.f.push(r.float());else m.f.push(r.float());break;case 5:if(m.b&&m.b.length||(m.b=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.b.push(r.bool());else m.b.push(r.bool());break;case 6:if(m.type&&m.type.length||(m.type=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.type.push(r.int32());else m.type.push(r.int32());break;case 7:m.shape&&m.shape.length||(m.shape=[]),m.shape.push($root.tensorflow.TensorShape.decode(r,r.uint32()));break;case 8:m.tensor&&m.tensor.length||(m.tensor=[]),m.tensor.push($root.tensorflow.Tensor.decode(r,r.uint32()));break;case 9:m.func&&m.func.length||(m.func=[]),m.func.push($root.tensorflow.NameAttrList.decode(r,r.uint32()));break;default:r.skipType(7&t)}}return m},ListValue}(),AttrValue}(),tensorflow.NameAttrList=function(){function NameAttrList(p){if(this.attr={},p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return NameAttrList.prototype.name="",NameAttrList.prototype.attr=$util.emptyObject,NameAttrList.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var k,c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.NameAttrList;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:r.skip().pos++,m.attr===$util.emptyObject&&(m.attr={}),k=r.string(),r.pos++,m.attr[k]=$root.tensorflow.AttrValue.decode(r,r.uint32());break;default:r.skipType(7&t)}}return m},NameAttrList}(),tensorflow.NodeDef=function(){function NodeDef(p){if(this.input=[],this.attr={},p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return NodeDef.prototype.name="",NodeDef.prototype.op="",NodeDef.prototype.input=$util.emptyArray,NodeDef.prototype.device="",NodeDef.prototype.attr=$util.emptyObject,NodeDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var k,c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.NodeDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:m.op=r.string();break;case 3:m.input&&m.input.length||(m.input=[]),m.input.push(r.string());break;case 4:m.device=r.string();break;case 5:r.skip().pos++,m.attr===$util.emptyObject&&(m.attr={}),k=r.string(),r.pos++,m.attr[k]=$root.tensorflow.AttrValue.decode(r,r.uint32());break;default:r.skipType(7&t)}}return m},NodeDef}(),tensorflow.VersionDef=function(){function VersionDef(p){if(this.badConsumers=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return VersionDef.prototype.producer=0,VersionDef.prototype.minConsumer=0,VersionDef.prototype.badConsumers=$util.emptyArray,VersionDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.VersionDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.producer=r.int32();break;case 2:m.minConsumer=r.int32();break;case 3:if(m.badConsumers&&m.badConsumers.length||(m.badConsumers=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.badConsumers.push(r.int32());else m.badConsumers.push(r.int32());break;default:r.skipType(7&t)}}return m},VersionDef}(),tensorflow.GraphDef=function(){function GraphDef(p){if(this.node=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return GraphDef.prototype.node=$util.emptyArray,GraphDef.prototype.versions=null,GraphDef.prototype.library=null,GraphDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.GraphDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.node&&m.node.length||(m.node=[]),m.node.push($root.tensorflow.NodeDef.decode(r,r.uint32()));break;case 4:m.versions=$root.tensorflow.VersionDef.decode(r,r.uint32());break;case 2:m.library=$root.tensorflow.FunctionDefLibrary.decode(r,r.uint32());break;default:r.skipType(7&t)}}return m},GraphDef}(),tensorflow.CollectionDef=function(){function CollectionDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}CollectionDef.prototype.nodeList=null,CollectionDef.prototype.bytesList=null,CollectionDef.prototype.int64List=null,CollectionDef.prototype.floatList=null,CollectionDef.prototype.anyList=null;var $oneOfFields;return Object.defineProperty(CollectionDef.prototype,"kind",{get:$util.oneOfGetter($oneOfFields=["nodeList","bytesList","int64List","floatList","anyList"]),set:$util.oneOfSetter($oneOfFields)}),CollectionDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.nodeList=$root.tensorflow.CollectionDef.NodeList.decode(r,r.uint32());break;case 2:m.bytesList=$root.tensorflow.CollectionDef.BytesList.decode(r,r.uint32());break;case 3:m.int64List=$root.tensorflow.CollectionDef.Int64List.decode(r,r.uint32());break;case 4:m.floatList=$root.tensorflow.CollectionDef.FloatList.decode(r,r.uint32());break;case 5:m.anyList=$root.tensorflow.CollectionDef.AnyList.decode(r,r.uint32());break;default:r.skipType(7&t)}}return m},CollectionDef.NodeList=function(){function NodeList(p){if(this.value=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return NodeList.prototype.value=$util.emptyArray,NodeList.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.NodeList;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.value&&m.value.length||(m.value=[]),m.value.push(r.string());break;default:r.skipType(7&t)}}return m},NodeList}(),CollectionDef.BytesList=function(){function BytesList(p){if(this.value=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return BytesList.prototype.value=$util.emptyArray,BytesList.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.BytesList;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.value&&m.value.length||(m.value=[]),m.value.push(r.bytes());break;default:r.skipType(7&t)}}return m},BytesList}(),CollectionDef.Int64List=function(){function Int64List(p){if(this.value=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return Int64List.prototype.value=$util.emptyArray,Int64List.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.Int64List;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:if(m.value&&m.value.length||(m.value=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.value.push(r.int64());else m.value.push(r.int64());break;default:r.skipType(7&t)}}return m},Int64List}(),CollectionDef.FloatList=function(){function FloatList(p){if(this.value=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return FloatList.prototype.value=$util.emptyArray,FloatList.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.FloatList;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:if(m.value&&m.value.length||(m.value=[]),2==(7&t))for(var c2=r.uint32()+r.pos;r.pos<c2;)m.value.push(r.float());else m.value.push(r.float());break;default:r.skipType(7&t)}}return m},FloatList}(),CollectionDef.AnyList=function(){function AnyList(p){if(this.value=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return AnyList.prototype.value=$util.emptyArray,AnyList.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.CollectionDef.AnyList;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.value&&m.value.length||(m.value=[]),m.value.push($root.tensorflow.Any.decode(r,r.uint32()));break;default:r.skipType(7&t)}}return m},AnyList}(),CollectionDef}(),tensorflow.SaverDef=function(){function SaverDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return SaverDef.prototype.filenameTensorName="",SaverDef.prototype.saveTensorName="",SaverDef.prototype.restoreOpName="",SaverDef.prototype.maxToKeep=0,SaverDef.prototype.sharded=!1,SaverDef.prototype.keepCheckpointEveryNHours=0,SaverDef.prototype.version=0,SaverDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.SaverDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.filenameTensorName=r.string();break;case 2:m.saveTensorName=r.string();break;case 3:m.restoreOpName=r.string();break;case 4:m.maxToKeep=r.int32();break;case 5:m.sharded=r.bool();break;case 6:m.keepCheckpointEveryNHours=r.float();break;case 7:m.version=r.int32();break;default:r.skipType(7&t)}}return m},SaverDef.CheckpointFormatVersion=function(){var valuesById={},values=Object.create(valuesById);return values[valuesById[0]="LEGACY"]=0,values[valuesById[1]="V1"]=1,values[valuesById[2]="V2"]=2,values}(),SaverDef}(),tensorflow.TensorInfo=function(){function TensorInfo(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}TensorInfo.prototype.name="",TensorInfo.prototype.cooSparse=null,TensorInfo.prototype.dtype=0,TensorInfo.prototype.tensorShape=null;var $oneOfFields;return Object.defineProperty(TensorInfo.prototype,"encoding",{get:$util.oneOfGetter($oneOfFields=["name","cooSparse"]),set:$util.oneOfSetter($oneOfFields)}),TensorInfo.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.TensorInfo;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 4:m.cooSparse=$root.tensorflow.TensorInfo.CooSparse.decode(r,r.uint32());break;case 2:m.dtype=r.int32();break;case 3:m.tensorShape=$root.tensorflow.TensorShape.decode(r,r.uint32());break;default:r.skipType(7&t)}}return m},TensorInfo.CooSparse=function(){function CooSparse(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return CooSparse.prototype.valuesTensorName="",CooSparse.prototype.indicesTensorName="",CooSparse.prototype.denseShapeTensorName="",CooSparse.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.TensorInfo.CooSparse;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.valuesTensorName=r.string();break;case 2:m.indicesTensorName=r.string();break;case 3:m.denseShapeTensorName=r.string();break;default:r.skipType(7&t)}}return m},CooSparse}(),TensorInfo}(),tensorflow.SignatureDef=function(){function SignatureDef(p){if(this.inputs={},this.outputs={},p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return SignatureDef.prototype.inputs=$util.emptyObject,SignatureDef.prototype.outputs=$util.emptyObject,SignatureDef.prototype.methodName="",SignatureDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var k,c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.SignatureDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:r.skip().pos++,m.inputs===$util.emptyObject&&(m.inputs={}),k=r.string(),r.pos++,m.inputs[k]=$root.tensorflow.TensorInfo.decode(r,r.uint32());break;case 2:r.skip().pos++,m.outputs===$util.emptyObject&&(m.outputs={}),k=r.string(),r.pos++,m.outputs[k]=$root.tensorflow.TensorInfo.decode(r,r.uint32());break;case 3:m.methodName=r.string();break;default:r.skipType(7&t)}}return m},SignatureDef}(),tensorflow.AssetFileDef=function(){function AssetFileDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return AssetFileDef.prototype.tensorInfo=null,AssetFileDef.prototype.filename="",AssetFileDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.AssetFileDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.tensorInfo=$root.tensorflow.TensorInfo.decode(r,r.uint32());break;case 2:m.filename=r.string();break;default:r.skipType(7&t)}}return m},AssetFileDef}(),tensorflow.OpDef=function(){function OpDef(p){if(this.inputArg=[],this.outputArg=[],this.attr=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return OpDef.prototype.name="",OpDef.prototype.inputArg=$util.emptyArray,OpDef.prototype.outputArg=$util.emptyArray,OpDef.prototype.attr=$util.emptyArray,OpDef.prototype.deprecation=null,OpDef.prototype.summary="",OpDef.prototype.description="",OpDef.prototype.isCommutative=!1,OpDef.prototype.isAggregate=!1,OpDef.prototype.isStateful=!1,OpDef.prototype.allowsUninitializedInput=!1,OpDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.OpDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:m.inputArg&&m.inputArg.length||(m.inputArg=[]),m.inputArg.push($root.tensorflow.OpDef.ArgDef.decode(r,r.uint32()));break;case 3:m.outputArg&&m.outputArg.length||(m.outputArg=[]),m.outputArg.push($root.tensorflow.OpDef.ArgDef.decode(r,r.uint32()));break;case 4:m.attr&&m.attr.length||(m.attr=[]),m.attr.push($root.tensorflow.OpDef.AttrDef.decode(r,r.uint32()));break;case 8:m.deprecation=$root.tensorflow.OpDef.OpDeprecation.decode(r,r.uint32());break;case 5:m.summary=r.string();break;case 6:m.description=r.string();break;case 18:m.isCommutative=r.bool();break;case 16:m.isAggregate=r.bool();break;case 17:m.isStateful=r.bool();break;case 19:m.allowsUninitializedInput=r.bool();break;default:r.skipType(7&t)}}return m},OpDef.ArgDef=function(){function ArgDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return ArgDef.prototype.name="",ArgDef.prototype.description="",ArgDef.prototype.type=0,ArgDef.prototype.typeAttr="",ArgDef.prototype.numberAttr="",ArgDef.prototype.typeListAttr="",ArgDef.prototype.isRef=!1,ArgDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.OpDef.ArgDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:m.description=r.string();break;case 3:m.type=r.int32();break;case 4:m.typeAttr=r.string();break;case 5:m.numberAttr=r.string();break;case 6:m.typeListAttr=r.string();break;case 16:m.isRef=r.bool();break;default:r.skipType(7&t)}}return m},ArgDef}(),OpDef.AttrDef=function(){function AttrDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return AttrDef.prototype.name="",AttrDef.prototype.type="",AttrDef.prototype.defaultValue=null,AttrDef.prototype.description="",AttrDef.prototype.hasMinimum=!1,AttrDef.prototype.minimum=$util.Long?$util.Long.fromBits(0,0,!1):0,AttrDef.prototype.allowedValues=null,AttrDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.OpDef.AttrDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.name=r.string();break;case 2:m.type=r.string();break;case 3:m.defaultValue=$root.tensorflow.AttrValue.decode(r,r.uint32());break;case 4:m.description=r.string();break;case 5:m.hasMinimum=r.bool();break;case 6:m.minimum=r.int64();break;case 7:m.allowedValues=$root.tensorflow.AttrValue.decode(r,r.uint32());break;default:r.skipType(7&t)}}return m},AttrDef}(),OpDef.OpDeprecation=function(){function OpDeprecation(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return OpDeprecation.prototype.version=0,OpDeprecation.prototype.explanation="",OpDeprecation.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.OpDef.OpDeprecation;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.version=r.int32();break;case 2:m.explanation=r.string();break;default:r.skipType(7&t)}}return m},OpDeprecation}(),OpDef}(),tensorflow.OpList=function(){function OpList(p){if(this.op=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return OpList.prototype.op=$util.emptyArray,OpList.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.OpList;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.op&&m.op.length||(m.op=[]),m.op.push($root.tensorflow.OpDef.decode(r,r.uint32()));break;default:r.skipType(7&t)}}return m},OpList}(),tensorflow.MetaGraphDef=function(){function MetaGraphDef(p){if(this.collectionDef={},this.signatureDef={},this.assetFileDef=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return MetaGraphDef.prototype.metaInfoDef=null,MetaGraphDef.prototype.graphDef=null,MetaGraphDef.prototype.saverDef=null,MetaGraphDef.prototype.collectionDef=$util.emptyObject,MetaGraphDef.prototype.signatureDef=$util.emptyObject,MetaGraphDef.prototype.assetFileDef=$util.emptyArray,MetaGraphDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var k,c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.MetaGraphDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.metaInfoDef=$root.tensorflow.MetaGraphDef.MetaInfoDef.decode(r,r.uint32());break;case 2:m.graphDef=$root.tensorflow.GraphDef.decode(r,r.uint32());break;case 3:m.saverDef=$root.tensorflow.SaverDef.decode(r,r.uint32());break;case 4:r.skip().pos++,m.collectionDef===$util.emptyObject&&(m.collectionDef={}),k=r.string(),r.pos++,m.collectionDef[k]=$root.tensorflow.CollectionDef.decode(r,r.uint32());break;case 5:r.skip().pos++,m.signatureDef===$util.emptyObject&&(m.signatureDef={}),k=r.string(),r.pos++,m.signatureDef[k]=$root.tensorflow.SignatureDef.decode(r,r.uint32());break;case 6:m.assetFileDef&&m.assetFileDef.length||(m.assetFileDef=[]),m.assetFileDef.push($root.tensorflow.AssetFileDef.decode(r,r.uint32()));break;default:r.skipType(7&t)}}return m},MetaGraphDef.MetaInfoDef=function(){function MetaInfoDef(p){
if(this.tags=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return MetaInfoDef.prototype.metaGraphVersion="",MetaInfoDef.prototype.strippedOpList=null,MetaInfoDef.prototype.anyInfo=null,MetaInfoDef.prototype.tags=$util.emptyArray,MetaInfoDef.prototype.tensorflowVersion="",MetaInfoDef.prototype.tensorflowGitVersion="",MetaInfoDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.MetaGraphDef.MetaInfoDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.metaGraphVersion=r.string();break;case 2:m.strippedOpList=$root.tensorflow.OpList.decode(r,r.uint32());break;case 3:m.anyInfo=$root.tensorflow.Any.decode(r,r.uint32());break;case 4:m.tags&&m.tags.length||(m.tags=[]),m.tags.push(r.string());break;case 5:m.tensorflowVersion=r.string();break;case 6:m.tensorflowGitVersion=r.string();break;default:r.skipType(7&t)}}return m},MetaInfoDef}(),MetaGraphDef}(),tensorflow.SavedModel=function(){function SavedModel(p){if(this.metaGraphs=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return SavedModel.prototype.savedModelSchemaVersion=$util.Long?$util.Long.fromBits(0,0,!1):0,SavedModel.prototype.metaGraphs=$util.emptyArray,SavedModel.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.SavedModel;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.savedModelSchemaVersion=r.int64();break;case 2:m.metaGraphs&&m.metaGraphs.length||(m.metaGraphs=[]),m.metaGraphs.push($root.tensorflow.MetaGraphDef.decode(r,r.uint32()));break;default:r.skipType(7&t)}}return m},SavedModel}(),tensorflow.FunctionDefLibrary=function(){function FunctionDefLibrary(p){if(this.function=[],this.gradient=[],p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return FunctionDefLibrary.prototype.function=$util.emptyArray,FunctionDefLibrary.prototype.gradient=$util.emptyArray,FunctionDefLibrary.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.FunctionDefLibrary;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.function&&m.function.length||(m.function=[]),m.function.push($root.tensorflow.FunctionDef.decode(r,r.uint32()));break;case 2:m.gradient&&m.gradient.length||(m.gradient=[]),m.gradient.push($root.tensorflow.GradientDef.decode(r,r.uint32()));break;default:r.skipType(7&t)}}return m},FunctionDefLibrary}(),tensorflow.FunctionDef=function(){function FunctionDef(p){if(this.attr={},this.nodeDef=[],this.ret={},p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return FunctionDef.prototype.signature=null,FunctionDef.prototype.attr=$util.emptyObject,FunctionDef.prototype.nodeDef=$util.emptyArray,FunctionDef.prototype.ret=$util.emptyObject,FunctionDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var k,c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.FunctionDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.signature=$root.tensorflow.OpDef.decode(r,r.uint32());break;case 5:r.skip().pos++,m.attr===$util.emptyObject&&(m.attr={}),k=r.string(),r.pos++,m.attr[k]=$root.tensorflow.AttrValue.decode(r,r.uint32());break;case 3:m.nodeDef&&m.nodeDef.length||(m.nodeDef=[]),m.nodeDef.push($root.tensorflow.NodeDef.decode(r,r.uint32()));break;case 4:r.skip().pos++,m.ret===$util.emptyObject&&(m.ret={}),k=r.string(),r.pos++,m.ret[k]=r.string();break;default:r.skipType(7&t)}}return m},FunctionDef}(),tensorflow.GradientDef=function(){function GradientDef(p){if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)null!=p[ks[i]]&&(this[ks[i]]=p[ks[i]])}return GradientDef.prototype.functionName="",GradientDef.prototype.gradientFunc="",GradientDef.decode=function(r,l){r instanceof $Reader||(r=$Reader.create(r));for(var c=void 0===l?r.len:r.pos+l,m=new $root.tensorflow.GradientDef;r.pos<c;){var t=r.uint32();switch(t>>>3){case 1:m.functionName=r.string();break;case 2:m.gradientFunc=r.string();break;default:r.skipType(7&t)}}return m},GradientDef}(),tensorflow}(),module.exports=$root},{"protobufjs/minimal":275}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ExecutionContext=function(){function ExecutionContext(weightMap,tensorArrayMap){this.weightMap=weightMap,this.tensorArrayMap=tensorArrayMap,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return ExecutionContext.prototype.newFrame=function(id,frameName){return{id:id,frameName:frameName,iterationId:0}},Object.defineProperty(ExecutionContext.prototype,"currentContext",{get:function(){return this.contexts},set:function(contexts){this.contexts!==contexts&&(this.contexts=contexts,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(ExecutionContext.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(ExecutionContext.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),ExecutionContext.prototype.generateCurrentContextIds=function(){for(var names=[],i=0;i<this.contexts.length-1;i++){var contexts=this.contexts.slice(0,this.contexts.length-i);names.push(this.contextIdforContexts(contexts))}names.push(""),this._currentContextIds=names},ExecutionContext.prototype.contextIdforContexts=function(contexts){return contexts?contexts.map(function(context){return 0===context.id&&0===context.iterationId?"":context.frameName+"-"+context.iterationId}).join("/"):""},ExecutionContext.prototype.enterFrame=function(frameId){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,frameId)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},ExecutionContext.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},ExecutionContext.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var context=Object.assign({},this.contexts[this.contexts.length-1]);context.iterationId+=1,context.id=this.lastId,this.contexts.splice(-1,1,context),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},ExecutionContext.prototype.getWeight=function(name){return this.weightMap[name]},ExecutionContext.prototype.addTensorArray=function(tensorArray){this.tensorArrayMap[tensorArray.id]=tensorArray},ExecutionContext.prototype.getTensorArray=function(id){return this.tensorArrayMap[id]},ExecutionContext}();exports.ExecutionContext=ExecutionContext},{}],16:[function(require,module,exports){"use strict";function loadFrozenModel(modelUrl,weightsManifestUrl,requestOption){return __awaiter(this,void 0,void 0,function(){var model;return __generator(this,function(_a){switch(_a.label){case 0:return model=new FrozenModel(modelUrl,weightsManifestUrl,requestOption),[4,model.load()];case 1:return _a.sent(),[2,model]}})})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),compiled_api_1=require("../data/compiled_api"),operation_mapper_1=require("../operations/operation_mapper"),graph_executor_1=require("./graph_executor"),FrozenModel=function(){function FrozenModel(modelUrl,weightManifestUrl,requestOption){this.modelUrl=modelUrl,this.weightManifestUrl=weightManifestUrl,this.requestOption=requestOption,this.version="n/a"}return Object.defineProperty(FrozenModel.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(FrozenModel.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(FrozenModel.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(FrozenModel.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(FrozenModel.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(FrozenModel.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),FrozenModel.prototype.findIOHandler=function(){var path=[this.modelUrl,this.weightManifestUrl];if(this.requestOption)this.handler=tfc.io.browserHTTPRequest(path,this.requestOption);else{var handlers=tfc.io.getLoadHandlers(path);if(0===handlers.length)handlers.push(tfc.io.browserHTTPRequest(path,this.requestOption));else if(handlers.length>1)throw new Error("Found more than one ("+handlers.length+") load handlers for URL '"+[path]+"'");this.handler=handlers[0]}},FrozenModel.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var artifacts,graph,weightMap;return __generator(this,function(_a){switch(_a.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return artifacts=_a.sent(),graph=compiled_api_1.tensorflow.GraphDef.decode(new Uint8Array(artifacts.modelTopology)),this.version=graph.versions.producer+"."+graph.versions.minConsumer,weightMap=tfc.io.decodeWeights(artifacts.weightData,artifacts.weightSpecs),this.executor=new graph_executor_1.GraphExecutor(operation_mapper_1.OperationMapper.Instance.transformGraph(graph)),this.executor.weightMap=this.convertTensorMapToTensorsMap(weightMap),[2,!0]}})})},FrozenModel.prototype.predict=function(inputs,config){return this.execute_(inputs,!0,this.outputNodes)},FrozenModel.prototype.constructTensorMap=function(inputs){var inputArray=inputs instanceof tfc.Tensor?[inputs]:inputs;if(inputArray.length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the frozen model has "+this.inputNodes.length+" placeholders, while there are "+inputArray.length+" input tensors.");return this.inputNodes.reduce(function(map,inputName,i){return map[inputName]=inputArray[i],map},{})},FrozenModel.prototype.execute=function(inputs,outputs){return this.execute_(inputs,!1,outputs)},FrozenModel.prototype.execute_=function(inputs,strictInputCheck,outputs){if(void 0===strictInputCheck&&(strictInputCheck=!0),outputs=outputs||this.outputNodes,(inputs instanceof tfc.Tensor||Array.isArray(inputs))&&(inputs=this.constructTensorMap(inputs)),this.executor.isControlFlowModel||this.executor.isDynamicShapeModel)throw new Error("The model contains control flow or dynamic shape ops, please use executeAsync method");var result=this.executor.execute(this.convertTensorMapToTensorsMap(inputs),strictInputCheck,outputs),keys=Object.keys(result);return Array.isArray(outputs)&&outputs.length>1?outputs.map(function(node){return result[node]}):result[keys[0]]},FrozenModel.prototype.executeAsync=function(inputs,outputs){return __awaiter(this,void 0,void 0,function(){var result,keys;return __generator(this,function(_a){switch(_a.label){case 0:if(!this.executor.isControlFlowModel&&!this.executor.isDynamicShapeModel)throw new Error("The model does not contain control flow or dynamic shape ops, please use execute method for better performance.");return outputs=outputs||this.outputNodes,(inputs instanceof tfc.Tensor||Array.isArray(inputs))&&(inputs=this.constructTensorMap(inputs)),[4,this.executor.executeAsync(this.convertTensorMapToTensorsMap(inputs),outputs)];case 1:return result=_a.sent(),keys=Object.keys(result),[2,Array.isArray(outputs)&&outputs.length>1?outputs.map(function(node){return result[node]}):result[keys[0]]]}})})},FrozenModel.prototype.convertTensorMapToTensorsMap=function(map){return Object.keys(map).reduce(function(newMap,key){return newMap[key]=[map[key]],newMap},{})},FrozenModel.prototype.dispose=function(){this.executor.dispose()},FrozenModel}();exports.FrozenModel=FrozenModel,exports.loadFrozenModel=loadFrozenModel},{"../data/compiled_api":14,"../operations/operation_mapper":52,"./graph_executor":17,"@tensorflow/tfjs-core":62}],17:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),utils_1=require("../operations/executors/utils"),operation_executor_1=require("../operations/operation_executor"),execution_context_1=require("./execution_context"),GraphExecutor=function(){function GraphExecutor(graph){this.graph=graph,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this.placeholders=graph.placeholders,this._outputs=graph.outputs,this.compile()}return Object.defineProperty(GraphExecutor.prototype,"weightMap",{get:function(){return this._weightMap},set:function(weightMap){var weightIds=Object.keys(weightMap).map(function(key){return weightMap[key].map(function(tensor){return tensor.id})});this.weightIds=[].concat.apply([],weightIds),this._weightMap=weightMap},enumerable:!0,configurable:!0}),Object.defineProperty(GraphExecutor.prototype,"inputs",{get:function(){return this.placeholders.map(function(node){return{name:node.name,shape:node.params.shape?node.params.shape.value:void 0,dtype:node.params.dtype?node.params.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(GraphExecutor.prototype,"outputs",{get:function(){return this._outputs.map(function(node){return{name:node.name,shape:node.params.shape?node.params.shape.value:void 0,dtype:node.params.dtype?node.params.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(GraphExecutor.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(node){return node.name})},enumerable:!0,configurable:!0}),Object.defineProperty(GraphExecutor.prototype,"outputNodes",{get:function(){return this.outputs.map(function(node){return node.name})},enumerable:!0,configurable:!0}),Object.defineProperty(GraphExecutor.prototype,"isControlFlowModel",{get:function(){return this.graph.withControlFlow},enumerable:!0,configurable:!0}),Object.defineProperty(GraphExecutor.prototype,"isDynamicShapeModel",{get:function(){return this.graph.withDynamicShape},enumerable:!0,configurable:!0}),GraphExecutor.prototype.compile=function(startNodes){if(!this.graph.withControlFlow&&!this.graph.withDynamicShape){var compiledOrder=[],inputs=startNodes||this.graph.placeholders,sortedNodeNames=inputs.map(function(node){return node.name}).sort(),nameKey=sortedNodeNames.join(this.SEPERATOR);if(!this.compiledMap.get(nameKey)){for(var stack=inputs.concat(this.graph.weights),visited={};stack.length>0;){var node=stack.pop();visited[node.name]=!0,compiledOrder.push(node),node.children.forEach(function(childNode){!visited[childNode.name]&&childNode.inputNames.every(function(name){var nodeName=utils_1.getNodeNameAndIndex(name)[0];return visited[nodeName]})&&stack.push(childNode)})}this.compiledMap.set(nameKey,compiledOrder)}}},GraphExecutor.prototype.execute=function(inputs,strictInputCheck,outputs){var _this=this;void 0===strictInputCheck&&(strictInputCheck=!0);var names=Object.keys(inputs).sort();this.checkInput(inputs,strictInputCheck),this.checkInputShapeAndType(inputs,strictInputCheck),this.compile(names.map(function(name){return _this.graph.nodes[name]}));var outputNames=this.calculateOutputs(outputs);this.checkOutput(this.compiledMap.get(names.join(this.SEPERATOR)),outputNames);var tensorArrayMap={};return tfjs_core_1.tidy(function(){for(var context=new execution_context_1.ExecutionContext(_this._weightMap,tensorArrayMap),tensorMap=__assign({},_this.weightMap,inputs),tensorsToKeep=_this.getFrozenTensorIds(tensorMap),intermediateTensorConsumerCount={},compiledNodes=_this.compiledMap.get(names.join(_this.SEPERATOR)),i=0;i<compiledNodes.length;i++){var node=compiledNodes[i];if(tensorMap[node.name]||(tensorMap[node.name]=operation_executor_1.executeOp(node,tensorMap,context),_this.checkTensorForDisposal(node.name,node,tensorMap,context,tensorsToKeep,intermediateTensorConsumerCount)),outputNames.every(function(name){return!!tensorMap[name]}))break}return _this.findOutputs(tensorMap,context,outputNames)})},GraphExecutor.prototype.getFrozenTensorIds=function(tensorMap){var ids=[].concat.apply([],Object.keys(tensorMap).map(function(key){return tensorMap[key]}).map(function(tensors){return tensors.map(function(tensor){return tensor.id})}));return new Set(ids)},GraphExecutor.prototype.checkTensorForDisposal=function(nodeName,node,tensorMap,context,tensorsToKeep,intermediateTensorConsumerCount){"control"!==node.category&&(tensorMap[nodeName].forEach(function(tensor){null!=tensor&&(intermediateTensorConsumerCount[tensor.id]=(intermediateTensorConsumerCount[tensor.id]||0)+node.children.length)}),node.inputs.forEach(function(input){if("control"!==input.category){var tensors=utils_1.getTensorsForCurrentContenxt(input.name,tensorMap,context);null!=tensors&&tensors.forEach(function(tensor){if(tensor&&!tensorsToKeep.has(tensor.id)){var count=intermediateTensorConsumerCount[tensor.id];1===count?(tensor.dispose(),delete intermediateTensorConsumerCount[tensor.id]):null!=count&&intermediateTensorConsumerCount[tensor.id]--}})}}))},GraphExecutor.prototype.executeAsync=function(inputs,outputs){return __awaiter(this,void 0,void 0,function(){var tensorArrayMap,context,tensors,results,outputIds,inputIdArray,inputIds,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return this.checkInput(inputs,!1),this.checkInputShapeAndType(inputs,!1),tensorArrayMap={},context=new execution_context_1.ExecutionContext(this._weightMap,tensorArrayMap),[4,this.executeWithControlFlow(inputs,context)];case 1:return tensors=_a.sent(),results=this.findOutputs(tensors,context,outputs),outputIds=Object.keys(results).map(function(key){return results[key].id}),inputIdArray=Object.keys(inputs).map(function(key){return inputs[key].map(function(input){return input.id})}),inputIds=[].concat.apply([],inputIdArray),Object.keys(tensors).forEach(function(key){tensors[key].forEach(function(tensor){tensor&&-1===outputIds.indexOf(tensor.id)&&-1===inputIds.indexOf(tensor.id)&&-1===_this.weightIds.indexOf(tensor.id)&&tensor.dispose()})}),[2,results]}})})},GraphExecutor.prototype.executeWithControlFlow=function(inputs,context){return __awaiter(this,void 0,void 0,function(){var names,inputNodes,stack,tensorMap,intermediateTensorConsumerCount,tensorsToKeep,added,promises,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:names=Object.keys(inputs),inputNodes=names.map(function(name){return _this.graph.nodes[name]}),stack=inputNodes.concat(this.graph.weights).map(function(node){return{node:node,contexts:context.currentContext}}),tensorMap=__assign({},this.weightMap,inputs),intermediateTensorConsumerCount={},tensorsToKeep=this.getFrozenTensorIds(tensorMap),added={},_a.label=1;case 1:return stack.length>0?(promises=this.processStack(inputNodes,stack,context,tensorMap,added,tensorsToKeep,intermediateTensorConsumerCount),[4,Promise.all(promises)]):[3,3];case 2:return _a.sent(),[3,1];case 3:return[2,tensorMap]}})})},GraphExecutor.prototype.processStack=function(inputNodes,stack,context,tensorMap,added,tensorsToKeep,intermediateTensorConsumerCount){for(var _this=this,promises=[],this_1=this;stack.length>0;)!function(){var item=stack.pop();context.currentContext=item.contexts;var nodeName="";if("enter"===item.node.op&&utils_1.getParamValue("isConstant",item.node,tensorMap,context)&&(nodeName=utils_1.getNodeNameAndIndex(item.node.name,context)[0]),-1===inputNodes.indexOf(item.node)){var tensors=operation_executor_1.executeOp(item.node,tensorMap,context);nodeName||(nodeName=utils_1.getNodeNameAndIndex(item.node.name,context)[0]);var currentContext_1=context.currentContext;tensors instanceof Promise?promises.push(tensors.then(function(t){return tensorMap[nodeName]=t,context.currentContext=currentContext_1,_this.checkTensorForDisposal(nodeName,item.node,tensorMap,context,tensorsToKeep,intermediateTensorConsumerCount),_this.processChildNodes(item.node,stack,context,tensorMap,added),t})):(tensorMap[nodeName]=tensors,this_1.checkTensorForDisposal(nodeName,item.node,tensorMap,context,tensorsToKeep,intermediateTensorConsumerCount),this_1.processChildNodes(item.node,stack,context,tensorMap,added))}else this_1.processChildNodes(item.node,stack,context,tensorMap,added)}();return promises},GraphExecutor.prototype.processChildNodes=function(node,stack,context,tensorMap,added){node.children.forEach(function(childNode){var nodeName=utils_1.getNodeNameAndIndex(childNode.name,context)[0];added[nodeName]||("merge"===childNode.op?childNode.inputNames.some(function(name){return!!utils_1.getTensor(name,tensorMap,context)})&&(added[nodeName]=!0,stack.push({contexts:context.currentContext,node:childNode})):childNode.inputNames.every(function(name){return!!utils_1.getTensor(name,tensorMap,context)})&&(added[nodeName]=!0,stack.push({contexts:context.currentContext,node:childNode})))})},GraphExecutor.prototype.calculateOutputs=function(outputs){return!outputs||outputs instanceof Array||(outputs=[outputs]),outputs||this.graph.outputs.map(function(node){return node.name})},GraphExecutor.prototype.findOutputs=function(tensorMap,context,outputs){return this.calculateOutputs(outputs).reduce(function(map,name){return map[name]=utils_1.getTensor(name,tensorMap,context),map},{})},GraphExecutor.prototype.dispose=function(){var _this=this;Object.keys(this.weightMap).forEach(function(key){return _this.weightMap[key].forEach(function(tensor){return tensor.dispose()})})},GraphExecutor.prototype.checkInputShapeAndType=function(inputs,strictInputCheck){void 0===strictInputCheck&&(strictInputCheck=!0),this.placeholders.forEach(function(node){var inputTensors=inputs[node.name];if(strictInputCheck||inputTensors){var input=inputTensors[0];if(node.params.shape&&node.params.shape.value){var shape_1=node.params.shape.value,match=shape_1.length===input.shape.length&&input.shape.every(function(dim,index){return-1===shape_1[index]||shape_1[index]===dim});tfjs_core_1.util.assert(match,"The shape of dict['"+node.name+"'] provided in model.execute(dict) must be ["+shape_1+"], but was ["+input.shape+"]")}node.params.dtype&&node.params.dtype.value&&tfjs_core_1.util.assert(input.dtype===node.params.dtype.value,"The dtype of dict['"+node.name+"'] provided in model.execute(dict) must be "+node.params.dtype.value+", but was "+input.dtype)}})},GraphExecutor.prototype.checkInput=function(inputs,strictInputCheck){var _this=this;void 0===strictInputCheck&&(strictInputCheck=!0);var inputKeys=Object.keys(inputs),missing=[],extra=[];this.inputNodes.forEach(function(name){-1===inputKeys.indexOf(name)&&missing.push(name)}),inputKeys.forEach(function(name){-1===_this.inputNodes.indexOf(name)&&extra.push(name)});var notInGraph=extra.filter(function(name){return!_this.graph.nodes[name]});if(missing.length>0&&strictInputCheck)throw new Error("The dict provided in model.execute(dict) has the keys ["+inputKeys+"], but is missing the required keys: ["+missing+"].");if(extra.length>0&&strictInputCheck)throw new Error("The dict provided in model.execute(dict) has unused keys: ["+extra+"]. Please provide only the following keys: ["+this.inputNodes+"].");if(notInGraph.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+notInGraph+"] not part of model graph.")},GraphExecutor.prototype.checkOutput=function(compiledNodes,outputs){var compiledNodeNames=compiledNodes.map(function(node){return node.name}),extra=[];if(outputs.forEach(function(name){-1===compiledNodeNames.indexOf(name)&&extra.push(name)}),extra.length>0)throw new Error("The following outputs are not be generated by the execution: ["+extra+"].")},GraphExecutor}();exports.GraphExecutor=GraphExecutor},{"../operations/executors/utils":35,"../operations/operation_executor":51,"./execution_context":15,"@tensorflow/tfjs-core":62}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),TensorArray=function(){function TensorArray(name,dtype,maxSize,elementShape,identicalElementShapes,dynamicSize,clearAfterRead){this.name=name,this.dtype=dtype,this.maxSize=maxSize,this.elementShape=elementShape,this.identicalElementShapes=identicalElementShapes,this.dynamicSize=dynamicSize,this.clearAfterRead=clearAfterRead,this.tensors=[],this.closed_=!1,this.id=TensorArray.nextId++}return Object.defineProperty(TensorArray.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),TensorArray.prototype.clearAndClose=function(){this.tensors.forEach(function(tensor){return tensor.tensor.dispose()}),this.tensors=[],this.closed_=!0},TensorArray.prototype.size=function(){return this.tensors.length},TensorArray.prototype.read=function(index){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(index<0||index>=this.tensors.length)throw new Error("Tried to read from index "+index+", but array size is: "+this.tensors.length);var tensorWithState=this.tensors[index];if(tensorWithState.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+index+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(tensorWithState.cleared=!0),tensorWithState.read=!0,tensorWithState.tensor},TensorArray.prototype.readMany=function(indices){var _this=this;return indices.map(function(index){return _this.read(index)})},TensorArray.prototype.write=function(index,tensor){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(index<0||!this.dynamicSize&&index>=this.maxSize)throw new Error("Tried to write to index "+index+", but array is not resizeable and size is: "+this.maxSize);var t=this.tensors[index]||{};if(tensor.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+index+",\n          because the value dtype is "+tensor.dtype+", but TensorArray dtype is "+this.dtype+".");if(0===this.size()&&0===this.elementShape.length&&(this.elementShape=tensor.shape),this.assertShapesMatch(this.elementShape,tensor.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+index+"."),t&&t.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+index+", because it has already been read.");if(t&&t.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+index+", because it has already been written.");t.tensor=tensor,t.written=!0,this.tensors[index]=t},TensorArray.prototype.writeMany=function(indices,tensors){var _this=this;if(indices.length!==tensors.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+indices.length+" is not the same as tensors size: "+tensors.length+".");indices.forEach(function(i,index){return _this.write(i,tensors[index])})},TensorArray.prototype.gather=function(indices,dtype){if(dtype&&dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+dtype);if(!indices){indices=[];for(var i=0;i<this.size();i++)indices.push(i)}if(0===indices.length)return tfjs_core_1.tensor([],[0].concat(this.elementShape));var tensors=this.readMany(indices);return this.assertShapesMatch(this.elementShape,tensors[0].shape,"TensorArray shape mismatch: "),tfjs_core_1.stack(tensors,0)},TensorArray.prototype.concat=function(dtype){if(dtype&&dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+dtype);if(0===this.size())return tfjs_core_1.tensor([],[0].concat(this.elementShape));for(var indices=[],i=0;i<this.size();i++)indices.push(i);var tensors=this.readMany(indices);return this.assertShapesMatch(this.elementShape,tensors[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+tensors[0].shape+")"),tfjs_core_1.concat(tensors,0)},TensorArray.prototype.scatter=function(indices,tensor){if(tensor.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+tensor.dtype)
;if(indices.length!==tensor.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+indices.length+" vs. "+tensor.shape[0]);var maxIndex=Math.max.apply(Math,indices);if(!this.dynamicSize&&maxIndex>=this.maxSize)throw new Error("Max index must be < array size ("+maxIndex+"  vs. "+this.maxSize+")");this.writeMany(indices,tfjs_core_1.unstack(tensor,0))},TensorArray.prototype.split=function(length,tensor){var _this=this;if(tensor.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+tensor.dtype);var totalLength=0,cumulativeLengths=length.map(function(len){return totalLength+=len});if(totalLength!==tensor.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+totalLength+", and tensor's shape is: "+tensor.shape);if(!this.dynamicSize&&length.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+length.length+"), and the TensorArray is not marked as dynamically resizeable");var elementPerRow=0===totalLength?0:tensor.size/totalLength,tensors=[];tfjs_core_1.tidy(function(){tensor=tensor.reshape([1,totalLength,elementPerRow]);for(var i=0;i<length.length;++i){var previousLength=0===i?0:cumulativeLengths[i-1],indices_1=[0,previousLength,0],sizes=[1,length[i],elementPerRow];tensors[i]=tfjs_core_1.slice(tensor,indices_1,sizes).reshape(_this.elementShape)}return tensors});for(var indices=[],i=0;i<length.length;i++)indices[i]=i;this.writeMany(indices,tensors)},TensorArray.prototype.assertShapesMatch=function(shapeA,shapeB,errorMessagePrefix){void 0===errorMessagePrefix&&(errorMessagePrefix=""),tfjs_core_1.util.assert(this.arraysEqual(shapeA,shapeB),errorMessagePrefix+" Shapes "+shapeA+" and "+shapeB+" must match")},TensorArray.prototype.arraysEqual=function(n1,n2){if(n1.length!==n2.length)return!1;for(var i=0;i<n1.length;i++)if(-1!==n1[i]&&-1!==n2[i]&&n1[i]!==n2[i])return!1;return!0},TensorArray.nextId=0,TensorArray}();exports.TensorArray=TensorArray},{"@tensorflow/tfjs-core":62}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var frozen_model_1=require("./executor/frozen_model");exports.FrozenModel=frozen_model_1.FrozenModel,exports.loadFrozenModel=frozen_model_1.loadFrozenModel;var version_1=require("./version");exports.version_converter=version_1.version},{"./executor/frozen_model":16,"./version":53}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"add":return[tfc.add(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"addN":return[tfc.addN(utils_1.getParamValue("tensors",node,tensorMap,context))];case"mod":return[tfc.mod(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"mul":return[tfc.mul(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"div":return[tfc.div(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"floorDiv":return[tfc.floorDiv(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"sub":return[tfc.sub(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"minimum":return[tfc.minimum(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"maximum":return[tfc.maximum(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"pow":return[tfc.pow(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"squaredDifference":return[tfc.squaredDifference(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="arithmetic"},{"./utils":35,"@tensorflow/tfjs-core":62}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"abs":return[tfc.abs(utils_1.getParamValue("x",node,tensorMap,context))];case"acos":return[tfc.acos(utils_1.getParamValue("x",node,tensorMap,context))];case"acosh":return[tfc.acosh(utils_1.getParamValue("x",node,tensorMap,context))];case"asin":return[tfc.asin(utils_1.getParamValue("x",node,tensorMap,context))];case"asinh":return[tfc.asinh(utils_1.getParamValue("x",node,tensorMap,context))];case"atan":return[tfc.atan(utils_1.getParamValue("x",node,tensorMap,context))];case"atan2":return[tfc.atan2(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("y",node,tensorMap,context))];case"atanh":return[tfc.atanh(utils_1.getParamValue("x",node,tensorMap,context))];case"ceil":return[tfc.ceil(utils_1.getParamValue("x",node,tensorMap,context))];case"cos":return[tfc.cos(utils_1.getParamValue("x",node,tensorMap,context))];case"cosh":return[tfc.cosh(utils_1.getParamValue("x",node,tensorMap,context))];case"elu":return[tfc.elu(utils_1.getParamValue("x",node,tensorMap,context))];case"erf":return[tfc.erf(utils_1.getParamValue("x",node,tensorMap,context))];case"exp":return[tfc.exp(utils_1.getParamValue("x",node,tensorMap,context))];case"expm1":return[tfc.expm1(utils_1.getParamValue("x",node,tensorMap,context))];case"floor":return[tfc.floor(utils_1.getParamValue("x",node,tensorMap,context))];case"log":return[tfc.log(utils_1.getParamValue("x",node,tensorMap,context))];case"log1p":return[tfc.log1p(utils_1.getParamValue("x",node,tensorMap,context))];case"neg":return[tfc.neg(utils_1.getParamValue("x",node,tensorMap,context))];case"reciprocal":return[tfc.reciprocal(utils_1.getParamValue("x",node,tensorMap,context))];case"relu":return[tfc.relu(utils_1.getParamValue("x",node,tensorMap,context))];case"round":return[tfc.round(utils_1.getParamValue("x",node,tensorMap,context))];case"selu":return[tfc.selu(utils_1.getParamValue("x",node,tensorMap,context))];case"sigmoid":return[tfc.sigmoid(utils_1.getParamValue("x",node,tensorMap,context))];case"sin":return[tfc.sin(utils_1.getParamValue("x",node,tensorMap,context))];case"sign":return[tfc.sign(utils_1.getParamValue("x",node,tensorMap,context))];case"sinh":return[tfc.sinh(utils_1.getParamValue("x",node,tensorMap,context))];case"softplus":return[tfc.softplus(utils_1.getParamValue("x",node,tensorMap,context))];case"sqrt":return[tfc.sqrt(utils_1.getParamValue("x",node,tensorMap,context))];case"square":return[tfc.square(utils_1.getParamValue("x",node,tensorMap,context))];case"tanh":return[tfc.tanh(utils_1.getParamValue("x",node,tensorMap,context))];case"tan":return[tfc.tan(utils_1.getParamValue("x",node,tensorMap,context))];case"clipByValue":return[tfc.clipByValue(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("clipValueMin",node,tensorMap,context),utils_1.getParamValue("clipValueMax",node,tensorMap,context))];case"rsqrt":return[tfc.div(tfc.scalar(1,"float32"),tfc.sqrt(utils_1.getTensor(node.inputNames[0],tensorMap,context)))];case"prod":return[tfc.prod(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("axes",node,tensorMap,context))];case"leakyRelu":return[tfc.leakyRelu(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("alpha",node,tensorMap,context))];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="basic_math"},{"./utils":35,"@tensorflow/tfjs-core":62}],22:[function(require,module,exports){"use strict";function executeOp(node,tensorMap,context){return __awaiter(this,void 0,void 0,function(){var _a,pred,data_1,inputName,frameId,data,tensor,input,size,dtype,elementShape,dynamicSize,clearAfterRead,identicalElementShapes,name_1,tensorArray,id,index,writeTensor,writeTensorArray,readId,readIndex,readTensorArray,gatherId,gatherIndices,gatherDtype,gatherTensorArray,scatterId,scatterIndices,scatterTensor,scatterTensorArray,concatId,concatTensorArray,concatDtype,splitId,splitTensor,lengths,splitTensorArray,sizeId,sizeTensorArray,closeId,closeTensorArray;return __generator(this,function(_b){switch(_b.label){case 0:switch(_a=node.op){case"loopCond":return[3,1];case"switch":return[3,2];case"merge":return[3,4];case"enter":return[3,5];case"exit":return[3,6];case"nextIteration":return[3,7];case"tensorArray":return[3,8];case"tensorArrayWrite":return[3,9];case"tensorArrayRead":return[3,10];case"tensorArrayGather":return[3,11];case"tensorArrayScatter":return[3,12];case"tensorArrayConcat":return[3,13];case"tensorArraySplit":return[3,14];case"tensorArraySize":return[3,15];case"tensorArrayClose":return[3,16]}return[3,17];case 1:return[2,[utils_1.getParamValue("pred",node,tensorMap,context).clone()]];case 2:return pred=utils_1.getParamValue("pred",node,tensorMap,context),data_1=utils_1.getParamValue("data",node,tensorMap,context),[4,pred.data()];case 3:return[2,_b.sent()[0]?[void 0,data_1.clone()]:[data_1.clone(),void 0]];case 4:return inputName=node.inputNames.find(function(name){return void 0!==utils_1.getTensor(name,tensorMap,context)}),[2,inputName?[utils_1.getTensor(inputName,tensorMap,context).clone()]:void 0];case 5:return frameId=utils_1.getParamValue("frameName",node,tensorMap,context),data=utils_1.getParamValue("tensor",node,tensorMap,context),context.enterFrame(frameId),[2,[data.clone()]];case 6:return tensor=utils_1.getParamValue("tensor",node,tensorMap,context),context.exitFrame(),[2,[tensor.clone()]];case 7:return input=utils_1.getParamValue("tensor",node,tensorMap,context),context.nextIteration(),[2,[input.clone()]];case 8:return size=utils_1.getParamValue("size",node,tensorMap,context),dtype=utils_1.getParamValue("dtype",node,tensorMap,context),elementShape=utils_1.getParamValue("elementShape",node,tensorMap,context),dynamicSize=utils_1.getParamValue("dynamicSize",node,tensorMap,context),clearAfterRead=utils_1.getParamValue("clearAfterRead",node,tensorMap,context),identicalElementShapes=utils_1.getParamValue("identicalElementShapes",node,tensorMap,context),name_1=utils_1.getParamValue("name",node,tensorMap,context),tensorArray=new tensor_array_1.TensorArray(name_1,dtype,size,elementShape,identicalElementShapes,dynamicSize,clearAfterRead),context.addTensorArray(tensorArray),[2,[tfjs_core_1.scalar(tensorArray.id),tfjs_core_1.scalar(1)]];case 9:return id=utils_1.getParamValue("tensorArrayId",node,tensorMap,context),index=utils_1.getParamValue("index",node,tensorMap,context),writeTensor=utils_1.getParamValue("tensor",node,tensorMap,context),writeTensorArray=context.getTensorArray(id),writeTensorArray.write(index,writeTensor),[2,[tfjs_core_1.scalar(1)]];case 10:return readId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context),readIndex=utils_1.getParamValue("index",node,tensorMap,context),readTensorArray=context.getTensorArray(readId),[2,[readTensorArray.read(readIndex)]];case 11:return gatherId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context),gatherIndices=utils_1.getParamValue("indices",node,tensorMap,context),gatherDtype=utils_1.getParamValue("dtype",node,tensorMap,context),gatherTensorArray=context.getTensorArray(gatherId),[2,[gatherTensorArray.gather(gatherIndices,gatherDtype)]];case 12:return scatterId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context),scatterIndices=utils_1.getParamValue("indices",node,tensorMap,context),scatterTensor=utils_1.getParamValue("tensor",node,tensorMap,context),scatterTensorArray=context.getTensorArray(scatterId),scatterTensorArray.scatter(scatterIndices,scatterTensor),[2,[tfjs_core_1.scalar(1)]];case 13:return concatId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context),concatTensorArray=context.getTensorArray(concatId),concatDtype=utils_1.getParamValue("dtype",node,tensorMap,context),[2,[concatTensorArray.concat(concatDtype)]];case 14:return splitId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context),splitTensor=utils_1.getParamValue("tensor",node,tensorMap,context),lengths=utils_1.getParamValue("lengths",node,tensorMap,context),splitTensorArray=context.getTensorArray(splitId),splitTensorArray.split(lengths,splitTensor),[2,[tfjs_core_1.scalar(1)]];case 15:return sizeId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context),sizeTensorArray=context.getTensorArray(sizeId),[2,[tfjs_core_1.scalar(sizeTensorArray.size(),"int32")]];case 16:return closeId=utils_1.getParamValue("tensorArrayId",node,tensorMap,context),closeTensorArray=context.getTensorArray(closeId),closeTensorArray.clearAndClose(),[2,[]];case 17:throw TypeError("Node type "+node.op+" is not implemented")}})})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),tensor_array_1=require("../../executor/tensor_array"),utils_1=require("./utils");exports.executeOp=executeOp,exports.CATEGORY="control"},{"../../executor/tensor_array":18,"./utils":35,"@tensorflow/tfjs-core":62}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"conv1d":var stride=utils_1.getParamValue("stride",node,tensorMap,context),pad=utils_1.getParamValue("pad",node,tensorMap,context),dataFormat=utils_1.getParamValue("dataFormat",node,tensorMap,context).toUpperCase(),dilation=utils_1.getParamValue("dilation",node,tensorMap,context);return[tfc.conv1d(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("filter",node,tensorMap,context),stride,pad,dataFormat,dilation)];case"conv2d":var stride=utils_1.getParamValue("strides",node,tensorMap,context),pad=utils_1.getParamValue("pad",node,tensorMap,context),dataFormat=utils_1.getParamValue("dataFormat",node,tensorMap,context).toUpperCase(),dilations=utils_1.getParamValue("dilations",node,tensorMap,context);return[tfc.conv2d(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("filter",node,tensorMap,context),[stride[1],stride[2]],pad,dataFormat,[dilations[0],dilations[1]])];case"conv2dTranspose":var shape=utils_1.getParamValue("outputShape",node,tensorMap,context),stride=utils_1.getParamValue("strides",node,tensorMap,context),pad=utils_1.getParamValue("pad",node,tensorMap,context);return[tfc.conv2dTranspose(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("filter",node,tensorMap,context),shape,[stride[1],stride[2]],pad)];case"depthwiseConv2d":var stride=utils_1.getParamValue("strides",node,tensorMap,context),pad=utils_1.getParamValue("pad",node,tensorMap,context),dilations=utils_1.getParamValue("dilations",node,tensorMap,context),dataFormat=utils_1.getParamValue("dataFormat",node,tensorMap,context).toUpperCase();return[tfc.depthwiseConv2d(utils_1.getParamValue("input",node,tensorMap,context),utils_1.getParamValue("filter",node,tensorMap,context),[stride[1],stride[2]],pad,dataFormat,[dilations[0],dilations[1]])];case"avgPool":var stride=utils_1.getParamValue("strides",node,tensorMap,context),pad=utils_1.getParamValue("pad",node,tensorMap,context),kernelSize=utils_1.getParamValue("kernelSize",node,tensorMap,context);return[tfc.avgPool(utils_1.getParamValue("x",node,tensorMap,context),[kernelSize[1],kernelSize[2]],[stride[1],stride[2]],pad)];case"maxPool":var stride=utils_1.getParamValue("strides",node,tensorMap,context),pad=utils_1.getParamValue("pad",node,tensorMap,context),kernelSize=utils_1.getParamValue("kernelSize",node,tensorMap,context);return[tfc.maxPool(utils_1.getParamValue("x",node,tensorMap,context),[kernelSize[1],kernelSize[2]],[stride[1],stride[2]],pad)];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="convolution"},{"./utils":35,"@tensorflow/tfjs-core":62}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"fill":var shape=utils_1.getParamValue("shape",node,tensorMap,context),dtype=utils_1.getParamValue("dtype",node,tensorMap,context),value=utils_1.getParamValue("value",node,tensorMap,context);return[tfc.fill(shape,value,dtype)];case"linspace":var start=utils_1.getParamValue("start",node,tensorMap,context),stop_1=utils_1.getParamValue("stop",node,tensorMap,context),num=utils_1.getParamValue("num",node,tensorMap,context);return[tfc.linspace(start,stop_1,num)];case"oneHot":var indices=utils_1.getParamValue("indices",node,tensorMap,context),depth=utils_1.getParamValue("depth",node,tensorMap,context),onValue=utils_1.getParamValue("onValue",node,tensorMap,context),offValue=utils_1.getParamValue("offValue",node,tensorMap,context);return[tfc.oneHot(indices,depth,onValue,offValue)];case"ones":return[tfc.ones(utils_1.getParamValue("shape",node,tensorMap,context),utils_1.getParamValue("dtype",node,tensorMap,context))];case"onesLike":return[tfc.onesLike(utils_1.getParamValue("x",node,tensorMap,context))];case"randomUniform":return[tfc.randomUniform(utils_1.getParamValue("shape",node,tensorMap,context),utils_1.getParamValue("minval",node,tensorMap,context),utils_1.getParamValue("maxval",node,tensorMap,context),utils_1.getParamValue("dtype",node,tensorMap,context))];case"range":var start=utils_1.getParamValue("start",node,tensorMap,context),stop_2=utils_1.getParamValue("stop",node,tensorMap,context),step=utils_1.getParamValue("step",node,tensorMap,context);return[tfc.range(start,stop_2,step,utils_1.getParamValue("dtype",node,tensorMap,context))];case"truncatedNormal":var shape=utils_1.getParamValue("shape",node,tensorMap,context),mean=utils_1.getParamValue("mean",node,tensorMap,context),stdDev=utils_1.getParamValue("stdDev",node,tensorMap,context),seed=utils_1.getParamValue("seed",node,tensorMap,context);return[tfc.truncatedNormal(shape,mean,stdDev,utils_1.getParamValue("dtype",node,tensorMap,context),seed)];case"zeros":return[tfc.zeros(utils_1.getParamValue("shape",node,tensorMap,context),utils_1.getParamValue("dtype",node,tensorMap,context))];case"zerosLike":return[tfc.zerosLike(utils_1.getParamValue("x",node,tensorMap,context))];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="creation"},{"./utils":35,"@tensorflow/tfjs-core":62}],25:[function(require,module,exports){"use strict";function executeOp(node,tensorMap,context){return __awaiter(this,void 0,void 0,function(){var _a,boxes,scores,maxOutputSize,iouThreshold,scoreThreshold;return __generator(this,function(_b){switch(_b.label){case 0:switch(_a=node.op){case"nonMaxSuppression":return[3,1];case"whereAsync":return[3,3];case"setdiff1dAsync":return[3,5]}return[3,7];case 1:return boxes=utils_1.getParamValue("boxes",node,tensorMap,context),scores=utils_1.getParamValue("scores",node,tensorMap,context),maxOutputSize=utils_1.getParamValue("maxOutputSize",node,tensorMap,context),iouThreshold=utils_1.getParamValue("iouThreshold",node,tensorMap,context),scoreThreshold=utils_1.getParamValue("scoreThreshold",node,tensorMap,context),[4,tfc.image.nonMaxSuppressionAsync(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold)];case 2:return[2,[_b.sent()]];case 3:return[4,tfc.whereAsync(utils_1.getParamValue("condition",node,tensorMap,context))];case 4:return[2,[_b.sent()]];case 5:return[4,tfc.setdiff1dAsync(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("y",node,tensorMap,context))];case 6:return[2,_b.sent()];case 7:throw TypeError("Node type "+node.op+" is not implemented")}})})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=executeOp,exports.CATEGORY="dynamic"},{"./utils":35,"@tensorflow/tfjs-core":62}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"topK":var x=utils_1.getParamValue("x",node,tensorMap,context),k=utils_1.getParamValue("k",node,tensorMap,context),sorted=utils_1.getParamValue("sorted",node,tensorMap,context),result=tfc.topk(x,k,sorted);return[result.values,result.indices];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="evaluation"},{"./utils":35,"@tensorflow/tfjs-core":62}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"const":return tensorMap[node.name];case"placeholder":var def=utils_1.getParamValue("default",node,tensorMap,context);return[utils_1.getTensor(node.name,tensorMap,context)||def];case"identity":case"stopGradient":case"fakeQuantWithMinMaxVars":return[utils_1.getParamValue("x",node,tensorMap,context).clone()];case"snapshot":return[utils_1.getParamValue("x",node,tensorMap,context).clone()];case"shape":return[tfc.tensor1d(utils_1.getParamValue("x",node,tensorMap,context).shape,"int32")];case"shapeN":return utils_1.getParamValue("x",node,tensorMap,context).map(function(t){return tfc.tensor1d(t.shape)});case"size":return[tfc.scalar(utils_1.getParamValue("x",node,tensorMap,context).size,"int32")];case"rank":return[tfc.scalar(utils_1.getParamValue("x",node,tensorMap,context).rank,"int32")];case"noop":return[];case"print":var input=utils_1.getParamValue("x",node,tensorMap,context),data=utils_1.getParamValue("data",node,tensorMap,context),message=utils_1.getParamValue("message",node,tensorMap,context),summarize=utils_1.getParamValue("summarize",node,tensorMap,context);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(message);for(var i=0;i<data.length;i++)console.log(Array.prototype.slice.call(data[0].dataSync()).slice(0,summarize));return[input];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="graph"},{"./utils":35,"@tensorflow/tfjs-core":62}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"resizeBilinear":var images=utils_1.getParamValue("images",node,tensorMap,context),size=utils_1.getParamValue("size",node,tensorMap,context),alignCorners=utils_1.getParamValue("alignCorners",node,tensorMap,context);return[tfc.image.resizeBilinear(images,[size[0],size[1]],alignCorners)];case"resizeNearestNeighbor":var images=utils_1.getParamValue("images",node,tensorMap,context),size=utils_1.getParamValue("size",node,tensorMap,context),alignCorners=utils_1.getParamValue("alignCorners",node,tensorMap,context);return[tfc.image.resizeNearestNeighbor(images,[size[0],size[1]],alignCorners)];case"cropAndResize":var image=utils_1.getParamValue("image",node,tensorMap,context),boxes=utils_1.getParamValue("boxes",node,tensorMap,context),boxInd=utils_1.getParamValue("boxInd",node,tensorMap,context),cropSize=utils_1.getParamValue("cropSize",node,tensorMap,context),method=utils_1.getParamValue("method",node,tensorMap,context),extrapolationValue=utils_1.getParamValue("extrapolationValue",node,tensorMap,context);return[tfc.image.cropAndResize(image,boxes,boxInd,cropSize,method,extrapolationValue)];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="image"},{"./utils":35,"@tensorflow/tfjs-core":62}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"equal":return[tfc.equal(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"notEqual":return[tfc.notEqual(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"greater":return[tfc.greater(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"greaterEqual":return[tfc.greaterEqual(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"less":return[tfc.less(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"lessEqual":return[tfc.lessEqual(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"logicalAnd":return[tfc.logicalAnd(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"logicalNot":return[tfc.logicalNot(utils_1.getParamValue("a",node,tensorMap,context))];case"logicalOr":return[tfc.logicalOr(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];case"where":return[tfc.where(utils_1.getParamValue("condition",node,tensorMap,context),utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context))];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="logical"},{"./utils":35,"@tensorflow/tfjs-core":62}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"matMul":return[tfc.matMul(utils_1.getParamValue("a",node,tensorMap,context),utils_1.getParamValue("b",node,tensorMap,context),utils_1.getParamValue("transposeA",node,tensorMap,context),utils_1.getParamValue("transposeB",node,tensorMap,context))];case"transpose":return[tfc.transpose(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("perm",node,tensorMap,context))];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="matrices"},{"./utils":35,"@tensorflow/tfjs-core":62}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"batchNormalization":return[tfc.batchNormalization(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("mean",node,tensorMap,context),utils_1.getParamValue("variance",node,tensorMap,context),utils_1.getParamValue("epsilon",node,tensorMap,context),utils_1.getParamValue("scale",node,tensorMap,context),utils_1.getParamValue("offset",node,tensorMap,context))];case"localResponseNormalization":return[tfc.localResponseNormalization(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("radius",node,tensorMap,context),utils_1.getParamValue("bias",node,tensorMap,context),utils_1.getParamValue("alpha",node,tensorMap,context),utils_1.getParamValue("beta",node,tensorMap,context))];case"softmax":return[tfc.softmax(utils_1.getParamValue("x",node,tensorMap,context))];case"logSoftmax":return[tfc.logSoftmax(utils_1.getParamValue("x",node,tensorMap,context))];case"sparseToDense":return[tfc.sparseToDense(utils_1.getParamValue("sparseIndices",node,tensorMap,context),utils_1.getParamValue("outputShape",node,tensorMap,context),utils_1.getParamValue("sparseValues",node,tensorMap,context),utils_1.getParamValue("defaultValue",node,tensorMap,context))];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="normalization"},{"./utils":35,"@tensorflow/tfjs-core":62}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"max":var axis=utils_1.getParamValue("axis",node,tensorMap,context),keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.max(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)];case"mean":var axis=utils_1.getParamValue("axis",node,tensorMap,context),keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.mean(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)];case"min":
var axis=utils_1.getParamValue("axis",node,tensorMap,context),keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.min(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)];case"sum":var axis=utils_1.getParamValue("axis",node,tensorMap,context),keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.sum(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)];case"all":var axis=utils_1.getParamValue("axis",node,tensorMap,context),keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.all(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)];case"any":var axis=utils_1.getParamValue("axis",node,tensorMap,context),keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.any(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)];case"argMax":var axis=utils_1.getParamValue("axis",node,tensorMap,context);return[tfc.argMax(utils_1.getParamValue("x",node,tensorMap,context),axis)];case"argMin":var axis=utils_1.getParamValue("axis",node,tensorMap,context);return[tfc.argMin(utils_1.getParamValue("x",node,tensorMap,context),axis)];case"prod":var axis=utils_1.getParamValue("axis",node,tensorMap,context),keepDims=utils_1.getParamValue("keepDims",node,tensorMap,context);return[tfc.prod(utils_1.getParamValue("x",node,tensorMap,context),axis,keepDims)];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="reduction"},{"./utils":35,"@tensorflow/tfjs-core":62}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"concat":var axis=utils_1.getParamValue("axis",node,tensorMap,context),inputs=utils_1.getParamValue("tensors",node,tensorMap,context);return[tfc.concat(inputs,axis)];case"gather":var axis=utils_1.getParamValue("axis",node,tensorMap,context),input=utils_1.getParamValue("x",node,tensorMap,context),indices=utils_1.getParamValue("indices",node,tensorMap,context);return[tfc.gather(input,indices,axis)];case"reverse":var axis=utils_1.getParamValue("axis",node,tensorMap,context),input=utils_1.getParamValue("x",node,tensorMap,context);return[tfc.reverse(input,axis)];case"slice":var begin=utils_1.getParamValue("begin",node,tensorMap,context),size=utils_1.getParamValue("size",node,tensorMap,context);return[tfc.slice(utils_1.getParamValue("x",node,tensorMap,context),begin,size)];case"stridedSlice":var begin=utils_1.getParamValue("begin",node,tensorMap,context),end=utils_1.getParamValue("end",node,tensorMap,context),strides=utils_1.getParamValue("strides",node,tensorMap,context),beginMask=utils_1.getParamValue("beginMask",node,tensorMap,context),endMask=utils_1.getParamValue("endMask",node,tensorMap,context),ellipsisMask=utils_1.getParamValue("ellipsisMask",node,tensorMap,context),newAxisMask=utils_1.getParamValue("newAxisMask",node,tensorMap,context),shrinkAxisMask=utils_1.getParamValue("shrinkAxisMask",node,tensorMap,context),tensor=utils_1.getParamValue("x",node,tensorMap,context);if(1===begin.length&&tensor.shape.length>1)for(var i=1;i<tensor.shape.length;i++)begin.push(0),end.push(tensor.shape[i]),strides.push(strides[0]);return[tfc.stridedSlice(tensor,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask)];case"stack":return tfc.tidy(function(){var axis=utils_1.getParamValue("axis",node,tensorMap,context),tensors=utils_1.getParamValue("tensors",node,tensorMap,context),shape=tensors[0].shape,squeezedShape=tensors[0].squeeze().shape,mapped=tensors.map(function(tensor){var sameShape=tfc.util.arraysEqual(tensor.shape,shape);if(!sameShape&&!tfc.util.arraysEqual(tensor.squeeze().shape,squeezedShape))throw new Error("the input tensors shape does not match");return sameShape?tensor:tensor.reshape(shape)});return[tfc.stack(mapped,axis)]});case"unstack":return tfc.tidy(function(){var axis=utils_1.getParamValue("axis",node,tensorMap,context),tensor=utils_1.getParamValue("tensor",node,tensorMap,context);return tfc.unstack(tensor,axis)});case"tile":var reps=utils_1.getParamValue("reps",node,tensorMap,context);return[tfc.tile(utils_1.getParamValue("x",node,tensorMap,context),reps)];case"split":var axis=utils_1.getParamValue("axis",node,tensorMap,context),numOrSizeSplits=utils_1.getParamValue("numOrSizeSplits",node,tensorMap,context);return tfc.split(utils_1.getParamValue("x",node,tensorMap,context),numOrSizeSplits,axis);case"scatterNd":var indices=utils_1.getParamValue("indices",node,tensorMap,context),values=utils_1.getParamValue("values",node,tensorMap,context),shape=utils_1.getParamValue("shape",node,tensorMap,context);return[tfc.scatterND(indices,values,shape)];case"gatherNd":var x=utils_1.getParamValue("x",node,tensorMap,context),indices=utils_1.getParamValue("indices",node,tensorMap,context);return[tfc.gatherND(x,indices)];case"sparseToDense":var indices=utils_1.getParamValue("sparseIndices",node,tensorMap,context),shape=utils_1.getParamValue("outputShape",node,tensorMap,context),sparseValues=utils_1.getParamValue("sparseValues",node,tensorMap,context),defaultValue=utils_1.getParamValue("defaultValue",node,tensorMap,context);return[tfc.sparseToDense(indices,sparseValues,shape,defaultValue)];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="slice_join"},{"./utils":35,"@tensorflow/tfjs-core":62}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),utils_1=require("./utils");exports.executeOp=function(node,tensorMap,context){switch(node.op){case"cast":return[tfc.cast(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("dtype",node,tensorMap,context))];case"expandDims":var axis=utils_1.getParamValue("axis",node,tensorMap,context);return[tfc.expandDims(utils_1.getParamValue("x",node,tensorMap,context),axis)];case"squeeze":var axis=utils_1.getParamValue("axis",node,tensorMap,context);return[tfc.squeeze(utils_1.getParamValue("x",node,tensorMap,context),axis)];case"reshape":return[tfc.reshape(utils_1.getParamValue("x",node,tensorMap,context),utils_1.getParamValue("shape",node,tensorMap,context))];case"pad":return[tfc.pad(utils_1.getParamValue("x",node,tensorMap,context),utils_1.split(utils_1.getParamValue("padding",node,tensorMap,context),2),utils_1.getParamValue("constantValue",node,tensorMap,context))];case"spaceToBatchND":var blockShape=utils_1.getParamValue("blockShape",node,tensorMap,context),paddings=utils_1.split(utils_1.getParamValue("paddings",node,tensorMap,context),2);return[tfc.spaceToBatchND(utils_1.getParamValue("x",node,tensorMap,context),blockShape,paddings)];case"batchToSpaceND":var blockShape=utils_1.getParamValue("blockShape",node,tensorMap,context),crops=utils_1.split(utils_1.getParamValue("crops",node,tensorMap,context),2);return[tfc.batchToSpaceND(utils_1.getParamValue("x",node,tensorMap,context),blockShape,crops)];case"depthToSpace":var blockSize=utils_1.getParamValue("blockSize",node,tensorMap,context),dataFormat=utils_1.getParamValue("dataFormat",node,tensorMap,context);return[tfc.depthToSpace(utils_1.getParamValue("x",node,tensorMap,context),blockSize,dataFormat)];default:throw TypeError("Node type "+node.op+" is not implemented")}},exports.CATEGORY="transformation"},{"./utils":35,"@tensorflow/tfjs-core":62}],35:[function(require,module,exports){"use strict";function getParamValue(paramName,node,tensorMap,context){var param=node.params[paramName];if(param&&void 0!==param.inputIndex){if("tensor"===param.type)return getTensor(node.inputNames[param.inputIndex],tensorMap,context);if("tensors"===param.type){return(0===param.inputIndex?0===param.inputParamLength?node.inputNames:node.inputNames.slice(param.inputIndex,-param.inputParamLength):node.inputNames.splice(param.inputIndex)).map(function(name){return getTensor(name,tensorMap,context)})}var data=Array.prototype.slice.call(getTensor(node.inputNames.slice(param.inputIndex)[0],tensorMap,context).dataSync());return"number"===param.type?data[0]:data}return param&&param.value}function getTensor(name,tensorsMap,context){var _a=parseNodeName(name),nodeName=_a[0],index=_a[1],contextId=context.currentContextIds.find(function(contextId){return!!tensorsMap[getNodeNameWithContextId(nodeName,contextId)]});return void 0!==contextId?tensorsMap[getNodeNameWithContextId(nodeName,contextId)][index]:void 0}function getTensorsForCurrentContenxt(name,tensorsMap,context){return tensorsMap[getNodeNameWithContextId(name,context.currentContextId)]}function getNodeNameAndIndex(inputName,context){var _a=parseNodeName(inputName),nodeName=_a[0],index=_a[1];return[getNodeNameWithContextId(nodeName,context&&context.currentContextId),index]}function getNodeNameWithContextId(name,contextId){return contextId?name+"-"+contextId:name}function parseNodeName(name){var index=name.lastIndexOf(":");return-1===index?[name,0]:[name.substring(0,index),Number(name.substring(index+1))]}function split(arr,size){for(var res=[],i=0;i<arr.length;i+=size)res.push(arr.slice(i,i+size));return res}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getParamValue=getParamValue,exports.getTensor=getTensor,exports.getTensorsForCurrentContenxt=getTensorsForCurrentContenxt,exports.getNodeNameAndIndex=getNodeNameAndIndex,exports.parseNodeName=parseNodeName,exports.split=split},{}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Add",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",dlOpName:"addN",category:"arithmetic",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",dlOpName:"sub",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",dlOpName:"floorDiv",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",dlOpName:"mul",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",dlOpName:"maximum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Minimum",dlOpName:"minimum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Pow",dlOpName:"pow",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",dlOpName:"squaredDifference",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",dlOpName:"mod",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",dlOpName:"mod",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Abs",dlOpName:"abs",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",dlOpName:"acos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",dlOpName:"asin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",dlOpName:"atan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",dlOpName:"atan2",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"y",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",dlOpName:"ceil",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"clip_value_min",dlParamName:"clipValueMin",type:"number"},{tfParamName:"clip_value_max",dlParamName:"clipValueMax",type:"number"}]},{tfOpName:"Cos",dlOpName:"cos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",dlOpName:"cosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",dlOpName:"elu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",dlOpName:"exp",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",dlOpName:"floor",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",dlOpName:"log",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",dlOpName:"neg",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",dlOpName:"relu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{dlParamName:"clipValueMin",type:"number",defaultValue:0},{dlParamName:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",dlOpName:"selu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",dlOpName:"sigmoid",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",dlOpName:"sin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",dlOpName:"sinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",dlOpName:"sqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",dlOpName:"rsqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",dlOpName:"square",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",dlOpName:"tan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",dlOpName:"tanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",dlOpName:"sign",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",dlOpName:"round",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",dlOpName:"expm1",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",dlOpName:"log1p",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",dlOpName:"softplus",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",dlOpName:"asinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",dlOpName:"acosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",dlOpName:"atanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",dlOpName:"erf",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",dlOpName:"prod",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axes",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool",notSupported:!0},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",dlOpName:"leakyRelu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"alpha",dlParamName:"alpha",type:"number",defaultValue:.2},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"LoopCond",dlOpName:"loopCond",category:"control",params:[{tfInputIndex:0,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Switch",dlOpName:"switch",category:"control",params:[{tfInputIndex:0,dlParamName:"data",type:"tensor"},{tfInputIndex:1,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Merge",dlOpName:"merge",category:"control",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"Enter",dlOpName:"enter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"frame_name",dlParamName:"frameName",type:"string"},{tfParamName:"is_constant",dlParamName:"isConstant",type:"bool"}]},{tfOpName:"Exit",dlOpName:"exit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",dlOpName:"nextIteration",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",dlOpName:"tensorArray",category:"control",params:[{tfInputIndex:0,dlParamName:"size",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"},{tfParamName:"dynamic_size",dlParamName:"dynamicSize",type:"bool"},{tfParamName:"clear_after_read",dlParamName:"clearAfterRead",type:"bool"},{tfParamName:"identical_element_shapes",dlParamName:"identicalElementShapes",type:"bool"},{tfParamName:"tensor_array_name",dlParamName:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",dlOpName:"tensorArrayWrite",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",dlOpName:"tensorArrayRead",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",dlOpName:"tensorArrayGather",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",dlOpName:"tensorArrayScatter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",dlOpName:"tensorArrayConcat",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape_except0",dlParamName:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",dlOpName:"tensorArraySplit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"tensor",type:"tensor"},{tfInputIndex:2,dlParamName:"lengths",type:"number[]"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",dlOpName:"tensorArraySize",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",dlOpName:"tensorArrayClose",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"}]}]},{}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"AvgPool",dlOpName:"avgPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",dlOpName:"maxPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",dlOpName:"conv1d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"stride",dlParamName:"stride",type:"number"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NWC"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"dilation",dlParamName:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",dlOpName:"conv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"useCudnnOnGpu",dlParamName:"useCudnnOnGpu",type:"bool"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"Conv2DBackpropInput",dlOpName:"conv2dTranspose",category:"convolution",params:[{tfInputIndex:2,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfInputIndex:0,dlParamName:"outputShape",type:"number[]"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]}]},{}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Fill",dlOpName:"fill",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfInputIndex:1,dlParamName:"value",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",dlOpName:"linspace",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"num",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",dlOpName:"oneHot",category:"creation",params:[{tfInputIndex:0,dlParamName:"indices",type:"tensor"},{tfInputIndex:1,dlParamName:"depth",type:"number"},{tfInputIndex:2,dlParamName:"onValue",type:"number",defaultValue:1},{tfInputIndex:3,dlParamName:"offValue",type:"number",defaultValue:0},{tfParamName:"axis",dlParamName:"axis",type:"number",notSupported:!0},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",dlOpName:"ones",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",dlOpName:"onesLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",dlOpName:"randomUniform",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"minval",dlParamName:"minval",type:"number",defaultValue:0},{tfParamName:"maxval",dlParamName:"maxval",type:"number",defaultValue:1},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"seed",dlParamName:"seed",type:"number",defaultValue:0},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",dlOpName:"range",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"step",type:"number",defaultValue:0},{tfParamName:"Tidx",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"truncatedNormal",dlOpName:"truncatedNormal",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"means",dlParamName:"mean",type:"number",defaultValue:0},{tfParamName:"stddev",dlParamName:"stdDev",type:"number",defaultValue:1},{tfParamName:"seed",dlParamName:"seed",type:"number"},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",dlOpName:"zeros",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",dlOpName:"zerosLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]}]},{}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"NonMaxSuppressionV2",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"},{tfInputIndex:4,dlParamName:"scoreThreshold",type:"number"}]},{tfOpName:"Where",dlOpName:"whereAsync",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",dlOpName:"setdiff1dAsync",category:"dynamic",
params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"y",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"TopKV2",dlOpName:"topK",category:"evaluation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"k",type:"number"},{tfParamName:"sorted",dlParamName:"sorted",type:"bool"}]}]},{}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"PlaceholderWithDefault",dlOpName:"placeholder",category:"graph",params:[{tfInputIndex:0,dlParamName:"default",type:"tensor"},{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",dlOpName:"placeholder",category:"graph",params:[{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Const",dlOpName:"const",category:"graph"},{tfOpName:"Identity",dlOpName:"identity",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Snapshot",dlOpName:"snapshot",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Rank",dlOpName:"rank",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Size",dlOpName:"size",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Shape",dlOpName:"shape",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"ShapeN",dlOpName:"shapeN",category:"graph",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"x",type:"tensors"}]},{tfOpName:"Print",dlOpName:"print",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfInputParamLength:1,dlParamName:"data",type:"tensors"},{tfParamName:"message",dlParamName:"message",type:"string"},{tfParamName:"first_n",dlParamName:"firstN",type:"number",notSupprted:!0},{tfParamName:"summarize",dlParamName:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",dlOpName:"noop",category:"graph",params:[]},{tfOpName:"StopGradient",dlOpName:"stopGradient",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",dlOpName:"fakeQuantWithMinMaxVars",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"min",dlParamName:"min",type:"number"},{tfParamName:"max",dlParamName:"max",type:"number"}]}]},{}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"ResizeBilinear",dlOpName:"resizeBilinear",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",dlOpName:"resizeNearestNeighbor",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",dlOpName:"cropAndResize",category:"image",params:[{tfInputIndex:0,dlParamName:"image",type:"tensor"},{tfInputIndex:1,dlParamName:"boxes",type:"tensor"},{tfInputIndex:2,dlParamName:"boxInd",type:"tensor"},{tfInputIndex:3,dlParamName:"cropSize",type:"number[]"},{tfParamName:"method",dlParamName:"method",type:"string"},{tfParamName:"extrapolation_value",dlParamName:"extrapolationValue",type:"number"}]}]},{}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Equal",dlOpName:"equal",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",dlOpName:"notEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",dlOpName:"greater",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",dlOpName:"greaterEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",dlOpName:"less",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",dlOpName:"lessEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",dlOpName:"logicalAnd",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",dlOpName:"logicalNot",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",dlOpName:"logicalOr",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",dlOpName:"where",category:"logical",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfInputIndex:1,dlParamName:"a",type:"tensor"},{tfInputIndex:2,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],46:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"MatMul",dlOpName:"matMul",category:"matrices",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"transpose_a",dlParamName:"transposeA",type:"bool",defaultValue:!1},{tfParamName:"transpose_b",dlParamName:"transposeB",type:"bool",defaultValue:!1},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",dlOpName:"matMul",category:"matrices",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"adj_x",dlParamName:"transposeA",type:"bool",defaultValue:!1},{tfParamName:"adj_y",dlParamName:"transposeB",type:"bool",defaultValue:!1},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",dlOpName:"transpose",category:"matrices",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"perm",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"FusedBatchNorm",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",dlOpName:"localResponseNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"depth_radius",dlParamName:"radius",type:"number",defaultValue:5},{tfParamName:"bias",dlParamName:"bias",type:"number",defaultValue:1},{tfParamName:"alpha",dlParamName:"alpha",type:"number",defaultValue:1},{tfParamName:"beta",dlParamName:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",dlOpName:"softmax",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",dlOpName:"logSoftmax",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"SparseToDense",dlOpName:"sparseToDense",category:"normalization",params:[{tfInputIndex:0,dlParamName:"sparseIndices",type:"tensor"},{tfInputIndex:1,dlParamName:"outputShape",type:"number[]"},{tfInputIndex:2,dlParamName:"sparseValues",type:"tensor"},{tfInputIndex:3,dlParamName:"defaultValue",type:"tensor"},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]},{}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Max",dlOpName:"max",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Mean",dlOpName:"mean",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Min",dlOpName:"min",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Sum",dlOpName:"sum",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"All",dlOpName:"all",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Any",dlOpName:"any",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",dlOpName:"argMax",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"ArgMin",dlOpName:"argMin",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"Prod",dlOpName:"prod",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]}]},{}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"ConcatV2",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:-1,dlParamName:"axis",type:"number"}]},{tfOpName:"Concat",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:1,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:0,dlParamName:"axis",type:"number"}]},{tfOpName:"GatherV2",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfInputIndex:2,dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"}]},{tfOpName:"Slice",dlOpName:"slice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"size",type:"number[]"}]},{tfOpName:"StridedSlice",dlOpName:"stridedSlice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"end",type:"number[]"},{tfInputIndex:3,dlParamName:"strides",type:"number[]"},{tfParamName:"begin_mask",dlParamName:"beginMask",type:"number",defaultValue:0},{tfParamName:"end_mask",dlParamName:"endMask",type:"number",defaultValue:0},{tfParamName:"new_axis_mask",dlParamName:"newAxisMask",type:"number",defaultValue:0},{tfParamName:"ellipsis_mask",dlParamName:"ellipsisMask",type:"number",defaultValue:0},{tfParamName:"shrink_axis_mask",dlParamName:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",dlOpName:"stack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",dlOpName:"unstack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"num",dlParamName:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",dlOpName:"tile",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"reps",type:"number[]"}]},{tfOpName:"Split",dlOpName:"split",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"axis",type:"number",defaultValue:0},{tfInputIndex:1,dlParamName:"x",type:"tensor"},{tfParamName:"num_split",dlParamName:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",dlOpName:"split",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"numOrSizeSplits",type:"number[]"},{tfInputIndex:2,dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",dlOpName:"scatterNd",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"indices",type:"tensor"},{tfInputIndex:1,dlParamName:"values",type:"tensor"},{tfInputIndex:2,dlParamName:"shape",type:"number[]"}]},{tfOpName:"GatherNd",dlOpName:"gatherNd",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",dlOpName:"sparseToDense",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"sparseIndices",type:"tensor"},{tfInputIndex:1,dlParamName:"outputShape",type:"number[]"},{tfInputIndex:2,dlParamName:"sparseValues",type:"tensor"},{tfInputIndex:3,dlParamName:"defaultValue",type:"tensor"},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]},{}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.json=[{tfOpName:"Cast",dlOpName:"cast",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"SrcT",dlParamName:"sdtype",type:"dtype",notSupported:!0},{tfParamName:"DstT",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",dlOpName:"expandDims",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfParamNameDeprecated:"dim",dlParamName:"axis",type:"number"}]},{tfOpName:"Pad",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfParamName:"constant_value",dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfInputIndex:2,dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",dlOpName:"reshape",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"shape",type:"number[]"}]},{tfOpName:"Squeeze",dlOpName:"squeeze",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"axis",tfParamNameDeprecated:"squeeze_dims",dlParamName:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",dlOpName:"spaceToBatchND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",dlOpName:"batchToSpaceND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",dlOpName:"depthToSpace",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"block_size",dlParamName:"blockSize",type:"number"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string"}]}]},{}],51:[function(require,module,exports){"use strict";function executeOp(node,tensorMap,context){switch(node.category){case"arithmetic":return arithmetic.executeOp(node,tensorMap,context);case"basic_math":return basicMath.executeOp(node,tensorMap,context);case"control":return control.executeOp(node,tensorMap,context);case"convolution":return convolution.executeOp(node,tensorMap,context);case"creation":return creation.executeOp(node,tensorMap,context);case"dynamic":return dynamic.executeOp(node,tensorMap,context);case"evaluation":return evaluation.executeOp(node,tensorMap,context);case"image":return image.executeOp(node,tensorMap,context);case"graph":return graph.executeOp(node,tensorMap,context);case"logical":return logical.executeOp(node,tensorMap,context);case"matrices":return matrices.executeOp(node,tensorMap,context);case"normalization":return normalization.executeOp(node,tensorMap,context);case"reduction":return reduction.executeOp(node,tensorMap,context);case"slice_join":return sliceJoin.executeOp(node,tensorMap,context);case"transformation":return transformation.executeOp(node,tensorMap,context);default:throw TypeError("Node type "+node.op+" is not implemented")}}Object.defineProperty(exports,"__esModule",{value:!0});var arithmetic=require("./executors/arithmetic_executor"),basicMath=require("./executors/basic_math_executor"),control=require("./executors/control_executor"),convolution=require("./executors/convolution_executor"),creation=require("./executors/creation_executor"),dynamic=require("./executors/dynamic_executor"),evaluation=require("./executors/evaluation_executor"),graph=require("./executors/graph_executor"),image=require("./executors/image_executor"),logical=require("./executors/logical_executor"),matrices=require("./executors/matrices_executor"),normalization=require("./executors/normalization_executor"),reduction=require("./executors/reduction_executor"),sliceJoin=require("./executors/slice_join_executor"),transformation=require("./executors/transformation_executor");exports.executeOp=executeOp},{"./executors/arithmetic_executor":20,"./executors/basic_math_executor":21,"./executors/control_executor":22,"./executors/convolution_executor":23,"./executors/creation_executor":24,"./executors/dynamic_executor":25,"./executors/evaluation_executor":26,"./executors/graph_executor":27,"./executors/image_executor":28,"./executors/logical_executor":29,"./executors/matrices_executor":30,"./executors/normalization_executor":31,"./executors/reduction_executor":32,"./executors/slice_join_executor":33,"./executors/transformation_executor":34}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var compiled_api_1=require("../data/compiled_api"),utils_1=require("./executors/utils"),arithmetic=require("./op_list/arithmetic"),basicMath=require("./op_list/basic_math"),control=require("./op_list/control"),convolution=require("./op_list/convolution"),creation=require("./op_list/creation"),dynamic=require("./op_list/dynamic"),evaluation=require("./op_list/evaluation"),graph=require("./op_list/graph"),image=require("./op_list/image"),logical=require("./op_list/logical"),matrices=require("./op_list/matrices"),normalization=require("./op_list/normalization"),reduction=require("./op_list/reduction"),sliceJoin=require("./op_list/slice_join"),transformation=require("./op_list/transformation"),CONTROL_FLOW_OPS=["Switch","Merge","Enter","Exit","NextIteration"],DYNAMIC_SHAPE_OPS=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"],OperationMapper=function(){function OperationMapper(){var ops=[arithmetic,basicMath,control,convolution,creation,dynamic,evaluation,logical,image,graph,matrices,normalization,reduction,sliceJoin,transformation],mappersJson=[].concat.apply([],ops.map(function(op){return op.json}));this.opMappers=mappersJson.reduce(function(map,mapper){return map[mapper.tfOpName]=mapper,map},{})}return Object.defineProperty(OperationMapper,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),OperationMapper.prototype.isControlFlow=function(node){return CONTROL_FLOW_OPS.some(function(op){return op===node.op})},OperationMapper.prototype.isDynamicShape=function(node){return DYNAMIC_SHAPE_OPS.some(function(op){return op===node.op})},OperationMapper.prototype.transformGraph=function(graph){var _this=this,tfNodes=graph.node,withControlFlow=!1,withDynamicShape=!1,placeholders=[],weights=[],nodes=tfNodes.reduce(function(map,node){return map[node.name]=_this.mapNode(node),_this.isControlFlow(node)&&(withControlFlow=!0),_this.isDynamicShape(node)&&(withDynamicShape=!0),"Placeholder"===node.op&&placeholders.push(map[node.name]),"Const"===node.op&&weights.push(map[node.name]),map},{}),inputs=[],outputs=[];return Object.keys(nodes).forEach(function(key){var node=nodes[key];node.inputNames.forEach(function(name){var nodeName=utils_1.getNodeNameAndIndex(name)[0];node.inputs.push(nodes[nodeName]),nodes[nodeName].children.push(node)}),0===node.inputs.length&&inputs.push(node)}),Object.keys(nodes).forEach(function(key){var node=nodes[key];0===node.children.length&&outputs.push(node)}),{nodes:nodes,inputs:inputs,outputs:outputs,weights:weights,placeholders:placeholders,withControlFlow:withControlFlow,withDynamicShape:withDynamicShape}},OperationMapper.prototype.mapNode=function(node){var _this=this,mapper=this.opMappers[node.op];if(void 0===mapper)throw new Error("Tensorflow Op is not supported: "+node.op);var newNode={name:node.name,op:mapper.dlOpName,category:mapper.category,inputNames:(node.input||[]).map(function(input){return input.startsWith("^")?input.substr(1):input}),inputs:[],children:[],params:{}};return mapper.params&&(newNode.params=mapper.params.reduce(function(map,param){var inputIndex=param.tfInputIndex,inputParamLength=param.tfInputParamLength,type=param.type,value=void 0;if(void 0===inputIndex)switch(param.type){case"string":value=_this.getStringParam(node.attr,param.tfParamName,param.defaultValue),void 0===value&&param.tfParamNameDeprecated&&(value=_this.getStringParam(node.attr,param.tfParamNameDeprecated,param.defaultValue));break;case"number":value=_this.getNumberParam(node.attr,param.tfParamName,param.defaultValue),void 0===value&&param.tfParamNameDeprecated&&(value=_this.getNumberParam(node.attr,param.tfParamNameDeprecated,param.defaultValue));break;case"number[]":value=_this.getNumericArrayParam(node.attr,param.tfParamName,param.defaultValue),void 0===value&&param.tfParamNameDeprecated&&(value=_this.getNumericArrayParam(node.attr,param.tfParamNameDeprecated,param.defaultValue));break;case"bool":value=_this.getBoolParam(node.attr,param.tfParamName,param.defaultValue),void 0===value&&param.tfParamNameDeprecated&&(value=_this.getBoolParam(node.attr,param.tfParamNameDeprecated,param.defaultValue));break;case"shape":value=_this.getTensorShapeParam(node.attr,param.tfParamName,param.defaultValue),void 0===value&&param.tfParamNameDeprecated&&(value=_this.getTensorShapeParam(node.attr,param.tfParamNameDeprecated,param.defaultValue));break;case"dtype":value=_this.getDtypeParam(node.attr,param.tfParamName,param.defaultValue),void 0===value&&param.tfParamNameDeprecated&&(value=_this.getDtypeParam(node.attr,param.tfParamNameDeprecated,param.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+param.type+" for op: "+node.op)}return map[param.dlParamName]={value:value,inputIndex:inputIndex,type:type,inputParamLength:inputParamLength},map},{})),newNode},OperationMapper.prototype.getStringParam=function(attrs,name,def,keepCase){void 0===keepCase&&(keepCase=!1);var param=attrs[name];if(void 0!==param){var value=String.fromCharCode.apply(null,param.s);return keepCase?value:value.toLowerCase()}return def},OperationMapper.prototype.getBoolParam=function(attrs,name,def){var param=attrs[name];return param?param.b:def},OperationMapper.prototype.getNumberParam=function(attrs,name,def){var param=attrs[name],value=param?param[param.value]:def;return"number"==typeof value?value:value.toInt()},OperationMapper.prototype.getDtypeParam=function(attrs,name,def){var param=attrs[name];if(param&&param.type)switch(param.type){case compiled_api_1.tensorflow.DataType.DT_FLOAT:return"float32";case compiled_api_1.tensorflow.DataType.DT_INT32:return"int32";case compiled_api_1.tensorflow.DataType.DT_BOOL:return"bool";default:return def}return def},OperationMapper.prototype.getTensorShapeParam=function(attrs,name,def){var param=attrs[name];return param&&param.shape?param.shape.dim.map(function(dim){return"number"==typeof dim.size?dim.size:dim.size.toInt()}):def},OperationMapper.prototype.getNumericArrayParam=function(attrs,name,def){var param=attrs[name];return param?(param.list.f&&param.list.f.length?param.list.f:param.list.i).map(function(v){return"number"==typeof v?v:v.toInt()}):def},OperationMapper}();exports.OperationMapper=OperationMapper},{"../data/compiled_api":14,"./executors/utils":35,"./op_list/arithmetic":36,"./op_list/basic_math":37,"./op_list/control":38,"./op_list/convolution":39,"./op_list/creation":40,"./op_list/dynamic":41,"./op_list/evaluation":42,"./op_list/graph":43,"./op_list/image":44,"./op_list/logical":45,"./op_list/matrices":46,"./op_list/normalization":47,"./op_list/reduction":48,"./op_list/slice_join":49,"./op_list/transformation":50}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.version="0.6.7"},{}],54:[function(require,module,exports){(function(setImmediate){"use strict";function nextFrame(){return new Promise(function(resolve){return delayCallback(function(){return resolve()})})}Object.defineProperty(exports,"__esModule",{value:!0});var delayCallback="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:setImmediate;exports.nextFrame=nextFrame}).call(this,require("timers").setImmediate)},{timers:294}],55:[function(require,module,exports){"use strict";function getWebGLContext(webGLVersion){if(!(webGLVersion in contexts)){document.createElement("canvas").addEventListener("webglcontextlost",function(ev){ev.preventDefault(),delete contexts[webGLVersion]},!1),contexts[webGLVersion]=getWebGLRenderingContext(webGLVersion)}var gl=contexts[webGLVersion];return gl.isContextLost()?(delete contexts[webGLVersion],getWebGLContext(webGLVersion)):(gl.disable(gl.DEPTH_TEST),gl.disable(gl.STENCIL_TEST),gl.disable(gl.BLEND),gl.disable(gl.DITHER),gl.disable(gl.POLYGON_OFFSET_FILL),gl.disable(gl.SAMPLE_COVERAGE),gl.enable(gl.SCISSOR_TEST),gl.enable(gl.CULL_FACE),gl.cullFace(gl.BACK),contexts[webGLVersion])}function getWebGLRenderingContext(webGLVersion){if(1!==webGLVersion&&2!==webGLVersion)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var canvas=document.createElement("canvas");return 1===webGLVersion?canvas.getContext("webgl",WEBGL_ATTRIBUTES)||canvas.getContext("experimental-webgl",WEBGL_ATTRIBUTES):canvas.getContext("webgl2",WEBGL_ATTRIBUTES)}Object.defineProperty(exports,"__esModule",{value:!0});var contexts={},WEBGL_ATTRIBUTES={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};exports.getWebGLContext=getWebGLContext},{}],56:[function(require,module,exports){"use strict";function isMobile(){var a=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isMobile=isMobile},{}],57:[function(require,module,exports){"use strict";function ones(shape){var values=util_1.makeOnesTypedArray(util_1.sizeFromShape(shape),"float32");return tensor_1.Tensor.make(shape,{values:values})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var profiler_1=require("./profiler"),tape_1=require("./tape"),tensor_1=require("./tensor"),tensor_util_1=require("./tensor_util"),util=require("./util"),util_1=require("./util"),Engine=function(){function Engine(backend,safeMode,debugMode){this.backend=backend,this.safeMode=safeMode,this.debugMode=debugMode,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientScopeCount=0,this.customGradientDepth=0,this.keepTensors=new Set,this.tensorInfo=new WeakMap,this.activeScope={track:[],name:"default scope"},this.scopeStack=[this.activeScope],this.profiler=new profiler_1.Profiler(backend),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return Engine.prototype.moveData=function(dataId){this.write(dataId,this.readSync(dataId))},Engine.prototype.tidy=function(nameOrFn,fn,gradMode){var _this=this;void 0===gradMode&&(gradMode=!1);var name=null;if(null==fn){if("function"!=typeof nameOrFn)throw new Error("Please provide a function to tidy()");fn=nameOrFn}else{if("string"!=typeof nameOrFn&&!(nameOrFn instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof fn)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");name=nameOrFn}var result;return this.scopedRun(function(){return _this.startScope(name,gradMode)},function(){return _this.endScope(result,gradMode)},function(){return result=fn(),result instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),result})},Engine.prototype.scopedRun=function(start,end,f){start();try{var res=f();return end(),res}catch(ex){throw end(),ex}},Engine.prototype.nextTensorId=function(){return Engine.nextTensorId++},Engine.prototype.nextVariableId=function(){return Engine.nextVariableId++},Engine.prototype.runKernel=function(forwardFunc,inputs,backwardsFunc){var result,_this=this,saved=[],saveFunc=function(x){return saved.push(x),x},scopeName=this.activeScope.name,startingBytecount=this.numBytes,startingNumTensors=this.numTensors;if(this.scopedRun(function(){return _this.customGradientDepth++},function(){return _this.customGradientDepth--},function(){result=_this.debugMode()?_this.profiler.profileKernel(scopeName,function(){return forwardFunc(_this.backend,saveFunc)}):forwardFunc(_this.backend,saveFunc)}),this.shouldRecord()){var tapeNode={id:this.nextTapeNodeId++,name:scopeName,inputs:inputs,outputs:Array.isArray(result)?result:[result]};null!=backwardsFunc&&(tapeNode.gradient=function(dy){return backwardsFunc(dy,saved)}),this.activeTape.push(tapeNode)}return this.profiling&&this.activeProfile.kernels.push({name:scopeName,bytesAdded:this.numBytes-startingBytecount,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-startingNumTensors,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(inputs).map(function(key){return inputs[key].shape}),outputShape:Array.isArray(result)?result.map(function(item){return item.shape}):result.shape}),result},Engine.prototype.registerTensor=function(a){var refCount=this.tensorInfo.has(a.dataId)?this.tensorInfo.get(a.dataId).refCount:0;this.numTensors++,0===refCount&&(this.numDataBuffers++,"complex64"!==a.dtype&&(this.numBytes+=util.sizeFromShape(a.shape)*util.bytesPerElement(a.dtype)),this.tensorInfo.set(a.dataId,{backend:this.backend,dtype:a.dtype,shape:a.shape,refCount:0}),this.backend.register(a.dataId,a.shape,a.dtype)),this.tensorInfo.get(a.dataId).refCount++,a instanceof tensor_1.Variable||this.track(a)},Engine.prototype.registerVariable=function(v){if(null!=this.registeredVariables[v.name])throw new Error("Variable with name "+v.name+" was already registered");this.registeredVariables[v.name]=v},Engine.prototype.disposeTensor=function(a){if(this.tensorInfo.has(a.dataId)){this.keepTensors.has(a.id)&&this.keepTensors.delete(a.id),this.numTensors--;if(this.tensorInfo.get(a.dataId).refCount<=1){this.tensorInfo.get(a.dataId).backend.disposeData(a.dataId),this.numDataBuffers--,"complex64"!==a.dtype&&(this.numBytes-=util.sizeFromShape(a.shape)*util.bytesPerElement(a.dtype)),this.tensorInfo.delete(a.dataId)}else this.tensorInfo.get(a.dataId).refCount--}},Engine.prototype.disposeVariables=function(){for(var varName in this.registeredVariables){var v=this.registeredVariables[varName];this.disposeTensor(v),delete this.registeredVariables[varName]}},Engine.prototype.memory=function(){var info=this.backend.memory();return info.numTensors=this.numTensors,info.numDataBuffers=this.numDataBuffers,info.numBytes=this.numBytes,info},Engine.prototype.profile=function(query){return __awaiter(this,void 0,void 0,function(){var startBytes,startNumTensors;return __generator(this,function(_a){return this.profiling=!0,startBytes=this.numBytes,startNumTensors=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=query(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-startBytes,this.activeProfile.newTensors=this.numTensors-startNumTensors,[2,this.activeProfile]})})},Engine.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},Engine.prototype.addTapeNode=function(inputs,result,gradientsFunc){var inputsMap={};inputs.forEach(function(input,idx){inputsMap[idx]=input});var gradient=function(dy){var res=gradientsFunc(dy),resMap={};return res.forEach(function(r,idx){resMap[idx]=function(){return r}}),resMap},tapeNode={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:inputsMap,outputs:[result],gradient:gradient};this.activeTape.push(tapeNode)},Engine.prototype.keep=function(result){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(result.id),result},Engine.prototype.startScope=function(name,gradientsMode){void 0===gradientsMode&&(gradientsMode=!1),gradientsMode&&0===this.gradientScopeCount&&(this.activeTape=[]),gradientsMode&&this.gradientScopeCount++;var scopeInfo={track:[],name:"unnamed scope"};name&&(scopeInfo.name=name),this.scopeStack.push(scopeInfo),this.activeScope=scopeInfo},Engine.prototype.endScope=function(result,gradientsMode){var _this=this;void 0===gradientsMode&&(gradientsMode=!1),gradientsMode&&0===--this.gradientScopeCount&&(this.activeTape=null);var tensorsToKeep=new Set(this.keepTensors),tensorsToTrackInParent=tensor_util_1.getTensorsInContainer(result);tensorsToTrackInParent.forEach(function(tensor){return tensorsToKeep.add(tensor.id)});for(var i=0;i<this.activeScope.track.length;i++){var tensor=this.activeScope.track[i];tensorsToKeep.has(tensor.id)||(null!=this.activeTape?tensorsToTrackInParent.push(tensor):tensor.dispose())}var oldScope=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?{track:[],name:"default scope"}:this.scopeStack[this.scopeStack.length-1],tensorsToTrackInParent.forEach(function(tensor){!_this.keepTensors.has(tensor.id)&&tensor_util_1.isTensorInList(tensor,oldScope.track)&&_this.track(tensor)})},Engine.prototype.gradients=function(f,xs,dy,allowNoGradients){var _this=this;return void 0===allowNoGradients&&(allowNoGradients=!1),util.assert(xs.length>0,"gradients() received an empty list of xs."),this.tidy("gradients",function(){var y=f();util.assert(y instanceof tensor_1.Tensor,"The result y returned by f() must be a tensor.");var filteredTape=tape_1.getFilteredNodesXToY(_this.activeTape,xs,y);if(!allowNoGradients&&0===filteredTape.length&&xs.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var accumulatedGradientMap={};return accumulatedGradientMap[y.id]=null==dy?ones(y.shape):dy,tape_1.backpropagateGradients(accumulatedGradientMap,filteredTape),{value:y,grads:xs.map(function(x){return accumulatedGradientMap[x.id]})}},!0)},Engine.prototype.customGrad=function(f){var _this=this;return util.assert(util.isFunction(f),"The f passed in customGrad(f) must be a function."),function(){for(var inputs=[],_i=0;_i<arguments.length;_i++)inputs[_i]=arguments[_i];util.assert(inputs.every(function(t){return t instanceof tensor_1.Tensor}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors");var gradientsFunc,result;if(_this.scopedRun(function(){return _this.customGradientDepth++},function(){return _this.customGradientDepth--},function(){result=_this.tidy(f.name,function(){var _a=f.apply(void 0,inputs),value=_a.value,gradFunc=_a.gradFunc;return util.assert(value instanceof tensor_1.Tensor,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),util.assert(util.isFunction(gradFunc),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),gradientsFunc=gradFunc,value},!0)}),_this.shouldRecord()){var gradFunc=function(dy){var res=gradientsFunc(dy),grads=Array.isArray(res)?res:[res];return util.assert(grads.length===inputs.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),util.assert(grads.every(function(t){return t instanceof tensor_1.Tensor}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),grads};_this.addTapeNode(inputs,result,gradFunc)}return result}},Engine.prototype.write=function(dataId,values){var info=this.tensorInfo.get(dataId);this.backend!==info.backend&&(info.backend.disposeData(dataId),info.backend=this.backend,this.backend.register(dataId,info.shape,info.dtype)),this.backend.write(dataId,values)},Engine.prototype.readSync=function(dataId){return this.tensorInfo.get(dataId).backend.readSync(dataId)},Engine.prototype.read=function(dataId){return this.tensorInfo.get(dataId).backend.read(dataId)},Engine.prototype.fromPixels=function(pixels,numChannels){return this.backend.fromPixels(pixels,numChannels)},Engine.prototype.time=function(query){return __awaiter(this,void 0,void 0,function(){var start,timingInfo;return __generator(this,function(_a){switch(_a.label){case 0:return start=util_1.now(),[4,this.backend.time(query)];case 1:return timingInfo=_a.sent(),timingInfo.wallMs=util_1.now()-start,[2,timingInfo]}})})},Engine.prototype.track=function(result){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope.track.push(result),result},Engine.nextTensorId=0,Engine.nextVariableId=0,Engine}();exports.Engine=Engine},{"./profiler":200,"./tape":202,"./tensor":203,"./tensor_util":205,"./util":210}],58:[function(require,module,exports){(function(process){"use strict";function getGlobalNamespace(){var ns;if("undefined"!=typeof window)ns=window;else{if(void 0===process)throw new Error("Could not find a global object");ns=process}return ns}Object.defineProperty(exports,"__esModule",{value:!0});var device_util=require("./device_util"),engine_1=require("./engine"),environment_util_1=require("./environment_util"),tensor_1=require("./tensor"),tensor_util_1=require("./tensor_util"),Environment=function(){function Environment(features){this.features={},this.registry={},null!=features&&(this.features=features),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return Environment.setBackend=function(backendName,safeMode){if(void 0===safeMode&&(safeMode=!1),!(backendName in exports.ENV.registry))throw new Error("Backend name '"+backendName+"' not found in registry");exports.ENV.engine.backend=exports.ENV.findBackend(backendName),exports.ENV.backendName=backendName},Environment.getBackend=function(){return exports.ENV.initEngine(),exports.ENV.backendName},Environment.disposeVariables=function(){exports.ENV.engine.disposeVariables()},Environment.memory=function(){return exports.ENV.engine.memory()},Environment.profile=function(f){return exports.ENV.engine.profile(f)},Environment.tidy=function(nameOrFn,fn,gradMode){return void 0===gradMode&&(gradMode=!1),exports.ENV.engine.tidy(nameOrFn,fn,gradMode)},Environment.dispose=function(container){tensor_util_1.getTensorsInContainer(container).forEach(function(tensor){return tensor.dispose()})},Environment.keep=function(result){return exports.ENV.engine.keep(result)},Environment.time=function(f){return exports.ENV.engine.time(f)},Environment.prototype.get=function(feature){return feature in this.features?this.features[feature]:(this.features[feature]=this.evaluateFeature(feature),this.features[feature])},Environment.prototype.getFeatures=function(){return this.features},Environment.prototype.set=function(feature,value){this.features[feature]=value},Environment.prototype.getBestBackendName=function(){var _this=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(name){return{name:name,entry:_this.registry[name]}}).sort(function(a,b){return b.entry.priority-a.entry.priority})[0].name},Environment.prototype.evaluateFeature=function(feature){if("DEBUG"===feature)return!1;if("IS_BROWSER"===feature)return"undefined"!=typeof window;if("IS_NODE"===feature)return void 0!==process&&void 0!==process.versions.node;if("IS_CHROME"===feature)return environment_util_1.isChrome();if("WEBGL_CPU_FORWARD"===feature)return!0;if("WEBGL_PACK_BATCHNORMALIZATION"===feature)return!1;if("WEBGL_LAZILY_UNPACK"===feature)return!1;if("WEBGL_CONV_IM2COL"===feature)return!1;if("WEBGL_PAGING_ENABLED"===feature)return this.get("IS_BROWSER")&&!this.get("PROD");if("WEBGL_MAX_TEXTURE_SIZE"===feature)return environment_util_1.getWebGLMaxTextureSize(this.get("WEBGL_VERSION"));if("IS_TEST"===feature)return!1;if("BACKEND"===feature)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===feature){var webGLVersion=this.get("WEBGL_VERSION");return 0===webGLVersion?0:environment_util_1.getWebGLDisjointQueryTimerVersion(webGLVersion)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===feature)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!device_util.isMobile();if("HAS_WEBGL"===feature)return this.get("WEBGL_VERSION")>0;if("WEBGL_VERSION"===feature)return environment_util_1.isWebGLVersionEnabled(2)?2:environment_util_1.isWebGLVersionEnabled(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===feature)return environment_util_1.isRenderToFloatTextureEnabled(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===feature)return environment_util_1.isDownloadFloatTextureEnabled(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===feature)return environment_util_1.isWebGLFenceEnabled(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===feature){return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}if("TEST_EPSILON"===feature)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===feature)return 32===this.backend.floatPrecision()?1e-7:.001;if("PROD"===feature)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===feature)return!this.get("PROD");throw new Error("Unknown feature "+feature+".")},Environment.prototype.setFeatures=function(features){this.features=Object.assign({},features)},Environment.prototype.reset=function(){this.features=environment_util_1.getFeaturesFromURL(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(Environment.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),Environment.prototype.findBackend=function(name){return name in this.registry?this.registry[name].backend:null},Environment.prototype.registerBackend=function(name,factory,priority,setTensorTrackerFn){var _this=this;if(void 0===priority&&(priority=1),name in this.registry)return console.warn(name+" backend was already registered. Reusing existing backend"),null!=setTensorTrackerFn&&setTensorTrackerFn(function(){return _this.engine}),!1;try{var backend=factory();return backend.setDataMover({moveData:function(dataId){return _this.engine.moveData(dataId)}}),this.registry[name]={backend:backend,priority:priority},!0}catch(err){return console.warn("Registration of backend "+name+" failed"),console.warn(err.stack||err.message),!1}},Environment.prototype.removeBackend=function(name){if(!(name in this.registry))throw new Error(name+" backend not found in registry");this.registry[name].backend.dispose(),delete this.registry[name]},Object.defineProperty(Environment.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),Environment.prototype.initEngine=function(){var _this=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var backend=this.findBackend(this.backendName);this.globalEngine=new engine_1.Engine(backend,!1,function(){return _this.get("DEBUG")})}},Environment}();exports.Environment=Environment,exports.ENV=function(){var ns=getGlobalNamespace();return null==ns.ENV&&(ns.ENV=new Environment(environment_util_1.getFeaturesFromURL()),tensor_1.setTensorTracker(function(){return ns.ENV.engine})),ns.ENV}()}).call(this,require("_process"))},{"./device_util":56,"./engine":57,"./environment_util":59,"./tensor":203,"./tensor_util":205,_process:274}],59:[function(require,module,exports){"use strict";function isWebGLVersionEnabled(webGLVersion){try{if(null!=canvas_util_1.getWebGLContext(webGLVersion))return!0}catch(e){return!1}return!1}function getWebGLMaxTextureSize(webGLVersion){if(null==MAX_TEXTURE_SIZE){var gl=canvas_util_1.getWebGLContext(webGLVersion);MAX_TEXTURE_SIZE=gl.getParameter(gl.MAX_TEXTURE_SIZE)}return MAX_TEXTURE_SIZE}function getWebGLDisjointQueryTimerVersion(webGLVersion){if(0===webGLVersion)return 0;var gl=canvas_util_1.getWebGLContext(webGLVersion);return hasExtension(gl,"EXT_disjoint_timer_query_webgl2")&&2===webGLVersion?2:hasExtension(gl,"EXT_disjoint_timer_query")?1:0}function isRenderToFloatTextureEnabled(webGLVersion){if(0===webGLVersion)return!1;var gl=canvas_util_1.getWebGLContext(webGLVersion);if(1===webGLVersion){if(!hasExtension(gl,"OES_texture_float"))return!1}else if(!hasExtension(gl,"EXT_color_buffer_float"))return!1;return createFloatTextureAndBindToFramebuffer(gl,webGLVersion)}function isDownloadFloatTextureEnabled(webGLVersion){if(0===webGLVersion)return!1;var gl=canvas_util_1.getWebGLContext(webGLVersion);if(1===webGLVersion){if(!hasExtension(gl,"OES_texture_float"))return!1;if(!hasExtension(gl,"WEBGL_color_buffer_float"))return!1}else if(!hasExtension(gl,"EXT_color_buffer_float"))return!1;return createFloatTextureAndBindToFramebuffer(gl,webGLVersion)}function isWebGLFenceEnabled(webGLVersion){return 2===webGLVersion&&null!=canvas_util_1.getWebGLContext(webGLVersion).fenceSync}function isChrome(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function getFeaturesFromURL(){var features={};if("undefined"==typeof window||void 0===window.location||void 0===window.location.search)return features;var urlParams=getQueryParams(window.location.search);if(TENSORFLOWJS_FLAGS_PREFIX in urlParams){var urlFlags_1={};urlParams[TENSORFLOWJS_FLAGS_PREFIX].split(",").forEach(function(keyValue){var _a=keyValue.split(":"),key=_a[0],value=_a[1];urlFlags_1[key]=value}),exports.URL_PROPERTIES.forEach(function(urlProperty){urlProperty.name in urlFlags_1&&(console.log("Setting feature override from URL "+urlProperty.name+": "+urlFlags_1[urlProperty.name]),urlProperty.type===Type.NUMBER?features[urlProperty.name]=+urlFlags_1[urlProperty.name]:urlProperty.type===Type.BOOLEAN?features[urlProperty.name]="true"===urlFlags_1[urlProperty.name]:urlProperty.type===Type.STRING?features[urlProperty.name]=urlFlags_1[urlProperty.name]:console.warn("Unknown URL param: "+urlProperty.name+"."))})}return features}function hasExtension(gl,extensionName){return null!=gl.getExtension(extensionName)}function createFloatTextureAndBindToFramebuffer(gl,webGLVersion){var frameBuffer=gl.createFramebuffer(),texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);var internalFormat=2===webGLVersion?gl.RGBA32F:gl.RGBA;gl.texImage2D(gl.TEXTURE_2D,0,internalFormat,1,1,0,gl.RGBA,gl.FLOAT,null),gl.bindFramebuffer(gl.FRAMEBUFFER,frameBuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);var isFrameBufferComplete=gl.checkFramebufferStatus(gl.FRAMEBUFFER)===gl.FRAMEBUFFER_COMPLETE;return gl.bindTexture(gl.TEXTURE_2D,null),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.deleteTexture(texture),gl.deleteFramebuffer(frameBuffer),isFrameBufferComplete}function getQueryParams(queryString){var params={};return queryString.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(s){for(var t=[],_i=1;_i<arguments.length;_i++)t[_i-1]=arguments[_i];return decodeParam(params,t[0],t[1]),t.join("=")}),params}function decodeParam(params,name,value){params[decodeURIComponent(name)]=decodeURIComponent(value||"")}Object.defineProperty(exports,"__esModule",{value:!0});var Type,canvas_util_1=require("./canvas_util");!function(Type){Type[Type.NUMBER=0]="NUMBER",Type[Type.BOOLEAN=1]="BOOLEAN",Type[Type.STRING=2]="STRING"}(Type=exports.Type||(exports.Type={})),exports.URL_PROPERTIES=[{name:"DEBUG",type:Type.BOOLEAN},{name:"IS_BROWSER",type:Type.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:Type.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:Type.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:Type.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:Type.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:Type.NUMBER},{name:"WEBGL_PAGING_ENABLED",type:Type.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:Type.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:Type.BOOLEAN},{name:"WEBGL_VERSION",type:Type.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:Type.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:Type.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:Type.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:Type.NUMBER},{name:"BACKEND",type:Type.STRING},{name:"EPSILON",type:Type.NUMBER},{name:"PROD",type:Type.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:Type.BOOLEAN}],exports.isWebGLVersionEnabled=isWebGLVersionEnabled;var MAX_TEXTURE_SIZE;exports.getWebGLMaxTextureSize=getWebGLMaxTextureSize,exports.getWebGLDisjointQueryTimerVersion=getWebGLDisjointQueryTimerVersion,exports.isRenderToFloatTextureEnabled=isRenderToFloatTextureEnabled,exports.isDownloadFloatTextureEnabled=isDownloadFloatTextureEnabled,exports.isWebGLFenceEnabled=isWebGLFenceEnabled,exports.isChrome=isChrome;var TENSORFLOWJS_FLAGS_PREFIX="tfjsflags";exports.getFeaturesFromURL=getFeaturesFromURL,exports.getQueryParams=getQueryParams},{"./canvas_util":55}],60:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),gradients_1=require("./gradients");exports.customGrad=gradients_1.customGrad,exports.grad=gradients_1.grad,exports.grads=gradients_1.grads,exports.valueAndGrad=gradients_1.valueAndGrad,exports.valueAndGrads=gradients_1.valueAndGrads,exports.variableGrads=gradients_1.variableGrads,exports.tidy=environment_1.Environment.tidy,exports.keep=environment_1.Environment.keep,exports.dispose=environment_1.Environment.dispose,exports.time=environment_1.Environment.time,exports.profile=environment_1.Environment.profile},{"./environment":58,"./gradients":61}],61:[function(require,module,exports){"use strict";function gradScope(nameOrScopeFn,scopeFn){return environment_1.ENV.engine.tidy(nameOrScopeFn,scopeFn,!0)}function grad(f){return util.assert(util.isFunction(f),"The f passed in grad(f) must be a function"),function(x,dy){return util.assert(x instanceof tensor_1.Tensor,"The x passed in grad(f)(x) must be a tensor"),util.assert(null==dy||dy instanceof tensor_1.Tensor,"The dy passed in grad(f)(x, dy) must be a tensor"),environment_1.ENV.engine.tidy(function(){var _a=environment_1.ENV.engine.gradients(function(){return f(x)},[x],dy),value=_a.value,grads=_a.grads;return null!=dy&&util.assertShapesMatch(value.shape,dy.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),checkGrads(grads),grads[0]})}}function grads(f){return util.assert(util.isFunction(f),"The f passed in grads(f) must be a function"),function(args,dy){return util.assert(Array.isArray(args)&&args.every(function(arg){return arg instanceof tensor_1.Tensor}),"The args passed in grads(f)(args) must be an array of tensors"),util.assert(null==dy||dy instanceof tensor_1.Tensor,"The dy passed in grads(f)(args, dy) must be a tensor"),environment_1.ENV.engine.tidy(function(){var _a=environment_1.ENV.engine.gradients(function(){return f.apply(void 0,args)},args,dy),value=_a.value,grads=_a.grads;return null!=dy&&util.assertShapesMatch(value.shape,dy.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(grads),grads})}}function valueAndGrad(f){return util.assert(util.isFunction(f),"The f passed in valueAndGrad(f) must be a function"),function(x,dy){util.assert(x instanceof tensor_1.Tensor,"The x passed in valueAndGrad(f)(x) must be a tensor"),util.assert(null==dy||dy instanceof tensor_1.Tensor,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var _a=environment_1.ENV.engine.gradients(function(){return f(x)},[x],dy),grads=_a.grads,value=_a.value;return checkGrads(grads),{grad:grads[0],value:value}}}function valueAndGrads(f){return util.assert(util.isFunction(f),"The f passed in valueAndGrads(f) must be a function"),function(args,dy){util.assert(Array.isArray(args)&&args.every(function(arg){return arg instanceof tensor_1.Tensor}),"The args passed in valueAndGrads(f)(args) must be array of tensors"),util.assert(null==dy||dy instanceof tensor_1.Tensor,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var res=environment_1.ENV.engine.gradients(function(){return f.apply(void 0,args)},args,dy);return null!=dy&&util.assertShapesMatch(res.value.shape,dy.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),checkGrads(res.grads),res}}function variableGrads(f,varList){if(util.assert(util.isFunction(f),"The f passed in variableGrads(f) must be a function"),util.assert(null==varList||Array.isArray(varList)&&varList.every(function(v){return v instanceof tensor_1.Variable}),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==varList){varList=[];for(var varName in environment_1.ENV.engine.registeredVariables)varList.push(environment_1.ENV.engine.registeredVariables[varName])}var originalVarCount=varList.length;varList=varList.filter(function(variable){return variable.trainable}),util.assert(varList.length>0,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+originalVarCount+" variables is trainable.");var _a=environment_1.ENV.engine.gradients(f,varList,null,!0),value=_a.value,grads=_a.grads;util.assert(grads.some(function(g){return null!=g}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),util.assert(0===value.rank,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+value.rank+" tensor");var namedGrads={};return varList.forEach(function(v,i){null!=grads[i]&&(namedGrads[v.name]=grads[i])}),{value:value,grads:namedGrads}}function customGrad(f){return environment_1.ENV.engine.customGrad(f)}function checkGrads(grads){if(grads.filter(function(g){return null==g}).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),tensor_1=require("./tensor"),util=require("./util");exports.gradScope=gradScope,exports.grad=grad,exports.grads=grads,exports.valueAndGrad=valueAndGrad,exports.valueAndGrads=valueAndGrads,exports.variableGrads=variableGrads,exports.customGrad=customGrad},{"./environment":58,"./tensor":203,"./util":210}],62:[function(require,module,exports){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0}),require("./kernels/backend_webgl"),require("./kernels/backend_cpu");var browser_util_1=require("./browser_util");exports.nextFrame=browser_util_1.nextFrame;var environment=require("./environment");exports.environment=environment;var environment_1=require("./environment"),io=require("./io/io");exports.io=io;var math=require("./math");exports.math=math;var serialization=require("./serialization");exports.serialization=serialization;var tensor_1=require("./tensor"),test_util=require("./test_util");exports.test_util=test_util;var util=require("./util");exports.util=util;var version_1=require("./version");exports.version_core=version_1.version;var webgl=require("./webgl");exports.webgl=webgl;var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer");exports.AdadeltaOptimizer=adadelta_optimizer_1.AdadeltaOptimizer;var adagrad_optimizer_1=require("./optimizers/adagrad_optimizer");exports.AdagradOptimizer=adagrad_optimizer_1.AdagradOptimizer;var adam_optimizer_1=require("./optimizers/adam_optimizer");exports.AdamOptimizer=adam_optimizer_1.AdamOptimizer;var adamax_optimizer_1=require("./optimizers/adamax_optimizer");exports.AdamaxOptimizer=adamax_optimizer_1.AdamaxOptimizer;var momentum_optimizer_1=require("./optimizers/momentum_optimizer");exports.MomentumOptimizer=momentum_optimizer_1.MomentumOptimizer;var optimizer_1=require("./optimizers/optimizer");exports.Optimizer=optimizer_1.Optimizer;var rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer");exports.RMSPropOptimizer=rmsprop_optimizer_1.RMSPropOptimizer;var sgd_optimizer_1=require("./optimizers/sgd_optimizer")
;exports.SGDOptimizer=sgd_optimizer_1.SGDOptimizer;var tensor_2=require("./tensor");exports.Tensor=tensor_2.Tensor,exports.TensorBuffer=tensor_2.TensorBuffer,exports.variable=tensor_2.variable,exports.Variable=tensor_2.Variable;var types_1=require("./types");exports.Rank=types_1.Rank,__export(require("./ops/ops"));var loss_ops_1=require("./ops/loss_ops");exports.Reduction=loss_ops_1.Reduction,__export(require("./train")),__export(require("./globals"));var environment_2=require("./environment");exports.ENV=environment_2.ENV,exports.Environment=environment_2.Environment,exports.setBackend=environment_1.Environment.setBackend,exports.getBackend=environment_1.Environment.getBackend,exports.disposeVariables=environment_1.Environment.disposeVariables,exports.memory=environment_1.Environment.memory;var backend_1=require("./kernels/backend");exports.KernelBackend=backend_1.KernelBackend,exports.DataStorage=backend_1.DataStorage;var ops=require("./ops/ops");tensor_1.setOpHandler(ops)},{"./browser_util":54,"./environment":58,"./globals":60,"./io/io":66,"./kernels/backend":74,"./kernels/backend_cpu":75,"./kernels/backend_webgl":77,"./math":141,"./ops/loss_ops":161,"./ops/ops":168,"./optimizers/adadelta_optimizer":191,"./optimizers/adagrad_optimizer":192,"./optimizers/adam_optimizer":193,"./optimizers/adamax_optimizer":194,"./optimizers/momentum_optimizer":195,"./optimizers/optimizer":196,"./optimizers/rmsprop_optimizer":198,"./optimizers/sgd_optimizer":199,"./serialization":201,"./tensor":203,"./test_util":207,"./train":208,"./types":209,"./util":210,"./version":211,"./webgl":212}],63:[function(require,module,exports){"use strict";function browserDownloads(fileNamePrefix){return void 0===fileNamePrefix&&(fileNamePrefix="model"),new BrowserDownloads(fileNamePrefix)}function browserFiles(files){return new BrowserFiles(files)}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),io_utils_1=require("./io_utils"),router_registry_1=require("./router_registry"),DEFAULT_FILE_NAME_PREFIX="model",DEFAULT_JSON_EXTENSION_NAME=".json",DEFAULT_WEIGHT_DATA_EXTENSION_NAME=".weights.bin",BrowserDownloads=function(){function BrowserDownloads(fileNamePrefix){if(!environment_1.ENV.get("IS_BROWSER"))throw new Error("triggerDownloads() cannot proceed because the current environment is not a browser.");fileNamePrefix.startsWith(BrowserDownloads.URL_SCHEME)&&(fileNamePrefix=fileNamePrefix.slice(BrowserDownloads.URL_SCHEME.length)),null!=fileNamePrefix&&0!==fileNamePrefix.length||(fileNamePrefix=DEFAULT_FILE_NAME_PREFIX),this.modelTopologyFileName=fileNamePrefix+DEFAULT_JSON_EXTENSION_NAME,this.weightDataFileName=fileNamePrefix+DEFAULT_WEIGHT_DATA_EXTENSION_NAME}return BrowserDownloads.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){var weightsURL,weightsManifest,modelTopologyAndWeightManifest,modelTopologyAndWeightManifestURL,jsonAnchor,weightDataAnchor;return __generator(this,function(_a){if(weightsURL=window.URL.createObjectURL(new Blob([modelArtifacts.weightData],{type:"application/octet-stream"})),modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("DownloadTrigger.save() does not support saving model topology in binary formats yet.");return weightsManifest=[{paths:["./"+this.weightDataFileName],weights:modelArtifacts.weightSpecs}],modelTopologyAndWeightManifest={modelTopology:modelArtifacts.modelTopology,weightsManifest:weightsManifest},modelTopologyAndWeightManifestURL=window.URL.createObjectURL(new Blob([JSON.stringify(modelTopologyAndWeightManifest)],{type:"application/json"})),jsonAnchor=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor,jsonAnchor.download=this.modelTopologyFileName,jsonAnchor.href=modelTopologyAndWeightManifestURL,jsonAnchor.click(),null!=modelArtifacts.weightData&&(weightDataAnchor=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor,weightDataAnchor.download=this.weightDataFileName,weightDataAnchor.href=weightsURL,weightDataAnchor.click()),[2,{modelArtifactsInfo:io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts)}]})})},BrowserDownloads.URL_SCHEME="downloads://",BrowserDownloads}();exports.BrowserDownloads=BrowserDownloads;var BrowserFiles=function(){function BrowserFiles(files){if(null==files||files.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+files);this.files=files}return BrowserFiles.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var jsonFile,weightFiles,_this=this;return __generator(this,function(_a){return jsonFile=this.files[0],weightFiles=this.files.slice(1),[2,new Promise(function(resolve,reject){var jsonReader=new FileReader;jsonReader.onload=function(event){var modelJSON=JSON.parse(event.target.result),modelTopology=modelJSON.modelTopology;if(null==modelTopology)return void reject(new Error("modelTopology field is missing from file "+jsonFile.name));0===weightFiles.length&&resolve({modelTopology:modelTopology});var weightsManifest=modelJSON.weightsManifest;if(null==weightsManifest)return void reject(new Error("weightManifest field is missing from file "+jsonFile.name));var pathToFile;try{pathToFile=_this.checkManifestAndWeightFiles(weightsManifest,weightFiles)}catch(err){return void reject(err)}var weightSpecs=[],paths=[],perFileBuffers=[];weightsManifest.forEach(function(weightsGroup){weightsGroup.paths.forEach(function(path){paths.push(path),perFileBuffers.push(null)}),weightSpecs.push.apply(weightSpecs,weightsGroup.weights)}),weightsManifest.forEach(function(weightsGroup){weightsGroup.paths.forEach(function(path){var weightFileReader=new FileReader;weightFileReader.onload=function(event){var weightData=event.target.result,index=paths.indexOf(path);perFileBuffers[index]=weightData,-1===perFileBuffers.indexOf(null)&&resolve({modelTopology:modelTopology,weightSpecs:weightSpecs,weightData:io_utils_1.concatenateArrayBuffers(perFileBuffers)})},weightFileReader.onerror=function(error){reject("Failed to weights data from file of path '"+path+"'.")},weightFileReader.readAsArrayBuffer(pathToFile[path])})})},jsonReader.onerror=function(error){reject("Failed to read model topology and weights manifest JSON from file '"+jsonFile.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},jsonReader.readAsText(jsonFile)})]})})},BrowserFiles.prototype.checkManifestAndWeightFiles=function(manifest,files){for(var basenames=[],fileNames=files.map(function(file){return io_utils_1.basename(file.name)}),pathToFile={},_i=0,manifest_1=manifest;_i<manifest_1.length;_i++){manifest_1[_i].paths.forEach(function(path){var pathBasename=io_utils_1.basename(path);if(-1!==basenames.indexOf(pathBasename))throw new Error("Duplicate file basename found in weights manifest: '"+pathBasename+"'");if(basenames.push(pathBasename),-1===fileNames.indexOf(pathBasename))throw new Error("Weight file with basename '"+pathBasename+"' is not provided.");pathToFile[path]=files[fileNames.indexOf(pathBasename)]})}if(basenames.length!==files.length)throw new Error("Mismatch in the number of files in weights manifest ("+basenames.length+") and the number of weight files provided ("+files.length+").");return pathToFile},BrowserFiles}();exports.browserDownloadsRouter=function(url){return environment_1.ENV.get("IS_BROWSER")&&!Array.isArray(url)&&url.startsWith(BrowserDownloads.URL_SCHEME)?browserDownloads(url.slice(BrowserDownloads.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.browserDownloadsRouter),exports.browserDownloads=browserDownloads,exports.browserFiles=browserFiles},{"../environment":58,"./io_utils":67,"./router_registry":71}],64:[function(require,module,exports){"use strict";function parseUrl(url){var lastSlash=url.lastIndexOf("/"),lastSearchParam=url.lastIndexOf("?");return[url.substring(0,lastSlash)+"/",lastSearchParam>lastSlash?url.substring(lastSearchParam):""]}function isHTTPScheme(url){return null!=url.match(BrowserHTTPRequest.URL_SCHEME_REGEX)}function browserHTTPRequest(path,requestInit,weightPathPrefix){return new BrowserHTTPRequest(path,requestInit,weightPathPrefix)}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util"),io_utils_1=require("./io_utils"),router_registry_1=require("./router_registry"),weights_loader_1=require("./weights_loader"),BrowserHTTPRequest=function(){function BrowserHTTPRequest(path,requestInit,weightPathPrefix){if(this.weightPathPrefix=weightPathPrefix,this.DEFAULT_METHOD="POST","undefined"==typeof fetch)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");if(util_1.assert(null!=path&&path.length>0,"URL path for browserHTTPRequest must not be null, undefined or empty."),Array.isArray(path)&&util_1.assert(2===path.length,"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+path.length+")."),this.path=path,null!=requestInit&&null!=requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=requestInit||{}}return BrowserHTTPRequest.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){var init,weightsManifest,modelTopologyAndWeightManifest,response;return __generator(this,function(_a){switch(_a.label){case 0:if(modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return init=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),init.body=new FormData,weightsManifest=[{paths:["./model.weights.bin"],weights:modelArtifacts.weightSpecs}],modelTopologyAndWeightManifest={modelTopology:modelArtifacts.modelTopology,weightsManifest:weightsManifest},init.body.append("model.json",new Blob([JSON.stringify(modelTopologyAndWeightManifest)],{type:"application/json"}),"model.json"),null!=modelArtifacts.weightData&&init.body.append("model.weights.bin",new Blob([modelArtifacts.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,fetch(this.path,init)];case 1:if(response=_a.sent(),response.ok)return[2,{modelArtifactsInfo:io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts),responses:[response]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+response.status+".")}})})},BrowserHTTPRequest.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]})})},BrowserHTTPRequest.prototype.loadBinaryTopology=function(){return __awaiter(this,void 0,void 0,function(){var response,error_1;return __generator(this,function(_a){switch(_a.label){case 0:return _a.trys.push([0,3,,4]),[4,fetch(this.path[0],this.requestInit)];case 1:if(response=_a.sent(),!response.ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+response.statusText);return[4,response.arrayBuffer()];case 2:return[2,_a.sent()];case 3:throw error_1=_a.sent(),new Error(this.path[0]+" not found. "+error_1);case 4:return[2]}})})},BrowserHTTPRequest.prototype.loadBinaryModel=function(){return __awaiter(this,void 0,void 0,function(){var graphPromise,manifestPromise,results,modelTopology,weightsManifestResponse,weightsManifest,weightSpecs,weightData,results_1;return __generator(this,function(_a){switch(_a.label){case 0:return graphPromise=this.loadBinaryTopology(),[4,fetch(this.path[1],this.requestInit)];case 1:if(manifestPromise=_a.sent(),!manifestPromise.ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+manifestPromise.statusText);return[4,Promise.all([graphPromise,manifestPromise])];case 2:return results=_a.sent(),modelTopology=results[0],weightsManifestResponse=results[1],[4,weightsManifestResponse.json()];case 3:return weightsManifest=_a.sent(),null==weightsManifest?[3,5]:[4,this.loadWeights(weightsManifest)];case 4:results_1=_a.sent(),weightSpecs=results_1[0],weightData=results_1[1],_a.label=5;case 5:return[2,{modelTopology:modelTopology,weightSpecs:weightSpecs,weightData:weightData}]}})})},BrowserHTTPRequest.prototype.loadJSONModel=function(){return __awaiter(this,void 0,void 0,function(){var modelConfigRequest,modelConfig,modelTopology,weightsManifest,weightSpecs,weightData,weightsManifest_1,results;return __generator(this,function(_a){switch(_a.label){case 0:return[4,fetch(this.path,this.requestInit)];case 1:if(modelConfigRequest=_a.sent(),!modelConfigRequest.ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+modelConfigRequest.statusText);return[4,modelConfigRequest.json()];case 2:if(modelConfig=_a.sent(),modelTopology=modelConfig.modelTopology,weightsManifest=modelConfig.weightsManifest,null==modelTopology&&null==weightsManifest)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==weightsManifest?[3,4]:(weightsManifest_1=modelConfig.weightsManifest,[4,this.loadWeights(weightsManifest_1)]);case 3:results=_a.sent(),weightSpecs=results[0],weightData=results[1],_a.label=4;case 4:return[2,{modelTopology:modelTopology,weightSpecs:weightSpecs,weightData:weightData}]}})})},BrowserHTTPRequest.prototype.loadWeights=function(weightsManifest){return __awaiter(this,void 0,void 0,function(){var weightPath,_a,prefix,suffix,pathPrefix,weightSpecs,_i,weightsManifest_2,entry,fetchURLs,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:for(weightPath=Array.isArray(this.path)?this.path[1]:this.path,_a=parseUrl(weightPath),prefix=_a[0],suffix=_a[1],pathPrefix=this.weightPathPrefix||prefix,weightSpecs=[],_i=0,weightsManifest_2=weightsManifest;_i<weightsManifest_2.length;_i++)entry=weightsManifest_2[_i],weightSpecs.push.apply(weightSpecs,entry.weights);return fetchURLs=[],weightsManifest.forEach(function(weightsGroup){weightsGroup.paths.forEach(function(path){fetchURLs.push(pathPrefix+path+suffix)})}),_b=[weightSpecs],_c=io_utils_1.concatenateArrayBuffers,[4,weights_loader_1.loadWeightsAsArrayBuffer(fetchURLs,this.requestInit)];case 1:return[2,_b.concat([_c.apply(void 0,[_d.sent()])])]}})})},BrowserHTTPRequest.URL_SCHEME_REGEX=/^https?:\/\//,BrowserHTTPRequest}();exports.BrowserHTTPRequest=BrowserHTTPRequest,exports.parseUrl=parseUrl,exports.httpRequestRouter=function(url){if("undefined"==typeof fetch)return null;return(Array.isArray(url)?url.every(function(urlItem){return isHTTPScheme(urlItem)}):isHTTPScheme(url))?browserHTTPRequest(url):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.httpRequestRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.httpRequestRouter),exports.browserHTTPRequest=browserHTTPRequest},{"../util":210,"./io_utils":67,"./router_registry":71,"./weights_loader":73}],65:[function(require,module,exports){"use strict";function deleteDatabase(){return __awaiter(this,void 0,void 0,function(){var idbFactory;return __generator(this,function(_a){return idbFactory=getIndexedDBFactory(),[2,new Promise(function(resolve,reject){var deleteRequest=idbFactory.deleteDatabase(DATABASE_NAME);deleteRequest.onsuccess=function(){return resolve()},deleteRequest.onerror=function(error){return reject(error)}})]})})}function getIndexedDBFactory(){if(!environment_1.ENV.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var theWindow=window,factory=theWindow.indexedDB||theWindow.mozIndexedDB||theWindow.webkitIndexedDB||theWindow.msIndexedDB||theWindow.shimIndexedDB;if(null==factory)throw new Error("The current browser does not appear to support IndexedDB.");return factory}function setUpDatabase(openRequest){var db=openRequest.result;db.createObjectStore(MODEL_STORE_NAME,{keyPath:"modelPath"}),db.createObjectStore(INFO_STORE_NAME,{keyPath:"modelPath"})}function browserIndexedDB(modelPath){return new BrowserIndexedDB(modelPath)}function maybeStripScheme(key){return key.startsWith(BrowserIndexedDB.URL_SCHEME)?key.slice(BrowserIndexedDB.URL_SCHEME.length):key}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),io_utils_1=require("./io_utils"),model_management_1=require("./model_management"),router_registry_1=require("./router_registry"),DATABASE_NAME="tensorflowjs",MODEL_STORE_NAME="models_store",INFO_STORE_NAME="model_info_store";exports.deleteDatabase=deleteDatabase;var BrowserIndexedDB=function(){function BrowserIndexedDB(modelPath){if(this.indexedDB=getIndexedDBFactory(),null==modelPath||!modelPath)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=modelPath}return BrowserIndexedDB.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,modelArtifacts)]})})},BrowserIndexedDB.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.databaseAction(this.modelPath)]})})},BrowserIndexedDB.prototype.databaseAction=function(modelPath,modelArtifacts){var _this=this;return new Promise(function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,1);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)},openRequest.onsuccess=function(){var db=openRequest.result;if(null==modelArtifacts){var modelTx=db.transaction(MODEL_STORE_NAME,"readonly"),modelStore=modelTx.objectStore(MODEL_STORE_NAME),getRequest_1=modelStore.get(_this.modelPath);getRequest_1.onsuccess=function(){if(null==getRequest_1.result)return db.close(),reject(new Error("Cannot find model with path '"+_this.modelPath+"' in IndexedDB."));resolve(getRequest_1.result.modelArtifacts)},getRequest_1.onerror=function(error){return db.close(),reject(getRequest_1.error)},modelTx.oncomplete=function(){return db.close()}}else{var modelTx_1,modelArtifactsInfo_1=io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts),infoTx_1=db.transaction(INFO_STORE_NAME,"readwrite"),infoStore_1=infoTx_1.objectStore(INFO_STORE_NAME),putInfoRequest_1=infoStore_1.put({modelPath:_this.modelPath,modelArtifactsInfo:modelArtifactsInfo_1});putInfoRequest_1.onsuccess=function(){modelTx_1=db.transaction(MODEL_STORE_NAME,"readwrite");var modelStore=modelTx_1.objectStore(MODEL_STORE_NAME),putModelRequest=modelStore.put({modelPath:_this.modelPath,modelArtifacts:modelArtifacts,modelArtifactsInfo:modelArtifactsInfo_1});putModelRequest.onsuccess=function(){return resolve({modelArtifactsInfo:modelArtifactsInfo_1})},putModelRequest.onerror=function(error){infoStore_1=infoTx_1.objectStore(INFO_STORE_NAME);var deleteInfoRequest=infoStore_1.delete(_this.modelPath);deleteInfoRequest.onsuccess=function(){return db.close(),reject(putModelRequest.error)},deleteInfoRequest.onerror=function(error){return db.close(),reject(putModelRequest.error)}}},putInfoRequest_1.onerror=function(error){return db.close(),reject(putInfoRequest_1.error)},infoTx_1.oncomplete=function(){null==modelTx_1?db.close():modelTx_1.oncomplete=function(){return db.close()}}}},openRequest.onerror=function(error){return reject(openRequest.error)}})},BrowserIndexedDB.URL_SCHEME="indexeddb://",BrowserIndexedDB}();exports.BrowserIndexedDB=BrowserIndexedDB,exports.indexedDBRouter=function(url){return environment_1.ENV.get("IS_BROWSER")&&!Array.isArray(url)&&url.startsWith(BrowserIndexedDB.URL_SCHEME)?browserIndexedDB(url.slice(BrowserIndexedDB.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.indexedDBRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.indexedDBRouter),exports.browserIndexedDB=browserIndexedDB;var BrowserIndexedDBManager=function(){function BrowserIndexedDBManager(){this.indexedDB=getIndexedDBFactory()}return BrowserIndexedDBManager.prototype.listModels=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,new Promise(function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,1);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)},openRequest.onsuccess=function(){var db=openRequest.result,tx=db.transaction(INFO_STORE_NAME,"readonly"),store=tx.objectStore(INFO_STORE_NAME),getAllInfoRequest=store.getAll();getAllInfoRequest.onsuccess=function(){for(var out={},_i=0,_a=getAllInfoRequest.result;_i<_a.length;_i++){var item=_a[_i];out[item.modelPath]=item.modelArtifactsInfo}resolve(out)},getAllInfoRequest.onerror=function(error){return db.close(),reject(getAllInfoRequest.error)},tx.oncomplete=function(){return db.close()}},openRequest.onerror=function(error){return reject(openRequest.error)}})]})})},BrowserIndexedDBManager.prototype.removeModel=function(path){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return path=maybeStripScheme(path),[2,new Promise(function(resolve,reject){var openRequest=_this.indexedDB.open(DATABASE_NAME,1);openRequest.onupgradeneeded=function(){return setUpDatabase(openRequest)},openRequest.onsuccess=function(){var modelTx,db=openRequest.result,infoTx=db.transaction(INFO_STORE_NAME,"readwrite"),infoStore=infoTx.objectStore(INFO_STORE_NAME),getInfoRequest=infoStore.get(path);getInfoRequest.onsuccess=function(){if(null==getInfoRequest.result)return db.close(),reject(new Error("Cannot find model with path '"+path+"' in IndexedDB."));var deleteInfoRequest=infoStore.delete(path),deleteModelData_1=function(){modelTx=db.transaction(MODEL_STORE_NAME,"readwrite");var modelStore=modelTx.objectStore(MODEL_STORE_NAME),deleteModelRequest=modelStore.delete(path);deleteModelRequest.onsuccess=function(){return resolve(getInfoRequest.result.modelArtifactsInfo)},deleteModelRequest.onerror=function(error){return reject(getInfoRequest.error)}};deleteInfoRequest.onsuccess=deleteModelData_1,deleteInfoRequest.onerror=function(error){return deleteModelData_1(),db.close(),reject(getInfoRequest.error)}},getInfoRequest.onerror=function(error){return db.close(),reject(getInfoRequest.error)},infoTx.oncomplete=function(){null==modelTx?db.close():modelTx.oncomplete=function(){return db.close()}}},openRequest.onerror=function(error){return reject(openRequest.error)}})]})})},BrowserIndexedDBManager}();if(exports.BrowserIndexedDBManager=BrowserIndexedDBManager,environment_1.ENV.get("IS_BROWSER"))try{model_management_1.ModelStoreManagerRegistry.registerManager(BrowserIndexedDB.URL_SCHEME,new BrowserIndexedDBManager)}catch(err){}},{"../environment":58,"./io_utils":67,"./model_management":69,"./router_registry":71}],66:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("./indexed_db"),require("./local_storage");var browser_files_1=require("./browser_files");exports.browserFiles=browser_files_1.browserFiles;var browser_http_1=require("./browser_http");exports.browserHTTPRequest=browser_http_1.browserHTTPRequest;var io_utils_1=require("./io_utils");exports.concatenateArrayBuffers=io_utils_1.concatenateArrayBuffers,exports.decodeWeights=io_utils_1.decodeWeights,exports.encodeWeights=io_utils_1.encodeWeights,exports.getModelArtifactsInfoForJSON=io_utils_1.getModelArtifactsInfoForJSON;var passthrough_1=require("./passthrough");exports.fromMemory=passthrough_1.fromMemory,exports.withSaveHandler=passthrough_1.withSaveHandler;var router_registry_1=require("./router_registry"),weights_loader_1=require("./weights_loader");exports.loadWeights=weights_loader_1.loadWeights;var registerSaveRouter=router_registry_1.IORouterRegistry.registerSaveRouter;exports.registerSaveRouter=registerSaveRouter;var registerLoadRouter=router_registry_1.IORouterRegistry.registerLoadRouter;exports.registerLoadRouter=registerLoadRouter;var getSaveHandlers=router_registry_1.IORouterRegistry.getSaveHandlers;exports.getSaveHandlers=getSaveHandlers;var getLoadHandlers=router_registry_1.IORouterRegistry.getLoadHandlers;exports.getLoadHandlers=getLoadHandlers;var model_management_1=require("./model_management");exports.copyModel=model_management_1.copyModel,exports.listModels=model_management_1.listModels,exports.moveModel=model_management_1.moveModel,exports.removeModel=model_management_1.removeModel},{"./browser_files":63,"./browser_http":64,"./indexed_db":65,"./io_utils":67,"./local_storage":68,"./model_management":69,"./passthrough":70,"./router_registry":71,"./weights_loader":73}],67:[function(require,module,exports){(function(Buffer){"use strict";function encodeWeights(tensors){return __awaiter(this,void 0,void 0,function(){var specs,dataPromises,name_1,t,tensorValues;return __generator(this,function(_a){switch(_a.label){case 0:specs=[],dataPromises=[];for(name_1 in tensors){if(t=tensors[name_1],"float32"!==t.dtype&&"int32"!==t.dtype&&"bool"!==t.dtype)throw new Error("Unsupported dtype in weight '"+name_1+"': "+t.dtype);specs.push({name:name_1,shape:t.shape,dtype:t.dtype}),dataPromises.push(t.data())}return[4,Promise.all(dataPromises)];case 1:return tensorValues=_a.sent(),[2,{data:concatenateTypedArrays(tensorValues),specs:specs}]}})})}function decodeWeights(buffer,specs){for(var out={},offset=0,_i=0,specs_1=specs;_i<specs_1.length;_i++){var spec=specs_1[_i];!function(spec){var name_2=spec.name,dtype=spec.dtype,shape=spec.shape,size=util_1.sizeFromShape(shape),typedArray=void 0;if("quantization"in spec){var quantization_1=spec.quantization;if("uint8"!==quantization_1.dtype&&"uint16"!==quantization_1.dtype)throw new Error("Weight "+spec.name+" has unknown quantization dtype "+quantization_1.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var quantizationSizeFactor=types_1.DTYPE_VALUE_SIZE_MAP[quantization_1.dtype],byteBuffer=buffer.slice(offset,offset+size*quantizationSizeFactor),quantizedArray="uint8"===quantization_1.dtype?new Uint8Array(byteBuffer):new Uint16Array(byteBuffer);if("float32"===dtype)typedArray=Float32Array.from(quantizedArray,function(v){return v*quantization_1.scale+quantization_1.min});else{if("int32"!==dtype)throw new Error("Unsupported dtype in weight '"+name_2+"': "+dtype);typedArray=Int32Array.from(quantizedArray,function(v){return Math.round(v*quantization_1.scale+quantization_1.min)})}offset+=size*quantizationSizeFactor}else{var dtypeFactor=types_1.DTYPE_VALUE_SIZE_MAP[dtype],byteBuffer=buffer.slice(offset,offset+size*dtypeFactor);if("float32"===dtype)typedArray=new Float32Array(byteBuffer);else if("int32"===dtype)typedArray=new Int32Array(byteBuffer);else{if("bool"!==dtype)throw new Error("Unsupported dtype in weight '"+name_2+"': "+dtype);typedArray=new Uint8Array(byteBuffer)}offset+=size*dtypeFactor}var value=void 0;if("float32"===dtype)value=tensor_ops_1.tensor(typedArray,shape,"float32");else if("int32"===dtype)value=tensor_ops_1.tensor(typedArray,shape,"int32");else{
if("bool"!==dtype)throw new Error("Unsupported dtype in weight '"+name_2+"': "+dtype);value=tensor_ops_1.tensor(typedArray,shape,"bool")}out[name_2]=value}(spec)}return out}function concatenateTypedArrays(xs){if(null===xs)throw new Error("Invalid input value: "+JSON.stringify(xs));var totalByteLength=0,normalizedXs=[];xs.forEach(function(x){if(totalByteLength+=x.byteLength,normalizedXs.push(x.byteLength===x.buffer.byteLength?x:new x.constructor(x)),!(x instanceof Float32Array||x instanceof Int32Array||x instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+x.constructor.name)});var y=new Uint8Array(totalByteLength),offset=0;return normalizedXs.forEach(function(x){y.set(new Uint8Array(x.buffer),offset),offset+=x.byteLength}),y.buffer}function stringByteLength(str){return useNodeBuffer?Buffer.byteLength(str):new Blob([str]).size}function arrayBufferToBase64String(buffer){return useNodeBuffer?Buffer.from(buffer).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(buffer)))}function base64StringToArrayBuffer(str){if(useNodeBuffer){var buf=Buffer.from(str,"base64");return buf.buffer.slice(buf.byteOffset,buf.byteOffset+buf.byteLength)}for(var s=atob(str),buffer=new Uint8Array(s.length),i=0;i<s.length;++i)buffer.set([s.charCodeAt(i)],i);return buffer.buffer}function concatenateArrayBuffers(buffers){var totalByteLength=0;buffers.forEach(function(buffer){totalByteLength+=buffer.byteLength});var temp=new Uint8Array(totalByteLength),offset=0;return buffers.forEach(function(buffer){temp.set(new Uint8Array(buffer),offset),offset+=buffer.byteLength}),temp.buffer}function basename(path){for(path=path.trim();path.endsWith("/");)path=path.slice(0,path.length-1);var items=path.split("/");return items[items.length-1]}function getModelArtifactsInfoForJSON(modelArtifacts){if(modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==modelArtifacts.modelTopology?0:stringByteLength(JSON.stringify(modelArtifacts.modelTopology)),weightSpecsBytes:null==modelArtifacts.weightSpecs?0:stringByteLength(JSON.stringify(modelArtifacts.weightSpecs)),weightDataBytes:null==modelArtifacts.weightData?0:modelArtifacts.weightData.byteLength}}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),util_1=require("../util"),types_1=require("./types");exports.encodeWeights=encodeWeights,exports.decodeWeights=decodeWeights,exports.concatenateTypedArrays=concatenateTypedArrays;var useNodeBuffer=void 0!==Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);exports.stringByteLength=stringByteLength,exports.arrayBufferToBase64String=arrayBufferToBase64String,exports.base64StringToArrayBuffer=base64StringToArrayBuffer,exports.concatenateArrayBuffers=concatenateArrayBuffers,exports.basename=basename,exports.getModelArtifactsInfoForJSON=getModelArtifactsInfoForJSON}).call(this,require("buffer").Buffer)},{"../ops/tensor_ops":187,"../util":210,"./types":72,buffer:10}],68:[function(require,module,exports){"use strict";function purgeLocalStorageArtifacts(){if(!environment_1.ENV.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("purgeLocalStorageModels() cannot proceed because local storage is unavailable in the current environment.");for(var LS=window.localStorage,purgedModelPaths=[],i=0;i<LS.length;++i){var key=LS.key(i),prefix=PATH_PREFIX+PATH_SEPARATOR;if(key.startsWith(prefix)&&key.length>prefix.length){LS.removeItem(key);var modelName=getModelPathFromKey(key);-1===purgedModelPaths.indexOf(modelName)&&purgedModelPaths.push(modelName)}}return purgedModelPaths}function getModelKeys(path){return{info:[PATH_PREFIX,path,INFO_SUFFIX].join(PATH_SEPARATOR),topology:[PATH_PREFIX,path,MODEL_TOPOLOGY_SUFFIX].join(PATH_SEPARATOR),weightSpecs:[PATH_PREFIX,path,WEIGHT_SPECS_SUFFIX].join(PATH_SEPARATOR),weightData:[PATH_PREFIX,path,WEIGHT_DATA_SUFFIX].join(PATH_SEPARATOR)}}function getModelPathFromKey(key){var items=key.split(PATH_SEPARATOR);if(items.length<3)throw new Error("Invalid key format: "+key);return items.slice(1,items.length-1).join(PATH_SEPARATOR)}function maybeStripScheme(key){return key.startsWith(BrowserLocalStorage.URL_SCHEME)?key.slice(BrowserLocalStorage.URL_SCHEME.length):key}function browserLocalStorage(modelPath){return new BrowserLocalStorage(modelPath)}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),util_1=require("../util"),io_utils_1=require("./io_utils"),model_management_1=require("./model_management"),router_registry_1=require("./router_registry"),PATH_SEPARATOR="/",PATH_PREFIX="tensorflowjs_models",INFO_SUFFIX="info",MODEL_TOPOLOGY_SUFFIX="model_topology",WEIGHT_SPECS_SUFFIX="weight_specs",WEIGHT_DATA_SUFFIX="weight_data";exports.purgeLocalStorageArtifacts=purgeLocalStorageArtifacts;var BrowserLocalStorage=function(){function BrowserLocalStorage(modelPath){if(!environment_1.ENV.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==modelPath||!modelPath)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=modelPath,this.keys=getModelKeys(this.modelPath)}return BrowserLocalStorage.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){var topology,weightSpecs,modelArtifactsInfo,key;return __generator(this,function(_a){if(modelArtifacts.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");topology=JSON.stringify(modelArtifacts.modelTopology),weightSpecs=JSON.stringify(modelArtifacts.weightSpecs),modelArtifactsInfo=io_utils_1.getModelArtifactsInfoForJSON(modelArtifacts);try{return this.LS.setItem(this.keys.info,JSON.stringify(modelArtifactsInfo)),this.LS.setItem(this.keys.topology,topology),this.LS.setItem(this.keys.weightSpecs,weightSpecs),this.LS.setItem(this.keys.weightData,io_utils_1.arrayBufferToBase64String(modelArtifacts.weightData)),[2,{modelArtifactsInfo:modelArtifactsInfo}]}catch(err){for(key in this.keys)this.LS.removeItem(this.keys[key]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+modelArtifactsInfo.modelTopologyBytes+", weightSpecsBytes="+modelArtifactsInfo.weightSpecsBytes+", weightDataBytes="+modelArtifactsInfo.weightDataBytes+".")}return[2]})})},BrowserLocalStorage.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var info,out,topology,weightSpecs,weightDataBase64;return __generator(this,function(_a){if(null==(info=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==info.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(out={},null==(topology=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(out.modelTopology=topology,null==(weightSpecs=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(out.weightSpecs=weightSpecs,null==(weightDataBase64=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return out.weightData=io_utils_1.base64StringToArrayBuffer(weightDataBase64),[2,out]})})},BrowserLocalStorage.URL_SCHEME="localstorage://",BrowserLocalStorage}();exports.BrowserLocalStorage=BrowserLocalStorage,exports.localStorageRouter=function(url){return environment_1.ENV.get("IS_BROWSER")&&!Array.isArray(url)&&url.startsWith(BrowserLocalStorage.URL_SCHEME)?browserLocalStorage(url.slice(BrowserLocalStorage.URL_SCHEME.length)):null},router_registry_1.IORouterRegistry.registerSaveRouter(exports.localStorageRouter),router_registry_1.IORouterRegistry.registerLoadRouter(exports.localStorageRouter),exports.browserLocalStorage=browserLocalStorage;var BrowserLocalStorageManager=function(){function BrowserLocalStorageManager(){util_1.assert(environment_1.ENV.get("IS_BROWSER"),"Current environment is not a web browser"),util_1.assert(void 0!==window.localStorage,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return BrowserLocalStorageManager.prototype.listModels=function(){return __awaiter(this,void 0,void 0,function(){var out,prefix,suffix,i,key,modelPath;return __generator(this,function(_a){for(out={},prefix=PATH_PREFIX+PATH_SEPARATOR,suffix=PATH_SEPARATOR+INFO_SUFFIX,i=0;i<this.LS.length;++i)key=this.LS.key(i),key.startsWith(prefix)&&key.endsWith(suffix)&&(modelPath=getModelPathFromKey(key),out[modelPath]=JSON.parse(this.LS.getItem(key)));return[2,out]})})},BrowserLocalStorageManager.prototype.removeModel=function(path){return __awaiter(this,void 0,void 0,function(){var keys,info;return __generator(this,function(_a){if(path=maybeStripScheme(path),keys=getModelKeys(path),null==this.LS.getItem(keys.info))throw new Error("Cannot find model at path '"+path+"'");return info=JSON.parse(this.LS.getItem(keys.info)),this.LS.removeItem(keys.info),this.LS.removeItem(keys.topology),this.LS.removeItem(keys.weightSpecs),this.LS.removeItem(keys.weightData),[2,info]})})},BrowserLocalStorageManager}();if(exports.BrowserLocalStorageManager=BrowserLocalStorageManager,environment_1.ENV.get("IS_BROWSER"))try{model_management_1.ModelStoreManagerRegistry.registerManager(BrowserLocalStorage.URL_SCHEME,new BrowserLocalStorageManager)}catch(err){}},{"../environment":58,"../util":210,"./io_utils":67,"./model_management":69,"./router_registry":71}],69:[function(require,module,exports){"use strict";function parseURL(url){if(-1===url.indexOf(URL_SCHEME_SUFFIX))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+ModelStoreManagerRegistry.getSchemes().join(","));return{scheme:url.split(URL_SCHEME_SUFFIX)[0],path:url.split(URL_SCHEME_SUFFIX)[1]}}function cloneModelInternal(sourceURL,destURL,deleteSource){return void 0===deleteSource&&(deleteSource=!1),__awaiter(this,void 0,void 0,function(){var loadHandlers,loadHandler,saveHandlers,saveHandler,sourceScheme,sourcePath,sameMedium,modelArtifacts,saveResult;return __generator(this,function(_a){switch(_a.label){case 0:return util_1.assert(sourceURL!==destURL,"Old path and new path are the same: '"+sourceURL+"'"),loadHandlers=router_registry_1.IORouterRegistry.getLoadHandlers(sourceURL),util_1.assert(loadHandlers.length>0,"Copying failed because no load handler is found for source URL "+sourceURL+"."),util_1.assert(loadHandlers.length<2,"Copying failed because more than one ("+loadHandlers.length+") load handlers for source URL "+sourceURL+"."),loadHandler=loadHandlers[0],saveHandlers=router_registry_1.IORouterRegistry.getSaveHandlers(destURL),util_1.assert(saveHandlers.length>0,"Copying failed because no save handler is found for destination URL "+destURL+"."),util_1.assert(saveHandlers.length<2,"Copying failed because more than one ("+loadHandlers.length+") save handlers for destination URL "+destURL+"."),saveHandler=saveHandlers[0],sourceScheme=parseURL(sourceURL).scheme,sourcePath=parseURL(sourceURL).path,sameMedium=sourceScheme===parseURL(sourceURL).scheme,[4,loadHandler.load()];case 1:return modelArtifacts=_a.sent(),deleteSource&&sameMedium?[4,ModelStoreManagerRegistry.getManager(sourceScheme).removeModel(sourcePath)]:[3,3];case 2:_a.sent(),_a.label=3;case 3:return[4,saveHandler.save(modelArtifacts)];case 4:return saveResult=_a.sent(),!deleteSource||sameMedium?[3,6]:[4,ModelStoreManagerRegistry.getManager(sourceScheme).removeModel(sourcePath)];case 5:_a.sent(),_a.label=6;case 6:return[2,saveResult.modelArtifactsInfo]}})})}function listModels(){return __awaiter(this,void 0,void 0,function(){var schemes,out,_i,schemes_1,scheme,schemeOut,path,url;return __generator(this,function(_a){switch(_a.label){case 0:schemes=ModelStoreManagerRegistry.getSchemes(),out={},_i=0,schemes_1=schemes,_a.label=1;case 1:return _i<schemes_1.length?(scheme=schemes_1[_i],[4,ModelStoreManagerRegistry.getManager(scheme).listModels()]):[3,4];case 2:schemeOut=_a.sent();for(path in schemeOut)url=scheme+URL_SCHEME_SUFFIX+path,out[url]=schemeOut[path];_a.label=3;case 3:return _i++,[3,1];case 4:return[2,out]}})})}function removeModel(url){return __awaiter(this,void 0,void 0,function(){var schemeAndPath,manager;return __generator(this,function(_a){switch(_a.label){case 0:return schemeAndPath=parseURL(url),manager=ModelStoreManagerRegistry.getManager(schemeAndPath.scheme),[4,manager.removeModel(schemeAndPath.path)];case 1:return[2,_a.sent()]}})})}function copyModel(sourceURL,destURL){return __awaiter(this,void 0,void 0,function(){var deleteSource;return __generator(this,function(_a){switch(_a.label){case 0:return deleteSource=!1,[4,cloneModelInternal(sourceURL,destURL,deleteSource)];case 1:return[2,_a.sent()]}})})}function moveModel(sourceURL,destURL){return __awaiter(this,void 0,void 0,function(){var deleteSource;return __generator(this,function(_a){switch(_a.label){case 0:return deleteSource=!0,[4,cloneModelInternal(sourceURL,destURL,deleteSource)];case 1:return[2,_a.sent()]}})})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util"),router_registry_1=require("./router_registry"),URL_SCHEME_SUFFIX="://",ModelStoreManagerRegistry=function(){function ModelStoreManagerRegistry(){this.managers={}}return ModelStoreManagerRegistry.getInstance=function(){return null==ModelStoreManagerRegistry.instance&&(ModelStoreManagerRegistry.instance=new ModelStoreManagerRegistry),ModelStoreManagerRegistry.instance},ModelStoreManagerRegistry.registerManager=function(scheme,manager){util_1.assert(null!=scheme,"scheme must not be undefined or null."),scheme.endsWith(URL_SCHEME_SUFFIX)&&(scheme=scheme.slice(0,scheme.indexOf(URL_SCHEME_SUFFIX))),util_1.assert(scheme.length>0,"scheme must not be an empty string.");var registry=ModelStoreManagerRegistry.getInstance();util_1.assert(null==registry.managers[scheme],"A model store manager is already registered for scheme '"+scheme+"'."),registry.managers[scheme]=manager},ModelStoreManagerRegistry.getManager=function(scheme){var manager=this.getInstance().managers[scheme];if(null==manager)throw new Error("Cannot find model manager for scheme '"+scheme+"'");return manager},ModelStoreManagerRegistry.getSchemes=function(){return Object.keys(this.getInstance().managers)},ModelStoreManagerRegistry}();exports.ModelStoreManagerRegistry=ModelStoreManagerRegistry,exports.listModels=listModels,exports.removeModel=removeModel,exports.copyModel=copyModel,exports.moveModel=moveModel},{"../util":210,"./router_registry":71}],70:[function(require,module,exports){"use strict";function fromMemory(modelTopology,weightSpecs,weightData){return new PassthroughLoader(modelTopology,weightSpecs,weightData)}function withSaveHandler(saveHandler){return new PassthroughSaver(saveHandler)}var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t},__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var PassthroughLoader=function(){function PassthroughLoader(modelTopology,weightSpecs,weightData){this.modelTopology=modelTopology,this.weightSpecs=weightSpecs,this.weightData=weightData}return PassthroughLoader.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,function(_a){return result={},null!=this.modelTopology&&(result=__assign({modelTopology:this.modelTopology},result)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(result=__assign({weightSpecs:this.weightSpecs},result)),null!=this.weightData&&this.weightData.byteLength>0&&(result=__assign({weightData:this.weightData},result)),[2,result]})})},PassthroughLoader}(),PassthroughSaver=function(){function PassthroughSaver(saveHandler){this.saveHandler=saveHandler}return PassthroughSaver.prototype.save=function(modelArtifacts){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.saveHandler(modelArtifacts)]})})},PassthroughSaver}();exports.fromMemory=fromMemory,exports.withSaveHandler=withSaveHandler},{}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var IORouterRegistry=function(){function IORouterRegistry(){this.saveRouters=[],this.loadRouters=[]}return IORouterRegistry.getInstance=function(){return null==IORouterRegistry.instance&&(IORouterRegistry.instance=new IORouterRegistry),IORouterRegistry.instance},IORouterRegistry.registerSaveRouter=function(saveRouter){IORouterRegistry.getInstance().saveRouters.push(saveRouter)},IORouterRegistry.registerLoadRouter=function(loadRouter){IORouterRegistry.getInstance().loadRouters.push(loadRouter)},IORouterRegistry.getSaveHandlers=function(url){return IORouterRegistry.getHandlers(url,"save")},IORouterRegistry.getLoadHandlers=function(url){return IORouterRegistry.getHandlers(url,"load")},IORouterRegistry.getHandlers=function(url,handlerType){var validHandlers=[];return("load"===handlerType?this.getInstance().loadRouters:this.getInstance().saveRouters).forEach(function(router){var handler=router(url);null!==handler&&validHandlers.push(handler)}),validHandlers},IORouterRegistry}();exports.IORouterRegistry=IORouterRegistry},{}],72:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DTYPE_VALUE_SIZE_MAP={float32:4,int32:4,uint16:2,uint8:1,bool:1}},{}],73:[function(require,module,exports){"use strict";function loadWeightsAsArrayBuffer(fetchURLs,requestOptions){return __awaiter(this,void 0,void 0,function(){var requests,responses,buffers;return __generator(this,function(_a){switch(_a.label){case 0:return requests=fetchURLs.map(function(fetchURL){return fetch(fetchURL,requestOptions)}),[4,Promise.all(requests)];case 1:return responses=_a.sent(),[4,Promise.all(responses.map(function(response){return response.arrayBuffer()}))];case 2:return buffers=_a.sent(),[2,buffers]}})})}function loadWeights(manifest,filePathPrefix,weightNames,requestOptions){return void 0===filePathPrefix&&(filePathPrefix=""),__awaiter(this,void 0,void 0,function(){var groupIndicesToFetchMap,groupWeightsToFetch,weightsFound,allManifestWeightNames,weightsNotFound,groupIndicesToFetch,fetchUrls,buffers,weightsTensorMap,bufferIndexOffset;return __generator(this,function(_a){switch(_a.label){case 0:if(groupIndicesToFetchMap=manifest.map(function(){return!1}),groupWeightsToFetch={},weightsFound=null!=weightNames?weightNames.map(function(){return!1}):[],allManifestWeightNames=[],manifest.forEach(function(manifestGroupConfig,groupIndex){var groupOffset=0;manifestGroupConfig.weights.forEach(function(weightsEntry){var rawDtype="quantization"in weightsEntry?weightsEntry.quantization.dtype:weightsEntry.dtype,weightsBytes=types_1.DTYPE_VALUE_SIZE_MAP[rawDtype]*util.sizeFromShape(weightsEntry.shape),enqueueWeightsForFetchingFn=function(){groupIndicesToFetchMap[groupIndex]=!0,null==groupWeightsToFetch[groupIndex]&&(groupWeightsToFetch[groupIndex]=[]),groupWeightsToFetch[groupIndex].push({manifestEntry:weightsEntry,groupOffset:groupOffset,sizeBytes:weightsBytes})};null!=weightNames?weightNames.forEach(function(weightName,weightIndex){weightName===weightsEntry.name&&(enqueueWeightsForFetchingFn(),weightsFound[weightIndex]=!0)}):enqueueWeightsForFetchingFn(),allManifestWeightNames.push(weightsEntry.name),groupOffset+=weightsBytes})}),!weightsFound.every(function(found){return found}))throw weightsNotFound=weightNames.filter(function(weight,i){return!weightsFound[i]}),new Error("Could not find weights in manifest with names: "+weightsNotFound.join(", ")+". \nManifest JSON has weights with names: "+allManifestWeightNames.join(", ")+".");return groupIndicesToFetch=groupIndicesToFetchMap.reduce(function(accumulator,shouldFetch,i){return shouldFetch&&accumulator.push(i),accumulator},[]),fetchUrls=[],groupIndicesToFetch.forEach(function(i){manifest[i].paths.forEach(function(filepath){var fetchUrl=filePathPrefix+(filePathPrefix.endsWith("/")?"":"/")+filepath;fetchUrls.push(fetchUrl)})}),[4,loadWeightsAsArrayBuffer(fetchUrls,requestOptions)];case 1:return buffers=_a.sent(),weightsTensorMap={},bufferIndexOffset=0,groupIndicesToFetch.forEach(function(i){for(var numBuffers=manifest[i].paths.length,groupBytes=0,i_1=0;i_1<numBuffers;i_1++)groupBytes+=buffers[bufferIndexOffset+i_1].byteLength;for(var groupBuffer=new ArrayBuffer(groupBytes),groupByteBuffer=new Uint8Array(groupBuffer),groupBufferOffset=0,i_2=0;i_2<numBuffers;i_2++){var buffer=new Uint8Array(buffers[bufferIndexOffset+i_2]);groupByteBuffer.set(buffer,groupBufferOffset),groupBufferOffset+=buffer.byteLength}groupWeightsToFetch[i].forEach(function(weightsEntry){var byteBuffer=groupBuffer.slice(weightsEntry.groupOffset,weightsEntry.groupOffset+weightsEntry.sizeBytes),nameToTensorMap=io_utils_1.decodeWeights(byteBuffer,[weightsEntry.manifestEntry]);for(var name_1 in nameToTensorMap)weightsTensorMap[name_1]=nameToTensorMap[name_1]}),bufferIndexOffset+=numBuffers}),[2,weightsTensorMap]}})})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util"),io_utils_1=require("./io_utils"),types_1=require("./types");exports.loadWeightsAsArrayBuffer=loadWeightsAsArrayBuffer,exports.loadWeights=loadWeights},{"../util":210,"./io_utils":67,"./types":72}],74:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DataStorage=function(){function DataStorage(dataMover){this.dataMover=dataMover,this.data=new WeakMap}return DataStorage.prototype.get=function(dataId){return this.data.has(dataId)||this.dataMover.moveData(dataId),this.data.get(dataId)},DataStorage.prototype.set=function(dataId,value){this.data.set(dataId,value)},DataStorage.prototype.has=function(dataId){return this.data.has(dataId)},DataStorage.prototype.delete=function(dataId){return this.data.delete(dataId)},DataStorage}();exports.DataStorage=DataStorage;var KernelBackend=function(){function KernelBackend(){}return KernelBackend.prototype.time=function(f){throw new Error("Not yet implemented.")},KernelBackend.prototype.read=function(dataId){throw new Error("Not yet implemented.")},KernelBackend.prototype.readSync=function(dataId){throw new Error("Not yet implemented.")},KernelBackend.prototype.disposeData=function(dataId){throw new Error("Not yet implemented.")},KernelBackend.prototype.write=function(dataId,values){throw new Error("Not yet implemented.")},KernelBackend.prototype.fromPixels=function(pixels,numChannels){throw new Error("Not yet implemented.")},KernelBackend.prototype.register=function(dataId,shape,dtype){throw new Error("Not yet implemented.")},KernelBackend.prototype.memory=function(){throw new Error("Not yet implemented.")},KernelBackend.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},KernelBackend.prototype.batchMatMul=function(a,b,transposeA,transposeB){throw new Error("Not yet implemented")},KernelBackend.prototype.slice=function(x,begin,size){throw new Error("Not yet implemented")},KernelBackend.prototype.stridedSlice=function(x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){throw new Error("Not yet implemented")},KernelBackend.prototype.reverse=function(a,axis){
throw new Error("Not yet implemented")},KernelBackend.prototype.concat=function(tensors,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.neg=function(a){throw new Error("Not yet implemented")},KernelBackend.prototype.add=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.addN=function(tensors){throw new Error("Not yet implemented")},KernelBackend.prototype.subtract=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.multiply=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.realDivide=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.floorDiv=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.sum=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.prod=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.unsortedSegmentSum=function(x,segmentIds,numSegments){throw new Error("Not yet implemented")},KernelBackend.prototype.argMin=function(x,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.argMax=function(x,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.equal=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.notEqual=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.less=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.lessEqual=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.greater=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.greaterEqual=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.logicalNot=function(a){throw new Error("Not yet implemented")},KernelBackend.prototype.logicalAnd=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.logicalOr=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.where=function(condition){throw new Error("Not yet implemented")},KernelBackend.prototype.select=function(condition,a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.topk=function(x,k,sorted){throw new Error("Not yet implemented")},KernelBackend.prototype.min=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.minimum=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.mod=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.max=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.maximum=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.all=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.any=function(x,axes){throw new Error("Not yet implemented")},KernelBackend.prototype.squaredDifference=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.ceil=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.floor=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.round=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.sign=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.pow=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.exp=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.expm1=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.log=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.log1p=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.sqrt=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.rsqrt=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.square=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.reciprocal=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.relu=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.elu=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.eluDer=function(dy,y){throw new Error("Not yet implemented")},KernelBackend.prototype.selu=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.int=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.clip=function(x,min,max){throw new Error("Not yet implemented")},KernelBackend.prototype.abs=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.complexAbs=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.sigmoid=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.softplus=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.sin=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.cos=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.tan=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.asin=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.acos=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.atan=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.atan2=function(a,b){throw new Error("Not yet implemented")},KernelBackend.prototype.sinh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.cosh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.tanh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.asinh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.acosh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.atanh=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.erf=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.step=function(x,alpha){throw new Error("Not yet implemented")},KernelBackend.prototype.conv2d=function(x,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.conv2dDerInput=function(dy,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.conv2dDerFilter=function(x,dY,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.depthwiseConv2D=function(input,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.depthwiseConv2DDerInput=function(dy,filter,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.depthwiseConv2DDerFilter=function(x,dY,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.maxPool=function(x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.maxPoolBackprop=function(dy,x,y,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.avgPool=function(x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.avgPoolBackprop=function(dy,x,convInfo){throw new Error("Not yet implemented")},KernelBackend.prototype.reshape=function(x,shape){throw new Error("Not yet implemented")},KernelBackend.prototype.cast=function(x,dtype){throw new Error("Not yet implemented")},KernelBackend.prototype.tile=function(x,reps){throw new Error("Not yet implemented")},KernelBackend.prototype.pad=function(x,paddings,constantValue){throw new Error("Not yet implemented")},KernelBackend.prototype.transpose=function(x,perm){throw new Error("Not yet implemented")},KernelBackend.prototype.gather=function(x,indices,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.gatherND=function(x,indices){throw new Error("Not yet implemented")},KernelBackend.prototype.scatterND=function(indices,updates,shape){throw new Error("Not yet implemented")},KernelBackend.prototype.batchToSpaceND=function(x,blockShape,crops){throw new Error("Not yet implemented")},KernelBackend.prototype.spaceToBatchND=function(x,blockShape,paddings){throw new Error("Not yet implemented")},KernelBackend.prototype.resizeBilinear=function(x,newHeight,newWidth,alignCorners){throw new Error("Not yet implemented")},KernelBackend.prototype.resizeBilinearBackprop=function(dy,x,alignCorners){throw new Error("Not yet implemented")},KernelBackend.prototype.resizeNearestNeighbor=function(x,newHEight,newWidth,alignCorners){throw new Error("Not yet implemented")},KernelBackend.prototype.resizeNearestNeighborBackprop=function(dy,x,alignCorners){throw new Error("Not yet implemented")},KernelBackend.prototype.batchNormalization=function(x,mean,variance,varianceEpsilon,scale,offset){throw new Error("Not yet implemented")},KernelBackend.prototype.localResponseNormalization4D=function(x,radius,bias,alpha,beta){throw new Error("Not yet implemented")},KernelBackend.prototype.LRNGrad=function(dy,inputImage,outputImage,radius,bias,alpha,beta){throw new Error("Not yet implemented")},KernelBackend.prototype.multinomial=function(logits,normalized,numSamples,seed){throw new Error("Not yet implemented")},KernelBackend.prototype.oneHot=function(indices,depth,onValue,offValue){throw new Error("Not yet implemented")},KernelBackend.prototype.cumsum=function(x,axis,exclusive,reverse){throw new Error("Not yet implemented")},KernelBackend.prototype.nonMaxSuppression=function(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){throw new Error("Not yet implemented")},KernelBackend.prototype.fft=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.ifft=function(x){throw new Error("Not yet implemented")},KernelBackend.prototype.complex=function(real,imag){throw new Error("Not yet implemented")},KernelBackend.prototype.real=function(input){throw new Error("Not yet implemented")},KernelBackend.prototype.imag=function(input){throw new Error("Not yet implemented")},KernelBackend.prototype.cropAndResize=function(image,boxes,boxIndex,cropSize,method,extrapolationValue){throw new Error("Not yet implemented")},KernelBackend.prototype.depthToSpace=function(x,blockSize,dataFormat){throw new Error("Not yet implemented")},KernelBackend.prototype.split=function(value,sizeSplits,axis){throw new Error("Not yet implemented")},KernelBackend.prototype.sparseToDense=function(sparseIndices,sparseValues,outputShape,defaultValue){throw new Error("Not yet implemented")},KernelBackend.prototype.setDataMover=function(dataMover){throw new Error("Not yet implemented")},KernelBackend.prototype.dispose=function(){throw new Error("Not yet implemented")},KernelBackend}();exports.KernelBackend=KernelBackend},{}],75:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),environment_1=require("../environment"),log_1=require("../log"),array_ops_util=require("../ops/array_ops_util"),axis_util=require("../ops/axis_util"),broadcast_util=require("../ops/broadcast_util"),concat_util=require("../ops/concat_util"),erf_util=require("../ops/erf_util"),gather_nd_util=require("../ops/gather_nd_util"),ops=require("../ops/ops"),ops_1=require("../ops/ops"),scatter_nd_util=require("../ops/scatter_nd_util"),selu_util=require("../ops/selu_util"),slice_util_1=require("../ops/slice_util"),tensor_1=require("../tensor"),types_1=require("../types"),util=require("../util"),util_1=require("../util"),backend_1=require("./backend"),backend_util=require("./backend_util"),complex_util=require("./complex_util"),non_max_suppression_impl_1=require("./non_max_suppression_impl"),split_shared_1=require("./split_shared"),topk_impl_1=require("./topk_impl"),where_impl_1=require("./where_impl"),MathBackendCPU=function(){function MathBackendCPU(){this.blockSize=48,this.firstUse=!0,environment_1.ENV.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return MathBackendCPU.prototype.setDataMover=function(dataMover){this.data=new backend_1.DataStorage(dataMover)},MathBackendCPU.prototype.register=function(dataId,shape,dtype){if(this.firstUse&&(this.firstUse=!1,environment_1.ENV.get("IS_NODE")&&log_1.warn("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(dataId))throw new Error("Data buffer is already registered");this.data.set(dataId,{dtype:dtype})},MathBackendCPU.prototype.write=function(dataId,values){if(null==values)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(dataId).values=values},MathBackendCPU.prototype.fromPixels=function(pixels,numChannels){if(null==pixels)throw new Error("pixels passed to tf.fromPixels() can not be null");var vals;if(environment_1.ENV.get("IS_NODE")&&null==pixels.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=pixels.getContext)vals=pixels.getContext("2d").getImageData(0,0,pixels.width,pixels.height).data;else if(pixels instanceof ImageData)vals=pixels.data;else{if(!(pixels instanceof HTMLImageElement||pixels instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+pixels.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=pixels.width,this.fromPixels2DContext.canvas.height=pixels.height,this.fromPixels2DContext.drawImage(pixels,0,0,pixels.width,pixels.height),vals=this.fromPixels2DContext.getImageData(0,0,pixels.width,pixels.height).data}var values;if(4===numChannels)values=new Int32Array(vals);else{var numPixels=pixels.width*pixels.height;values=new Int32Array(numPixels*numChannels);for(var i=0;i<numPixels;i++)for(var channel=0;channel<numChannels;++channel)values[i*numChannels+channel]=vals[4*i+channel]}var outShape=[pixels.height,pixels.width,numChannels];return ops_1.tensor3d(values,outShape,"int32")},MathBackendCPU.prototype.read=function(dataId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.readSync(dataId)]})})},MathBackendCPU.prototype.readSync=function(dataId){var _a=this.data.get(dataId),dtype=_a.dtype,complexTensors=_a.complexTensors;if("complex64"===dtype){var realValues=complexTensors.real.dataSync(),imagValues=complexTensors.imag.dataSync();return complex_util.mergeRealAndImagArrays(realValues,imagValues)}return this.data.get(dataId).values},MathBackendCPU.prototype.disposeData=function(dataId){if(this.data.has(dataId)){var complexTensors=this.data.get(dataId).complexTensors;null!=complexTensors&&(complexTensors.real.dispose(),complexTensors.imag.dispose()),this.data.delete(dataId)}},MathBackendCPU.prototype.time=function(f){return __awaiter(this,void 0,void 0,function(){var start,kernelMs;return __generator(this,function(_a){return start=util_1.now(),f(),kernelMs=util_1.now()-start,[2,{kernelMs:kernelMs}]})})},MathBackendCPU.prototype.memory=function(){return{unreliable:!0}},MathBackendCPU.prototype.complex=function(real,imag){var result=tensor_1.Tensor.make(real.shape,{},"complex64");return this.data.get(result.dataId).complexTensors={real:environment_1.ENV.engine.keep(real.clone()),imag:environment_1.ENV.engine.keep(imag.clone())},result},MathBackendCPU.prototype.real=function(input){return this.data.get(input.dataId).complexTensors.real.clone()},MathBackendCPU.prototype.imag=function(input){return this.data.get(input.dataId).complexTensors.imag.clone()},MathBackendCPU.prototype.assertNotComplex=function(tensor,opName){Array.isArray(tensor)||(tensor=[tensor]),tensor.forEach(function(t){null!=t&&util.assert("complex64"!==t.dtype,opName+" does not support complex64 tensors.")})},MathBackendCPU.prototype.slice=function(x,begin,size){this.assertNotComplex(x,"slice");for(var buffer=ops.buffer(size,x.dtype),i=0;i<buffer.size;++i){var loc=buffer.indexToLoc(i),xLoc=loc.map(function(idx,j){return idx+begin[j]});buffer.set.apply(buffer,[x.get.apply(x,xLoc)].concat(loc))}return buffer.toTensor()},MathBackendCPU.prototype.stridedSlice=function(x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){this.assertNotComplex(x,"stridedSlice");var _a=slice_util_1.getStridedSlicedInfo(x.shape,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask),beginIndex=_a[0],size=_a[1],shrinkAxis=_a[2],shape=size.filter(function(v,index){return-1===shrinkAxis.indexOf(index)});if(shape.some(function(axis){return 0===axis}))return ops.tensor([],shape);for(var buffer=ops.buffer(size,x.dtype),i=0;i<buffer.size;i++){for(var loc=buffer.indexToLoc(i),newLoc=new Array(loc.length),j=0;j<newLoc.length;j++)newLoc[j]=loc[j]*strides[j]+beginIndex[j];buffer.set.apply(buffer,[x.get.apply(x,newLoc)].concat(loc))}return buffer.toTensor().reshape(shape)},MathBackendCPU.prototype.reverse=function(x,axis){this.assertNotComplex(x,"reverse");for(var buffer=ops.buffer(x.shape,x.dtype),xBuffer=x.buffer(),i=0;i<buffer.size;i++)!function(i){var outLoc=buffer.indexToLoc(i),inLoc=outLoc.slice();axis.forEach(function(ax){return inLoc[ax]=x.shape[ax]-1-inLoc[ax]}),buffer.set.apply(buffer,[xBuffer.get.apply(xBuffer,inLoc)].concat(outLoc))}(i);return buffer.toTensor()},MathBackendCPU.prototype.concat=function(tensors,axis){this.assertNotComplex(tensors,"concat");var tensors2D=tensors.map(function(t){var innerSize=util.sizeFromShape(t.shape.slice(axis));return t.as2D(-1,innerSize)}),outShape=concat_util.computeOutShape(tensors2D.map(function(t){return t.shape}),1),values=ops.buffer(outShape,tensors[0].dtype).values;if(1===tensors2D[0].shape[0]){var offset_1=0;tensors2D.forEach(function(t){values.set(t.dataSync(),offset_1),offset_1+=t.size})}else{var colOffset_1=0;tensors2D.forEach(function(t){for(var tVals=t.dataSync(),tIdx=0,row=0;row<t.shape[0];++row)for(var resIdx=row*outShape[1]+colOffset_1,col=0;col<t.shape[1];++col)values[resIdx+col]=tVals[tIdx++];colOffset_1+=t.shape[1]})}var finalOutShape=concat_util.computeOutShape(tensors.map(function(t){return t.shape}),axis);return ops_1.tensor(values,finalOutShape,tensors[0].dtype)},MathBackendCPU.prototype.neg=function(x){return this.assertNotComplex(x,"neg"),this.multiply(ops.scalar(-1),x)},MathBackendCPU.prototype.add=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(aReal,aImag,bReal,bImag){return{real:aReal+bReal,imag:aImag+bImag}}):this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),function(aValue,bValue){return aValue+bValue})},MathBackendCPU.prototype.addN=function(tensors){this.assertNotComplex(tensors,"addN");for(var vals=tensors.map(function(t){return t.dataSync()}),result=ops.buffer(tensors[0].shape,tensors[0].dtype),resultVals=result.values,i=0;i<tensors.length;i++)for(var currVals=vals[i],j=0;j<resultVals.length;j++)resultVals[j]+=currVals[j];return result.toTensor()},MathBackendCPU.prototype.subtract=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(aReal,aImag,bReal,bImag){return{real:aReal-bReal,imag:aImag-bImag}}):this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),function(aValue,bValue){return aValue-bValue})},MathBackendCPU.prototype.pow=function(a,b){return this.assertNotComplex([a,b],"pow"),this.broadcastedBinaryOp(a,b,a.dtype,function(aValue,bValue){return Math.pow(aValue,bValue)})},MathBackendCPU.prototype.batchMatMul=function(a,b,transposeA,transposeB){this.assertNotComplex([a,b],"matMul");for(var sharedDim=transposeA?a.shape[1]:a.shape[2],leftDim=transposeA?a.shape[2]:a.shape[1],rightDim=transposeB?b.shape[1]:b.shape[2],batchDim=a.shape[0],aValues=a.dataSync(),bValues=b.dataSync(),_a=transposeA?[a.strides[0],1,a.strides[1]]:[a.strides[0],a.strides[1],1],aBatch=_a[0],aOuterStep=_a[1],aInnerStep=_a[2],_b=transposeB?[1,b.strides[1],b.strides[0]]:[b.strides[1],1,b.strides[0]],bInnerStep=_b[0],bOuterStep=_b[1],bBatch=_b[2],size=leftDim*rightDim,result=new Float32Array(batchDim*size),blockSize=this.blockSize,b_1=0;b_1<batchDim;b_1++)for(var i0=0;i0<leftDim;i0+=blockSize)for(var j0=0;j0<rightDim;j0+=blockSize)for(var k0=0;k0<sharedDim;k0+=blockSize)for(var iBlock=Math.min(i0+blockSize,leftDim),jBlock=Math.min(j0+blockSize,rightDim),kBlock=Math.min(k0+blockSize,sharedDim),i=i0;i<iBlock;i++)for(var j=j0;j<jBlock;j++){for(var sum=0,k=k0;k<kBlock;k++)sum+=aValues[b_1*aBatch+i*aOuterStep+k*aInnerStep]*bValues[k*bInnerStep+j*bOuterStep+b_1*bBatch];result[b_1*size+(i*rightDim+j)]+=sum}return ops.tensor3d(result,[batchDim,leftDim,rightDim])},MathBackendCPU.prototype.multiply=function(a,b){return"complex64"===a.dtype||"complex64"===b.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),b.cast("complex64"),function(aReal,aImag,bReal,bImag){return{real:aReal*bReal-aImag*bImag,imag:aReal*bImag+aImag*bReal}}):this.broadcastedBinaryOp(a,b,types_1.upcastType(a.dtype,b.dtype),function(aValue,bValue){return aValue*bValue})},MathBackendCPU.prototype.realDivide=function(a,b){this.assertNotComplex([a,b],"realDivide");var op=function(a,b){return a/b};return this.broadcastedBinaryOp(a,b,"float32",op)},MathBackendCPU.prototype.floorDiv=function(a,b){this.assertNotComplex([a,b],"floorDiv");var op=function(a,b){return Math.floor(a/b)};return this.broadcastedBinaryOp(a,b,"int32",op)},MathBackendCPU.prototype.sum=function(x,axes){this.assertNotComplex(x,"sum"),axis_util.assertAxesAreInnerMostDims("sum",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],resultDtype=types_1.upcastType(x.dtype,"int32"),result=ops.zeros(outShape,resultDtype),reduceSize=util.sizeFromShape(reduceShape),vals=result.dataSync(),aVals=x.dataSync(),i=0;i<vals.length;++i){for(var offset=i*reduceSize,sum=0,j=0;j<reduceSize;++j)sum+=aVals[offset+j];vals[i]=sum}return result},MathBackendCPU.prototype.prod=function(x,axes){this.assertNotComplex(x,"sum");for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],resultDtype=types_1.upcastType(x.dtype,"int32"),result=ops.zeros(outShape,resultDtype),reduceSize=util.sizeFromShape(reduceShape),vals=result.dataSync(),aVals=x.dataSync(),i=0;i<vals.length;++i){for(var offset=i*reduceSize,prod=1,j=0;j<reduceSize;++j)prod*=aVals[offset+j];vals[i]=prod}return result},MathBackendCPU.prototype.unsortedSegmentSum=function(x,segmentIds,numSegments){this.assertNotComplex(x,"unsortedSegmentSum");for(var res=[],numIters=x.rank-segmentIds.rank,i=0;i<numIters;++i)segmentIds=segmentIds.expandDims(i+1);for(var i=0;i<numSegments;++i){var segmentId=ops.scalar(i,"int32"),mask=ops.equal(segmentId,segmentIds).asType("float32"),sum=mask.mul(x).sum(0);res.push(sum)}return ops.stack(res)},MathBackendCPU.prototype.argMin=function(x,axis){this.assertNotComplex(x,"argMin");var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMin",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,"int32"),reduceSize=util.sizeFromShape(reduceShape),vals=result.dataSync(),aVals=x.dataSync(),i=0;i<vals.length;++i){for(var offset=i*reduceSize,min=aVals[offset],minIndex=0,j=0;j<reduceSize;++j){var value=aVals[offset+j];value<min&&(min=value,minIndex=j)}vals[i]=minIndex}return result},MathBackendCPU.prototype.argMax=function(x,axis){this.assertNotComplex(x,"argMax");var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMax",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,"int32"),reduceSize=util.sizeFromShape(reduceShape),vals=result.dataSync(),aVals=x.dataSync(),i=0;i<vals.length;++i){for(var offset=i*reduceSize,max=aVals[offset],maxIndex=0,j=0;j<reduceSize;++j){var value=aVals[offset+j];value>max&&(max=value,maxIndex=j)}vals[i]=maxIndex}return result},MathBackendCPU.prototype.cumsum=function(x,axis,exclusive,reverse){if(this.assertNotComplex(x,"cumsum"),axis!==x.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(x.rank-1)+" but got axis="+axis);for(var resultDtype=types_1.upcastType(x.dtype,"int32"),result=ops.zeros(x.shape,resultDtype),vals=result.dataSync(),aVals=x.dataSync(),finalDim=x.shape[x.rank-1],indexAdjuster=reverse?function(i,j){return i+finalDim-j-1}:function(i,j){return i+j},i=0;i<aVals.length;i+=finalDim)for(var j=0;j<finalDim;j++){var idx=indexAdjuster(i,j);if(0===j)vals[idx]=exclusive?0:aVals[idx];else{var prevIdx=indexAdjuster(i,j-1);vals[idx]=exclusive?aVals[prevIdx]+vals[prevIdx]:aVals[idx]+vals[prevIdx]}}return result},MathBackendCPU.prototype.equal=function(a,b){return this.assertNotComplex([a,b],"equal"),this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal===bVal?1:0})},MathBackendCPU.prototype.notEqual=function(a,b){return this.assertNotComplex([a,b],"notEqual"),this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal!==bVal?1:0})},MathBackendCPU.prototype.less=function(a,b){return this.assertNotComplex([a,b],"less"),this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal<bVal?1:0})},MathBackendCPU.prototype.lessEqual=function(a,b){return this.assertNotComplex([a,b],"lessEqual"),this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal<=bVal?1:0})},MathBackendCPU.prototype.greater=function(a,b){return this.assertNotComplex([a,b],"greater"),this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal>bVal?1:0})},MathBackendCPU.prototype.greaterEqual=function(a,b){return this.assertNotComplex([a,b],"greaterEqual"),this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal>=bVal?1:0})},MathBackendCPU.prototype.logicalNot=function(x){this.assertNotComplex(x,"logicalNot");for(var values=x.dataSync(),newValues=new Int32Array(values.length),i=0;i<values.length;++i)newValues[i]=values[i]?0:1;return tensor_1.Tensor.make(x.shape,{values:newValues},"bool")},MathBackendCPU.prototype.logicalAnd=function(a,b){return this.assertNotComplex([a,b],"logicalAnd"),this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal&&bVal})},MathBackendCPU.prototype.logicalOr=function(a,b){return this.assertNotComplex([a,b],"logicalOr"),this.broadcastedBinaryOp(a,b,"bool",function(aVal,bVal){return aVal||bVal})},MathBackendCPU.prototype.select=function(condition,a,b){this.assertNotComplex([condition,a,b],"select");for(var values=condition.dataSync(),aValues=a.dataSync(),bValues=b.dataSync(),result=ops.zeros(a.shape,types_1.upcastType(a.dtype,b.dtype)),newValues=result.dataSync(),index=0,offset=0===condition.rank||condition.rank>1||1===a.rank?1:a.shape[1],i=0;i<values.length;i++)for(var j=0;j<offset;j++)1===values[i]?newValues[index++]=aValues[i]:newValues[index++]=bValues[i];return result},MathBackendCPU.prototype.where=function(condition){this.assertNotComplex([condition],"where");var condVals=condition.dataSync();return where_impl_1.whereImpl(condition.shape,condVals)},MathBackendCPU.prototype.topk=function(x,k,sorted){this.assertNotComplex(x,"topk");var xVals=x.dataSync();return topk_impl_1.topkImpl(xVals,x.shape,x.dtype,k,sorted)},MathBackendCPU.prototype.min=function(x,axes){this.assertNotComplex(x,"min"),axis_util.assertAxesAreInnerMostDims("min",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,x.dtype),reduceSize=util.sizeFromShape(reduceShape),vals=result.dataSync(),aVals=x.dataSync(),i=0;i<vals.length;++i){for(var offset=i*reduceSize,min=aVals[offset],j=0;j<reduceSize;++j){var value=aVals[offset+j];value<min&&(min=value)}vals[i]=min}return result},MathBackendCPU.prototype.minimum=function(a,b){return this.assertNotComplex([a,b],"minimum"),this.broadcastedBinaryOp(a,b,a.dtype,function(aVal,bVal){return Math.min(aVal,bVal)})},MathBackendCPU.prototype.mod=function(a,b){return this.assertNotComplex([a,b],"mod"),this.broadcastedBinaryOp(a,b,a.dtype,function(aVal,bVal){var rem=aVal%bVal;return aVal<0&&bVal<0||aVal>=0&&bVal>=0?rem:(rem+bVal)%bVal})},MathBackendCPU.prototype.max=function(x,axes){this.assertNotComplex(x,"max"),axis_util.assertAxesAreInnerMostDims("max",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,x.dtype),reduceSize=util.sizeFromShape(reduceShape),vals=result.dataSync(),aVals=x.dataSync(),i=0;i<vals.length;++i){for(var offset=i*reduceSize,max=aVals[offset],j=0;j<reduceSize;++j){var value=aVals[offset+j];value>max&&(max=value)}vals[i]=max}return result},MathBackendCPU.prototype.maximum=function(a,b){return this.assertNotComplex([a,b],"maximum"),this.broadcastedBinaryOp(a,b,a.dtype,function(aVal,bVal){return Math.max(aVal,bVal)})},MathBackendCPU.prototype.all=function(x,axes){this.assertNotComplex(x,"all"),axis_util.assertAxesAreInnerMostDims("all",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,x.dtype),reduceSize=util.sizeFromShape(reduceShape),vals=result.dataSync(),aVals=x.dataSync(),i=0;i<vals.length;++i){for(var offset=i*reduceSize,all=aVals[offset],j=0;j<reduceSize;++j){var value=aVals[offset+j];all=all&&value}vals[i]=all}return result},MathBackendCPU.prototype.any=function(x,axes){this.assertNotComplex(x,"any"),axis_util.assertAxesAreInnerMostDims("any",axes,x.rank);for(var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],result=ops.zeros(outShape,x.dtype),reduceSize=util.sizeFromShape(reduceShape),vals=result.dataSync(),aVals=x.dataSync(),i=0;i<vals.length;++i){for(var offset=i*reduceSize,anyVal=aVals[offset],j=0;j<reduceSize;++j){var value=aVals[offset+j];anyVal=anyVal||value}vals[i]=anyVal}return result},MathBackendCPU.prototype.squaredDifference=function(a,b){return this.assertNotComplex([a,b],"squaredDifference"),
this.broadcastedBinaryOp(a,b,a.dtype,function(aVal,bVal){var diff=aVal-bVal;return diff*diff})},MathBackendCPU.prototype.ceil=function(x){this.assertNotComplex(x,"ceil");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=Math.ceil(values[i]);return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.floor=function(x){this.assertNotComplex(x,"floor");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=Math.floor(values[i]);return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.sign=function(x){this.assertNotComplex(x,"x");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i)values[i]<0?newValues[i]=-1:values[i]>0?newValues[i]=1:newValues[i]=0;return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.round=function(x){this.assertNotComplex(x,"round");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var base=Math.floor(values[i]);values[i]-base<.5?newValues[i]=Math.floor(values[i]):values[i]-base>.5?newValues[i]=Math.ceil(values[i]):newValues[i]=base%2==0?base:base+1}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.exp=function(x){this.assertNotComplex(x,"exp");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=Math.exp(values[i]);return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.expm1=function(x){this.assertNotComplex(x,"expm1");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=Math.expm1(values[i]);return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.log=function(x){this.assertNotComplex(x,"log");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.log(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.log1p=function(x){this.assertNotComplex(x,"log1p");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.log1p(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.sqrt=function(x){this.assertNotComplex(x,"sqrt");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=Math.sqrt(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.rsqrt=function(x){this.assertNotComplex(x,"rsqrt");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=1/Math.sqrt(value)}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.square=function(x){this.assertNotComplex(x,"square");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i){var value=values[i];newValues[i]=value*value}return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.reciprocal=function(x){this.assertNotComplex(x,"reciprocal");for(var values=x.dataSync(),newValues=new Float32Array(values.length),i=0;i<values.length;++i)newValues[i]=1/values[i];return tensor_1.Tensor.make(x.shape,{values:newValues})},MathBackendCPU.prototype.relu=function(x){this.assertNotComplex(x,"relu");for(var res=ops.zeros(x.shape,x.dtype),resVals=res.dataSync(),inVals=x.dataSync(),i=0;i<inVals.length;++i)resVals[i]=Math.max(0,inVals[i]);return res},MathBackendCPU.prototype.elu=function(x){this.assertNotComplex(x,"elu");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>=0?v:Math.exp(v)-1}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.eluDer=function(dy,y){this.assertNotComplex([dy,y],"eluDer");for(var resultValues=new Float32Array(y.size),values=y.dataSync(),dyValues=dy.dataSync(),i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>=1?dyValues[i]:dyValues[i]*(v+1)}return tensor_1.Tensor.make(y.shape,{values:resultValues})},MathBackendCPU.prototype.selu=function(x){this.assertNotComplex(x,"selu");for(var scaleAlpha=selu_util.SELU_SCALEALPHA,scale=selu_util.SELU_SCALE,resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>=0?scale*v:scaleAlpha*(Math.exp(v)-1)}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.clip=function(x,min,max){this.assertNotComplex(x,"clip");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i){var v=values[i];resultValues[i]=v>max?max:v<min?min:v}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.abs=function(x){for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.abs(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.complexAbs=function(x){for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<x.size;++i){var real=values[2*i],imag=values[2*i+1];resultValues[i]=Math.sqrt(real*real+imag*imag)}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.int=function(x){this.assertNotComplex(x,"int");for(var resultValues=new Int32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=values[i];return tensor_1.Tensor.make(x.shape,{values:resultValues},"int32")},MathBackendCPU.prototype.sigmoid=function(x){this.assertNotComplex(x,"sigmoid");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=1/(1+Math.exp(-values[i]));return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.softplus=function(x){this.assertNotComplex(x,"softplus");for(var threshold=Math.log(1.1920928955078125e-7)+2,resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i){var tooLarge=values[i]>-threshold,tooSmall=values[i]<threshold,expX=Math.exp(values[i]),result=void 0;result=tooSmall?expX:tooLarge?values[i]:Math.log(1+expX),resultValues[i]=result}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.sin=function(x){this.assertNotComplex(x,"sin");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.sin(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.cos=function(x){this.assertNotComplex(x,"cos");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.cos(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.tan=function(x){this.assertNotComplex(x,"tan");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.tan(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.asin=function(x){this.assertNotComplex(x,"asin");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.asin(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.acos=function(x){this.assertNotComplex(x,"acos");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.acos(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.atan=function(x){this.assertNotComplex(x,"atan");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.atan(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.atan2=function(a,b){return this.assertNotComplex([a,b],"atan2"),this.broadcastedBinaryOp(a,b,a.dtype,function(aValue,bValue){return Math.atan2(aValue,bValue)})},MathBackendCPU.prototype.sinh=function(x){this.assertNotComplex(x,"sinh");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.sinh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.cosh=function(x){this.assertNotComplex(x,"cosh");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.cosh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.tanh=function(x){this.assertNotComplex(x,"tanh");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=util.tanh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.asinh=function(x){this.assertNotComplex(x,"asinh");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.asinh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.acosh=function(x){this.assertNotComplex(x,"acosh");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.acosh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.atanh=function(x){this.assertNotComplex(x,"atanh");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i)resultValues[i]=Math.atanh(values[i]);return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.erf=function(x){this.assertNotComplex(x,"erf");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),p=erf_util.ERF_P,a1=erf_util.ERF_A1,a2=erf_util.ERF_A2,a3=erf_util.ERF_A3,a4=erf_util.ERF_A4,a5=erf_util.ERF_A5,i=0;i<values.length;++i){var v=values[i],t=1/(1+p*v);resultValues[i]=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-v*v)}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.step=function(x,alpha){void 0===alpha&&(alpha=0),this.assertNotComplex(x,"step");for(var resultValues=new Float32Array(x.size),values=x.dataSync(),i=0;i<values.length;++i){var value=values[i];isNaN(value)?resultValues[i]=NaN:resultValues[i]=value>0?1:alpha}return tensor_1.Tensor.make(x.shape,{values:resultValues})},MathBackendCPU.prototype.conv2d=function(x,filter,convInfo){this.assertNotComplex([x,filter],"conv2d");for(var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,padLeft=convInfo.padInfo.left,padTop=convInfo.padInfo.top,y=ops.buffer(convInfo.outShape,x.dtype),xVals=x.dataSync(),wVals=filter.dataSync(),yVals=y.values,b=0;b<convInfo.batchSize;++b)for(var xOffset1=b*x.strides[0],yOffset1=b*y.strides[0],yR=0;yR<convInfo.outHeight;++yR)for(var yOffset2=yOffset1+yR*y.strides[1],xRCorner=yR*convInfo.strideHeight-padLeft,wR=0;wR<filterHeight;wR++){var xR=xRCorner+wR*dilationHeight;if(!(xR<0||xR>=convInfo.inHeight))for(var wOffset1=wR*filter.strides[0],xOffset2=xOffset1+xR*x.strides[1],yC=0;yC<convInfo.outWidth;++yC)for(var yOffset3=yOffset2+yC*convInfo.outChannels,xCCorner=yC*convInfo.strideWidth-padTop,wC=0;wC<filterWidth;wC++){var xC=xCCorner+wC*dilationWidth;if(!(xC<0||xC>=convInfo.inWidth))for(var wOffset2=wOffset1+wC*filter.strides[1],xOffset3=xOffset2+xC*convInfo.inChannels,wOffset3=wOffset2,d1=0;d1<convInfo.inChannels;++d1){for(var xVal=xVals[xOffset3+d1],d2=0;d2<convInfo.outChannels;++d2)yVals[yOffset3+d2]+=xVal*wVals[wOffset3+d2];wOffset3+=convInfo.outChannels}}}return y.toTensor()},MathBackendCPU.prototype.conv2dDerInput=function(dy,filter,convInfo){this.assertNotComplex([dy,filter],"conv2dDerInput");for(var dx=ops.buffer(convInfo.inShape,"float32"),dxValues=dx.values,_a=dx.strides,dxS0=_a[0],dxS1=_a[1],dxS2=_a[2],dyValues=dy.dataSync(),_b=dy.strides,dyS0=_b[0],dyS1=_b[1],dyS2=_b[2],fltValues=filter.dataSync(),_c=filter.strides,fltS0=_c[0],fltS1=_c[1],fltS2=_c[2],batchSize=convInfo.batchSize,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,inHeight=convInfo.inHeight,inWidth=convInfo.inWidth,outChannels=convInfo.outChannels,outHeight=convInfo.outHeight,outWidth=convInfo.outWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,topPad=filterHeight-1-convInfo.padInfo.top,leftPad=filterWidth-1-convInfo.padInfo.left,b=0;b<batchSize;++b)for(var d1=0;d1<inChannels;++d1)for(var xR=0;xR<inHeight;++xR)for(var xRCorner=xR-topPad,xRMin=Math.max(0,Math.ceil(xRCorner/strideHeight)),yRMax=Math.min(outHeight,(filterHeight+xRCorner)/strideHeight),xC=0;xC<inWidth;++xC){for(var xCCorner=xC-leftPad,xCMin=Math.max(0,Math.ceil(xCCorner/strideWidth)),yCMax=Math.min(outWidth,(filterWidth+xCCorner)/strideWidth),dotProd=0,yR=xRMin;yR<yRMax;++yR)for(var wR=yR*strideHeight-xRCorner,yC=xCMin;yC<yCMax;++yC)for(var wC=yC*strideWidth-xCCorner,dyOffset=dyS0*b+dyS1*yR+dyS2*yC,fltOffset=fltS0*(filterHeight-1-wR)+fltS1*(filterWidth-1-wC)+fltS2*d1,d2=0;d2<outChannels;++d2){var pixel=dyValues[dyOffset+d2],weight=fltValues[fltOffset+d2];dotProd+=pixel*weight}dxValues[dxS0*b+dxS1*xR+dxS2*xC+d1]=dotProd}return dx.toTensor()},MathBackendCPU.prototype.conv2dDerFilter=function(x,dy,convInfo){this.assertNotComplex([x,dy],"conv2dDerFilter");for(var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dW=ops.buffer(convInfo.filterShape,"float32"),leftPad=convInfo.padInfo.left,topPad=convInfo.padInfo.top,wR=0;wR<filterHeight;++wR)for(var yRMin=Math.max(0,Math.ceil((topPad-wR)/strideHeight)),yRMax=Math.min(convInfo.outHeight,(convInfo.inHeight+topPad-wR)/strideHeight),wC=0;wC<filterWidth;++wC)for(var yCMin=Math.max(0,Math.ceil((leftPad-wC)/strideWidth)),yCMax=Math.min(convInfo.outWidth,(convInfo.inWidth+leftPad-wC)/strideWidth),d1=0;d1<convInfo.inChannels;++d1)for(var d2=0;d2<convInfo.outChannels;++d2){for(var dotProd=0,b=0;b<convInfo.batchSize;++b)for(var yR=yRMin;yR<yRMax;++yR)for(var xR=wR+yR*strideHeight-topPad,yC=yCMin;yC<yCMax;++yC){var xC=wC+yC*strideWidth-leftPad;dotProd+=x.get(b,xR,xC,d1)*dy.get(b,yR,yC,d2)}dW.set(dotProd,wR,wC,d1,d2)}return dW.toTensor()},MathBackendCPU.prototype.depthwiseConv2D=function(x,filter,convInfo){this.assertNotComplex([x,filter],"depthwiseConv2D");for(var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,padLeft=convInfo.padInfo.left,padTop=convInfo.padInfo.top,chMul=convInfo.outChannels/convInfo.inChannels,y=ops.buffer(convInfo.outShape,x.dtype),xVals=x.dataSync(),wVals=filter.dataSync(),yVals=y.values,b=0;b<convInfo.batchSize;++b)for(var xOffset1=b*x.strides[0],yOffset1=b*y.strides[0],yR=0;yR<convInfo.outHeight;++yR)for(var yOffset2=yOffset1+yR*y.strides[1],xRCorner=yR*convInfo.strideHeight-padLeft,wR=0;wR<filterHeight;++wR){var xR=xRCorner+wR*dilationHeight;if(!(xR<0||xR>=convInfo.inHeight))for(var wOffset1=wR*filter.strides[0],xOffset2=xOffset1+xR*x.strides[1],yC=0;yC<convInfo.outWidth;++yC)for(var yOffset3=yOffset2+yC*y.strides[2],xCCorner=yC*convInfo.strideWidth-padTop,wC=0;wC<filterWidth;++wC){var xC=xCCorner+wC*dilationWidth;if(!(xC<0||xC>=convInfo.inWidth))for(var wOffset2=wOffset1+wC*filter.strides[1],xOffset3=xOffset2+xC*convInfo.inChannels,yOffset4=yOffset3,wOffset3=wOffset2,d1=0;d1<convInfo.inChannels;++d1){for(var xVal=xVals[xOffset3+d1],q=0;q<chMul;++q)yVals[yOffset4+q]+=xVal*wVals[wOffset3+q];yOffset4+=chMul,wOffset3+=chMul}}}return y.toTensor()},MathBackendCPU.prototype.depthwiseConv2DDerInput=function(dy,filter,convInfo){this.assertNotComplex([dy,filter],"depthwiseConv2DDerInput");for(var dx=ops.buffer(convInfo.inShape,"float32"),dxValues=dx.values,_a=dx.strides,dxS0=_a[0],dxS1=_a[1],dxS2=_a[2],dyValues=dy.dataSync(),_b=dy.strides,dyS0=_b[0],dyS1=_b[1],dyS2=_b[2],fltValues=filter.dataSync(),_c=filter.strides,fltS0=_c[0],fltS1=_c[1],fltS2=_c[2],batchSize=convInfo.batchSize,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,inHeight=convInfo.inHeight,inWidth=convInfo.inWidth,outChannels=convInfo.outChannels,outHeight=convInfo.outHeight,outWidth=convInfo.outWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,topPad=filterHeight-1-convInfo.padInfo.top,leftPad=filterWidth-1-convInfo.padInfo.left,chMul=outChannels/inChannels,b=0;b<batchSize;++b)for(var d1=0;d1<inChannels;++d1)for(var xR=0;xR<inHeight;++xR)for(var xRCorner=xR-topPad,xRMin=Math.max(0,Math.ceil(xRCorner/strideHeight)),yRMax=Math.min(outHeight,(filterHeight+xRCorner)/strideHeight),xC=0;xC<inWidth;++xC){for(var xCCorner=xC-leftPad,xCMin=Math.max(0,Math.ceil(xCCorner/strideWidth)),yCMax=Math.min(outWidth,(filterWidth+xCCorner)/strideWidth),dotProd=0,yR=xRMin;yR<yRMax;++yR)for(var wR=yR*strideHeight-xRCorner,yC=xCMin;yC<yCMax;++yC)for(var wC=yC*strideWidth-xCCorner,dyOffset=dyS0*b+dyS1*yR+dyS2*yC,fltOffset=fltS0*(filterHeight-1-wR)+fltS1*(filterWidth-1-wC)+fltS2*d1,dm=0;dm<chMul;++dm){var d2=d1*chMul+dm,pixel=dyValues[dyOffset+d2],weight=fltValues[fltOffset+dm];dotProd+=pixel*weight}dxValues[dxS0*b+dxS1*xR+dxS2*xC+d1]=dotProd}return dx.toTensor()},MathBackendCPU.prototype.depthwiseConv2DDerFilter=function(x,dy,convInfo){this.assertNotComplex([x,dy],"depthwiseConv2DDerFilter");for(var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dW=ops.buffer(convInfo.filterShape,"float32"),leftPad=convInfo.padInfo.left,topPad=convInfo.padInfo.top,chMul=convInfo.outChannels/convInfo.inChannels,wR=0;wR<filterHeight;++wR)for(var yRMin=Math.max(0,Math.ceil((topPad-wR)/strideHeight)),yRMax=Math.min(convInfo.outHeight,(convInfo.inHeight+topPad-wR)/strideHeight),wC=0;wC<filterWidth;++wC)for(var yCMin=Math.max(0,Math.ceil((leftPad-wC)/strideWidth)),yCMax=Math.min(convInfo.outWidth,(convInfo.inWidth+leftPad-wC)/strideWidth),d2=0;d2<convInfo.outChannels;++d2){for(var d1=Math.trunc(d2/chMul),dm=d2%chMul,dotProd=0,b=0;b<convInfo.batchSize;++b)for(var yR=yRMin;yR<yRMax;++yR)for(var xR=wR+yR*strideHeight-topPad,yC=yCMin;yC<yCMax;++yC){var xC=wC+yC*strideWidth-leftPad;dotProd+=x.get(b,xR,xC,d1)*dy.get(b,yR,yC,d2)}dW.set(dotProd,wR,wC,d1,dm)}return dW.toTensor()},MathBackendCPU.prototype.tile=function(x,reps){this.assertNotComplex(x,"tile");for(var newShape=new Array(x.rank),i=0;i<newShape.length;i++)newShape[i]=x.shape[i]*reps[i];for(var result=ops.buffer(newShape,x.dtype),xBuf=x.buffer(),i=0;i<result.values.length;++i){for(var newLoc=result.indexToLoc(i),originalLoc=new Array(x.rank),i_1=0;i_1<originalLoc.length;i_1++)originalLoc[i_1]=newLoc[i_1]%x.shape[i_1];var originalIndex=xBuf.locToIndex(originalLoc);result.values[i]=xBuf.values[originalIndex]}return result.toTensor()},MathBackendCPU.prototype.pad=function(x,paddings,constantValue){this.assertNotComplex(x,"pad");var outShape=paddings.map(function(p,i){return p[0]+x.shape[i]+p[1]}),start=paddings.map(function(p){return p[0]}),xBuffer=x.buffer(),buffer=ops.buffer(outShape,x.dtype);0!==constantValue&&buffer.values.fill(constantValue);for(var i=0;i<x.size;i++){var coords=xBuffer.indexToLoc(i),outCoords=coords.map(function(c,i){return c+start[i]});buffer.set.apply(buffer,[x.get.apply(x,coords)].concat(outCoords))}return buffer.toTensor()},MathBackendCPU.prototype.transpose=function(x,perm){this.assertNotComplex(x,"transpose");for(var newShape=new Array(x.rank),i=0;i<newShape.length;i++)newShape[i]=x.shape[perm[i]];for(var values=x.dataSync(),result=ops_1.buffer(newShape,x.dtype),xBuf=x.buffer(),i=0;i<x.size;++i){for(var loc=xBuf.indexToLoc(i),newLoc=new Array(loc.length),i_2=0;i_2<newLoc.length;i_2++)newLoc[i_2]=loc[perm[i_2]];var newIndex=result.locToIndex(newLoc);result.values[newIndex]=values[i]}return result.toTensor()},MathBackendCPU.prototype.gather=function(x,indices,axis){this.assertNotComplex([x,indices],"gather");var newShape=x.shape.slice(),indicesValues=indices.dataSync();newShape[axis]=indicesValues.length;for(var result=ops_1.buffer(newShape,x.dtype),xBuf=x.buffer(),i=0;i<result.size;++i){var newLoc=result.indexToLoc(i),originalLoc=newLoc.slice();originalLoc[axis]=indicesValues[newLoc[axis]];var originalIndex=xBuf.locToIndex(originalLoc);result.values[i]=xBuf.values[originalIndex]}return result.toTensor()},MathBackendCPU.prototype.batchToSpaceND=function(x,blockShape,crops){this.assertNotComplex([x],"batchToSpaceND");var prod=blockShape.reduce(function(a,b){return a*b}),reshaped=array_ops_util.getReshaped(x.shape,blockShape,prod),permuted=array_ops_util.getPermuted(reshaped.length,blockShape.length),reshapedPermuted=array_ops_util.getReshapedPermuted(x.shape,blockShape,prod),sliceBeginCoords=array_ops_util.getSliceBeginCoords(crops,blockShape.length),sliceSize=array_ops_util.getSliceSize(reshapedPermuted,crops,blockShape.length);return x.reshape(reshaped).transpose(permuted).reshape(reshapedPermuted).slice(sliceBeginCoords,sliceSize)},MathBackendCPU.prototype.spaceToBatchND=function(x,blockShape,paddings){this.assertNotComplex([x],"spaceToBatchND");var prod=blockShape.reduce(function(a,b){return a*b}),completePaddings=[[0,0]];completePaddings.push.apply(completePaddings,paddings);for(var i=1+blockShape.length;i<x.shape.length;++i)completePaddings.push([0,0]);var paddedX=x.pad(completePaddings),reshapedPaddedShape=array_ops_util.getReshaped(paddedX.shape,blockShape,prod,!1),permutedReshapedPaddedPermutation=array_ops_util.getPermuted(reshapedPaddedShape.length,blockShape.length,!1),flattenShape=array_ops_util.getReshapedPermuted(paddedX.shape,blockShape,prod,!1);return paddedX.reshape(reshapedPaddedShape).transpose(permutedReshapedPaddedPermutation).reshape(flattenShape)},MathBackendCPU.prototype.pool=function(x,convInfo,poolType){this.assertNotComplex(x,"pool");for(var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,initialValue="max"===poolType?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,xValues=x.dataSync(),output=ops.buffer(convInfo.outShape,x.dtype),outputVals=output.values,outputBatchStrides=convInfo.outShape[1]*convInfo.outShape[2]*convInfo.outShape[3],outputRowStrides=convInfo.outShape[2]*convInfo.outShape[3],outputColStrides=convInfo.outShape[3],b=0;b<convInfo.batchSize;++b)for(var outputBatchOffset=b*outputBatchStrides,inputBatchOffset=b*x.strides[0],d=0;d<convInfo.inChannels;++d)for(var yR=0;yR<convInfo.outHeight;++yR)for(var xRCorner=yR*strideHeight-padTop,xRMin=Math.max(0,xRCorner),xRMax=Math.min(convInfo.inHeight,effectiveFilterHeight+xRCorner),outputRowOffset=outputBatchOffset+yR*outputRowStrides,yC=0;yC<convInfo.outWidth;++yC){for(var xCCorner=yC*strideWidth-padLeft,xCMin=Math.max(0,xCCorner),xCMax=Math.min(convInfo.inWidth,effectiveFilterWidth+xCCorner),minMaxValue=initialValue,avgValue=0,count=0,xR=xRMin;xR<xRMax;xR+=dilationHeight){for(var xROffset=inputBatchOffset+xR*x.strides[1],xC=xCMin;xC<xCMax;xC+=dilationWidth){var xCOffset=xROffset+xC*x.strides[2],pixel=xValues[xCOffset+d];"max"===poolType&&pixel>minMaxValue?minMaxValue=pixel:"avg"===poolType&&(avgValue+=pixel,count++)}if(isNaN(minMaxValue))break}var outputOffset=outputRowOffset+yC*outputColStrides+d;outputVals[outputOffset]="avg"===poolType?avgValue/count:minMaxValue}return output.toTensor()},MathBackendCPU.prototype.maxPool=function(x,convInfo){return this.pool(x,convInfo,"max")},MathBackendCPU.prototype.maxPoolPositions=function(x,convInfo){for(var maxPositions=ops.buffer(convInfo.outShape,"int32"),strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,b=0;b<convInfo.batchSize;++b)for(var d=0;d<convInfo.inChannels;++d)for(var yR=0;yR<convInfo.outHeight;++yR){for(var xRCorner=yR*strideHeight-padTop,xRMin=xRCorner;xRMin<0;)xRMin+=dilationHeight;for(var xRMax=Math.min(convInfo.inHeight,effectiveFilterHeight+xRCorner),yC=0;yC<convInfo.outWidth;++yC){for(var xCCorner=yC*strideWidth-padLeft,xCMin=xCCorner;xCMin<0;)xCMin+=dilationWidth;for(var xCMax=Math.min(convInfo.inWidth,effectiveFilterWidth+xCCorner),maxValue=Number.NEGATIVE_INFINITY,maxPosition=-1,xR=xRMin;xR<xRMax;xR+=dilationHeight)for(var wR=xR-xRCorner,xC=xCMin;xC<xCMax;xC+=dilationWidth){var wC=xC-xCCorner,pixel=x.get(b,xR,xC,d);pixel>maxValue&&(maxValue=pixel,maxPosition=wR*effectiveFilterWidth+wC)}maxPositions.set(maxPosition,b,yR,yC,d)}}return maxPositions.toTensor()},MathBackendCPU.prototype.maxPoolBackprop=function(dy,x,y,convInfo){this.assertNotComplex([x,y],"maxPoolBackprop");for(var maxPositions=this.maxPoolPositions(x,convInfo),strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,dx=ops.buffer(x.shape,"float32"),b=0;b<convInfo.batchSize;++b)for(var d=0;d<convInfo.inChannels;++d)for(var dxR=0;dxR<convInfo.inHeight;++dxR)for(var dxC=0;dxC<convInfo.inWidth;++dxC){for(var dyRCorner=dxR-padTop,dyCCorner=dxC-padLeft,dotProd=0,wR=0;wR<effectiveFilterHeight;wR+=dilationHeight){var dyR=(dyRCorner+wR)/strideHeight;if(!(dyR<0||dyR>=convInfo.outHeight||Math.floor(dyR)!==dyR))for(var wC=0;wC<effectiveFilterWidth;wC+=dilationWidth){var dyC=(dyCCorner+wC)/strideWidth;if(!(dyC<0||dyC>=convInfo.outWidth||Math.floor(dyC)!==dyC)){var maxPos=effectiveFilterHeight*effectiveFilterWidth-1-maxPositions.get(b,dyR,dyC,d),curPos=wR*effectiveFilterWidth+wC,mask=maxPos===curPos?1:0;if(0!==mask){var pixel=dy.get(b,dyR,dyC,d);dotProd+=pixel*mask}}}}dx.set(dotProd,b,dxR,dxC,d)}return dx.toTensor()},MathBackendCPU.prototype.avgPoolBackprop=function(dy,x,convInfo){this.assertNotComplex([dy,x],"avgPoolBackprop");for(var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,dx=ops.buffer(x.shape,"float32"),avgMultiplier=1/(filterHeight*filterWidth),b=0;b<convInfo.batchSize;++b)for(var d=0;d<convInfo.inChannels;++d)for(var dxR=0;dxR<convInfo.inHeight;++dxR)for(var dxC=0;dxC<convInfo.inWidth;++dxC){for(var dyRCorner=dxR-padTop,dyCCorner=dxC-padLeft,dotProd=0,wR=0;wR<effectiveFilterHeight;wR+=dilationHeight){var dyR=(dyRCorner+wR)/strideHeight;if(!(dyR<0||dyR>=convInfo.outHeight||Math.floor(dyR)!==dyR))for(var wC=0;wC<effectiveFilterWidth;wC+=dilationWidth){var dyC=(dyCCorner+wC)/strideWidth;if(!(dyC<0||dyC>=convInfo.outWidth||Math.floor(dyC)!==dyC)){var pixel=dy.get(b,dyR,dyC,d);dotProd+=pixel}}}dx.set(dotProd*avgMultiplier,b,dxR,dxC,d)}return dx.toTensor()},MathBackendCPU.prototype.cast=function(x,dtype){return backend_util.castTensor(x,dtype,this)},MathBackendCPU.prototype.reshape=function(x,shape){return backend_util.reshapeTensor(x,shape)},MathBackendCPU.prototype.avgPool=function(x,convInfo){return this.assertNotComplex(x,"avgPool"),this.pool(x,convInfo,"avg").toFloat()},MathBackendCPU.prototype.resizeBilinear=function(x,newHeight,newWidth,alignCorners){this.assertNotComplex(x,"resizeBilinear");for(var _a=x.shape,batch=_a[0],oldHeight=_a[1],oldWidth=_a[2],numChannels=_a[3],xValues=x.dataSync(),result=new Float32Array(util.sizeFromShape([batch,newHeight,newWidth,numChannels])),effectiveInputSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutputSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth],outputIdx=0,effectiveRowSizeRatio=effectiveInputSize[0]/effectiveOutputSize[0],effectiveColSizeRatio=effectiveInputSize[1]/effectiveOutputSize[1],b=0;b<batch;b++)for(var r=0;r<newHeight;r++)for(var sourceFracRow=effectiveRowSizeRatio*r,sourceRowFloor=Math.floor(sourceFracRow),rowFrac=sourceFracRow-sourceRowFloor,sourceRowCeil=Math.min(oldHeight-1,Math.ceil(sourceFracRow)),topRowOffset=b*x.strides[0]+sourceRowFloor*x.strides[1],botRowOffset=b*x.strides[0]+sourceRowCeil*x.strides[1],c=0;c<newWidth;c++)for(var sourceFracCol=effectiveColSizeRatio*c,sourceColFloor=Math.floor(sourceFracCol),colFrac=sourceFracCol-sourceColFloor,sourceColCeil=Math.min(oldWidth-1,Math.ceil(sourceFracCol)),topLeftOffest=topRowOffset+sourceColFloor*x.strides[2],botLeftOffset=botRowOffset+sourceColFloor*x.strides[2],topRightOffset=topRowOffset+ +sourceColCeil*x.strides[2],botRightOffest=botRowOffset+sourceColCeil*x.strides[2],d=0;d<numChannels;d++){var topLeft=xValues[topLeftOffest+d],bottomLeft=xValues[botLeftOffset+d],topRight=xValues[topRightOffset+d],bottomRight=xValues[botRightOffest+d],top_1=topLeft+(topRight-topLeft)*colFrac,bottom=bottomLeft+(bottomRight-bottomLeft)*colFrac,newValue=top_1+(bottom-top_1)*rowFrac;result[outputIdx++]=newValue}return ops.tensor(result,[batch,newHeight,newWidth,numChannels])},MathBackendCPU.prototype.resizeBilinearBackprop=function(dy,x,alignCorners){this.assertNotComplex([dy,x],"resizeBilinearBackprop");for(var _a=x.shape,batch=_a[0],xHeight=_a[1],xWidth=_a[2],depth=_a[3],_b=dy.shape,yHeight=_b[1],yWidth=_b[2],output=new Float32Array(batch*xHeight*xWidth*depth),effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth],effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth],heightScale=effectiveXSize[0]/effectiveYSize[0],widthScale=effectiveXSize[1]/effectiveYSize[1],dyValues=dy.dataSync(),offset=0,b=0;b<batch;b++)for(var bOffset=b*x.strides[0],r=0;r<yHeight;r++)for(var dxR=r*heightScale,topDxRIndex=Math.floor(dxR),bottomDxRIndex=Math.min(Math.ceil(dxR),xHeight-1),topDxROffset=bOffset+topDxRIndex*x.strides[1],bottomDxROffset=bOffset+bottomDxRIndex*x.strides[1],dxRLerp=dxR-topDxRIndex,inverseDxRLerp=1-dxRLerp,c=0;c<yWidth;c++)for(var dxC=c*widthScale,leftDxCIndex=Math.floor(dxC),rightDxCIndex=Math.min(Math.ceil(dxC),xWidth-1),dxCLerp=dxC-leftDxCIndex,inverseDxCLerp=1-dxCLerp,topLeftRCOffset=topDxROffset+leftDxCIndex*x.strides[2],topRightRCOffset=topDxROffset+rightDxCIndex*x.strides[2],bottomLeftRCOffset=bottomDxROffset+leftDxCIndex*x.strides[2],bottomRightRCOffset=bottomDxROffset+rightDxCIndex*x.strides[2],inverseDxRLerpTimesInverseDxCLerp=inverseDxRLerp*inverseDxCLerp,inverseDxRLerpTimesDxCLerp=inverseDxRLerp*dxCLerp,dxRLerpTimesInverseDxCLerp=dxRLerp*inverseDxCLerp,dxRLerpTimesDxCLerp=dxRLerp*dxCLerp,d=0;d<depth;d++){var dyVal=dyValues[offset++];output[topLeftRCOffset+d]+=dyVal*inverseDxRLerpTimesInverseDxCLerp,output[topRightRCOffset+d]+=dyVal*inverseDxRLerpTimesDxCLerp,output[bottomLeftRCOffset+d]+=dyVal*dxRLerpTimesInverseDxCLerp,output[bottomRightRCOffset+d]+=dyVal*dxRLerpTimesDxCLerp}return ops.tensor4d(output,[batch,xWidth,xHeight,depth],x.dtype)},MathBackendCPU.prototype.resizeNearestNeighbor=function(x,newHeight,newWidth,alignCorners){this.assertNotComplex(x,"resizeNearestNeighbor")
;for(var _a=x.shape,batch=_a[0],oldHeight=_a[1],oldWidth=_a[2],numChannels=_a[3],xValues=x.dataSync(),output=new Float32Array(batch*newHeight*newWidth*numChannels),effectiveInputSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutputSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth],effectiveRowSizeRatio=effectiveInputSize[0]/effectiveOutputSize[0],effectiveColSizeRatio=effectiveInputSize[1]/effectiveOutputSize[1],outputOffset=0,b=0;b<batch;b++)for(var batchOffset=b*x.strides[0],r=0;r<newHeight;r++)for(var sourceFracRow=effectiveRowSizeRatio*r,sourceNearestRow=Math.min(oldHeight-1,alignCorners?Math.round(sourceFracRow):Math.floor(sourceFracRow)),rowOffset=batchOffset+sourceNearestRow*x.strides[1],c=0;c<newWidth;c++)for(var sourceFracCol=effectiveColSizeRatio*c,sourceNearestCol=Math.min(oldWidth-1,alignCorners?Math.round(sourceFracCol):Math.floor(sourceFracCol)),colOffset=rowOffset+sourceNearestCol*x.strides[2],d=0;d<numChannels;d++){var newVal=xValues[colOffset+d];output[outputOffset++]=newVal}return ops.tensor(output,[batch,newHeight,newWidth,numChannels],x.dtype)},MathBackendCPU.prototype.resizeNearestNeighborBackprop=function(dy,x,alignCorners){this.assertNotComplex([dy,x],"resizeNearestNeighborBackprop");for(var _a=x.shape,batch=_a[0],xHeight=_a[1],xWidth=_a[2],depth=_a[3],_b=dy.shape,yHeight=_b[1],yWidth=_b[2],output=new Float32Array(batch*xHeight*xWidth*depth),dyValues=dy.dataSync(),effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth],effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth],heightScale=effectiveXSize[0]/effectiveYSize[0],widthScale=effectiveXSize[1]/effectiveYSize[1],invHeightScale=1/heightScale,invWidthScale=1/widthScale,winHeight=2*Math.ceil(invHeightScale)+2,winWidth=2*Math.ceil(invWidthScale)+2,b=0;b<batch;b++)for(var batchOffset=b*x.strides[0],r=0;r<xHeight;r++)for(var rowOffset=batchOffset+r*x.strides[1],startRLerp=Math.floor(r*invHeightScale),startDyR=Math.floor(startRLerp-winHeight/2),c=0;c<xWidth;c++)for(var colOffset=rowOffset+c*x.strides[2],startCLerp=Math.floor(c*invWidthScale),startDyC=Math.floor(startCLerp-winWidth/2),d=0;d<depth;d++){for(var accum=0,dyRIndex=0;dyRIndex<winHeight;dyRIndex++){var dyR=dyRIndex+startDyR;if(!(dyR<0||dyR>=yHeight)){var dyROffset=batchOffset+dyR*dy.strides[1],sourceFracRow=dyR*heightScale,sourceNearestRow=Math.min(xHeight-1,alignCorners?Math.round(sourceFracRow):Math.floor(sourceFracRow));if(r===sourceNearestRow)for(var dyCIndex=0;dyCIndex<winWidth;dyCIndex++){var dyC=dyCIndex+startDyC;if(!(dyC<0||dyC>=yWidth)){var dyCOffset=dyROffset+dyC*dy.strides[2],sourceFracCol=dyC*widthScale,sourceNearestCol=Math.min(xWidth-1,alignCorners?Math.round(sourceFracCol):Math.floor(sourceFracCol));c===sourceNearestCol&&(accum+=dyValues[dyCOffset+d])}}}}output[colOffset+d]=accum}return ops.tensor4d(output,x.shape,x.dtype)},MathBackendCPU.prototype.batchNormalization=function(x,mean,variance,varianceEpsilon,scale,offset){this.assertNotComplex([x,mean,variance,scale,offset],"batchNormalization");for(var xVals=x.dataSync(),mVals=mean.dataSync(),varVals=variance.dataSync(),sVals=scale?scale.dataSync():new Float32Array([1]),offVals=offset?offset.dataSync():new Float32Array([0]),outVals=new Float32Array(xVals.length),offValsLength=offVals.length,sValsLength=sVals.length,varValsLength=varVals.length,mValsLength=mVals.length,offi=0,mi=0,si=0,vi=0,i=0;i<xVals.length;++i)outVals[i]=offVals[offi++]+(xVals[i]-mVals[mi++])*sVals[si++]/Math.sqrt(varVals[vi++]+varianceEpsilon),offi>=offValsLength&&(offi=0),mi>=mValsLength&&(mi=0),si>=sValsLength&&(si=0),vi>=varValsLength&&(vi=0);return ops_1.tensor4d(outVals,x.shape)},MathBackendCPU.prototype.localResponseNormalization4D=function(x,depthRadius,bias,alpha,beta){this.assertNotComplex(x,"localResponseNormalization4D");for(var channels=x.shape[3],maxD=channels-1,xValues=x.dataSync(),size=util.sizeFromShape(x.shape),result=new Float32Array(size),offset=0;offset<size;offset++){var sum=function(offset){for(var currentChannel=offset%channels,beginSumOffset=offset-currentChannel+Math.max(0,currentChannel-depthRadius),endSumOffset=offset-currentChannel+Math.min(currentChannel+depthRadius,maxD),sum=0;beginSumOffset<=endSumOffset;beginSumOffset++){var z=xValues[beginSumOffset];sum+=z*z}return sum}(offset),val=xValues[offset]*Math.pow(bias+alpha*sum,-beta);result[offset]=val}return ops.tensor4d(result,x.shape)},MathBackendCPU.prototype.LRNGrad=function(dy,inputImage,outputImage,depthRadius,bias,alpha,beta){this.assertNotComplex(dy,"LRNGrad");for(var channels=dy.shape[3],dyValues=dy.dataSync(),inputImageValues=inputImage.dataSync(),outputImageValues=outputImage.dataSync(),result=new Float32Array(util.sizeFromShape(dy.shape)),size=util.sizeFromShape(dy.shape),offset=0;offset<size;offset++){for(var currentChannel=offset%channels,depthBegin=offset-currentChannel+Math.max(0,currentChannel-depthRadius),depthEnd=offset-currentChannel+Math.min(channels,currentChannel+depthRadius+1),norm=0,k=depthBegin;k<depthEnd;k++)norm+=Math.pow(inputImageValues[k],2);norm=alpha*norm+bias;for(var k=depthBegin;k<depthEnd;k++){var dyi=-2*alpha*beta*inputImageValues[k]*outputImageValues[offset]/norm;offset===k&&(dyi+=Math.pow(norm,-beta)),dyi*=dyValues[offset],result[k]+=dyi}}return ops.tensor4d(result,dy.shape)},MathBackendCPU.prototype.multinomial=function(logits,normalized,numSamples,seed){this.assertNotComplex(logits,"multinomial");for(var probabilities=normalized?logits:ops.softmax(logits),batchSize=probabilities.shape[0],numEvents=probabilities.shape[1],res=ops.zeros([batchSize,numSamples],"int32"),resVals=res.dataSync(),probVals=probabilities.dataSync(),b=0;b<batchSize;++b){var offset=b*numEvents,cdf=new Float32Array(numEvents-1);cdf[0]=probVals[offset];for(var event_1=1;event_1<cdf.length;++event_1)cdf[event_1]=cdf[event_1-1]+probVals[offset+event_1];for(var random=seedrandom.alea(seed.toString()),outOffset=b*numSamples,sampleId=0;sampleId<numSamples;++sampleId){var r=random();resVals[outOffset+sampleId]=cdf.length;for(var event_2=0;event_2<cdf.length;event_2++)if(r<cdf[event_2]){resVals[outOffset+sampleId]=event_2;break}}}return res},MathBackendCPU.prototype.oneHot=function(indices,depth,onValue,offValue){this.assertNotComplex(indices,"oneHot");var res=new Float32Array(indices.size*depth);res.fill(offValue);for(var event_3=0;event_3<indices.size;++event_3)indices.get(event_3)>=0&&indices.get(event_3)<depth&&(res[event_3*depth+indices.get(event_3)]=onValue);return ops.tensor2d(res,[indices.size,depth],"int32")},MathBackendCPU.prototype.nonMaxSuppression=function(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){this.assertNotComplex(boxes,"nonMaxSuppression");var boxesVals=boxes.dataSync(),scoresVals=scores.dataSync();return non_max_suppression_impl_1.nonMaxSuppressionImpl(boxesVals,scoresVals,maxOutputSize,iouThreshold,scoreThreshold)},MathBackendCPU.prototype.fft=function(x){if(1!==x.shape[0])throw new Error("tf.fft() on CPU only supports vectors.");return this.fftImpl(x,!1)},MathBackendCPU.prototype.ifft=function(x){if(1!==x.shape[0])throw new Error("tf.ifft() on CPU only supports vectors.");return this.fftImpl(x,!0)},MathBackendCPU.prototype.fftImpl=function(x,inverse){var x1D=x.as1D(),n=x1D.size;if(this.isExponentOf2(n)){var result=this.fftRadix2(x1D,n,inverse).as2D(x.shape[0],x.shape[1]);return inverse&&(result=ops.complex(ops.real(result).div(ops_1.scalar(n)),ops.imag(result).div(ops_1.scalar(n)))),result}var data=x.dataSync(),rawOutput=this.fourierTransformByMatmul(data,n,inverse),output=complex_util.splitRealAndImagArrays(rawOutput);return ops.complex(output.real,output.imag).as2D(x.shape[0],x.shape[1])},MathBackendCPU.prototype.isExponentOf2=function(size){return 0==(size&size-1)},MathBackendCPU.prototype.fftRadix2=function(input,size,inverse){if(1===size)return input;var data=input.dataSync(),half=size/2,evenComplex=complex_util.complexWithEvenIndex(data),evenTensor=ops.complex(evenComplex.real,evenComplex.imag).as1D(),oddComplex=complex_util.complexWithOddIndex(data),oddTensor=ops.complex(oddComplex.real,oddComplex.imag).as1D();evenTensor=this.fftRadix2(evenTensor,half,inverse),oddTensor=this.fftRadix2(oddTensor,half,inverse);var e=complex_util.exponents(size,inverse),exponent=ops.complex(e.real,e.imag).mul(oddTensor),addPart=evenTensor.add(exponent),subPart=evenTensor.sub(exponent),realTensor=ops.real(addPart).concat(ops.real(subPart)),imagTensor=ops.imag(addPart).concat(ops.imag(subPart));return ops.complex(realTensor,imagTensor).as1D()},MathBackendCPU.prototype.fourierTransformByMatmul=function(data,size,inverse){for(var ret=new Float32Array(2*size),r=0;r<size;r++){for(var real=0,imag=0,c=0;c<size;c++){var e=complex_util.exponent(r*c,size,inverse),term=complex_util.getComplexWithIndex(data,c);real+=term.real*e.real-term.imag*e.imag,imag+=term.real*e.imag+term.imag*e.real}inverse&&(real/=size,imag/=size),complex_util.assignToTypedArray(ret,real,imag,r)}return ret},MathBackendCPU.prototype.depthToSpace=function(x,blockSize,dataFormat){util.assert("NHWC"===dataFormat,"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+dataFormat),util.assert(blockSize>1,"blockSize should be > 1 for depthToSpace, but was: "+blockSize);for(var batchSize=x.shape[0],inputHeight=x.shape[1],inputWidth=x.shape[2],inputDepth=x.shape[3],outputHeight=inputHeight*blockSize,outputWidth=inputWidth*blockSize,outputDepth=inputDepth/(blockSize*blockSize),xValues=x.dataSync(),result=new Float32Array(batchSize*outputHeight*outputWidth*outputDepth),outputIdx=0,b=0;b<batchSize;++b)for(var h=0;h<outputHeight;++h)for(var inH=Math.floor(h/blockSize),offsetH=h%blockSize,w=0;w<outputWidth;++w)for(var inW=Math.floor(w/blockSize),offsetW=w%blockSize,offsetD=(offsetH*blockSize+offsetW)*outputDepth,d=0;d<outputDepth;++d){var inD=d+offsetD,inputIdx=inD+inputDepth*(inW+inputWidth*(inH+inputHeight*b));result[outputIdx++]=xValues[inputIdx]}return ops.tensor4d(result,[batchSize,outputHeight,outputWidth,outputDepth])},MathBackendCPU.prototype.broadcastedBinaryOp=function(a,b,dtype,op){var newShape=broadcast_util.assertAndGetBroadcastShape(a.shape,b.shape),result=ops.buffer(newShape,dtype),aVals=a.dataSync(),bVals=b.dataSync(),aBroadcastDims=broadcast_util.getBroadcastDims(a.shape,newShape),bBroadcastDims=broadcast_util.getBroadcastDims(b.shape,newShape),resVals=result.values;if(aBroadcastDims.length+bBroadcastDims.length===0)for(var i=0;i<resVals.length;++i)resVals[i]=op(aVals[i%aVals.length],bVals[i%bVals.length]);else for(var aBuf=a.buffer(),bBuf=b.buffer(),i=0;i<resVals.length;++i)!function(i){var loc=result.indexToLoc(i),aLoc=loc.slice(-a.rank);aBroadcastDims.forEach(function(d){return aLoc[d]=0});var aIndex=aBuf.locToIndex(aLoc),bLoc=loc.slice(-b.rank);bBroadcastDims.forEach(function(d){return bLoc[d]=0});var bIndex=bBuf.locToIndex(bLoc);resVals[i]=op(aVals[aIndex],bVals[bIndex])}(i);return result.toTensor()},MathBackendCPU.prototype.broadcastedBinaryComplexOp=function(a,b,op){var newShape=broadcast_util.assertAndGetBroadcastShape(a.shape,b.shape),realResult=ops.buffer(newShape,"float32"),imagResult=ops.buffer(newShape,"float32"),aVals=a.dataSync(),bVals=b.dataSync(),aBroadcastDims=broadcast_util.getBroadcastDims(a.shape,newShape),bBroadcastDims=broadcast_util.getBroadcastDims(b.shape,newShape),realVals=realResult.values,imagVals=imagResult.values;if(aBroadcastDims.length+bBroadcastDims.length===0)for(var i=0;i<realVals.length;i++){var aIdx=i%aVals.length,bIdx=i%bVals.length,result=op(aVals[2*aIdx],aVals[2*aIdx+1],bVals[2*bIdx],bVals[2*bIdx+1]);realVals[i]=result.real,imagVals[i]=result.imag}else for(var aRealBuf=this.data.get(a.dataId).complexTensors.real.buffer(),bRealBuf=this.data.get(b.dataId).complexTensors.real.buffer(),i=0;i<realVals.length;i++)!function(i){var loc=realResult.indexToLoc(i),aLoc=loc.slice(-a.rank);aBroadcastDims.forEach(function(d){return aLoc[d]=0});var aIndex=aRealBuf.locToIndex(aLoc),bLoc=loc.slice(-b.rank);bBroadcastDims.forEach(function(d){return bLoc[d]=0});var bIndex=bRealBuf.locToIndex(bLoc),opResult=op(aVals[2*aIndex],aVals[2*aIndex+1],bVals[2*bIndex],bVals[2*bIndex+1]);realVals[i]=opResult.real,imagVals[i]=opResult.imag}(i);return this.complex(realResult.toTensor(),imagResult.toTensor())},MathBackendCPU.prototype.split=function(x,sizeSplits,axis){return split_shared_1.split(x,sizeSplits,axis)},MathBackendCPU.prototype.dispose=function(){},MathBackendCPU.prototype.floatPrecision=function(){return 32},MathBackendCPU.prototype.cropAndResize=function(images,boxes,boxIndex,cropSize,method,extrapolationValue){for(var _a=images.shape,batch=_a[0],imageHeight=_a[1],imageWidth=_a[2],numChannels=_a[3],numBoxes=boxes.shape[0],cropHeight=cropSize[0],cropWidth=cropSize[1],output=ops.buffer([numBoxes,cropHeight,cropWidth,numChannels]),boxVals=boxes.dataSync(),boxIndVals=boxIndex.dataSync(),imageVals=images.dataSync(),inStride=images.strides,outStride=output.strides,b=0;b<numBoxes;b++){var startInd=4*b,y1=boxVals[startInd],x1=boxVals[startInd+1],y2=boxVals[startInd+2],x2=boxVals[startInd+3],bInd=boxIndVals[b];if(!(bInd>=batch))for(var heightScale=cropHeight>1?(y2-y1)*(imageHeight-1)/(cropHeight-1):0,widthScale=cropWidth>1?(x2-x1)*(imageWidth-1)/(cropWidth-1):0,y=0;y<cropHeight;y++){var yInd=cropHeight>1?y1*(imageHeight-1)+y*heightScale:.5*(y1+y2)*(imageHeight-1);if(yInd<0||yInd>imageHeight-1)for(var x=0;x<cropWidth;x++)for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}else if("bilinear"===method)for(var topInd=Math.floor(yInd),bottomInd=Math.ceil(yInd),yLerp=yInd-topInd,x=0;x<cropWidth;x++){var xInd=cropWidth>1?x1*(imageWidth-1)+x*widthScale:.5*(x1+x2)*(imageWidth-1);if(xInd<0||xInd>imageWidth-1)for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}else for(var leftInd=Math.floor(xInd),rightInd=Math.ceil(xInd),xLerp=xInd-leftInd,c=0;c<numChannels;c++){var ind=c+leftInd*inStride[2]+topInd*inStride[1]+bInd*inStride[0],topLeft=imageVals[ind];ind=c+rightInd*inStride[2]+topInd*inStride[1]+bInd*inStride[0];var topRight=imageVals[ind];ind=c+leftInd*inStride[2]+bottomInd*inStride[1]+bInd*inStride[0];var bottomLeft=imageVals[ind];ind=c+rightInd*inStride[2]+bottomInd*inStride[1]+bInd*inStride[0];var bottomRight=imageVals[ind],top_2=topLeft+(topRight-topLeft)*xLerp,bottom=bottomLeft+(bottomRight-bottomLeft)*xLerp;ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0],output.values[ind]=top_2+(bottom-top_2)*yLerp}}else for(var x=0;x<cropWidth;++x){var xInd=cropWidth>1?x1*(imageWidth-1)+x*widthScale:.5*(x1+x2)*(imageWidth-1);if(xInd<0||xInd>imageWidth-1)for(var c=0;c<numChannels;c++){var ind=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[ind]=extrapolationValue}else for(var closestX=Math.round(xInd),closestY=Math.round(yInd),c=0;c<numChannels;c++){var inInd=c+closestX*inStride[2]+closestY*inStride[1]+bInd*inStride[0],outInd=c+x*outStride[2]+y*outStride[1]+b*outStride[0];output.values[outInd]=imageVals[inInd]}}}}return output.toTensor()},MathBackendCPU.prototype.sparseToDense=function(sparseIndices,sparseValues,outputShape,defaultValue){var _a=scatter_nd_util.calculateShapes(sparseValues,sparseIndices,outputShape),sliceRank=_a.sliceRank,numUpdates=_a.numUpdates,sliceSize=_a.sliceSize,strides=_a.strides,outputSize=_a.outputSize;return this.scatter(sparseIndices,sparseValues,outputShape,outputSize,sliceSize,numUpdates,sliceRank,strides,defaultValue,!1)},MathBackendCPU.prototype.gatherND=function(x,indices){var indicesShape=indices.shape,sliceRank=indicesShape[indicesShape.length-1],_a=gather_nd_util.prepareAndValidate(x,indices),resultShape=_a[0],numSlices=_a[1],sliceSize=_a[2],strides=_a[3];if(0===numSlices)return ops_1.tensor([],resultShape,x.dtype);for(var buffer=new tensor_1.TensorBuffer([numSlices,sliceSize],x.dtype),indicesData=indices.dataSync(),xData=x.dataSync(),i=0;i<numSlices;i++){for(var index=[],flattenIndex=0,j=0;j<sliceRank;j++){var dim=indicesData[i*sliceRank+j];flattenIndex+=dim*strides[j],index.push(dim)}if(flattenIndex<0||flattenIndex>=x.size/sliceSize)throw new Error("Invalid indices: "+index+" does not index into "+x.shape);for(var k=0;k<sliceSize;k++)buffer.values[i*sliceSize+k]=xData[flattenIndex*sliceSize+k]}return buffer.toTensor().reshape(resultShape)},MathBackendCPU.prototype.scatterND=function(indices,updates,shape){var _a=scatter_nd_util.calculateShapes(updates,indices,shape),sliceRank=_a.sliceRank,numUpdates=_a.numUpdates,sliceSize=_a.sliceSize,strides=_a.strides,outputSize=_a.outputSize,defaultValue=ops_1.scalar(0);return this.scatter(indices,updates,shape,outputSize,sliceSize,numUpdates,sliceRank,strides,defaultValue,!0)},MathBackendCPU.prototype.scatter=function(indices,updates,shape,outputSize,sliceSize,numUpdates,sliceRank,strides,defaultValue,sumDupeIndices){var flattenShape=[outputSize/sliceSize,sliceSize],indicesData=indices.dataSync(),updatesData=updates.dataSync();if(0===outputSize)return ops_1.tensor([],shape,updates.dtype);var buffer=new tensor_1.TensorBuffer(flattenShape,updates.dtype);buffer.values.fill(defaultValue.dataSync()[0]);for(var i=0;i<numUpdates;i++){for(var index=[],flattenIndex=0,j=0;j<sliceRank;j++){var dim=indicesData[i*sliceRank+j];index.push(dim),flattenIndex+=dim*strides[j]}if(flattenIndex<0||flattenIndex>=outputSize/sliceSize)throw new Error("Invalid indices: "+index+" does not index into "+shape);for(var k=0;k<sliceSize;k++)sumDupeIndices?buffer.values[flattenIndex*sliceSize+k]+=updatesData[i*sliceSize+k]:buffer.values[flattenIndex*sliceSize+k]=0===updates.rank?updatesData[0]:updatesData[i*sliceSize+k]}return buffer.toTensor().reshape(shape)},MathBackendCPU}();exports.MathBackendCPU=MathBackendCPU,environment_1.ENV.registerBackend("cpu",function(){return new MathBackendCPU},1,tensor_1.setTensorTracker)},{"../environment":58,"../log":140,"../ops/array_ops_util":143,"../ops/axis_util":144,"../ops/broadcast_util":147,"../ops/concat_util":151,"../ops/erf_util":155,"../ops/gather_nd_util":157,"../ops/ops":168,"../ops/scatter_nd_util":176,"../ops/selu_util":179,"../ops/slice_util":181,"../tensor":203,"../types":209,"../util":210,"./backend":74,"./backend_util":76,"./complex_util":78,"./non_max_suppression_impl":79,"./split_shared":81,"./topk_impl":82,"./where_impl":139,seedrandom:286}],76:[function(require,module,exports){"use strict";function castTensor(x,dtype,backend){if("complex64"===dtype){if("complex64"===x.dtype)return x.clone();var zerosTensor=tensor_ops_1.zeros(x.shape),floatX=x.toFloat(),result=backend.complex(floatX,zerosTensor);return zerosTensor.dispose(),floatX.dispose(),result}if(!util_1.hasEncodingLoss(x.dtype,dtype))return tensor_1.Tensor.make(x.shape,{dataId:x.dataId},dtype);if("complex64"===x.dtype){var real=backend.real(x),result=real.cast(dtype);return real.dispose(),result}if("int32"===dtype)return backend.int(x);if("bool"===dtype){var zero=tensor_ops_1.scalar(0,x.dtype),result=backend.notEqual(x,zero);return zero.dispose(),result}throw new Error("Error in Cast: unknown dtype argument ("+dtype+")")}function reshapeTensor(x,shape){return tensor_1.Tensor.make(shape,{dataId:x.dataId},x.dtype)}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),tensor_1=require("../tensor"),util_1=require("../util");exports.castTensor=castTensor,exports.reshapeTensor=reshapeTensor},{"../ops/tensor_ops":187,"../tensor":203,"../util":210}],77:[function(require,module,exports){"use strict";function float32ToTypedArray(a,dtype){if("float32"===dtype||"complex64"===dtype)return a;if("int32"===dtype||"bool"===dtype){for(var result="int32"===dtype?new Int32Array(a.length):new Uint8Array(a.length),i=0;i<result.length;++i)result[i]=Math.round(a[i]);return result}throw new Error("Unknown dtype "+dtype)}function typedArrayToFloat32(a,dtype){return a instanceof Float32Array?a:new Float32Array(a)}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var canvas_util_1=require("../canvas_util"),environment_1=require("../environment"),globals_1=require("../globals"),log_1=require("../log"),array_ops_util=require("../ops/array_ops_util"),axis_util=require("../ops/axis_util"),concat_util_1=require("../ops/concat_util"),gather_nd_util=require("../ops/gather_nd_util"),reduce_util=require("../ops/reduce_util"),scatter_nd_util=require("../ops/scatter_nd_util"),segment_util=require("../ops/segment_util"),slice_util_1=require("../ops/slice_util"),softmax_1=require("../ops/softmax"),tensor_ops_1=require("../ops/tensor_ops"),tensor_1=require("../tensor"),types_1=require("../types"),util=require("../util"),util_1=require("../util"),backend_1=require("./backend"),backend_util=require("./backend_util"),complex_util_1=require("./complex_util"),non_max_suppression_impl_1=require("./non_max_suppression_impl"),split_shared_1=require("./split_shared"),topk_impl_1=require("./topk_impl"),argminmax_gpu_1=require("./webgl/argminmax_gpu"),avg_pool_backprop_gpu_1=require("./webgl/avg_pool_backprop_gpu"),batchnorm_gpu_1=require("./webgl/batchnorm_gpu"),batchnorm_packed_gpu_1=require("./webgl/batchnorm_packed_gpu"),binaryop_complex_gpu=require("./webgl/binaryop_complex_gpu"),binaryop_complex_gpu_1=require("./webgl/binaryop_complex_gpu"),binaryop_gpu=require("./webgl/binaryop_gpu"),binaryop_gpu_1=require("./webgl/binaryop_gpu"),clip_gpu_1=require("./webgl/clip_gpu"),complex_abs_gpu_1=require("./webgl/complex_abs_gpu"),concat_gpu_1=require("./webgl/concat_gpu"),conv_backprop_gpu_1=require("./webgl/conv_backprop_gpu"),conv_backprop_gpu_depthwise_1=require("./webgl/conv_backprop_gpu_depthwise"),conv_gpu_1=require("./webgl/conv_gpu"),conv_gpu_depthwise_1=require("./webgl/conv_gpu_depthwise"),crop_and_resize_gpu_1=require("./webgl/crop_and_resize_gpu"),cumsum_gpu_1=require("./webgl/cumsum_gpu"),depth_to_space_gpu_1=require("./webgl/depth_to_space_gpu"),encode_float_gpu_1=require("./webgl/encode_float_gpu"),fft_gpu=require("./webgl/fft_gpu"),fft_gpu_1=require("./webgl/fft_gpu"),from_pixels_gpu_1=require("./webgl/from_pixels_gpu"),gather_gpu_1=require("./webgl/gather_gpu"),gather_nd_gpu_1=require("./webgl/gather_nd_gpu"),gpgpu_context_1=require("./webgl/gpgpu_context"),gpgpu_math=require("./webgl/gpgpu_math"),im2col_gpu_1=require("./webgl/im2col_gpu"),lrn_gpu_1=require("./webgl/lrn_gpu"),lrn_grad_gpu_1=require("./webgl/lrn_grad_gpu"),max_pool_backprop_gpu_1=require("./webgl/max_pool_backprop_gpu"),mulmat_gpu_1=require("./webgl/mulmat_gpu"),mulmat_packed_gpu_1=require("./webgl/mulmat_packed_gpu"),multinomial_gpu_1=require("./webgl/multinomial_gpu"),onehot_gpu_1=require("./webgl/onehot_gpu"),pack_gpu_1=require("./webgl/pack_gpu"),pad_gpu_1=require("./webgl/pad_gpu"),pool_gpu_1=require("./webgl/pool_gpu"),reduce_gpu_1=require("./webgl/reduce_gpu"),reshape_packed_gpu_1=require("./webgl/reshape_packed_gpu"),resize_bilinear_backprop_gpu_1=require("./webgl/resize_bilinear_backprop_gpu"),resize_bilinear_gpu_1=require("./webgl/resize_bilinear_gpu"),resize_nearest_neighbor_backprop_gpu_1=require("./webgl/resize_nearest_neighbor_backprop_gpu"),resize_nearest_neighbor_gpu_1=require("./webgl/resize_nearest_neighbor_gpu"),reverse_gpu_1=require("./webgl/reverse_gpu"),scatter_gpu_1=require("./webgl/scatter_gpu"),segment_gpu_1=require("./webgl/segment_gpu"),select_gpu_1=require("./webgl/select_gpu"),slice_gpu_1=require("./webgl/slice_gpu"),strided_slice_gpu_1=require("./webgl/strided_slice_gpu"),tex_util_1=require("./webgl/tex_util"),texture_manager_1=require("./webgl/texture_manager"),tile_gpu_1=require("./webgl/tile_gpu"),transpose_gpu_1=require("./webgl/transpose_gpu"),unary_op=require("./webgl/unaryop_gpu"),unaryop_gpu_1=require("./webgl/unaryop_gpu"),unpack_gpu_1=require("./webgl/unpack_gpu"),webgl_util=require("./webgl/webgl_util"),where_impl_1=require("./where_impl"),BEFORE_PAGING_CONSTANT=300;exports.SIZE_UPLOAD_UNIFORM=4,exports.MATMUL_SHARED_DIM_THRESHOLD=1e3;var MathBackendWebGL=function(){function MathBackendWebGL(gpgpu,delayedStorage){if(void 0===delayedStorage&&(delayedStorage=!0),this.gpgpu=gpgpu,this.delayedStorage=delayedStorage,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,environment_1.ENV.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(null==gpgpu){var gl=canvas_util_1.getWebGLContext(environment_1.ENV.get("WEBGL_VERSION"));this.gpgpu=new gpgpu_context_1.GPGPUContext(gl),this.canvas=gl.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpuCreatedLocally=!1,this.canvas=gpgpu.gl.canvas;environment_1.ENV.get("WEBGL_PAGING_ENABLED")&&(this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*BEFORE_PAGING_CONSTANT),this.textureManager=new texture_manager_1.TextureManager(this.gpgpu)}return MathBackendWebGL.prototype.register=function(dataId,shape,dtype){if(this.texData.has(dataId))throw new Error("Data buffer is already registered");this.texData.set(dataId,{shape:shape,dtype:dtype,values:null,texture:null,complexTensors:null,texShape:null,usage:tex_util_1.TextureUsage.RENDER,isPacked:!1})},MathBackendWebGL.prototype.setDataMover=function(dataMover){this.texData=new backend_1.DataStorage(dataMover)},MathBackendWebGL.prototype.fromPixels=function(pixels,numChannels){if(null==pixels)throw new Error("pixels passed to tf.fromPixels() can not be null");var texShape=[pixels.height,pixels.width],outShape=[pixels.height,pixels.width,numChannels];if(!(pixels instanceof HTMLVideoElement||pixels instanceof HTMLImageElement||pixels instanceof HTMLCanvasElement||pixels instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+pixels.constructor.name);if(pixels instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if(!environment_1.ENV.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=pixels.width,this.fromPixels2DContext.canvas.height=pixels.height,this.fromPixels2DContext.drawImage(pixels,0,0,pixels.width,pixels.height),pixels=this.fromPixels2DContext.canvas}var tempPixelHandle=this.makeTensorHandle(texShape,"int32");this.texData.get(tempPixelHandle.dataId).usage=tex_util_1.TextureUsage.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(tempPixelHandle.dataId),pixels);var program=new from_pixels_gpu_1.FromPixelsProgram(outShape),res=this.compileAndRun(program,[tempPixelHandle]);return this.disposeData(tempPixelHandle.dataId),res},MathBackendWebGL.prototype.makeTensorHandle=function(shape,dtype){var dataId={};return this.register(dataId,shape,dtype),{dataId:dataId,shape:shape,dtype:dtype}},MathBackendWebGL.prototype.write=function(dataId,values){if(null==values)throw new Error("MathBackendWebGL.write(): values can not be null");var texData=this.texData.get(dataId),texture=texData.texture,texShape=texData.texShape,usage=texData.usage,dtype=texData.dtype,isPacked=texData.isPacked;if("complex64"===dtype)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=texture&&(this.releaseTexture(dataId,texture,texShape,usage,isPacked),texData.texture=null,texData.texShape=null),texData.usage=tex_util_1.TextureUsage.UPLOAD,texData.values=values,this.delayedStorage||this.uploadToGPU(dataId)},MathBackendWebGL.prototype.readSync=function(dataId){var texData=this.texData.get(dataId),values=texData.values,dtype=texData.dtype,complexTensors=texData.complexTensors;if(null!=values)return this.convertAndCacheOnCPU(dataId);var start,shouldTimeProgram=null!=this.activeTimers;shouldTimeProgram&&(start=performance.now());var result;if("complex64"===dtype){var realValues=complexTensors.real.dataSync(),imagValues=complexTensors.imag.dataSync();result=complex_util_1.mergeRealAndImagArrays(realValues,imagValues)}else result=this.getValuesFromTexture(dataId);return shouldTimeProgram&&(this.downloadWaitMs+=performance.now()-start),this.convertAndCacheOnCPU(dataId,result)},MathBackendWebGL.prototype.read=function(dataId){return __awaiter(this,void 0,void 0,function(){var subscribers_1,texData,texture,values,texShape,bufferOrTexture,vals,dTypeVals,subscribers;return __generator(this,function(_a){switch(_a.label){case 0:if(this.pendingRead.has(dataId))return subscribers_1=this.pendingRead.get(dataId),[2,new Promise(function(resolve){return subscribers_1.push(resolve)})];if(texData=this.texData.get(dataId),texture=texData.texture,values=texData.values,texShape=texData.texShape,null!=values)return[2,this.convertAndCacheOnCPU(dataId)];if(this.pendingRead.set(dataId,[]),!environment_1.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===environment_1.ENV.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return bufferOrTexture=this.gpgpu.maybeCreateBufferFromTexture(texture,texShape[0],texShape[1]),[4,this.gpgpu.createAndWaitForFence()];case 1:return _a.sent(),vals=bufferOrTexture instanceof WebGLTexture?this.getValuesFromTexture(dataId):this.gpgpu.downloadFloat32MatrixFromBuffer(bufferOrTexture,texShape[0],texShape[1]),dTypeVals=this.convertAndCacheOnCPU(dataId,vals),subscribers=this.pendingRead.get(dataId),this.pendingRead.delete(dataId),subscribers.forEach(function(resolve){return resolve(dTypeVals)}),this.pendingDisposal.has(dataId)&&(this.pendingDisposal.delete(dataId),this.disposeData(dataId)),[2,dTypeVals]}})})},MathBackendWebGL.prototype.getValuesFromTexture=function(dataId){var _a=this.texData.get(dataId),shape=_a.shape,dtype=_a.dtype,texture=_a.texture,texShape=_a.texShape;if(environment_1.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(dataId).isPacked){
var batch=util.sizeFromShape(shape.slice(0,shape.length-2)),rows=shape.length>1?shape[shape.length-2]:1,cols=shape[shape.length-1];return this.gpgpu.downloadMatrixFromPackedTexture(texture,batch,rows,cols,texShape[0],texShape[1])}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(texture,texShape[0],texShape[1])}var tmpTarget=this.makeTensorHandle(shape,"float32");tmpTarget.size=util_1.sizeFromShape(shape),this.texData.get(tmpTarget.dataId).usage=tex_util_1.TextureUsage.DOWNLOAD;var program=new encode_float_gpu_1.EncodeFloatProgram(shape);this.compileAndRun(program,[{shape:shape,dtype:dtype,dataId:dataId}],tmpTarget,null,!1);var tmpData=this.texData.get(tmpTarget.dataId),vals=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(tmpData.texture,tmpData.texShape[0],tmpData.texShape[1]);return this.disposeData(tmpTarget.dataId),vals},MathBackendWebGL.prototype.time=function(f){return __awaiter(this,void 0,void 0,function(){var oldActiveTimers,newActiveTimers,outerMostTime,flattenedActiveTimerQueries,flattenedActiveTimerNames,kernelMs,res;return __generator(this,function(_a){switch(_a.label){case 0:return oldActiveTimers=this.activeTimers,newActiveTimers=[],outerMostTime=!1,null==this.programTimersStack?(this.programTimersStack=newActiveTimers,outerMostTime=!0):this.activeTimers.push(newActiveTimers),this.activeTimers=newActiveTimers,f(),flattenedActiveTimerQueries=util.flatten(this.activeTimers.map(function(d){return d.query})).filter(function(d){return null!=d}),flattenedActiveTimerNames=util.flatten(this.activeTimers.map(function(d){return d.name})).filter(function(d){return null!=d}),this.activeTimers=oldActiveTimers,outerMostTime&&(this.programTimersStack=null),[4,Promise.all(flattenedActiveTimerQueries)];case 1:return kernelMs=_a.sent(),res={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:util.sum(kernelMs),getExtraProfileInfo:function(){return kernelMs.map(function(d,i){return{name:flattenedActiveTimerNames[i],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,res]}})})},MathBackendWebGL.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},MathBackendWebGL.prototype.startTimer=function(){return environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},MathBackendWebGL.prototype.endTimer=function(query){return environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),query):(query.endMs=performance.now(),query)},MathBackendWebGL.prototype.getQueryTime=function(query){return __awaiter(this,void 0,void 0,function(){var timerQuery;return __generator(this,function(_a){return environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(query)]:(timerQuery=query,[2,timerQuery.endMs-timerQuery.startMs])})})},MathBackendWebGL.prototype.disposeData=function(dataId){if(!this.pendingDisposal.has(dataId)){if(this.pendingRead.has(dataId))return void this.pendingDisposal.add(dataId);if(this.texData.has(dataId)){var _a=this.texData.get(dataId),texture=_a.texture,texShape=_a.texShape,usage=_a.usage,complexTensors=_a.complexTensors,isPacked=_a.isPacked;null!=texture&&this.releaseTexture(dataId,texture,texShape,usage,isPacked),null!=complexTensors&&(complexTensors.real.dispose(),complexTensors.imag.dispose()),this.texData.delete(dataId)}}},MathBackendWebGL.prototype.getTexture=function(dataId){return this.uploadToGPU(dataId),this.texData.get(dataId).texture},MathBackendWebGL.prototype.getCPUBackend=function(){return environment_1.ENV.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=environment_1.ENV.findBackend("cpu")),this.cpuBackend):null},MathBackendWebGL.prototype.shouldExecuteOnCPU=function(inputs,sizeThreshold){var _this=this;return void 0===sizeThreshold&&(sizeThreshold=10),null!=this.getCPUBackend()&&inputs.every(function(input){return null==_this.texData.get(input.dataId).texture&&input.size<sizeThreshold})},MathBackendWebGL.prototype.getGPGPUContext=function(){return this.gpgpu},MathBackendWebGL.prototype.getCanvas=function(){return this.canvas},MathBackendWebGL.prototype.complex=function(real,imag){var result=this.makeOutputArray(real.shape,"complex64");return this.texData.get(result.dataId).complexTensors={real:environment_1.ENV.engine.keep(real.clone()),imag:environment_1.ENV.engine.keep(imag.clone())},result},MathBackendWebGL.prototype.real=function(input){return this.texData.get(input.dataId).complexTensors.real.clone()},MathBackendWebGL.prototype.imag=function(input){return this.texData.get(input.dataId).complexTensors.imag.clone()},MathBackendWebGL.prototype.slice=function(x,begin,size){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.slice(x,begin,size);var program=new slice_gpu_1.SliceProgram(size),customSetup=program.getCustomSetupFunc(begin);return this.compileAndRun(program,[x],null,customSetup)},MathBackendWebGL.prototype.stridedSlice=function(x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){if(this.shouldExecuteOnCPU([x]))return this.cpuBackend.stridedSlice(x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask);var _a=slice_util_1.getStridedSlicedInfo(x.shape,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask),beginIndex=_a[0],size=_a[1],shrinkAxis=_a[2],shape=size.filter(function(v,index){return-1===shrinkAxis.indexOf(index)});if(shape.some(function(axis){return 0===axis}))return tensor_ops_1.tensor([],shape);var program=new strided_slice_gpu_1.StridedSliceProgram(beginIndex,strides,size,shrinkAxis);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.reverse=function(x,axis){var program=new reverse_gpu_1.ReverseProgram(x.shape,axis);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.concat2Tensors=function(a,b,axis){var outShape=concat_util_1.computeOutShape([a.shape,b.shape],axis),a2D=a.as2D(-1,util_1.sizeFromShape(a.shape.slice(axis))),b2D=b.as2D(-1,util_1.sizeFromShape(b.shape.slice(axis))),program=new concat_gpu_1.ConcatProgram(a2D.shape,b2D.shape);return this.compileAndRun(program,[a2D,b2D]).reshape(outShape)},MathBackendWebGL.prototype.concat=function(tensors,axis){if(this.shouldExecuteOnCPU(tensors))return this.cpuBackend.concat(tensors,axis);if(1===tensors.length)return tensors[0];for(var result=tensors[0],i=1;i<tensors.length;++i)result=this.concat2Tensors(result,tensors[i],axis);return result},MathBackendWebGL.prototype.neg=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.NEG);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.batchMatMul=function(a,b,transposeA,transposeB){var outerShapeA=transposeA?a.shape[2]:a.shape[1],outerShapeB=transposeB?b.shape[1]:b.shape[2],sharedDim=transposeA?a.shape[1]:a.shape[2],_a=a.shape,batch=_a[0];if((1===outerShapeA||1===outerShapeB)&&sharedDim>exports.MATMUL_SHARED_DIM_THRESHOLD){transposeA&&(a=a.transpose([0,2,1])),transposeB&&(b=b.transpose([0,2,1]));var a3D=1===outerShapeB?a:a.as3D(batch,sharedDim,1),axis=1===outerShapeB?2:1,b3D=1===outerShapeB?b.as3D(batch,1,sharedDim):b;return this.multiply(a3D,b3D).sum(axis,!0)}if(1===batch){var aSqueezed=a.as2D(a.shape[1],a.shape[2]),bSqueezed=b.as2D(b.shape[1],b.shape[2]),program=new mulmat_packed_gpu_1.MatMulPackedProgram(aSqueezed.shape,bSqueezed.shape,[outerShapeA,outerShapeB],transposeA,transposeB),result=this.compileAndRun(program,[aSqueezed,bSqueezed],this.makePackedTensor(program.outputShape));return!1===environment_1.ENV.get("WEBGL_LAZILY_UNPACK")&&(result=this.unpackTensor(result)),result.reshape([1,result.shape[0],result.shape[1]])}return this.compileAndRun(new mulmat_gpu_1.MatMulProgram(a.shape,b.shape,transposeA,transposeB),[a,b])},MathBackendWebGL.prototype.multiply=function(a,b){if("complex64"===a.dtype){var aData=this.texData.get(a.dataId),bData=this.texData.get(b.dataId),realProgram=new binaryop_complex_gpu_1.BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.REAL,a.shape,b.shape),imagProgram=new binaryop_complex_gpu_1.BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.IMAG,a.shape,b.shape),inputs=[this.makeComplexComponentTensorHandle(a,aData.complexTensors.real),this.makeComplexComponentTensorHandle(a,aData.complexTensors.imag),this.makeComplexComponentTensorHandle(b,bData.complexTensors.real),this.makeComplexComponentTensorHandle(b,bData.complexTensors.imag)],real=this.compileAndRun(realProgram,inputs),imag=this.compileAndRun(imagProgram,inputs),complex=this.complex(real,imag);return real.dispose(),imag.dispose(),complex}if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.multiply(a,b);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MUL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,a.dtype);return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.batchNormalization=function(x,mean,variance,varianceEpsilon,scale,offset){var inputs=[x,mean,variance],offsetShape=null;null!=offset&&(offsetShape=offset.shape,inputs.push(offset));var scaleShape=null;null!=scale&&(scaleShape=scale.shape,inputs.push(scale));var output=null,envSpecificBatchNormProgram=batchnorm_gpu_1.BatchNormProgram;environment_1.ENV.get("WEBGL_PACK_BATCHNORMALIZATION")&&(output=this.makePackedTensor(x.shape),envSpecificBatchNormProgram=batchnorm_packed_gpu_1.BatchNormPackedProgram);var program=new envSpecificBatchNormProgram(x.shape,mean.shape,variance.shape,offsetShape,scaleShape,varianceEpsilon);return this.compileAndRun(program,inputs,output)},MathBackendWebGL.prototype.localResponseNormalization4D=function(x,radius,bias,alpha,beta){var program=new lrn_gpu_1.LRNProgram(x.shape,radius,bias,alpha,beta);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.LRNGrad=function(dy,inputImage,outputImage,depthRadius,bias,alpha,beta){var program=new lrn_grad_gpu_1.LRNGradProgram(inputImage.shape,depthRadius,bias,alpha,beta);return this.compileAndRun(program,[inputImage,outputImage,dy])},MathBackendWebGL.prototype.tile=function(x,reps){var program=new tile_gpu_1.TileProgram(x.shape,reps);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.pad=function(x,paddings,constantValue){var program=new pad_gpu_1.PadProgram(x.shape,paddings,constantValue);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.transpose=function(x,perm){var program=new transpose_gpu_1.TransposeProgram(x.shape,perm);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.gather=function(x,indices,axis){var program=new gather_gpu_1.GatherProgram(x.shape,indices.size,axis);return this.compileAndRun(program,[x,indices])},MathBackendWebGL.prototype.batchToSpaceND=function(x,blockShape,crops){util.assert(x.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var prod=blockShape.reduce(function(a,b){return a*b}),reshaped=array_ops_util.getReshaped(x.shape,blockShape,prod),permuted=array_ops_util.getPermuted(reshaped.length,blockShape.length),reshapedPermuted=array_ops_util.getReshapedPermuted(x.shape,blockShape,prod),sliceBeginCoords=array_ops_util.getSliceBeginCoords(crops,blockShape.length),sliceSize=array_ops_util.getSliceSize(reshapedPermuted,crops,blockShape.length);return x.reshape(reshaped).transpose(permuted).reshape(reshapedPermuted).slice(sliceBeginCoords,sliceSize)},MathBackendWebGL.prototype.spaceToBatchND=function(x,blockShape,paddings){util.assert(x.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var prod=blockShape.reduce(function(a,b){return a*b}),completePaddings=[[0,0]];completePaddings.push.apply(completePaddings,paddings);for(var i=1+blockShape.length;i<x.shape.length;++i)completePaddings.push([0,0]);var paddedX=x.pad(completePaddings),reshapedPaddedShape=array_ops_util.getReshaped(paddedX.shape,blockShape,prod,!1),permutedReshapedPaddedPermutation=array_ops_util.getPermuted(reshapedPaddedShape.length,blockShape.length,!1),flattenShape=array_ops_util.getReshapedPermuted(paddedX.shape,blockShape,prod,!1);return paddedX.reshape(reshapedPaddedShape).transpose(permutedReshapedPaddedPermutation).reshape(flattenShape)},MathBackendWebGL.prototype.reduce=function(x,reduceType,dtype){var batchSize=x.shape[0],inSize=x.shape[1],windowSize=reduce_util.computeOptimalWindowSize(inSize),reduceInfo={windowSize:windowSize,inSize:inSize,batchSize:batchSize},program=new reduce_gpu_1.ReduceProgram(reduceInfo,reduceType),_a=program.outputShape,rows=_a[0],cols=_a[1],output=this.makeOutputArray([rows,cols],dtype);return this.compileAndRun(program,[x],output),1===output.shape[1]?output:this.reduce(output,reduceType,dtype)},MathBackendWebGL.prototype.argReduce=function(x,reduceType,bestIndicesA){void 0===bestIndicesA&&(bestIndicesA=null);var batchSize=x.shape[0],inSize=x.shape[1];null!=bestIndicesA&&(batchSize=bestIndicesA.shape[0],inSize=bestIndicesA.shape[1]);var windowSize=reduce_util.computeOptimalWindowSize(inSize),reduceInfo={windowSize:windowSize,inSize:inSize,batchSize:batchSize},program=new argminmax_gpu_1.ArgMinMaxProgram(reduceInfo,reduceType,null==bestIndicesA),_a=program.outputShape,rows=_a[0],cols=_a[1],output=this.makeOutputArray([rows,cols],"int32"),inputs=[x];return null!=bestIndicesA&&inputs.push(bestIndicesA),this.compileAndRun(program,inputs,output),1===output.shape[1]?output:this.argReduce(x,reduceType,output)},MathBackendWebGL.prototype.sum=function(x,axes){axis_util.assertAxesAreInnerMostDims("sum",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize),outputDType=types_1.sumOutType(x.dtype);return this.reduce(a2D,"sum",outputDType).reshape(outShape)},MathBackendWebGL.prototype.prod=function(x,axes){var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize),outputDType=types_1.sumOutType(x.dtype);return this.reduce(a2D,"prod",outputDType).reshape(outShape)},MathBackendWebGL.prototype.unsortedSegmentSum=function(x,segmentIds,numSegments){var axis=0,permutation=axis_util.getAxesPermutation([axis],x.rank),permutedX=x;null!=permutation&&(permutedX=x.transpose(permutation),axis=axis_util.getInnerMostAxes(1,x.rank)[0]);var outShape=segment_util.computeOutShape(permutedX.shape,axis,numSegments),inSize=util.sizeFromShape([permutedX.shape[axis]]),a2D=permutedX.as2D(-1,inSize),outputDType=types_1.sumOutType(x.dtype),result=this.segOpCompute(a2D,"unsortedSegmentSum",segmentIds,outputDType,numSegments).reshape(outShape);return null!=permutation&&(result=result.transpose(axis_util.getUndoAxesPermutation(permutation))),result},MathBackendWebGL.prototype.segOpCompute=function(x,segOpType,segmentIds,dtype,numSegments){var batchSize=x.shape[0],inSize=x.shape[1],windowSize=segment_util.segOpComputeOptimalWindowSize(inSize,numSegments),segOpInfo={windowSize:windowSize,inSize:inSize,batchSize:batchSize,numSegments:numSegments},program=new segment_gpu_1.SegmentOpProgram(segOpInfo,segOpType),_a=program.outputShape,rows=_a[0],cols=_a[1],output=this.makeOutputArray([rows,cols],dtype);return this.compileAndRun(program,[x,segmentIds],output),output.shape[1]===numSegments?output:(segmentIds=tensor_ops_1.range(0,numSegments).tile([inSize/windowSize]),this.segOpCompute(output,segOpType,segmentIds,dtype,numSegments))},MathBackendWebGL.prototype.argMin=function(x,axis){var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMin",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.argReduce(a2D,"min").reshape(outShape)},MathBackendWebGL.prototype.argMax=function(x,axis){var axes=[axis];axis_util.assertAxesAreInnerMostDims("argMax",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.argReduce(a2D,"max").reshape(outShape)},MathBackendWebGL.prototype.cumsum=function(x,axis,exclusive,reverse){if(axis!==x.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(x.rank-1)+" but got axis="+axis);var program=new cumsum_gpu_1.CumSumProgram(x.shape,exclusive,reverse);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.equal=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.EQUAL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.notEqual=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.NOT_EQUAL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.less=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.less(a,b);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.lessEqual=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LESS_EQUAL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.greater=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.greater(a,b);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.greaterEqual=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.GREATER_EQUAL,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.logicalNot=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOGICAL_NOT);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.logicalAnd=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_AND,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.logicalOr=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.LOGICAL_OR,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"bool");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.select=function(condition,a,b){var program=new select_gpu_1.SelectProgram(condition.rank,a.shape,a.rank),output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[condition,a,b],output)},MathBackendWebGL.prototype.where=function(condition){log_1.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var condVals=condition.dataSync();return where_impl_1.whereImpl(condition.shape,condVals)},MathBackendWebGL.prototype.topk=function(x,k,sorted){var xVals=x.dataSync();return topk_impl_1.topkImpl(xVals,x.shape,x.dtype,k,sorted)},MathBackendWebGL.prototype.min=function(x,axes){axis_util.assertAxesAreInnerMostDims("min",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.reduce(a2D,"min",a2D.dtype).reshape(outShape)},MathBackendWebGL.prototype.minimum=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.minimum(a,b);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MIN,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.mod=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MOD,a.shape,b.shape),customSetup=program.getCustomSetupFunc();return this.compileAndRun(program,[a,b],null,customSetup)},MathBackendWebGL.prototype.max=function(x,axes){axis_util.assertAxesAreInnerMostDims("max",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.reduce(a2D,"max",a2D.dtype).reshape(outShape)},MathBackendWebGL.prototype.maximum=function(a,b){if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.maximum(a,b);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.MAX,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.all=function(x,axes){axis_util.assertAxesAreInnerMostDims("all",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.reduce(a2D,"all",a2D.dtype).reshape(outShape)},MathBackendWebGL.prototype.any=function(x,axes){axis_util.assertAxesAreInnerMostDims("any",axes,x.rank);var _a=axis_util.computeOutAndReduceShapes(x.shape,axes),outShape=_a[0],reduceShape=_a[1],inSize=util.sizeFromShape(reduceShape),a2D=x.as2D(-1,inSize);return this.reduce(a2D,"any",a2D.dtype).reshape(outShape)},MathBackendWebGL.prototype.squaredDifference=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.SQUARED_DIFFERENCE,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.realDivide=function(a,b){var op=binaryop_gpu.DIV,program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"float32");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.floorDiv=function(a,b){var op=binaryop_gpu.INT_DIV,program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,"int32");return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.add=function(a,b){if("complex64"===a.dtype&&"complex64"===b.dtype)return this.complexSeparableBinaryOp(a,b,binaryop_gpu.ADD);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ADD,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.complexSeparableBinaryOp=function(a,b,op){var _this=this,aData=this.texData.get(a.dataId),bData=this.texData.get(b.dataId),_a=[[aData.complexTensors.real,bData.complexTensors.real],[aData.complexTensors.imag,bData.complexTensors.imag]].map(function(complexParts){var aPart=complexParts[0],bPart=complexParts[1],program=new binaryop_gpu_1.BinaryOpProgram(op,a.shape,b.shape),output=_this.makeOutputArray(program.outputShape,types_1.upcastType(aPart.dtype,bPart.dtype)),aHandle=_this.makeComplexComponentTensorHandle(a,aPart),bHandle=_this.makeComplexComponentTensorHandle(b,bPart);return _this.compileAndRun(program,[aHandle,bHandle],output)}),real=_a[0],imag=_a[1],complex=this.complex(real,imag);return real.dispose(),imag.dispose(),complex},MathBackendWebGL.prototype.makeComplexComponentTensorHandle=function(complexTensor,complexPart){return{dataId:complexPart.dataId,dtype:complexPart.dtype,shape:complexTensor.shape}},MathBackendWebGL.prototype.addN=function(tensors){for(var res=tensors[0],i=1;i<tensors.length;i++)res=this.add(res,tensors[i]);return res},MathBackendWebGL.prototype.subtract=function(a,b){if("complex64"===a.dtype&&"complex64"===b.dtype)return this.complexSeparableBinaryOp(a,b,binaryop_gpu.SUB);if(this.shouldExecuteOnCPU([a,b]))return this.cpuBackend.subtract(a,b);var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.SUB,a.shape,b.shape),output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[a,b],output)},MathBackendWebGL.prototype.pow=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.POW,a.shape,b.shape),customSetup=program.getCustomSetupFunc(),output=this.makeOutputArray(program.outputShape,types_1.upcastType(a.dtype,b.dtype));return this.compileAndRun(program,[a,b],output,customSetup)},MathBackendWebGL.prototype.ceil=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.CEIL);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.floor=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.FLOOR);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.sign=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIGN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.round=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ROUND);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.exp=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.EXP);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.expm1=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.EXPM1);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.log=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOG),customSetup=program.getCustomSetupFunc();return this.compileAndRun(program,[x],null,customSetup)},MathBackendWebGL.prototype.log1p=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.LOG1P);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.sqrt=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SQRT);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.rsqrt=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RSQRT);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.square=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SQUARE);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.reciprocal=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RECIPROCAL);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.relu=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.RELU);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.elu=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ELU);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.eluDer=function(dy,y){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ELU_DER,dy.shape,y.shape);return this.compileAndRun(program,[dy,y])},MathBackendWebGL.prototype.selu=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SELU);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.int=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TO_INT),output=this.makeOutputArray(program.outputShape,"int32");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.clip=function(x,min,max){var program=new clip_gpu_1.ClipProgram(x.shape,min,max);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.abs=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ABS);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.complexAbs=function(x){var xData=this.texData.get(x.dataId),program=new complex_abs_gpu_1.ComplexAbsProgram(x.shape),inputs=[this.makeComplexComponentTensorHandle(x,xData.complexTensors.real),this.makeComplexComponentTensorHandle(x,xData.complexTensors.imag)];return this.compileAndRun(program,inputs)},MathBackendWebGL.prototype.sigmoid=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIGMOID);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.softplus=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SOFTPLUS);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.sin=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SIN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.cos=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.COS);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.tan=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TAN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.asin=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ASIN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.acos=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ACOS);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.atan=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ATAN);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.atan2=function(a,b){var program=new binaryop_gpu_1.BinaryOpProgram(binaryop_gpu.ATAN2,a.shape,b.shape);return this.compileAndRun(program,[a,b])},MathBackendWebGL.prototype.sinh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.SINH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.cosh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.COSH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.tanh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.TANH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.asinh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ASINH);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.acosh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ACOSH),customSetup=program.getCustomSetupFunc();return this.compileAndRun(program,[x],null,customSetup)},MathBackendWebGL.prototype.atanh=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ATANH),customSetup=program.getCustomSetupFunc();return this.compileAndRun(program,[x],null,customSetup)},MathBackendWebGL.prototype.erf=function(x){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.ERF);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.step=function(x,alpha){var program=new unaryop_gpu_1.UnaryOpProgram(x.shape,unary_op.STEP(alpha));return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.conv2dWithIm2Row=function(x,filter,convInfo){var filterWidth=convInfo.filterWidth,filterHeight=convInfo.filterHeight,inChannels=convInfo.inChannels,outWidth=convInfo.outWidth,outHeight=convInfo.outHeight,sharedDim=filterWidth*filterHeight*inChannels,numCols=outHeight*outWidth,x2ColShape=[sharedDim,numCols],xSqueezed=x.squeeze([0]),w2Row=filter.reshape([sharedDim,-1]),im2ColProgram=new im2col_gpu_1.Im2ColProgram(x2ColShape,xSqueezed.shape,convInfo),im2Col=this.compileAndRun(im2ColProgram,[xSqueezed],this.makePackedTensor(x2ColShape)),matmulProgram=new mulmat_packed_gpu_1.MatMulPackedProgram(im2Col.shape,w2Row.shape,[numCols,convInfo.outChannels],!0,!1),product=this.compileAndRun(matmulProgram,[im2Col,w2Row],this.makePackedTensor(matmulProgram.outputShape));return!1===environment_1.ENV.get("WEBGL_LAZILY_UNPACK")&&(product=this.unpackTensor(product)),product.reshape([1,outHeight,outWidth,convInfo.outChannels])},MathBackendWebGL.prototype.conv2d=function(x,filter,convInfo){if(environment_1.ENV.get("WEBGL_CONV_IM2COL")&&1===x.shape[0])return this.conv2dWithIm2Row(x,filter,convInfo);var program=new conv_gpu_1.Conv2DProgram(convInfo);return this.compileAndRun(program,[x,filter])},MathBackendWebGL.prototype.conv2dDerInput=function(dy,filter,convInfo){var program=new conv_backprop_gpu_1.Conv2DDerInputProgram(convInfo);return this.compileAndRun(program,[dy,filter])},MathBackendWebGL.prototype.conv2dDerFilter=function(x,dy,convInfo){var program=new conv_backprop_gpu_1.Conv2DDerFilterProgram(convInfo);return this.compileAndRun(program,[x,dy])},MathBackendWebGL.prototype.depthwiseConv2D=function(x,filter,convInfo){
var program=new conv_gpu_depthwise_1.DepthwiseConv2DProgram(convInfo);return this.compileAndRun(program,[x,filter])},MathBackendWebGL.prototype.depthwiseConv2DDerInput=function(dy,filter,convInfo){var program=new conv_backprop_gpu_depthwise_1.DepthwiseConv2DDerInputProgram(convInfo);return this.compileAndRun(program,[dy,filter])},MathBackendWebGL.prototype.depthwiseConv2DDerFilter=function(x,dy,convInfo){var program=new conv_backprop_gpu_depthwise_1.DepthwiseConv2DDerFilterProgram(convInfo);return this.compileAndRun(program,[x,dy])},MathBackendWebGL.prototype.maxPool=function(x,convInfo){var program=new pool_gpu_1.Pool2DProgram(convInfo,"max",!1),output=this.makeOutputArray(program.outputShape,x.dtype);return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.avgPool=function(x,convInfo){var program=new pool_gpu_1.Pool2DProgram(convInfo,"avg",!1),output=this.makeOutputArray(program.outputShape,"float32");return this.compileAndRun(program,[x],output)},MathBackendWebGL.prototype.maxPoolBackprop=function(dy,x,y,convInfo){var maxPoolPositionsProgram=new pool_gpu_1.Pool2DProgram(convInfo,"max",!0),maxPoolPositions=this.compileAndRun(maxPoolPositionsProgram,[x]),maxPoolBackPropProgram=new max_pool_backprop_gpu_1.MaxPool2DBackpropProgram(convInfo),output=this.makeOutputArray(maxPoolBackPropProgram.outputShape,x.dtype),result=this.compileAndRun(maxPoolBackPropProgram,[dy,maxPoolPositions],output);return maxPoolPositions.dispose(),result},MathBackendWebGL.prototype.avgPoolBackprop=function(dy,x,convInfo){var avgPoolBackpropProgram=new avg_pool_backprop_gpu_1.AvgPool2DBackpropProgram(convInfo),output=this.makeOutputArray(avgPoolBackpropProgram.outputShape,x.dtype);return this.compileAndRun(avgPoolBackpropProgram,[dy],output)},MathBackendWebGL.prototype.cast=function(x,dtype){return backend_util.castTensor(x,dtype,this)},MathBackendWebGL.prototype.reshape=function(x,shape){return this.texData.get(x.dataId).isPacked&&!webgl_util.isReshapeFree(x.shape,shape)?this.packedReshape(x,shape):backend_util.reshapeTensor(x,shape)},MathBackendWebGL.prototype.resizeBilinear=function(x,newHeight,newWidth,alignCorners){var program=new resize_bilinear_gpu_1.ResizeBilinearProgram(x.shape,newHeight,newWidth,alignCorners);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.resizeBilinearBackprop=function(dy,x,alignCorners){var program=new resize_bilinear_backprop_gpu_1.ResizeBilinearBackpropProgram(dy,x,alignCorners);return this.compileAndRun(program,[dy])},MathBackendWebGL.prototype.resizeNearestNeighbor=function(x,newHeight,newWidth,alignCorners){var program=new resize_nearest_neighbor_gpu_1.ResizeNearestNeighborProgram(x.shape,newHeight,newWidth,alignCorners);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.resizeNearestNeighborBackprop=function(dy,x,alignCorners){var program=new resize_nearest_neighbor_backprop_gpu_1.ResizeNearestNeigborBackpropProgram(dy,x,alignCorners);return this.compileAndRun(program,[dy])},MathBackendWebGL.prototype.multinomial=function(logits,normalized,numSamples,seed){var probs=normalized?logits:softmax_1.softmax(logits),batchSize=probs.shape[0],numOutcomes=probs.shape[1],program=new multinomial_gpu_1.MultinomialProgram(batchSize,numOutcomes,numSamples),output=this.makeOutputArray(program.outputShape,"int32"),customSetup=program.getCustomSetupFunc(seed);return this.compileAndRun(program,[probs],output,customSetup)},MathBackendWebGL.prototype.oneHot=function(indices,depth,onValue,offValue){var program=new onehot_gpu_1.OneHotProgram(indices.size,depth,onValue,offValue);return this.compileAndRun(program,[indices])},MathBackendWebGL.prototype.nonMaxSuppression=function(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){log_1.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var boxesVals=boxes.dataSync(),scoresVals=scores.dataSync();return non_max_suppression_impl_1.nonMaxSuppressionImpl(boxesVals,scoresVals,maxOutputSize,iouThreshold,scoreThreshold)},MathBackendWebGL.prototype.cropAndResize=function(image,boxes,boxIndex,cropSize,method,extrapolationValue){var program=new crop_and_resize_gpu_1.CropAndResizeProgram(image.shape,boxes.shape,cropSize,method,extrapolationValue);return this.compileAndRun(program,[image,boxes,boxIndex])},MathBackendWebGL.prototype.depthToSpace=function(x,blockSize,dataFormat){util.assert(blockSize>1,"blockSize should be > 1 for depthToSpace, but was: "+blockSize);var batchSize=x.shape[0],inputHeight="NHWC"===dataFormat?x.shape[1]:x.shape[2],inputWidth="NHWC"===dataFormat?x.shape[2]:x.shape[3],inputDepth="NHWC"===dataFormat?x.shape[3]:x.shape[1],outputHeight=inputHeight*blockSize,outputWidth=inputWidth*blockSize,outputDepth=inputDepth/(blockSize*blockSize),outputShape="NHWC"===dataFormat?[batchSize,outputHeight,outputWidth,outputDepth]:[batchSize,outputDepth,outputHeight,outputWidth],program=new depth_to_space_gpu_1.DepthToSpaceProgram(outputShape,blockSize,dataFormat);return this.compileAndRun(program,[x])},MathBackendWebGL.prototype.split=function(x,sizeSplits,axis){return split_shared_1.split(x,sizeSplits,axis)},MathBackendWebGL.prototype.scatterND=function(indices,updates,shape){var _a=scatter_nd_util.calculateShapes(updates,indices,shape),sliceRank=_a.sliceRank,numUpdates=_a.numUpdates,sliceSize=_a.sliceSize,strides=_a.strides,outputSize=_a.outputSize,flattenShape=[outputSize/sliceSize,sliceSize],flattenIndices=indices.reshape([numUpdates,sliceRank]),flattenX=updates.reshape([numUpdates,sliceSize]);if(0===outputSize)return backend_util.reshapeTensor(tensor_ops_1.tensor([]),shape);var defaultValue=tensor_ops_1.scalar(0),program=new scatter_gpu_1.ScatterProgram(numUpdates,sliceRank,flattenIndices.rank,flattenX.rank,strides,flattenShape);return this.compileAndRun(program,[flattenX,flattenIndices,defaultValue]).reshape(shape)},MathBackendWebGL.prototype.sparseToDense=function(sparseIndices,sparseValues,outputShape,defaultValue){var _a=scatter_nd_util.calculateShapes(sparseValues,sparseIndices,outputShape),sliceRank=_a.sliceRank,numUpdates=_a.numUpdates,strides=_a.strides,outputSize=_a.outputSize,program=new scatter_gpu_1.ScatterProgram(numUpdates,sliceRank,sparseIndices.rank,sparseValues.rank,strides,[outputSize,1],!1);return this.compileAndRun(program,[sparseValues,sparseIndices,defaultValue]).reshape(outputShape)},MathBackendWebGL.prototype.fft=function(x){return this.fftImpl(x,!1)},MathBackendWebGL.prototype.ifft=function(x){return this.fftImpl(x,!0)},MathBackendWebGL.prototype.fftImpl=function(x,inverse){var xData=this.texData.get(x.dataId),realProgram=new fft_gpu_1.FFTProgram(fft_gpu.COMPLEX_FFT.REAL,x.shape,inverse),imagProgram=new fft_gpu_1.FFTProgram(fft_gpu.COMPLEX_FFT.IMAG,x.shape,inverse),inputs=[this.makeComplexComponentTensorHandle(x,xData.complexTensors.real),this.makeComplexComponentTensorHandle(x,xData.complexTensors.imag)],real=this.compileAndRun(realProgram,inputs),imag=this.compileAndRun(imagProgram,inputs),complex=this.complex(real,imag).as2D(x.shape[0],x.shape[1]);return real.dispose(),imag.dispose(),complex},MathBackendWebGL.prototype.gatherND=function(x,indices){var indicesShape=indices.shape,sliceRank=indicesShape[indicesShape.length-1],_a=gather_nd_util.prepareAndValidate(x,indices),resultShape=_a[0],numSlices=_a[1],sliceSize=_a[2],strides=_a[3],flattenIndices=indices.reshape([numSlices,sliceRank]),flattenX=x.reshape([x.size/sliceSize,sliceSize]),program=new gather_nd_gpu_1.GatherNDProgram(sliceRank,strides,[numSlices,sliceSize]);return this.compileAndRun(program,[flattenX,flattenIndices]).reshape(resultShape)},MathBackendWebGL.prototype.makeOutputArray=function(shape,dtype){return tensor_1.Tensor.make(shape,{},dtype)},MathBackendWebGL.prototype.makePackedTensor=function(shape){var packedTensor=tensor_1.Tensor.make(shape,{});return this.texData.get(packedTensor.dataId).isPacked=!0,packedTensor},MathBackendWebGL.prototype.unpackTensor=function(input){var program=new unpack_gpu_1.UnpackProgram(input.shape);return this.compileAndRun(program,[input])},MathBackendWebGL.prototype.getBatchDim=function(shape,dimsToSkip){return void 0===dimsToSkip&&(dimsToSkip=2),util.sizeFromShape(shape.slice(0,shape.length-dimsToSkip))},MathBackendWebGL.prototype.getRowsCols=function(shape){if(0===shape.length)throw Error("Cannot get rows and columns of an empty shape array.");return[shape.length>1?shape[shape.length-2]:1,shape[shape.length-1]]},MathBackendWebGL.prototype.packedReshape=function(input,afterShape){var inputAs3D=input.reshape([this.getBatchDim(input.shape)].concat(this.getRowsCols(input.shape))),afterShapeAs3D=[this.getBatchDim(afterShape)].concat(this.getRowsCols(afterShape)),program=new reshape_packed_gpu_1.ReshapePackedProgram(afterShapeAs3D,inputAs3D.shape);return this.compileAndRun(program,[inputAs3D],this.makePackedTensor(afterShapeAs3D)).reshape(afterShape)},MathBackendWebGL.prototype.compileAndRun=function(program,inputs,output,customSetup,pageToCpu){var _this=this;if(void 0===pageToCpu&&(pageToCpu=!0),null==output&&(output=this.makeOutputArray(program.outputShape,inputs[0].dtype)),0===output.size)return this.texData.get(output.dataId).values=util_1.getTypedArrayFromDType(output.dtype,0),output;var inputsData=inputs.map(function(input){if("complex64"===input.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var texData=_this.texData.get(input.dataId);if(null==texData.texture&&(texData.isPacked||!program.usesPackedTextures)&&util.sizeFromShape(input.shape)<=environment_1.ENV.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:input.shape,texData:null,isUniform:!0,uniformValues:_this.readSync(input.dataId)};if(texData.isPacked!==!!program.usesPackedTextures){var preProcessProgram=void 0,processedInput=void 0;texData.isPacked?(preProcessProgram=new unpack_gpu_1.UnpackProgram(input.shape),processedInput=_this.compileAndRun(preProcessProgram,[input])):(preProcessProgram=new pack_gpu_1.PackProgram(input.shape),processedInput=_this.compileAndRun(preProcessProgram,[input],_this.makePackedTensor(input.shape))),texData=_this.texData.get(processedInput.dataId),input=processedInput}return _this.uploadToGPU(input.dataId),{shape:input.shape,texData:texData,isUniform:!1}});this.uploadToGPU(output.dataId);var query,outputData={shape:output.shape,texData:this.texData.get(output.dataId),isUniform:!1},key=gpgpu_math.makeShaderKey(program,inputsData,outputData),binary=this.getAndSaveBinary(key,function(){return gpgpu_math.compileProgram(_this.gpgpu,program,inputsData,outputData)}),shouldTimeProgram=null!=this.activeTimers;if(shouldTimeProgram&&(query=this.startTimer()),gpgpu_math.runProgram(binary,inputsData,outputData,customSetup),environment_1.ENV.get("WEBGL_PAGING_ENABLED")&&pageToCpu&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var numBytesToPage=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;numBytesToPage>0&&this.lruDataGPU.length>0;){var dataId=this.lruDataGPU.shift(),_a=this.texData.get(dataId),shape=_a.shape,dtype=_a.dtype;numBytesToPage-=this.computeBytes(shape,dtype),this.read(dataId)}return shouldTimeProgram&&(query=this.endTimer(query),this.activeTimers.push({name:program.constructor.name,query:this.getQueryTime(query)})),output},MathBackendWebGL.prototype.getAndSaveBinary=function(key,getBinary){return key in this.binaryCache||(this.binaryCache[key]=getBinary()),this.binaryCache[key]},MathBackendWebGL.prototype.getTextureManager=function(){return this.textureManager},MathBackendWebGL.prototype.dispose=function(){if(!this.disposed){for(var key in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[key].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},MathBackendWebGL.prototype.floatPrecision=function(){var _this=this;return globals_1.tidy(function(){return _this.abs(tensor_ops_1.scalar(1e-8)).get()>0?32:16})},MathBackendWebGL.prototype.uploadToGPU=function(dataId){var texData=this.texData.get(dataId),shape=texData.shape,values=texData.values,texture=texData.texture,dtype=texData.dtype,usage=texData.usage,isPacked=texData.isPacked;if(null==texture){var start,shouldTimeProgram=null!=this.activeTimers;shouldTimeProgram&&(start=performance.now());var texShape=webgl_util.getTextureShapeFromLogicalShape(shape,isPacked);texData.texShape=texShape;var newTexture=this.acquireTexture(dataId,texShape,usage,isPacked);if(texData.texture=newTexture,null!=values){if(isPacked){var batch=util.sizeFromShape(shape.slice(0,shape.length-2)),rows=shape.length>1?shape[shape.length-2]:1,cols=shape[shape.length-1];this.gpgpu.uploadMatrixToPackedTexture(newTexture,batch,rows,cols,typedArrayToFloat32(values,dtype))}else this.gpgpu.uploadMatrixToTexture(newTexture,texShape[0],texShape[1],typedArrayToFloat32(values,dtype));texData.values=null,shouldTimeProgram&&(this.uploadWaitMs+=performance.now()-start)}}else if(environment_1.ENV.get("WEBGL_PAGING_ENABLED")){var index=this.lruDataGPU.indexOf(dataId);index>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(dataId),1),this.lruDataGPU.push(dataId))}},MathBackendWebGL.prototype.convertAndCacheOnCPU=function(dataId,float32Values){var dontKeepCopyOnGPU=this.delayedStorage,texData=this.texData.get(dataId),texture=texData.texture,texShape=texData.texShape,dtype=texData.dtype,usage=texData.usage,isPacked=texData.isPacked;return dontKeepCopyOnGPU&&null!=texture&&(this.releaseTexture(dataId,texture,texShape,usage,isPacked),texData.texture=null,texData.texShape=null),texData.usage=tex_util_1.TextureUsage.UPLOAD,null!=float32Values&&(texData.values=float32ToTypedArray(float32Values,dtype)),texData.values},MathBackendWebGL.prototype.releaseTexture=function(dataId,texture,texShape,texType,isPacked){var _a=this.texData.get(dataId),shape=_a.shape,dtype=_a.dtype;if(environment_1.ENV.get("WEBGL_PAGING_ENABLED")){var idx=this.lruDataGPU.indexOf(dataId);idx>=0&&this.lruDataGPU.splice(idx,1)}this.numBytesInGPU-=this.computeBytes(shape,dtype),this.textureManager.releaseTexture(texture,texShape,texType,isPacked)},MathBackendWebGL.prototype.acquireTexture=function(dataId,texShape,texType,isPacked){var _a=this.texData.get(dataId),shape=_a.shape,dtype=_a.dtype;return environment_1.ENV.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.push(dataId),this.numBytesInGPU+=this.computeBytes(shape,dtype),this.textureManager.acquireTexture(texShape,texType,isPacked)},MathBackendWebGL.prototype.computeBytes=function(shape,dtype){return util.sizeFromShape(shape)*util.bytesPerElement(dtype)},MathBackendWebGL}();exports.MathBackendWebGL=MathBackendWebGL,environment_1.ENV.get("IS_BROWSER")&&environment_1.ENV.registerBackend("webgl",function(){return new MathBackendWebGL},2,tensor_1.setTensorTracker)},{"../canvas_util":55,"../environment":58,"../globals":60,"../log":140,"../ops/array_ops_util":143,"../ops/axis_util":144,"../ops/concat_util":151,"../ops/gather_nd_util":157,"../ops/reduce_util":171,"../ops/scatter_nd_util":176,"../ops/segment_util":178,"../ops/slice_util":181,"../ops/softmax":182,"../ops/tensor_ops":187,"../tensor":203,"../types":209,"../util":210,"./backend":74,"./backend_util":76,"./complex_util":78,"./non_max_suppression_impl":79,"./split_shared":81,"./topk_impl":82,"./webgl/argminmax_gpu":83,"./webgl/avg_pool_backprop_gpu":84,"./webgl/batchnorm_gpu":85,"./webgl/batchnorm_packed_gpu":86,"./webgl/binaryop_complex_gpu":87,"./webgl/binaryop_gpu":88,"./webgl/clip_gpu":89,"./webgl/complex_abs_gpu":90,"./webgl/concat_gpu":91,"./webgl/conv_backprop_gpu":92,"./webgl/conv_backprop_gpu_depthwise":93,"./webgl/conv_gpu":94,"./webgl/conv_gpu_depthwise":95,"./webgl/crop_and_resize_gpu":96,"./webgl/cumsum_gpu":97,"./webgl/depth_to_space_gpu":98,"./webgl/encode_float_gpu":99,"./webgl/fft_gpu":100,"./webgl/from_pixels_gpu":101,"./webgl/gather_gpu":102,"./webgl/gather_nd_gpu":103,"./webgl/gpgpu_context":104,"./webgl/gpgpu_math":105,"./webgl/im2col_gpu":107,"./webgl/lrn_gpu":108,"./webgl/lrn_grad_gpu":109,"./webgl/max_pool_backprop_gpu":110,"./webgl/mulmat_gpu":111,"./webgl/mulmat_packed_gpu":112,"./webgl/multinomial_gpu":113,"./webgl/onehot_gpu":114,"./webgl/pack_gpu":115,"./webgl/pad_gpu":116,"./webgl/pool_gpu":117,"./webgl/reduce_gpu":118,"./webgl/reshape_packed_gpu":119,"./webgl/resize_bilinear_backprop_gpu":120,"./webgl/resize_bilinear_gpu":121,"./webgl/resize_nearest_neighbor_backprop_gpu":122,"./webgl/resize_nearest_neighbor_gpu":123,"./webgl/reverse_gpu":124,"./webgl/scatter_gpu":125,"./webgl/segment_gpu":126,"./webgl/select_gpu":127,"./webgl/slice_gpu":130,"./webgl/strided_slice_gpu":131,"./webgl/tex_util":132,"./webgl/texture_manager":133,"./webgl/tile_gpu":134,"./webgl/transpose_gpu":135,"./webgl/unaryop_gpu":136,"./webgl/unpack_gpu":137,"./webgl/webgl_util":138,"./where_impl":139}],78:[function(require,module,exports){"use strict";function mergeRealAndImagArrays(real,imag){if(real.length!==imag.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+real.length+", imag: "+imag.length+".");for(var result=new Float32Array(2*real.length),i=0;i<result.length;i+=2)result[i]=real[i/2],result[i+1]=imag[i/2];return result}function splitRealAndImagArrays(complex){for(var real=new Float32Array(complex.length/2),imag=new Float32Array(complex.length/2),i=0;i<complex.length;i+=2)real[i/2]=complex[i],imag[i/2]=complex[i+1];return{real:real,imag:imag}}function complexWithEvenIndex(complex){for(var len=Math.ceil(complex.length/4),real=new Float32Array(len),imag=new Float32Array(len),i=0;i<complex.length;i+=4)real[Math.floor(i/4)]=complex[i],imag[Math.floor(i/4)]=complex[i+1];return{real:real,imag:imag}}function complexWithOddIndex(complex){for(var len=Math.floor(complex.length/4),real=new Float32Array(len),imag=new Float32Array(len),i=2;i<complex.length;i+=4)real[Math.floor(i/4)]=complex[i],imag[Math.floor(i/4)]=complex[i+1];return{real:real,imag:imag}}function getComplexWithIndex(complex,index){return{real:complex[2*index],imag:complex[2*index+1]}}function assignToTypedArray(data,real,imag,index){data[2*index]=real,data[2*index+1]=imag}function exponents(n,inverse){for(var real=new Float32Array(n/2),imag=new Float32Array(n/2),i=0;i<Math.ceil(n/2);i++){var x=(inverse?2:-2)*Math.PI*(i/n);real[i]=Math.cos(x),imag[i]=Math.sin(x)}return{real:real,imag:imag}}function exponent(k,n,inverse){var x=(inverse?2:-2)*Math.PI*(k/n);return{real:Math.cos(x),imag:Math.sin(x)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeRealAndImagArrays=mergeRealAndImagArrays,exports.splitRealAndImagArrays=splitRealAndImagArrays,exports.complexWithEvenIndex=complexWithEvenIndex,exports.complexWithOddIndex=complexWithOddIndex,exports.getComplexWithIndex=getComplexWithIndex,exports.assignToTypedArray=assignToTypedArray,exports.exponents=exponents,exports.exponent=exponent},{}],79:[function(require,module,exports){"use strict";function nonMaxSuppressionImpl(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){for(var candidates=Array.from(scores).map(function(score,boxIndex){return{score:score,boxIndex:boxIndex}}).filter(function(c){return c.score>scoreThreshold}).sort(function(c1,c2){return c2.score-c1.score}),selected=[],i=0;i<candidates.length;i++){var _a=candidates[i],score=_a.score,boxIndex=_a.boxIndex;if(score<scoreThreshold)break;for(var ignoreCandidate=!1,j=selected.length-1;j>=0;--j){if(intersectionOverUnion(boxes,boxIndex,selected[j])>=iouThreshold){ignoreCandidate=!0;break}}if(!ignoreCandidate&&(selected.push(boxIndex),selected.length>=maxOutputSize))break}return tensor_ops_1.tensor1d(selected,"int32")}function intersectionOverUnion(boxes,i,j){var iCoord=boxes.subarray(4*i,4*i+4),jCoord=boxes.subarray(4*j,4*j+4),yminI=Math.min(iCoord[0],iCoord[2]),xminI=Math.min(iCoord[1],iCoord[3]),ymaxI=Math.max(iCoord[0],iCoord[2]),xmaxI=Math.max(iCoord[1],iCoord[3]),yminJ=Math.min(jCoord[0],jCoord[2]),xminJ=Math.min(jCoord[1],jCoord[3]),ymaxJ=Math.max(jCoord[0],jCoord[2]),xmaxJ=Math.max(jCoord[1],jCoord[3]),areaI=(ymaxI-yminI)*(xmaxI-xminI),areaJ=(ymaxJ-yminJ)*(xmaxJ-xminJ);if(areaI<=0||areaJ<=0)return 0;var intersectionYmin=Math.max(yminI,yminJ),intersectionXmin=Math.max(xminI,xminJ),intersectionYmax=Math.min(ymaxI,ymaxJ),intersectionXmax=Math.min(xmaxI,xmaxJ),intersectionArea=Math.max(intersectionYmax-intersectionYmin,0)*Math.max(intersectionXmax-intersectionXmin,0);return intersectionArea/(areaI+areaJ-intersectionArea)}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops");exports.nonMaxSuppressionImpl=nonMaxSuppressionImpl},{"../ops/tensor_ops":187}],80:[function(require,module,exports){"use strict";function getVecChannels(name,rank){return["x","y","z","w","u","v"].slice(0,rank).map(function(d){return name+"."+d})}function getChannels(name,rank){return 1===rank?[name]:getVecChannels(name,rank)}function getSourceCoords(rank,dims){if(1===rank)return"rc";for(var coords="",i=0;i<rank;i++)coords+=dims[i],i<rank-1&&(coords+=",");return coords}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getVecChannels=getVecChannels,exports.getChannels=getChannels,exports.getSourceCoords=getSourceCoords},{}],81:[function(require,module,exports){"use strict";function split(x,sizeSplits,axis){var begin=Array(x.rank).fill(0),size=x.shape.slice();return sizeSplits.map(function(s){size[axis]=s;var slice=x.slice(begin,size);return begin[axis]+=s,slice})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.split=split},{}],82:[function(require,module,exports){"use strict";function topkImpl(x,xShape,xDtype,k,sorted){for(var lastDim=xShape[xShape.length-1],_a=[x.length/lastDim,lastDim],batch=_a[0],size=_a[1],allTopKVals=util_1.getTypedArrayFromDType(xDtype,batch*k),allTopKIndices=util_1.getTypedArrayFromDType("int32",batch*k),b=0;b<batch;b++){for(var offset=b*size,vals=x.subarray(offset,offset+size),valAndInd=[],i=0;i<vals.length;i++)valAndInd.push({value:vals[i],index:i});valAndInd.sort(function(a,b){return b.value-a.value});for(var outOffset=b*k,topKVals=allTopKVals.subarray(outOffset,outOffset+k),topKIndices=allTopKIndices.subarray(outOffset,outOffset+k),i=0;i<k;i++)topKVals[i]=valAndInd[i].value,topKIndices[i]=valAndInd[i].index}var outputShape=xShape.slice();return outputShape[outputShape.length-1]=k,[tensor_ops_1.tensor(allTopKVals,outputShape,xDtype),tensor_ops_1.tensor(allTopKIndices,outputShape,"int32")]}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("../ops/tensor_ops"),util_1=require("../util");exports.topkImpl=topkImpl},{"../ops/tensor_ops":187,"../util":210}],83:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ArgMinMaxProgram=function(){function ArgMinMaxProgram(reduceInfo,op,firstPass){this.variableNames=["A"];var windowSize=reduceInfo.windowSize,batchSize=reduceInfo.batchSize,inSize=reduceInfo.inSize,outSize=Math.ceil(inSize/windowSize);firstPass||this.variableNames.push("bestIndicesA"),this.outputShape=[batchSize,outSize];var compOp="max"===op?">":"<",indexSnippet=firstPass?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+windowSize+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+windowSize+"; i++) {\n          int inIdx = "+indexSnippet+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+compOp+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}return ArgMinMaxProgram}();exports.ArgMinMaxProgram=ArgMinMaxProgram},{}],84:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AvgPool2DBackpropProgram=function(){function AvgPool2DBackpropProgram(convInfo){this.variableNames=["dy"],this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,avgMultiplier=1/(filterHeight*filterWidth);this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n      const float avgMultiplier = float("+avgMultiplier+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+effectiveFilterHeight+";\n            wR += "+dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+effectiveFilterWidth+";\n            wC+= "+dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return AvgPool2DBackpropProgram}();exports.AvgPool2DBackpropProgram=AvgPool2DBackpropProgram},{}],85:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),BatchNormProgram=function(){function BatchNormProgram(xShape,meanShape,varianceShape,offsetShape,scaleShape,varianceEpsilon){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],broadcast_util.assertAndGetBroadcastShape(xShape,meanShape),broadcast_util.assertAndGetBroadcastShape(xShape,varianceShape);var offsetSnippet="0.0";null!=offsetShape&&(broadcast_util.assertAndGetBroadcastShape(xShape,offsetShape),this.variableNames.push("offset"),offsetSnippet="getOffsetAtOutCoords()");var scaleSnippet="1.0";null!=scaleShape&&(broadcast_util.assertAndGetBroadcastShape(xShape,scaleShape),this.variableNames.push("scale"),scaleSnippet="getScaleAtOutCoords()"),this.outputShape=xShape,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+offsetSnippet+";\n        float scale = "+scaleSnippet+";\n        float inv = scale * inversesqrt(variance + float("+varianceEpsilon+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "}return BatchNormProgram}();exports.BatchNormProgram=BatchNormProgram},{"../../ops/broadcast_util":147}],86:[function(require,module,exports){"use strict";function broadcastSample(texName,rank){var texSampler="get"+texName.charAt(0).toUpperCase()+texName.slice(1);return 1===rank?"\n      vec4 "+texName+"Sample = "+texSampler+"(rc.w);\n      vec4 "+texName+" = vec4("+texName+"Sample.xy, "+texName+"Sample.xy);\n    ":"vec4 "+texName+" = "+texSampler+"(rc.x, rc.y, rc.z, rc.w)"}Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),BatchNormPackedProgram=function(){function BatchNormPackedProgram(xShape,meanShape,varianceShape,offsetShape,scaleShape,varianceEpsilon){this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],broadcast_util.assertAndGetBroadcastShape(xShape,meanShape),broadcast_util.assertAndGetBroadcastShape(xShape,varianceShape);var meanSnippet=broadcastSample("mean",meanShape.length),varianceSnippet=broadcastSample("variance",varianceShape.length),offsetSnippet="vec4 offset = vec4(0.0)";null!=offsetShape&&(broadcast_util.assertAndGetBroadcastShape(xShape,offsetShape),this.variableNames.push("offset"),offsetSnippet=broadcastSample("offset",offsetShape.length));var scaleSnippet="vec4 scale = vec4(1.0)";null!=scaleShape&&(broadcast_util.assertAndGetBroadcastShape(xShape,scaleShape),this.variableNames.push("scale"),scaleSnippet=broadcastSample("scale",scaleShape.length)),this.outputShape=xShape,this.userCode="\n      void main() {\n        ivec4 rc = getOutputCoords();\n\n        "+offsetSnippet+";\n        "+scaleSnippet+";\n\n        vec4 x = getX(rc.x, rc.y, rc.z, rc.w);\n        "+meanSnippet+";\n        "+varianceSnippet+";\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+varianceEpsilon+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "}return BatchNormPackedProgram}();exports.BatchNormPackedProgram=BatchNormPackedProgram},{"../../ops/broadcast_util":147}],87:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util");exports.COMPLEX_MULTIPLY={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};var BinaryOpComplexProgram=function(){function BinaryOpComplexProgram(op,aShape,bShape){this.variableNames=["AReal","AImag","BReal","BImag"],this.supportsBroadcasting=!0,this.outputShape=broadcast_util.assertAndGetBroadcastShape(aShape,bShape),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+op+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "}return BinaryOpComplexProgram}();exports.BinaryOpComplexProgram=BinaryOpComplexProgram},{"../../ops/broadcast_util":147}],88:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),CHECK_NAN_SNIPPET="\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n";exports.ADD="return a + b;",exports.SUB="return a - b;",exports.MUL="return a * b;",exports.DIV="if (a == b) return 1.0;\n  return a / b;",exports.INT_DIV="\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",exports.POW="\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",exports.SQUARED_DIFFERENCE="return (a - b) * (a - b);",exports.EQUAL="return float(a == b);",exports.NOT_EQUAL="return float(a != b);",exports.LESS="return float(a < b);",exports.LESS_EQUAL="return float(a <= b);",exports.GREATER="return float(a > b);",exports.GREATER_EQUAL="return float(a >= b);",exports.LOGICAL_AND="return float(a >= 1.0 && b >= 1.0);",exports.LOGICAL_OR="return float(a >= 1.0 || b >= 1.0);",exports.MAX=CHECK_NAN_SNIPPET+"\n  return max(a, b);\n",exports.MIN=CHECK_NAN_SNIPPET+"\n  return min(a, b);\n",exports.MOD="if (b == 0.0) return NAN;\n  return mod(a, b);",exports.ATAN2=CHECK_NAN_SNIPPET+"\n  return atan(a, b);\n",
exports.ELU_DER="return (b >= 1.0) ? a : a * (b + 1.0);";var BinaryOpProgram=function(){function BinaryOpProgram(op,aShape,bShape){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=broadcast_util.assertAndGetBroadcastShape(aShape,bShape),this.userCode="\n      uniform float NAN;\n      float binaryOperation(float a, float b) {\n        "+op+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return BinaryOpProgram.prototype.getCustomSetupFunc=function(){var _this=this;return function(gpgpu,webGLProgram){null==_this.startLoc&&(_this.startLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"NAN"),null==_this.startLoc)||gpgpu.gl.uniform1f(_this.startLoc,NaN)}},BinaryOpProgram}();exports.BinaryOpProgram=BinaryOpProgram},{"../../ops/broadcast_util":147}],89:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ClipProgram=function(){function ClipProgram(aShape,min,max){this.variableNames=["A"],this.outputShape=aShape,this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, float("+min+"), float("+max+")));\n      }\n    "}return ClipProgram}();exports.ClipProgram=ClipProgram},{}],90:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ComplexAbsProgram=function(){function ComplexAbsProgram(shape){this.variableNames=["real","imag"],this.outputShape=shape,this.userCode="\n      void main() {\n        float real = getRealAtOutCoords();\n        float imag = getImagAtOutCoords();\n        vec2 v = vec2(real, imag);\n\n        setOutput(sqrt(dot(v, v)));\n      }\n    "}return ComplexAbsProgram}();exports.ComplexAbsProgram=ComplexAbsProgram},{}],91:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var concat_util=require("../../ops/concat_util"),ConcatProgram=function(){function ConcatProgram(aShape,bShape){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=concat_util.computeOutShape([aShape,bShape],1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+aShape[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+aShape[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "}return ConcatProgram}();exports.ConcatProgram=ConcatProgram},{"../../ops/concat_util":151}],92:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Conv2DDerFilterProgram=function(){function Conv2DDerFilterProgram(convInfo){this.variableNames=["x","dy"],this.outputShape=convInfo.filterShape;var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+convInfo.batchSize+"; b++) {\n          for (int yR = 0; yR < "+convInfo.outHeight+"; yR++) {\n            int xR = wR + yR * "+strideHeight+" - "+padTop+";\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+convInfo.outWidth+"; yC++) {\n              int xC = wC + yC * "+strideWidth+" - "+padLeft+";\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv2DDerFilterProgram}();exports.Conv2DDerFilterProgram=Conv2DDerFilterProgram;var Conv2DDerInputProgram=function(){function Conv2DDerInputProgram(convInfo){this.variableNames=["dy","W"],this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padTop=filterHeight-1-convInfo.padInfo.top,padLeft=filterWidth-1-convInfo.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+filterHeight+" - 1 - wR;\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+filterWidth+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+convInfo.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv2DDerInputProgram}();exports.Conv2DDerInputProgram=Conv2DDerInputProgram},{}],93:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DepthwiseConv2DDerFilterProgram=function(){function DepthwiseConv2DDerFilterProgram(convInfo){this.variableNames=["x","dy"],this.outputShape=convInfo.filterShape;var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+channelMul+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+convInfo.batchSize+"; b++) {\n          for (int yR = 0; yR < "+convInfo.outHeight+"; yR++) {\n            int xR = wR + yR * "+strideHeight+" - "+padTop+";\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+convInfo.outWidth+"; yC++) {\n              int xC = wC + yC * "+strideWidth+" - "+padLeft+";\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DDerFilterProgram}();exports.DepthwiseConv2DDerFilterProgram=DepthwiseConv2DDerFilterProgram;var DepthwiseConv2DDerInputProgram=function(){function DepthwiseConv2DDerInputProgram(convInfo){this.variableNames=["dy","W"],this.outputShape=convInfo.inShape;var filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,padTop=filterHeight-1-convInfo.padInfo.top,padLeft=filterWidth-1-convInfo.padInfo.left,channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+filterHeight+" - 1 - wR;\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+filterWidth+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+channelMul+"; dm++) {\n              int d2 = d1 * "+channelMul+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DDerInputProgram}();exports.DepthwiseConv2DDerInputProgram=DepthwiseConv2DDerInputProgram},{}],94:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Conv2DProgram=function(){function Conv2DProgram(convInfo){this.variableNames=["x","W"],this.outputShape=convInfo.outShape;var padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,inputDepthNearestVec4=4*Math.floor(convInfo.inChannels/4),inputDepthVec4Remainder=convInfo.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+dilationHeight+";\n\n          if (xR < 0 || xR >= "+convInfo.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+dilationWidth+";\n\n            if (xC < 0 || xC >= "+convInfo.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+inputDepthNearestVec4+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===inputDepthVec4Remainder)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+inputDepthNearestVec4+") *\n                getW(wR, wC, "+inputDepthNearestVec4+", d2);\n            } else if ("+(2===inputDepthVec4Remainder)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+inputDepthNearestVec4+"),\n                getX(batch, xR, xC, "+inputDepthNearestVec4+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+inputDepthNearestVec4+", d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===inputDepthVec4Remainder)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+inputDepthNearestVec4+"),\n                getX(batch, xR, xC, "+inputDepthNearestVec4+" + 1),\n                getX(batch, xR, xC, "+inputDepthNearestVec4+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+inputDepthNearestVec4+", d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 1, d2),\n                getW(wR, wC, "+inputDepthNearestVec4+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return Conv2DProgram}();exports.Conv2DProgram=Conv2DProgram},{}],95:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DepthwiseConv2DProgram=function(){function DepthwiseConv2DProgram(convInfo){this.variableNames=["x","W"],this.outputShape=convInfo.outShape;var xNumRows=convInfo.inHeight,xNumCols=convInfo.inWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,filterHeight=convInfo.filterHeight,filterWidth=convInfo.filterWidth,channelMul=convInfo.outChannels/convInfo.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+channelMul+";\n        int q = d2 - d1 * "+channelMul+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+filterHeight+"; wR++) {\n          int xR = xRCorner + wR * "+dilationHeight+";\n\n          if (xR < 0 || xR >= "+xNumRows+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+filterWidth+"; wC++) {\n            int xC = xCCorner + wC * "+dilationWidth+";\n\n            if (xC < 0 || xC >= "+xNumCols+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return DepthwiseConv2DProgram}();exports.DepthwiseConv2DProgram=DepthwiseConv2DProgram},{}],96:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CropAndResizeProgram=function(){function CropAndResizeProgram(imageShape,boxShape,cropSize,method,extrapolationValue){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var batch=imageShape[0],imageHeight=imageShape[1],imageWidth=imageShape[2],depth=imageShape[3],numBoxes=boxShape[0],cropHeight=cropSize[0],cropWidth=cropSize[1];this.outputShape=[numBoxes,cropHeight,cropWidth,depth];var methodId="bilinear"===method?1:0,_a=[imageHeight-1+".0",imageWidth-1+".0"],inputHeightFloat=_a[0],inputWidthFloat=_a[1],_b=cropHeight>1?[""+(imageHeight-1)/(cropHeight-1),"(y2-y1) * height_ratio","y1*"+inputHeightFloat+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+inputHeightFloat],heightRatio=_b[0],heightScale=_b[1],inY=_b[2],_c=cropWidth>1?[""+(imageWidth-1)/(cropWidth-1),"(x2-x1) * width_ratio","x1*"+inputWidthFloat+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+inputWidthFloat],widthRatio=_c[0],widthScale=_c[1],inX=_c[2];this.userCode="\n      const float height_ratio = float("+heightRatio+");\n      const float width_ratio = float("+widthRatio+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+batch+") {\n          return;\n        }\n\n        float height_scale = "+heightScale+";\n        float width_scale = "+widthScale+";\n\n        float in_y = "+inY+";\n        if( in_y < 0.0 || in_y > "+inputHeightFloat+" ) {\n          setOutput(float("+extrapolationValue+"));\n          return;\n        }\n        float in_x = "+inX+";\n        if( in_x < 0.0 || in_x > "+inputWidthFloat+" ) {\n          setOutput(float("+extrapolationValue+"));\n          return;\n        }\n\n        vec2 sourceFracIndexRC = vec2(in_y,in_x);\n        if("+methodId+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));\n\n          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);\n          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);\n          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);\n          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n          float top = topLeft + (topRight - topLeft) * fracRC.y;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n          float newValue = top + (bottom - top) * fracRC.x;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestRC = ivec2(floor(\n            sourceFracIndexRC + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);\n          setOutput(newValue);\n        }\n      }\n    "}return CropAndResizeProgram}();exports.CropAndResizeProgram=CropAndResizeProgram},{}],97:[function(require,module,exports){"use strict";function getCoords(rank,name){if(1===rank)return""+name;if(2===rank)return name+".x, "+name+".y";if(3===rank)return name+".x, "+name+".y, "+name+".z";if(4===rank)return name+".x, "+name+".y, "+name+".z, "+name+".w";throw Error("Cumulative sum for rank "+rank+" is not yet supported")}function getFinalCoord(rank,name){if(1===rank)return""+name;if(2===rank)return name+".y";if(3===rank)return name+".z";if(4===rank)return name+".w";throw Error("Cumulative sum for rank "+rank+" is not yet supported")}Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),CumSumProgram=function(){function CumSumProgram(shape,exclusive,reverse){this.variableNames=["x"],this.outputShape=shape;var rank=shape.length,finalDim=shape[shape.length-1],comparator=reverse?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(reverse?"return "+finalDim+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+shader_compiler_1.getCoordsDataType(rank)+" coords = getOutputCoords();\n        int end = "+getFinalCoord(rank,"coords")+";\n        float val = 0.0;\n        for (int i = "+finalDim+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+comparator+" end) {\n            continue;\n          }\n          if (idx == end && "+exclusive+") {\n            continue;\n          }\n          "+getFinalCoord(rank,"coords")+" = idx;\n          val += getX("+getCoords(rank,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}return CumSumProgram}();exports.CumSumProgram=CumSumProgram},{"./shader_compiler":128}],98:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DepthToSpaceProgram=function(){function DepthToSpaceProgram(outputShape,blockSize,dataFormat){this.variableNames=["x"],this.outputShape=[],this.outputShape=outputShape,this.blockSize=blockSize,this.dataFormat=dataFormat,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+blockSize+";\n      int offset_h = imod(h, "+blockSize+");\n      int in_w = w / "+blockSize+";\n      int offset_w = imod(w, "+blockSize+");\n      int offset_d = (offset_h * "+blockSize+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return DepthToSpaceProgram.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},DepthToSpaceProgram.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},DepthToSpaceProgram.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},DepthToSpaceProgram.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},DepthToSpaceProgram.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},DepthToSpaceProgram}();exports.DepthToSpaceProgram=DepthToSpaceProgram},{}],99:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var EncodeFloatProgram=function(){function EncodeFloatProgram(outputShape){this.variableNames=["A"],this.outputShape=outputShape,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isNaN(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        gl_FragColor = encode_float(x);\n      }\n    "}return EncodeFloatProgram}();exports.EncodeFloatProgram=EncodeFloatProgram},{}],100:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.COMPLEX_FFT={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"};var FFTProgram=function(){function FFTProgram(op,inputShape,inverse){this.variableNames=["real","imag"];var innerDim=inputShape[1];this.outputShape=inputShape;var exponentMultiplierSnippet=inverse?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,resultDenominator=inverse?innerDim+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+exponentMultiplierSnippet+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+op+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+innerDim+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+innerDim+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+resultDenominator+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "}return FFTProgram}();exports.FFTProgram=FFTProgram},{}],101:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FromPixelsProgram=function(){function FromPixelsProgram(outputShape){this.variableNames=["A"];var height=outputShape[0],width=outputShape[1];this.outputShape=outputShape,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+width+".0, "+height+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}return FromPixelsProgram}();exports.FromPixelsProgram=FromPixelsProgram},{}],102:[function(require,module,exports){"use strict";function getSourceCoords(aShape,axis){var rank=aShape.length;if(rank>4)throw Error("Gather for rank "+rank+" is not yet supported");if(1===rank)return"int(getIndices(resRC))";for(var currentCoords=["resRC.x","resRC.y","resRC.z","resRC.w"],sourceCoords=[],i=0;i<aShape.length;i++)i===axis?sourceCoords.push("int(getIndices("+currentCoords[i]+"))"):sourceCoords.push(""+currentCoords[i]);return sourceCoords.join()}Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),GatherProgram=function(){function GatherProgram(aShape,indicesLength,axis){this.variableNames=["A","indices"];var outputShape=aShape.slice();outputShape[axis]=indicesLength,this.outputShape=outputShape,this.rank=outputShape.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),sourceCoords=getSourceCoords(aShape,axis);this.userCode="\n      void main() {\n        "+dtype+" resRC = getOutputCoords();\n        setOutput(getA("+sourceCoords+"));\n      }\n    "}return GatherProgram}();exports.GatherProgram=GatherProgram},{"./shader_compiler":128}],103:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),GatherNDProgram=function(){function GatherNDProgram(sliceDim,strides,shape){this.sliceDim=sliceDim,this.strides=strides,this.variableNames=["x","indices"],this.outputShape=shape;var stridesType=shader_compiler_1.getCoordsDataType(strides.length),dtype=shader_compiler_1.getCoordsDataType(shape.length),strideString=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+stridesType+" strides = "+stridesType+"("+this.strides+");\n         void main() {\n          "+dtype+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+strideString+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "}return GatherNDProgram}();exports.GatherNDProgram=GatherNDProgram},{"./shader_compiler":128}],104:[function(require,module,exports){"use strict";function binSearchLastTrue(arr){for(var start=0,end=arr.length-1,best=-1;start<=end;){var mid=start+end>>1;arr[mid]()?(best=mid,start=mid+1):end=mid-1}return best}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var canvas_util_1=require("../../canvas_util"),environment_1=require("../../environment"),util=require("../../util"),gpgpu_util=require("./gpgpu_util"),tex_util=require("./tex_util"),webgl_util=require("./webgl_util"),GPGPUContext=function(){function GPGPUContext(gl){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],this.gl=null!=gl?gl:canvas_util_1.getWebGLContext(environment_1.ENV.get("WEBGL_VERSION")),1===environment_1.ENV.get("WEBGL_VERSION")?(this.textureFloatExtension=webgl_util.getExtensionOrThrow(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),environment_1.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=webgl_util.getExtensionOrThrow(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=webgl_util.getExtensionOrThrow(this.gl,"EXT_color_buffer_float"),this.vertexBuffer=gpgpu_util.createVertexBuffer(this.gl),this.indexBuffer=gpgpu_util.createIndexBuffer(this.gl),this.framebuffer=webgl_util.createFramebuffer(this.gl),this.textureConfig=gpgpu_util.getTextureConfig(this.gl,this.textureHalfFloatExtension)}return GPGPUContext.prototype.dispose=function(){
var _this=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var gl=this.gl;webgl_util.callAndCheck(gl,function(){return gl.finish()}),webgl_util.callAndCheck(gl,function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,null)}),webgl_util.callAndCheck(gl,function(){return gl.deleteFramebuffer(_this.framebuffer)}),webgl_util.callAndCheck(gl,function(){return gl.bindBuffer(gl.ARRAY_BUFFER,null)}),webgl_util.callAndCheck(gl,function(){return gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)}),webgl_util.callAndCheck(gl,function(){return gl.deleteBuffer(_this.indexBuffer)}),this.disposed=!0}},GPGPUContext.prototype.enableAutomaticDebugValidation=function(enabled){this.autoDebugValidate=enabled,webgl_util.enableDebugWebGLErrorChecking(enabled)},GPGPUContext.prototype.createFloat32MatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createFloat32MatrixTexture(this.gl,rows,columns,this.textureConfig)},GPGPUContext.prototype.createFloat16MatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createFloat16MatrixTexture(this.gl,rows,columns,this.textureConfig)},GPGPUContext.prototype.createUnsignedBytesMatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createUnsignedBytesMatrixTexture(this.gl,rows,columns,this.textureConfig)},GPGPUContext.prototype.uploadPixelDataToTexture=function(texture,pixels){this.throwIfDisposed(),gpgpu_util.uploadPixelDataToTexture(this.gl,texture,pixels)},GPGPUContext.prototype.createFloat16PackedMatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createFloat16PackedMatrixTexture(this.gl,rows,columns,this.textureConfig)},GPGPUContext.prototype.createPackedMatrixTexture=function(rows,columns){return this.throwIfDisposed(),gpgpu_util.createPackedMatrixTexture(this.gl,rows,columns,this.textureConfig)},GPGPUContext.prototype.deleteMatrixTexture=function(texture){var _this=this;this.throwIfDisposed(),this.outputTexture===texture&&(webgl_util.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),webgl_util.callAndCheck(this.gl,function(){return _this.gl.deleteTexture(texture)})},GPGPUContext.prototype.uploadMatrixToTexture=function(texture,rows,columns,matrix){this.throwIfDisposed();var numChannels=webgl_util.getNumChannels();return gpgpu_util.uploadMatrixToTexture(this.gl,texture,rows,columns,matrix,numChannels,this.textureConfig)},GPGPUContext.prototype.uploadMatrixToPackedTexture=function(texture,batch,rows,columns,matrix){return this.throwIfDisposed(),gpgpu_util.uploadMatrixToPackedTexture(this.gl,texture,batch,rows,columns,matrix,this.textureConfig)},GPGPUContext.prototype.downloadFloat32MatrixFromOutputTexture=function(texture,rows,columns){var _this=this;return this.downloadMatrixDriver(texture,function(){return gpgpu_util.downloadFloat32MatrixFromOutputTexture(_this.gl,rows,columns,_this.textureConfig)})},GPGPUContext.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(texture,rows,columns){var _this=this;return this.downloadMatrixDriver(texture,function(){return gpgpu_util.downloadByteEncodedFloatMatrixFromOutputTexture(_this.gl,rows,columns,_this.textureConfig)})},GPGPUContext.prototype.downloadFloat32MatrixFromBuffer=function(buffer,rows,columns){return gpgpu_util.downloadFloat32MatrixFromBuffer(this.gl,buffer,rows,columns,this.textureConfig)},GPGPUContext.prototype.maybeCreateBufferFromTexture=function(texture,rows,columns){this.bindTextureToFrameBuffer(texture);var result=gpgpu_util.maybeCreateBufferFromOutputTexture(this.gl,texture,rows,columns,this.textureConfig);return this.unbindTextureToFrameBuffer(),result},GPGPUContext.prototype.createAndWaitForFence=function(){var fenceContext=this.createFence(this.gl);return this.pollFence(fenceContext)},GPGPUContext.prototype.createFence=function(gl){var query,isFencePassed,_this=this;if(environment_1.ENV.get("WEBGL_FENCE_API_ENABLED")){var gl2_1=gl,sync_1=gl2_1.fenceSync(gl2_1.SYNC_GPU_COMMANDS_COMPLETE,0);gl.flush(),isFencePassed=function(){var status=gl2_1.clientWaitSync(sync_1,0,0);return status===gl2_1.ALREADY_SIGNALED||status===gl2_1.CONDITION_SATISFIED},query=sync_1}else environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(query=this.beginQuery(),this.endQuery(),isFencePassed=function(){return _this.isQueryAvailable(query,environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):isFencePassed=function(){return!0};return{query:query,isFencePassed:isFencePassed}},GPGPUContext.prototype.downloadMatrixFromPackedTexture=function(texture,batch,rows,columns,physicalRows,physicalCols){var _this=this;return this.downloadMatrixDriver(texture,function(){return gpgpu_util.downloadMatrixFromPackedOutputTexture(_this.gl,batch,rows,columns,physicalRows,physicalCols,_this.textureConfig)})},GPGPUContext.prototype.createProgram=function(fragmentShaderSource){this.throwIfDisposed();var gl=this.gl,fragmentShader=webgl_util.createFragmentShader(gl,fragmentShaderSource),vertexShader=gpgpu_util.createVertexShader(gl),program=webgl_util.createProgram(gl);return webgl_util.callAndCheck(gl,function(){return gl.attachShader(program,vertexShader)}),webgl_util.callAndCheck(gl,function(){return gl.attachShader(program,fragmentShader)}),webgl_util.linkProgram(gl,program),this.autoDebugValidate&&webgl_util.validateProgram(gl,program),this.vertexAttrsAreBound||(this.setProgram(program),this.vertexAttrsAreBound=gpgpu_util.bindVertexProgramAttributeStreams(gl,this.program,this.vertexBuffer)),program},GPGPUContext.prototype.deleteProgram=function(program){var _this=this;this.throwIfDisposed(),program===this.program&&(this.program=null),null!=program&&webgl_util.callAndCheck(this.gl,function(){return _this.gl.deleteProgram(program)})},GPGPUContext.prototype.setProgram=function(program){var _this=this;this.throwIfDisposed(),this.program=program,null!=this.program&&this.autoDebugValidate&&webgl_util.validateProgram(this.gl,this.program),webgl_util.callAndCheck(this.gl,function(){return _this.gl.useProgram(program)})},GPGPUContext.prototype.getUniformLocation=function(program,uniformName,shouldThrow){return void 0===shouldThrow&&(shouldThrow=!0),this.throwIfDisposed(),shouldThrow?webgl_util.getProgramUniformLocationOrThrow(this.gl,program,uniformName):webgl_util.getProgramUniformLocation(this.gl,program,uniformName)},GPGPUContext.prototype.getAttributeLocation=function(program,attribute){var _this=this;return this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,function(){return _this.gl.getAttribLocation(program,attribute)})},GPGPUContext.prototype.getUniformLocationNoThrow=function(program,uniformName){return this.throwIfDisposed(),this.gl.getUniformLocation(program,uniformName)},GPGPUContext.prototype.setInputMatrixTexture=function(inputMatrixTexture,uniformLocation,textureUnit){this.throwIfDisposed(),this.throwIfNoProgram(),webgl_util.bindTextureToProgramUniformSampler(this.gl,this.program,inputMatrixTexture,uniformLocation,textureUnit)},GPGPUContext.prototype.setOutputMatrixTexture=function(outputMatrixTexture,rows,columns){this.setOutputMatrixTextureDriver(outputMatrixTexture,columns,rows)},GPGPUContext.prototype.setOutputPackedMatrixTexture=function(outputPackedMatrixTexture,rows,columns){this.throwIfDisposed();var _a=tex_util.getPackedMatrixTextureShapeWidthHeight(rows,columns),width=_a[0],height=_a[1];this.setOutputMatrixTextureDriver(outputPackedMatrixTexture,width,height)},GPGPUContext.prototype.setOutputMatrixWriteRegion=function(startRow,numRows,startColumn,numColumns){this.setOutputMatrixWriteRegionDriver(startColumn,startRow,numColumns,numRows)},GPGPUContext.prototype.setOutputPackedMatrixWriteRegion=function(startRow,numRows,startColumn,numColumns){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},GPGPUContext.prototype.debugValidate=function(){null!=this.program&&webgl_util.validateProgram(this.gl,this.program),webgl_util.validateFramebuffer(this.gl)},GPGPUContext.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var gl=this.gl;this.autoDebugValidate&&this.debugValidate(),webgl_util.callAndCheck(gl,function(){return gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)})},GPGPUContext.prototype.blockUntilAllProgramsCompleted=function(){var _this=this;this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,function(){return _this.gl.finish()})},GPGPUContext.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=webgl_util.getExtensionOrThrow(this.gl,2===environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},GPGPUContext.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},GPGPUContext.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},GPGPUContext.prototype.beginQuery=function(){if(2===environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var gl2=this.gl,ext_1=this.getQueryTimerExtensionWebGL2(),query_1=gl2.createQuery();return gl2.beginQuery(ext_1.TIME_ELAPSED_EXT,query_1),query_1}var ext=this.getQueryTimerExtensionWebGL1(),query=ext.createQueryEXT();return ext.beginQueryEXT(ext.TIME_ELAPSED_EXT,query),query},GPGPUContext.prototype.endQuery=function(){if(2===environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var gl2=this.gl,ext_2=this.getQueryTimerExtensionWebGL2();return void gl2.endQuery(ext_2.TIME_ELAPSED_EXT)}var ext=this.getQueryTimerExtensionWebGL1();ext.endQueryEXT(ext.TIME_ELAPSED_EXT)},GPGPUContext.prototype.waitForQueryAndGetTime=function(query){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,util.repeatedTry(function(){return _this.disposed||_this.isQueryAvailable(query,environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return _a.sent(),[2,this.getQueryTime(query,environment_1.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},GPGPUContext.prototype.getQueryTime=function(query,queryTimerVersion){if(0===queryTimerVersion)return null;if(2===queryTimerVersion){var gl2=this.gl,timeElapsedNanos=gl2.getQueryParameter(query,gl2.QUERY_RESULT);return timeElapsedNanos/1e6}var ext=this.getQueryTimerExtensionWebGL1(),timeElapsedNanos=ext.getQueryObjectEXT(query,ext.QUERY_RESULT_EXT);return timeElapsedNanos/1e6},GPGPUContext.prototype.isQueryAvailable=function(query,queryTimerVersion){if(0===queryTimerVersion)return!0;if(2===queryTimerVersion){var gl2=this.gl,ext=this.getQueryTimerExtensionWebGL2(),available=gl2.getQueryParameter(query,gl2.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(ext.GPU_DISJOINT_EXT)),available&&!this.disjoint}var ext=this.getQueryTimerExtensionWebGL1(),available=ext.getQueryObjectEXT(query,ext.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(ext.GPU_DISJOINT_EXT)),available&&!this.disjoint},GPGPUContext.prototype.pollFence=function(fenceContext){var _this=this;return new Promise(function(resolve){_this.addItemToPoll(function(){return fenceContext.isFencePassed()},function(){return resolve()})})},GPGPUContext.prototype.pollItems=function(){for(var index=binSearchLastTrue(this.itemsToPoll.map(function(x){return x.isDoneFn})),i=0;i<=index;++i){(0,this.itemsToPoll[i].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(index+1)},GPGPUContext.prototype.addItemToPoll=function(isDoneFn,resolveFn){var _this=this;this.itemsToPoll.push({isDoneFn:isDoneFn,resolveFn:resolveFn}),this.itemsToPoll.length>1||util.repeatedTry(function(){return _this.pollItems(),0===_this.itemsToPoll.length})},GPGPUContext.prototype.bindTextureToFrameBuffer=function(texture){this.throwIfDisposed(),webgl_util.bindColorTextureToFramebuffer(this.gl,texture,this.framebuffer),this.autoDebugValidate&&webgl_util.validateFramebuffer(this.gl)},GPGPUContext.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(webgl_util.bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&webgl_util.validateFramebuffer(this.gl)):webgl_util.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer)},GPGPUContext.prototype.downloadMatrixDriver=function(texture,downloadAndDecode){this.bindTextureToFrameBuffer(texture);var result=downloadAndDecode();return this.unbindTextureToFrameBuffer(),result},GPGPUContext.prototype.setOutputMatrixTextureDriver=function(outputMatrixTextureMaybePacked,width,height){this.throwIfDisposed();var gl=this.gl;webgl_util.bindColorTextureToFramebuffer(gl,outputMatrixTextureMaybePacked,this.framebuffer),this.autoDebugValidate&&webgl_util.validateFramebuffer(gl),this.outputTexture=outputMatrixTextureMaybePacked,webgl_util.callAndCheck(gl,function(){return gl.viewport(0,0,width,height)}),webgl_util.callAndCheck(gl,function(){return gl.scissor(0,0,width,height)})},GPGPUContext.prototype.setOutputMatrixWriteRegionDriver=function(x,y,width,height){var _this=this;this.throwIfDisposed(),webgl_util.callAndCheck(this.gl,function(){return _this.gl.scissor(x,y,width,height)})},GPGPUContext.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},GPGPUContext.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},GPGPUContext}();exports.GPGPUContext=GPGPUContext,exports.binSearchLastTrue=binSearchLastTrue},{"../../canvas_util":55,"../../environment":58,"../../util":210,"./gpgpu_util":106,"./tex_util":132,"./webgl_util":138}],105:[function(require,module,exports){"use strict";function compileProgram(gpgpu,program,inputs,output){for(var userCode=program.userCode,inputInfos=inputs.map(function(input,i){var shapeInfo={logicalShape:input.shape,texShape:input.isUniform?null:input.texData.texShape,isUniform:input.isUniform,isPacked:!input.isUniform&&input.texData.isPacked};return{name:program.variableNames[i],shapeInfo:shapeInfo}}),inShapeInfos=inputInfos.map(function(x){return x.shapeInfo}),outShapeInfo={logicalShape:output.shape,texShape:output.texData.texShape,isUniform:!1,isPacked:output.texData.isPacked},source=shader_compiler.makeShader(inputInfos,outShapeInfo,userCode,!0===program.supportsBroadcasting,program.usesPackedTextures),webGLProgram=gpgpu.createProgram(source),uniformLocations={},i=0;i<program.variableNames.length;i++){var uniformName=program.variableNames[i];uniformLocations[uniformName]=gpgpu.getUniformLocation(webGLProgram,uniformName,!1)}return{program:program,source:source,webGLProgram:webGLProgram,uniformLocations:uniformLocations,gpgpu:gpgpu,inShapeInfos:inShapeInfos,outShapeInfo:outShapeInfo}}function validateBinaryAndProgram(shapeInfos,inputs){if(shapeInfos.length!==inputs.length)throw Error("Binary was compiled with "+shapeInfos.length+" inputs, but was executed with "+inputs.length+" inputs");shapeInfos.forEach(function(s,i){var shapeA=s.logicalShape,input=inputs[i],shapeB=input.shape;if(!util.arraysEqual(shapeA,shapeB))throw Error("Binary was compiled with different shapes than the current args. Shapes "+shapeA+" and "+shapeB+" must match");if(!s.isUniform||!input.isUniform){var texShapeA=s.texShape,texShapeB=input.isUniform?null:input.texData.texShape;if(!util.arraysEqual(texShapeA,texShapeB))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+texShapeA+" and "+texShapeB+" must match")}})}function runProgram(binary,inputs,output,customSetup){validateBinaryAndProgram(binary.inShapeInfos,inputs),validateBinaryAndProgram([binary.outShapeInfo],[output]);var outTex=output.texData.texture,outTexShape=output.texData.texShape,gpgpu=binary.gpgpu;output.texData.isPacked?gpgpu.setOutputPackedMatrixTexture(outTex,outTexShape[0],outTexShape[1]):gpgpu.setOutputMatrixTexture(outTex,outTexShape[0],outTexShape[1]),gpgpu.setProgram(binary.webGLProgram),inputs.forEach(function(input,i){var variableName=binary.program.variableNames[i],variableUniformLocation=binary.uniformLocations[variableName];if(null!=variableUniformLocation){if(input.isUniform){if(1===util.sizeFromShape(input.shape))gpgpu.gl.uniform1f(variableUniformLocation,input.uniformValues[0]);else{var vals=input.uniformValues;vals instanceof Float32Array||(vals=new Float32Array(vals)),gpgpu.gl.uniform1fv(variableUniformLocation,vals)}return}var tex=input.texData.texture;gpgpu.setInputMatrixTexture(tex,variableUniformLocation,i)}}),null!=customSetup&&customSetup(gpgpu,binary.webGLProgram),gpgpu.executeProgram()}function makeShaderKey(program,inputs,output){var keyInputs="";inputs.concat(output).forEach(function(x){keyInputs+=x.shape+"_"+(x.isUniform?"uniform":x.texData.texShape)});var keyUserCode=program.userCode,keyBroadcast=(!0===program.supportsBroadcasting).toString(),key=program.constructor.name;return key+="_"+keyBroadcast+"_"+keyInputs+"_"+keyUserCode}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../../util"),shader_compiler=require("./shader_compiler");exports.compileProgram=compileProgram,exports.runProgram=runProgram,exports.makeShaderKey=makeShaderKey},{"../../util":210,"./shader_compiler":128}],106:[function(require,module,exports){"use strict";function createVertexShader(gl){return webgl_util.createVertexShader(gl,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function createVertexBuffer(gl){var vertexArray=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return webgl_util.createStaticVertexBuffer(gl,vertexArray)}function createIndexBuffer(gl){var triangleVertexIndices=new Uint16Array([0,1,2,2,1,3]);return webgl_util.createStaticIndexBuffer(gl,triangleVertexIndices)}function getTextureConfig(gl,textureHalfFloatExtension){var internalFormatFloat,internalFormatHalfFloat,internalFormatPackedFloat,textureFormatFloat,downloadTextureFormat,downloadUnpackNumChannels,defaultNumChannels,textureTypeHalfFloat,glany=gl;return 2===environment_1.ENV.get("WEBGL_VERSION")?(internalFormatFloat=glany.R32F,internalFormatHalfFloat=glany.R16F,internalFormatPackedFloat=glany.RGBA32F,textureFormatFloat=glany.RED,downloadUnpackNumChannels=4,defaultNumChannels=1,textureTypeHalfFloat=glany.HALF_FLOAT):(internalFormatFloat=gl.RGBA,internalFormatHalfFloat=gl.RGBA,internalFormatPackedFloat=glany.RGBA,textureFormatFloat=gl.RGBA,downloadUnpackNumChannels=4,defaultNumChannels=4,textureTypeHalfFloat=null!=textureHalfFloatExtension?textureHalfFloatExtension.HALF_FLOAT_OES:null),downloadTextureFormat=gl.RGBA,{internalFormatFloat:internalFormatFloat,internalFormatHalfFloat:internalFormatHalfFloat,internalFormatPackedFloat:internalFormatPackedFloat,textureFormatFloat:textureFormatFloat,downloadTextureFormat:downloadTextureFormat,downloadUnpackNumChannels:downloadUnpackNumChannels,defaultNumChannels:defaultNumChannels,textureTypeHalfFloat:textureTypeHalfFloat}}function createAndConfigureTexture(gl,width,height,internalFormat,textureFormat,textureType){webgl_util.validateTextureSize(width,height);var texture=webgl_util.createTexture(gl),tex2d=gl.TEXTURE_2D;return webgl_util.callAndCheck(gl,function(){return gl.bindTexture(tex2d,texture)}),webgl_util.callAndCheck(gl,function(){return gl.texParameteri(tex2d,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE)}),webgl_util.callAndCheck(gl,function(){return gl.texParameteri(tex2d,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}),webgl_util.callAndCheck(gl,function(){return gl.texParameteri(tex2d,gl.TEXTURE_MIN_FILTER,gl.NEAREST)}),webgl_util.callAndCheck(gl,function(){return gl.texParameteri(tex2d,gl.TEXTURE_MAG_FILTER,gl.NEAREST)}),webgl_util.callAndCheck(gl,function(){return gl.texImage2D(tex2d,0,internalFormat,width,height,0,textureFormat,textureType,null)}),webgl_util.callAndCheck(gl,function(){return gl.bindTexture(gl.TEXTURE_2D,null)}),texture}function createFloat32MatrixTexture(gl,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns);return createAndConfigureTexture(gl,_a[0],_a[1],textureConfig.internalFormatFloat,textureConfig.textureFormatFloat,gl.FLOAT)}function createFloat16MatrixTexture(gl,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns);return createAndConfigureTexture(gl,_a[0],_a[1],textureConfig.internalFormatFloat,textureConfig.textureFormatFloat,textureConfig.textureTypeHalfFloat)}function createUnsignedBytesMatrixTexture(gl,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns);return createAndConfigureTexture(gl,_a[0],_a[1],gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE)}function createPackedMatrixTexture(gl,rows,columns,textureConfig){var _a=tex_util.getPackedMatrixTextureShapeWidthHeight(rows,columns);return createAndConfigureTexture(gl,_a[0],_a[1],textureConfig.internalFormatPackedFloat,gl.RGBA,gl.FLOAT)}function createFloat16PackedMatrixTexture(gl,rows,columns,textureConfig){var _a=tex_util.getPackedMatrixTextureShapeWidthHeight(rows,columns);return createAndConfigureTexture(gl,_a[0],_a[1],textureConfig.internalFormatHalfFloat,gl.RGBA,textureConfig.textureTypeHalfFloat)}function bindVertexProgramAttributeStreams(gl,program,vertexBuffer){return webgl_util.callAndCheck(gl,function(){return gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer)}),webgl_util.bindVertexBufferToProgramAttribute(gl,program,"clipSpacePos",vertexBuffer,3,20,0)&&webgl_util.bindVertexBufferToProgramAttribute(gl,program,"uv",vertexBuffer,2,20,12)}function uploadPixelDataToTexture(gl,texture,pixels){webgl_util.callAndCheck(gl,function(){return gl.bindTexture(gl.TEXTURE_2D,texture)}),webgl_util.callAndCheck(gl,function(){return gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,pixels)}),webgl_util.callAndCheck(gl,function(){return gl.bindTexture(gl.TEXTURE_2D,null)})}function uploadDataToTexture(gl,texture,width,height,data,textureFormat){webgl_util.validateTextureSize(width,height),webgl_util.callAndCheck(gl,function(){return gl.bindTexture(gl.TEXTURE_2D,texture)}),webgl_util.callAndCheck(gl,function(){return gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,width,height,textureFormat,gl.FLOAT,data)}),webgl_util.callAndCheck(gl,function(){return gl.bindTexture(gl.TEXTURE_2D,null)})}function uploadMatrixToTexture(gl,texture,rows,columns,matrix,numChannels,textureConfig){var unpackedArray,_a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns),w=_a[0],h=_a[1];1===textureConfig.defaultNumChannels?unpackedArray=matrix:(unpackedArray=new Float32Array(tex_util.getUnpackedArraySizeFromMatrixSize(matrix.length,numChannels)),tex_util.encodeMatrixToUnpackedArray(matrix,unpackedArray,numChannels)),uploadDataToTexture(gl,texture,w,h,unpackedArray,textureConfig.textureFormatFloat)}function uploadMatrixToPackedTexture(gl,texture,batch,rows,columns,matrix,textureConfig){var _a=tex_util.getPackedMatrixTextureShapeWidthHeight(rows,columns),w=_a[0],h=_a[1],packedRGBA=new Float32Array(tex_util.getPackedRGBAArraySizeFromMatrixShape(rows,columns));tex_util.encodeMatrixToPackedRGBA(matrix,batch,rows,columns,packedRGBA),uploadDataToTexture(gl,texture,w,h,packedRGBA,gl.RGBA)}function maybeCreateBufferFromOutputTexture(gl,texture,rows,columns,textureConfig){var bufferOrTexture=texture;if(2===environment_1.ENV.get("WEBGL_VERSION")){var gl2_1=gl,buffer_1=gl2_1.createBuffer();webgl_util.callAndCheck(gl,function(){return gl.bindBuffer(gl2_1.PIXEL_PACK_BUFFER,buffer_1)});var bufferSizeBytes_1=4*tex_util.getUnpackedArraySizeFromMatrixSize(rows*columns,textureConfig.downloadUnpackNumChannels);webgl_util.callAndCheck(gl,function(){return gl.bufferData(gl2_1.PIXEL_PACK_BUFFER,bufferSizeBytes_1,gl.STATIC_DRAW)}),webgl_util.callAndCheck(gl,function(){return gl2_1.readPixels(0,0,columns,rows,gl.RGBA,gl.FLOAT,0)}),webgl_util.callAndCheck(gl,function(){return gl.bindBuffer(gl2_1.PIXEL_PACK_BUFFER,null)}),bufferOrTexture=buffer_1}return bufferOrTexture}function downloadFloat32MatrixFromBuffer(gl,buffer,rows,columns,textureConfig){var gl2=gl,downloadTarget=new Float32Array(tex_util.getUnpackedArraySizeFromMatrixSize(rows*columns,textureConfig.downloadUnpackNumChannels));gl2.bindBuffer(gl.ARRAY_BUFFER,buffer),gl2.getBufferSubData(gl.ARRAY_BUFFER,0,downloadTarget),gl2.bindBuffer(gl.ARRAY_BUFFER,null);var matrix=new Float32Array(rows*columns);return tex_util.decodeMatrixFromUnpackedArray(downloadTarget,matrix,textureConfig.downloadUnpackNumChannels),matrix}function downloadFloat32MatrixFromOutputTexture(gl,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns),w=_a[0],h=_a[1],downloadTarget=new Float32Array(tex_util.getUnpackedArraySizeFromMatrixSize(rows*columns,textureConfig.downloadUnpackNumChannels));webgl_util.callAndCheck(gl,function(){return gl.readPixels(0,0,w,h,textureConfig.downloadTextureFormat,gl.FLOAT,downloadTarget)});var matrix=new Float32Array(rows*columns);return tex_util.decodeMatrixFromUnpackedArray(downloadTarget,matrix,textureConfig.downloadUnpackNumChannels),matrix}function downloadByteEncodedFloatMatrixFromOutputTexture(gl,rows,columns,textureConfig){var _a=tex_util.getUnpackedMatrixTextureShapeWidthHeight(rows,columns),w=_a[0],h=_a[1],downloadTarget=new Uint8Array(tex_util.getUnpackedArraySizeFromMatrixSize(rows*columns,4));return webgl_util.callAndCheck(gl,function(){return gl.readPixels(0,0,w,h,textureConfig.downloadTextureFormat,gl.UNSIGNED_BYTE,downloadTarget)}),new Float32Array(downloadTarget.buffer)}function downloadMatrixFromPackedOutputTexture(gl,batch,rows,cols,physicalRows,physicalCols,textureConfig){var _a=tex_util.getPackedMatrixTextureShapeWidthHeight(physicalRows,physicalCols),w=_a[0],h=_a[1],packedRGBA=new Float32Array(tex_util.getPackedRGBAArraySizeFromMatrixShape(physicalRows,physicalCols));webgl_util.callAndCheck(gl,function(){return gl.readPixels(0,0,w,h,gl.RGBA,gl.FLOAT,packedRGBA)});var matrix=new Float32Array(util.sizeFromShape([batch,rows,cols]));return tex_util.decodeMatrixFromPackedRGBA(packedRGBA,batch,rows,cols,matrix)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util"),tex_util=require("./tex_util"),webgl_util=require("./webgl_util");exports.createVertexShader=createVertexShader,exports.createVertexBuffer=createVertexBuffer,exports.createIndexBuffer=createIndexBuffer,exports.getTextureConfig=getTextureConfig,exports.createFloat32MatrixTexture=createFloat32MatrixTexture,exports.createFloat16MatrixTexture=createFloat16MatrixTexture,exports.createUnsignedBytesMatrixTexture=createUnsignedBytesMatrixTexture,exports.createPackedMatrixTexture=createPackedMatrixTexture,exports.createFloat16PackedMatrixTexture=createFloat16PackedMatrixTexture,exports.bindVertexProgramAttributeStreams=bindVertexProgramAttributeStreams,exports.uploadPixelDataToTexture=uploadPixelDataToTexture,exports.uploadMatrixToTexture=uploadMatrixToTexture,exports.uploadMatrixToPackedTexture=uploadMatrixToPackedTexture,exports.maybeCreateBufferFromOutputTexture=maybeCreateBufferFromOutputTexture,exports.downloadFloat32MatrixFromBuffer=downloadFloat32MatrixFromBuffer,exports.downloadFloat32MatrixFromOutputTexture=downloadFloat32MatrixFromOutputTexture,exports.downloadByteEncodedFloatMatrixFromOutputTexture=downloadByteEncodedFloatMatrixFromOutputTexture,exports.downloadMatrixFromPackedOutputTexture=downloadMatrixFromPackedOutputTexture},{"../../environment":58,"../../util":210,"./tex_util":132,"./webgl_util":138}],107:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Im2ColProgram=function(){function Im2ColProgram(outputShape,inputShape,convInfo){this.variableNames=["A"],this.outputShape=outputShape;var filterWidth=convInfo.filterWidth,inChannels=convInfo.inChannels,strideWidth=convInfo.strideWidth,strideHeight=convInfo.strideHeight,padInfo=convInfo.padInfo,outWidth=convInfo.outWidth,dilationWidth=convInfo.dilationWidth,dilationHeight=convInfo.dilationHeight,left=padInfo.left,top=padInfo.top,itemsPerBlockRow=inChannels*filterWidth;this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+outputShape[1]+" || pos >= "+outputShape[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+outWidth+")) * "+strideHeight+" - "+top+";\n            int d0 = offsetY + "+dilationHeight+" * (pos / "+itemsPerBlockRow+");\n\n            if(d0 >= "+inputShape[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+outWidth+".) * "+strideWidth+". - "+left+".);\n            int d1 = offsetX + "+dilationWidth+" * (int(mod(float(pos), "+itemsPerBlockRow+".) / "+inChannels+".));\n\n            if(d1 >= "+inputShape[1]+" || d1 < 0) continue;\n\n            result[row * 2 + col] = getA(d0, d1, int(mod(float(pos), "+inChannels+".)));\n          }\n        }\n\n        gl_FragColor = result;\n      }\n    "}return Im2ColProgram}();exports.Im2ColProgram=Im2ColProgram},{}],108:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LRNProgram=function(){function LRNProgram(xShape,radius,bias,alpha,beta){this.variableNames=["x"],this.outputShape=[];var rad=radius,maxD=xShape[3]-1;this.outputShape=xShape;var powOperator,basis="float("+bias+") + float("+alpha+") * sum";powOperator=.5===beta?"inversesqrt("+basis+")":1===beta?"1.0/("+basis+")":"exp(log("+basis+") * float(-"+beta+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+rad+"; j <= "+rad+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+maxD+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+powOperator+";\n        setOutput(val);\n      }\n    "}return LRNProgram}();exports.LRNProgram=LRNProgram},{}],109:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LRNGradProgram=function(){function LRNGradProgram(inputShape,depthRadius,bias,alpha,beta){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=inputShape,this.depth=inputShape[3],this.depthRadius=depthRadius,this.bias=bias,this.alpha=alpha,this.beta=beta,
this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+depthRadius+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+depthRadius+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+alpha+") * norm + float("+bias+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+alpha+")\n                * float("+beta+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+beta+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "}return LRNGradProgram}();exports.LRNGradProgram=LRNGradProgram},{}],110:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MaxPool2DBackpropProgram=function(){function MaxPool2DBackpropProgram(convInfo){this.variableNames=["dy","maxPos"],this.outputShape=convInfo.inShape;var strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=effectiveFilterHeight-1-convInfo.padInfo.top,padLeft=effectiveFilterWidth-1-convInfo.padInfo.left,lastIndex=effectiveFilterHeight*effectiveFilterWidth-1;this.userCode="\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+effectiveFilterHeight+";\n          wR += "+dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+convInfo.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+effectiveFilterWidth+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+convInfo.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+lastIndex+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+effectiveFilterWidth+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return MaxPool2DBackpropProgram}();exports.MaxPool2DBackpropProgram=MaxPool2DBackpropProgram},{}],111:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MatMulProgram=function(){function MatMulProgram(aShape,bShape,transposeA,transposeB){void 0===transposeA&&(transposeA=!1),void 0===transposeB&&(transposeB=!1),this.variableNames=["matrixA","matrixB"];var batchSize=aShape[0],outerShapeA=transposeA?aShape[2]:aShape[1],outerShapeB=transposeB?bShape[1]:bShape[2],sharedDim=transposeA?aShape[1]:aShape[2];this.outputShape=[batchSize,outerShapeA,outerShapeB];var aSnippetFromOffset=function(vec4Offset,indexVar){return transposeA?"batch, "+indexVar+" + "+vec4Offset+", aRow":"batch, aRow, "+indexVar+" + "+vec4Offset},bSnippetFromOffset=function(vec4Offset,indexVar){return transposeB?"batch, bCol, "+indexVar+" + "+vec4Offset:"batch, "+indexVar+" + "+vec4Offset+", bCol"},sharedDimNearestVec4=4*Math.floor(sharedDim/4),sharedDimVec4Remainder=sharedDim%4;this.userCode=" float dotARowBCol(int batch, int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+sharedDimNearestVec4+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+aSnippetFromOffset(0,"i")+"),\n          getMatrixA("+aSnippetFromOffset(1,"i")+"),\n          getMatrixA("+aSnippetFromOffset(2,"i")+"),\n          getMatrixA("+aSnippetFromOffset(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+bSnippetFromOffset(0,"i")+"),\n          getMatrixB("+bSnippetFromOffset(1,"i")+"),\n          getMatrixB("+bSnippetFromOffset(2,"i")+"),\n          getMatrixB("+bSnippetFromOffset(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===sharedDimVec4Remainder)+") {\n        result += getMatrixA("+aSnippetFromOffset(0,sharedDimNearestVec4)+") *\n          getMatrixB("+bSnippetFromOffset(0,sharedDimNearestVec4)+");\n      } else if ("+(2===sharedDimVec4Remainder)+") {\n        vec2 a = vec2(\n          getMatrixA("+aSnippetFromOffset(0,sharedDimNearestVec4)+"),\n          getMatrixA("+aSnippetFromOffset(1,sharedDimNearestVec4)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+bSnippetFromOffset(0,sharedDimNearestVec4)+"),\n          getMatrixB("+bSnippetFromOffset(1,sharedDimNearestVec4)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===sharedDimVec4Remainder)+") {\n        vec3 a = vec3(\n          getMatrixA("+aSnippetFromOffset(0,sharedDimNearestVec4)+"),\n          getMatrixA("+aSnippetFromOffset(1,sharedDimNearestVec4)+"),\n          getMatrixA("+aSnippetFromOffset(2,sharedDimNearestVec4)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+bSnippetFromOffset(0,sharedDimNearestVec4)+"),\n          getMatrixB("+bSnippetFromOffset(1,sharedDimNearestVec4)+"),\n          getMatrixB("+bSnippetFromOffset(2,sharedDimNearestVec4)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec3 resBRC = getOutputCoords();\n      setOutput(dotARowBCol(resBRC.x, resBRC.y, resBRC.z));\n    }\n    "}return MatMulProgram}();exports.MatMulProgram=MatMulProgram},{}],112:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MatMulPackedProgram=function(){function MatMulPackedProgram(aShape,bShape,outputShape,transposeA,transposeB){void 0===transposeA&&(transposeA=!1),void 0===transposeB&&(transposeB=!1),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=outputShape;var sharedDim=transposeA?aShape[0]:aShape[1],sharedDimensionPacked=Math.ceil(sharedDim/2),aSample=transposeA?"i * 2, rc.x":"rc.x, i * 2",bSample=transposeB?"rc.y, i * 2":"i * 2, rc.y",aSwizzle=transposeA?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],bSwizzle=transposeB?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];this.userCode="\n      const float sharedDimension = "+sharedDimensionPacked+".0;\n\n      vec4 dot2x2ARowBCol(ivec2 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+sharedDimensionPacked+"; i++) {\n          vec4 a = getMatrixA("+aSample+");\n          vec4 b = getMatrixB("+bSample+");\n\n          result += ("+aSwizzle[0]+" * "+bSwizzle[0]+") + ("+aSwizzle[1]+" * "+bSwizzle[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec2 rc = getOutputCoords();\n        setOutput(dot2x2ARowBCol(rc));\n      }\n    "}return MatMulPackedProgram}();exports.MatMulPackedProgram=MatMulPackedProgram},{}],113:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MultinomialProgram=function(){function MultinomialProgram(batchSize,numOutcomes,numSamples){this.variableNames=["probs"],this.outputShape=[batchSize,numSamples],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(numOutcomes-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(numOutcomes-1)+"));\n      }\n    "}return MultinomialProgram.prototype.getCustomSetupFunc=function(seed){var _this=this;return function(gpgpu,webGLProgram){null==_this.seedLoc&&(_this.seedLoc=gpgpu.getUniformLocation(webGLProgram,"seed")),gpgpu.gl.uniform1f(_this.seedLoc,seed)}},MultinomialProgram}();exports.MultinomialProgram=MultinomialProgram},{}],114:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var OneHotProgram=function(){function OneHotProgram(numIndices,depth,onValue,offValue){this.variableNames=["indices"],this.outputShape=[numIndices,depth],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+offValue+"), float("+onValue+"),\n                      float(index == coords.y)));\n      }\n    "}return OneHotProgram}();exports.OneHotProgram=OneHotProgram},{}],115:[function(require,module,exports){"use strict";function getSourceCoordsArr(rank,dims){for(var coords=[],row=0;row<=1;row++)for(var col=0;col<=1;col++){for(var coord=(0===row?"r":"rp1")+", "+(0===col?"c":"cp1"),d=2;d<rank;d++)coord=dims[dims.length-1-d]+","+coord;coords.push(coord)}return coords}function getOutOfBoundsCondition(rank,shape,dims){if(1===rank)return"rc > "+shape[0];for(var cond="",i=rank-2;i<rank;i++)cond+=dims[i]+" >= "+shape[i],i<rank-1&&(cond+="||");return cond}function getSetup(rank,cols,rows,dims){if(1===rank)return"";var innerDims=dims.slice(-2);return"\n    int r = "+innerDims[0]+";\n    int c = "+innerDims[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+cols+";\n    bool rEdge = rp1 >= "+rows+";\n  "}function getOutput(shape,dims){var rank=shape.length,sourceCoords=getSourceCoordsArr(rank,dims);return 1===rank?"getA(rc),\n            rc + 1 >= "+shape[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+sourceCoords[0]+"),\n          cEdge ? 0. : getA("+sourceCoords[1]+"),\n          rEdge ? 0. : getA("+sourceCoords[2]+"),\n          rEdge || cEdge ? 0. : getA("+sourceCoords[3]+")"}Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),PackProgram=function(){function PackProgram(outputShape){this.variableNames=["A"],this.outputShape=outputShape;var rank=outputShape.length,channels=packing_util_1.getChannels("rc",rank),dtype=shader_compiler_1.getCoordsDataType(rank),outOfBoundsCondition=getOutOfBoundsCondition(rank,outputShape,channels),setup=getSetup(rank,outputShape[outputShape.length-1],outputShape[outputShape.length-2],channels),output=getOutput(outputShape,channels);this.userCode="\n      void main() {\n        "+dtype+" rc = getOutputCoords();\n\n        if("+outOfBoundsCondition+") {\n          gl_FragColor = vec4(0);\n        } else {\n          "+setup+"\n\n          setOutput(vec4("+output+"));\n        }\n      }\n    "}return PackProgram}();exports.PackProgram=PackProgram},{"../packing_util":80,"./shader_compiler":128}],116:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),PadProgram=function(){function PadProgram(xShape,paddings,constantValue){this.variableNames=["x"],this.outputShape=paddings.map(function(p,i){return p[0]+xShape[i]+p[1]});var rank=xShape.length,type=shader_compiler_1.getCoordsDataType(rank),start=paddings.map(function(p){return p[0]}).join(","),end=paddings.map(function(p,i){return p[0]+xShape[i]}).join(","),unpackedCoords=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,rank);if(1===rank)return void(this.userCode="\n        int start = "+start+";\n        int end = "+end+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+constantValue+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ");this.userCode="\n      "+type+" start = "+type+"("+start+");\n      "+type+" end = "+type+"("+end+");\n\n      void main() {\n        "+type+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+constantValue+"));\n        } else {\n          "+type+" coords = outC - start;\n          setOutput(getX("+unpackedCoords+"));\n        }\n      }\n    "}return PadProgram}();exports.PadProgram=PadProgram},{"./shader_compiler":128}],117:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Pool2DProgram=function(){function Pool2DProgram(convInfo,poolType,computePositions){if(this.variableNames=["x"],"avg"===poolType&&computePositions)throw new Error("Cannot compute positions for average pool.");var filterWidth=convInfo.filterWidth,strideHeight=convInfo.strideHeight,strideWidth=convInfo.strideWidth,dilationHeight=convInfo.dilationHeight,dilationWidth=convInfo.dilationWidth,effectiveFilterHeight=convInfo.effectiveFilterHeight,effectiveFilterWidth=convInfo.effectiveFilterWidth,padTop=convInfo.padInfo.top,padLeft=convInfo.padInfo.left;this.outputShape=convInfo.outShape;var isAvgPool="avg"===poolType,initializationValue="0.0";if(isAvgPool||(initializationValue="-1.0 / 0.0"),computePositions){return void(this.userCode="\n        const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n        const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+effectiveFilterHeight+";\n              wR += "+dilationHeight+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+convInfo.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+effectiveFilterWidth+";\n                wC += "+dilationWidth+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+convInfo.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+effectiveFilterWidth+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}var returnValue=poolType+"("+poolType+"("+poolType+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===poolType&&(returnValue="avgValue / count");var filterWidthNearestVec4=4*Math.floor(filterWidth/4),filterWidthVec4Remainder=filterWidth%4,updateSnippet="\n      if ("+isAvgPool+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+strideHeight+", "+strideWidth+");\n      const ivec2 pads = ivec2("+padTop+", "+padLeft+");\n      const float initializationValue = "+initializationValue+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+convInfo.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+initializationValue+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+effectiveFilterHeight+";\n            wR += "+dilationHeight+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+convInfo.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+filterWidthNearestVec4+"; wC += 4) {\n            int xC = xCCorner + wC * "+dilationWidth+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+dilationWidth+", d),\n              getValue(batch, xR, xC + 2 * "+dilationWidth+", d),\n              getValue(batch, xR, xC + 3 * "+dilationWidth+", d)\n            );\n\n            "+updateSnippet+"\n          }\n\n          int xC = xCCorner + "+filterWidthNearestVec4+";\n          if ("+(1===filterWidthVec4Remainder)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+updateSnippet+"\n          } else if ("+(2===filterWidthVec4Remainder)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+dilationWidth+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+updateSnippet+"\n          } else if ("+(3===filterWidthVec4Remainder)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+dilationWidth+", d),\n              getValue(batch, xR, xC + 2 * "+dilationWidth+", d),\n              initializationValue\n            );\n\n            "+updateSnippet+"\n          }\n        }\n        setOutput("+returnValue+");\n      }\n    "}return Pool2DProgram}();exports.Pool2DProgram=Pool2DProgram},{}],118:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ReduceProgram=function(){function ReduceProgram(reduceInfo,reduceType){this.variableNames=["x"];var windowSize=reduceInfo.windowSize,batchSize=reduceInfo.batchSize,inSize=reduceInfo.inSize,outSize=Math.ceil(inSize/windowSize);this.outputShape=[batchSize,outSize];var initializationValue="0.0",compareOp="";"prod"===reduceType?initializationValue="1.0":"min"===reduceType?(initializationValue="1.0 / 0.0",compareOp="min"):"max"===reduceType&&(initializationValue="-1.0 / 0.0",compareOp="max");var returnValue=reduceType+"("+reduceType+"("+reduceType+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===reduceType?returnValue="sumValue":"prod"===reduceType?returnValue="prodValue":"all"===reduceType?returnValue="allValue":"any"===reduceType&&(returnValue="anyValue");var windowSizeNearestVec4=4*Math.floor(windowSize/4),windowSizeVec4Remainder=windowSize%4,updateSnippet="\n      if ("+("sum"===reduceType)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===reduceType)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+compareOp+"(values, minMaxValue);\n      }\n    ",vecType="vec4";"all"===reduceType?(initializationValue="1.0",updateSnippet="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",vecType="bvec4"):"any"===reduceType&&(initializationValue="0.0",updateSnippet="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",vecType="bvec4");var checkOutOfBounds="";inSize%windowSize>0&&(checkOutOfBounds="\n        if (inIdx < 0 || inIdx >= "+inSize+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+initializationValue+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+checkOutOfBounds+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+windowSize+";\n\n        vec4 minMaxValue = vec4("+initializationValue+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+windowSizeNearestVec4+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+vecType+" values = "+vecType+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+updateSnippet+"\n        }\n\n        int inIdx = inOffset + "+windowSizeNearestVec4+";\n        if ("+(1===windowSizeVec4Remainder)+") {\n          "+vecType+" values = "+vecType+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+updateSnippet+"\n        } else if ("+(2===windowSizeVec4Remainder)+") {\n          "+vecType+" values = "+vecType+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+updateSnippet+"\n        } else if ("+(3===windowSizeVec4Remainder)+") {\n          "+vecType+" values = "+vecType+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+updateSnippet+"\n        }\n        setOutput("+returnValue+");\n      }\n    "}return ReduceProgram}();exports.ReduceProgram=ReduceProgram},{}],119:[function(require,module,exports){"use strict";function getFlatIndex(shape){return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+shader_util.dotify(["coords.x","coords.y","coords.z"],util.computeStrides(shape).map(function(d){return d.toString()}).concat(["1."]))+");\n    }\n  "}function getReshapedInputCoords(shape){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],shape)+"\n      return ivec3(r, c, d);\n    }\n  "}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../../util"),shader_util=require("./shader_compiler_util"),ReshapePackedProgram=function(){function ReshapePackedProgram(outputShape,inputShape){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=outputShape;for(var mainLoop="",i=0;i<4;i++){var thisRC="thisRC = rc;";i%2==1&&(thisRC+="thisRC.z += 1;"),i>1&&(thisRC+="thisRC.y += 1;"),mainLoop+="\n        "+thisRC+"\n        "+(i>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+i+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(i>0?"}":"")+"\n      "}this.userCode="\n      "+getReshapedInputCoords(inputShape)+"\n      "+getFlatIndex(outputShape)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+outputShape[1]+";\n        int cols = "+outputShape[2]+";\n\n        "+mainLoop+"\n\n        setOutput(result);\n      }\n    "}return ReshapePackedProgram}();exports.ReshapePackedProgram=ReshapePackedProgram},{"../../util":210,"./shader_compiler_util":129}],120:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearBackpropProgram=function(){function ResizeBilinearBackpropProgram(dy,x,alignCorners){this.variableNames=["dy"],this.outputShape=[],this.outputShape=x.shape;var _a=x.shape,xHeight=_a[1],xWidth=_a[2],_b=dy.shape,yHeight=_b[1],yWidth=_b[2],effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth],effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth],heightScale=effectiveXSize[0]/effectiveYSize[0],widthScale=effectiveXSize[1]/effectiveYSize[1],invHeightScale=1/heightScale,invWidthScale=1/widthScale,winHeight=2*Math.ceil(invHeightScale)+2,winWidth=2*Math.ceil(invWidthScale)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+heightScale+");\n        const float widthScale = float("+widthScale+");\n\n        const float invHeightScale = float("+invHeightScale+");\n        const float invWidthScale = float("+invWidthScale+");\n\n        const int winHeight = int("+winHeight+");\n        const int winWidth = int("+winWidth+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+yHeight+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+yWidth+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(xHeight-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(xWidth-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}return ResizeBilinearBackpropProgram}();exports.ResizeBilinearBackpropProgram=ResizeBilinearBackpropProgram},{}],121:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeBilinearProgram=function(){function ResizeBilinearProgram(inputShape,newHeight,newWidth,alignCorners){this.variableNames=["A"],this.outputShape=[];var batch=inputShape[0],oldHeight=inputShape[1],oldWidth=inputShape[2],depth=inputShape[3];this.outputShape=[batch,newHeight,newWidth,depth];var effectiveInSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+effectiveInSize[0]/effectiveOutSize[0]+",\n          "+effectiveInSize[1]/effectiveOutSize[1]+");\n      const vec2 inputShapeRC = vec2("+oldHeight+".0, "+oldWidth+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}return ResizeBilinearProgram}();exports.ResizeBilinearProgram=ResizeBilinearProgram},{}],122:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeNearestNeigborBackpropProgram=function(){function ResizeNearestNeigborBackpropProgram(dy,x,alignCorners){this.variableNames=["dy"],this.outputShape=[],this.outputShape=x.shape
;var _a=x.shape,xHeight=_a[1],xWidth=_a[2],_b=dy.shape,yHeight=_b[1],yWidth=_b[2],effectiveXSize=[alignCorners&&yHeight>1?xHeight-1:xHeight,alignCorners&&yWidth>1?xWidth-1:xWidth],effectiveYSize=[alignCorners&&yHeight>1?yHeight-1:yHeight,alignCorners&&yWidth>1?yWidth-1:yWidth],heightScale=effectiveXSize[0]/effectiveYSize[0],widthScale=effectiveXSize[1]/effectiveYSize[1],invHeightScale=1/heightScale,invWidthScale=1/widthScale,winHeight=2*Math.ceil(invHeightScale)+2,winWidth=2*Math.ceil(invWidthScale)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+heightScale+");\n        const float widthScale = float("+widthScale+");\n\n        const float invHeightScale = float("+invHeightScale+");\n        const float invWidthScale = float("+invWidthScale+");\n\n        const int winHeight = int("+winHeight+");\n        const int winWidth = int("+winWidth+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+yHeight+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+yWidth+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+effectiveXSize[0]+") *\n                (float(dyR) / float("+effectiveYSize[0]+"));\n\n            float sourceFracCol =\n                float("+effectiveXSize[1]+") *\n                  (float(dyC) / float("+effectiveYSize[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+xHeight+") - 1),\n                "+alignCorners+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+xWidth+") - 1),\n                "+alignCorners+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}return ResizeNearestNeigborBackpropProgram}();exports.ResizeNearestNeigborBackpropProgram=ResizeNearestNeigborBackpropProgram},{}],123:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResizeNearestNeighborProgram=function(){function ResizeNearestNeighborProgram(inputShape,newHeight,newWidth,alignCorners){this.variableNames=["A"],this.outputShape=[];var batch=inputShape[0],oldHeight=inputShape[1],oldWidth=inputShape[2],depth=inputShape[3];this.outputShape=[batch,newHeight,newWidth,depth];var effectiveInSize=[alignCorners&&newHeight>1?oldHeight-1:oldHeight,alignCorners&&newWidth>1?oldWidth-1:oldWidth],effectiveOutSize=[alignCorners&&newHeight>1?newHeight-1:newHeight,alignCorners&&newWidth>1?newWidth-1:newWidth],roundBase=alignCorners?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+effectiveInSize[0]/effectiveOutSize[0]+",\n          "+effectiveInSize[1]/effectiveOutSize[1]+");\n      const vec2 inputShapeRC = vec2("+oldHeight+".0, "+oldWidth+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+roundBase+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "}return ResizeNearestNeighborProgram}();exports.ResizeNearestNeighborProgram=ResizeNearestNeighborProgram},{}],124:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),ReverseProgram=function(){function ReverseProgram(xShape,axis){this.variableNames=["x"];var rank=xShape.length;if(rank>4)throw new Error("WebGL backend: Reverse of rank-"+rank+" tensor is not yet supported");if(this.outputShape=xShape,1===rank)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+xShape[0]+" - coord - 1));\n        }\n      ");var getInCoord=function(i){return-1!==axis.indexOf(i)&&1!==xShape[i]?xShape[i]+" - coords["+i+"] - 1":"coords["+i+"]"},inCoords=xShape.map(function(_,i){return getInCoord(i)}).join(","),type=shader_compiler_1.getCoordsDataType(rank);this.userCode="\n      void main() {\n        "+type+" coords = getOutputCoords();\n        setOutput(getX("+inCoords+"));\n      }\n    "}return ReverseProgram}();exports.ReverseProgram=ReverseProgram},{"./shader_compiler":128}],125:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),ScatterProgram=function(){function ScatterProgram(updateSize,sliceDim,indicesRank,updatesRank,strides,shape,summingDupeIndex){void 0===summingDupeIndex&&(summingDupeIndex=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=shape;var stridesType=shader_compiler_1.getCoordsDataType(strides.length),dtype=shader_compiler_1.getCoordsDataType(shape.length),indicesString="";1===indicesRank?indicesString="i":2===indicesRank&&(indicesString="i, j");var indicesSnippet="getIndices("+indicesString+")",updatesString="";1===updatesRank?updatesString="i":2===updatesRank&&(updatesString="i, coords[1]");var updatesSnippet="getUpdates("+updatesString+")",strideString=sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+stridesType+" strides = "+stridesType+"("+strides+");\n\n        void main() {\n          "+dtype+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+updateSize+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+sliceDim+"; j++) {\n              int index = round("+indicesSnippet+");\n              flattenedIndex += index * "+strideString+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+updatesSnippet+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "}return ScatterProgram}();exports.ScatterProgram=ScatterProgram},{"./shader_compiler":128}],126:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SegmentOpProgram=function(){function SegmentOpProgram(segOpInfo,segOpType){this.variableNames=["x","segmentIds"];var windowSize=segOpInfo.windowSize,batchSize=segOpInfo.batchSize,inSize=segOpInfo.inSize,numSegments=segOpInfo.numSegments,outSize=numSegments*Math.ceil(inSize/windowSize);this.outputShape=[batchSize,outSize];var windowSizeNearestVec4=4*Math.floor(windowSize/4),windowSizeVec4Remainder=windowSize%4,updateSnippet="\n        sumValue += dot(values, filter);\n    ",checkValueOutOfBounds="";inSize%windowSize>0&&(checkValueOutOfBounds="\n        if (inIdx < 0 || inIdx >= "+inSize+") {\n          return initializationValue;\n        }\n      ");var checkSegmentIdOutOfBounds="";inSize%windowSize>0&&(checkSegmentIdOutOfBounds="\n        if (inIdx < 0 || inIdx >= "+inSize+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+checkValueOutOfBounds+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+checkSegmentIdOutOfBounds+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+numSegments+")) * float("+windowSize+"));\n        int currentSeg = int(mod(float(outIdx), float("+numSegments+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+windowSizeNearestVec4+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+updateSnippet+"\n        }\n\n        int inIdx = inOffset + "+windowSizeNearestVec4+";\n        if ("+(1===windowSizeVec4Remainder)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+updateSnippet+"\n        } else if ("+(2===windowSizeVec4Remainder)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+updateSnippet+"\n        } else if ("+(3===windowSizeVec4Remainder)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+updateSnippet+"\n        }\n        setOutput(sumValue);\n      }\n    "}return SegmentOpProgram}();exports.SegmentOpProgram=SegmentOpProgram},{}],127:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),SelectProgram=function(){function SelectProgram(cRank,shape,rank){this.variableNames=["c","a","b"],this.outputShape=shape;var cCoords,abCoords;if(rank>4)throw Error("Where for rank "+rank+" is not yet supported");if(1===rank)abCoords="resRC",cCoords="resRC";else{for(var currentCoords=["resRC.x","resRC.y","resRC.z","resRC.w"],cCoordVars=[],abCoordVars=[],i=0;i<shape.length;i++)abCoordVars.push(""+currentCoords[i]),i<cRank&&cCoordVars.push(""+currentCoords[i]);cCoords=cCoordVars.join(),abCoords=abCoordVars.join()}var dtype=shader_compiler_1.getCoordsDataType(rank);this.userCode="\n      void main() {\n        "+dtype+" resRC = getOutputCoords();\n        float cVal = getC("+cCoords+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+abCoords+"));\n        } else {\n          setOutput(getB("+abCoords+"));\n        }\n      }\n    "}return SelectProgram}();exports.SelectProgram=SelectProgram},{"./shader_compiler":128}],128:[function(require,module,exports){"use strict";function makeShader(inputsInfo,outputShape,userCode,broadcast,usesPackedTextures){var inputPrefixSnippet=inputsInfo.map(function(x){var size=util.sizeFromShape(x.shapeInfo.logicalShape);return x.shapeInfo.isUniform?"uniform float "+x.name+(size>1?"["+size+"]":"")+";":"uniform sampler2D "+x.name+";"});inputPrefixSnippet=inputPrefixSnippet.join("\n");var outputSamplingSnippet,floatTextureSetOutputSnippet,inputSamplingSnippet=inputsInfo.map(function(x){return getInputSamplingSnippet(x,outputShape,broadcast)}).join("\n"),outTexShape=outputShape.texShape,shaderPrefix=SHADER_PREFIX;return outputShape.isPacked?(outputSamplingSnippet=getPackedOutputSamplingSnippet(outputShape.logicalShape,outTexShape),floatTextureSetOutputSnippet=FLOAT_TEXTURE_SET_RGBA_SNIPPET):(outputSamplingSnippet=getOutputSamplingSnippet(outputShape.logicalShape,outTexShape),floatTextureSetOutputSnippet=FLOAT_TEXTURE_SET_R_SNIPPET),usesPackedTextures&&(shaderPrefix+=SHADER_PACKED_PREFIX),[shaderPrefix,FLOAT_TEXTURE_SAMPLE_SNIPPET,floatTextureSetOutputSnippet,inputPrefixSnippet,outputSamplingSnippet,inputSamplingSnippet,userCode].join("\n")}function getSamplerFromInInfo(inInfo){var shape=inInfo.shapeInfo.logicalShape;switch(shape.length){case 0:return getSamplerScalar(inInfo);case 1:return getSampler1D(inInfo);case 2:return getSampler2D(inInfo);case 3:return getSampler3D(inInfo);case 4:return getSampler4D(inInfo);case 5:return getSampler5D(inInfo);case 6:return getSampler6D(inInfo);default:throw new Error(shape.length+"-D input sampling is not yet supported")}}function getPackedSamplerFromInInfo(inInfo){var shape=inInfo.shapeInfo.logicalShape;switch(shape.length){case 1:return getPackedSampler1D(inInfo);case 2:return getPackedSampler2D(inInfo);case 3:return getPackedSampler3D(inInfo);case 4:return getPackedSampler4D(inInfo);default:throw new Error("Packed "+shape.length+"-D input sampling is not yet supported")}}function getInputSamplingSnippet(inInfo,outShapeInfo,broadcast){var res=getSamplerFlat(inInfo);return inInfo.shapeInfo.isPacked?res+=getPackedSamplerFromInInfo(inInfo):res+=getSamplerFromInInfo(inInfo),(broadcast||util.arraysEqual(inInfo.shapeInfo.logicalShape,outShapeInfo.logicalShape))&&(res+=getSamplerAtOutputCoords(inInfo,outShapeInfo,broadcast)),res}function getPackedOutputSamplingSnippet(outShape,outTexShape){switch(outShape.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return getOutputPacked1DCoords(outShape,outTexShape);case 2:return getOutputPacked2DCoords(outShape,outTexShape);case 3:return getOutputPacked3DCoords(outShape,outTexShape);case 4:return getOutputPacked4DCoords(outShape,outTexShape);default:throw new Error(outShape.length+"-D packed output coordinate fetching is not yet supported")}}function getOutputSamplingSnippet(outShape,outTexShape){switch(outShape.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return getOutput1DCoords(outShape,outTexShape);case 2:return getOutput2DCoords(outShape,outTexShape);case 3:return getOutput3DCoords(outShape,outTexShape);case 4:return getOutput4DCoords(outShape,outTexShape);case 5:return getOutput5DCoords(outShape,outTexShape);case 6:return getOutput6DCoords(outShape,outTexShape);default:throw new Error(outShape.length+"-D output sampling is not yet supported")}}function getOutputPacked1DCoords(shape,texShape){var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)];return 1===texShape[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+packedTexShape[1]+".0);\n      }\n    ":1===texShape[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+packedTexShape[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n      return resTexRC.x * "+packedTexShape[1]+" + resTexRC.y;\n    }\n  "}function getOutput1DCoords(shape,texShape){return 1===texShape[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+texShape[1]+".0);\n      }\n    ":1===texShape[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+texShape[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+texShape[0]+", "+texShape[1]+"));\n      return resTexRC.x * "+texShape[1]+" + resTexRC.y;\n    }\n  "}function getOutputPacked3DCoords(shape,texShape){var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)],texelsInLogicalRow=Math.ceil(shape[2]/2),texelsInBatch=texelsInLogicalRow*Math.ceil(shape[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n      int index = resTexRC.x * "+packedTexShape[1]+" + resTexRC.y;\n\n      int b = index / "+texelsInBatch+";\n      index -= b * "+texelsInBatch+";\n\n      int r = 2 * (index / "+texelsInLogicalRow+");\n      int c = imod(index, "+texelsInLogicalRow+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}function getOutput3DCoords(shape,texShape){var coordsFromIndexSnippet=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d"],shape);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+texShape[0]+", "+texShape[1]+"));\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n      "+coordsFromIndexSnippet+"\n      return ivec3(r, c, d);\n    }\n  "}function getOutputPacked4DCoords(shape,texShape){var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)],texelsInLogicalRow=Math.ceil(shape[3]/2),texelsInBatch=texelsInLogicalRow*Math.ceil(shape[2]/2),texelsInBatch2=texelsInBatch*shape[1];return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n      int index = resTexRC.x * "+packedTexShape[1]+" + resTexRC.y;\n\n      int b2 = index / "+texelsInBatch2+";\n      index -= b2 * "+texelsInBatch2+";\n\n      int b = index / "+texelsInBatch+";\n      index -= b * "+texelsInBatch+";\n\n      int r = 2 * (index / "+texelsInLogicalRow+");\n      int c = imod(index, "+texelsInLogicalRow+") * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  "}function getOutput4DCoords(shape,texShape){var coordsFromIndexSnippet=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2"],shape);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+texShape[0]+", "+texShape[1]+"));\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n      "+coordsFromIndexSnippet+"\n      return ivec4(r, c, d, d2);\n    }\n  "}function getOutput5DCoords(shape,texShape){var coordsFromIndexSnippet=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3"],shape);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+texShape[0]+",\n                             "+texShape[1]+"));\n\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n\n      "+coordsFromIndexSnippet+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}function getOutput6DCoords(shape,texShape){var coordsFromIndexSnippet=shader_util.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3","d4"],shape);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+texShape[0]+", "+texShape[1]+"));\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n\n      "+coordsFromIndexSnippet+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}function getOutputPacked2DCoords(shape,texShape){var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)];if(util.arraysEqual(shape,texShape))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n      }\n    ";var texelsInLogicalRow=Math.ceil(shape[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+packedTexShape[0]+", "+packedTexShape[1]+"));\n\n      int index = resTexRC.x * "+packedTexShape[1]+" + resTexRC.y;\n      int r = 2 * (index / "+texelsInLogicalRow+");\n      int c = imod(index, "+texelsInLogicalRow+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}function getOutput2DCoords(shape,texShape){return util.arraysEqual(shape,texShape)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+texShape[0]+", "+texShape[1]+"));\n      }\n    ":1===shape[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+texShape[0]+", "+texShape[1]+"));\n        int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===shape[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+texShape[0]+", "+texShape[1]+"));\n        int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+texShape[0]+", "+texShape[1]+"));\n      int index = resTexRC.x * "+texShape[1]+" + resTexRC.y;\n      int r = index / "+shape[1]+";\n      int c = index - r * "+shape[1]+";\n      return ivec2(r, c);\n    }\n  "}function getSamplerScalar(inputInfo){var texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1);return inputInfo.shapeInfo.isUniform?"float "+funcName+"() {return "+texName+";}":"\n    float "+funcName+"() {\n      return sampleTexture("+texName+", halfCR);\n    }\n  "}function getPackedSampler1D(inputInfo){var texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape,packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)];return"\n    vec4 "+funcName+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+packedTexShape[0]+", "+packedTexShape[1]+", index);\n      return texture2D("+texName+", uv);\n    }\n  "}function getSampler1D(inputInfo){var texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1);return"\n    float "+funcName+"(int index) {\n      return "+funcName+"Flat(index);\n    }\n  "}function getPackedSampler2D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1];if(null!=texShape&&util.arraysEqual(shape,texShape))return"\n      vec4 "+funcName+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+texNumC+".0, "+texNumR+".0);\n\n        return texture2D("+texName+", uv);\n      }\n    ";var packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)];return"\n    vec4 "+funcName+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(shape[1]/2)+", "+packedTexShape[0]+", "+packedTexShape[1]+", row, col);\n      return texture2D("+texName+", uv);\n    }\n  "}function getSampler2D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape;if(null!=texShape&&util.arraysEqual(shape,texShape)){var texNumR_1=texShape[0];return"\n    float "+funcName+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+texShape[1]+".0, "+texNumR_1+".0);\n      return sampleTexture("+texName+", uv);\n    }\n  "}var _a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims,squeezedShape=newShape;if(squeezedShape.length<shape.length){var newInputInfo=squeezeInputInfo(inputInfo,squeezedShape),params=["row","col"];return"\n      "+getSamplerFromInInfo(newInputInfo)+"\n      float "+funcName+"(int row, int col) {\n        return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n      }\n    "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col) {\n        float index = dot(vec2(row, col), vec2("+shape[1]+", 1));\n        return "+funcName+"Flat(round(index));\n      }\n    ";var texNumR=texShape[0],texNumC=texShape[1];return 1===texNumC?"\n    float "+funcName+"(int row, int col) {\n      float index = dot(vec2(row, col), vec2("+shape[1]+", 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+texNumR+".0);\n      return sampleTexture("+texName+", uv);\n    }\n  ":1===texNumR?"\n    float "+funcName+"(int row, int col) {\n      float index = dot(vec2(row, col), vec2("+shape[1]+", 1));\n      vec2 uv = vec2((index + 0.5) / "+texNumC+".0, 0.5);\n      return sampleTexture("+texName+", uv);\n    }\n  ":"\n  float "+funcName+"(int row, int col) {\n    vec2 uv = UVfrom2D("+texNumR+", "+texNumC+", "+shape[1]+", row, col);\n    return sampleTexture("+texName+", uv);\n  }\n"}function getPackedSampler3D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape,packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)];if(1===shape[0]){var squeezedShape=shape.slice(1),keptDims=[1,2],newInputInfo=squeezeInputInfo(inputInfo,squeezedShape),params=["b","row","col"];return"\n        "+getPackedSamplerFromInInfo(newInputInfo)+"\n        vec4 "+funcName+"(int b, int row, int col) {\n          return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n        }\n      "}var texNumR=packedTexShape[0],texNumC=packedTexShape[1],valuesPerRow=Math.ceil(shape[2]/2);return"\n    vec4 "+funcName+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+texNumR+", "+texNumC+", "+valuesPerRow*Math.ceil(shape[1]/2)+", "+valuesPerRow+", b, row, col);\n      return texture2D("+texName+", uv);\n    }\n  "}function getSampler3D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),stride0=shape[1]*shape[2],stride1=shape[2],_a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims,squeezedShape=newShape;if(squeezedShape.length<shape.length){var newInputInfo=squeezeInputInfo(inputInfo,squeezedShape),params=["row","col","depth"];return"\n        "+getSamplerFromInInfo(newInputInfo)+"\n        float "+funcName+"(int row, int col, int depth) {\n          return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n        }\n      "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col, int depth) {\n        float index = dot(vec3(row, col, depth),\n                          vec3("+stride0+", "+stride1+", 1));\n        return "+funcName+"Flat(round(index));\n      }\n    ";var texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1];return texNumC===stride0?"\n        float "+funcName+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+stride1+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+texNumC+".0, "+texNumR+".0);\n          return sampleTexture("+texName+", uv);\n        }\n      ":texNumC===stride1?"\n    float "+funcName+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+shape[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+texNumC+".0, "+texNumR+".0);\n      return sampleTexture("+texName+", uv);\n    }\n  ":"\n      float "+funcName+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+texNumR+", "+texNumC+", "+stride0+", "+stride1+", row, col, depth);\n        return sampleTexture("+texName+", uv);\n      }\n  "}function getPackedSampler4D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),texShape=inputInfo.shapeInfo.texShape,packedTexShape=[Math.ceil(texShape[0]/2),Math.ceil(texShape[1]/2)],texNumR=packedTexShape[0],texNumC=packedTexShape[1],valuesPerRow=Math.ceil(shape[3]/2),texelsInBatch=valuesPerRow*Math.ceil(shape[2]/2);return"\n    vec4 "+funcName+"(int b2, int b, int row, int col) {\n      vec2 uv = packedUVfrom4D(\n        "+texNumR+", "+texNumC+", "+texelsInBatch*shape[1]+",\n        "+texelsInBatch+", "+valuesPerRow+", b2, b, row, col);\n      return texture2D("+texName+", uv);\n    }\n  "}function getSampler4D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),stride2=shape[3],stride1=shape[2]*stride2,stride0=shape[1]*stride1,_a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims;if(newShape.length<shape.length){var newInputInfo=squeezeInputInfo(inputInfo,newShape),params=["row","col","depth","depth2"];return"\n      "+getSamplerFromInInfo(newInputInfo)+"\n      float "+funcName+"(int row, int col, int depth, int depth2) {\n        return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n      }\n    "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col, int depth, int depth2) {\n        float index = dot(vec4(row, col, depth, depth2),\n                          vec4("+stride0+", "+stride1+", "+stride2+", 1));\n        return "+funcName+"Flat(round(index));\n      }\n    ";var texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1];return texNumC===stride0?"\n      float "+funcName+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2), vec3("+stride1+", "+stride2+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":texNumC===stride2?"\n      float "+funcName+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+shape[1]*shape[2]+", "+shape[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":"\n    float "+funcName+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+texNumR+", "+texNumC+", "+stride0+", "+stride1+",\n          "+stride2+", row, col, depth, depth2);\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getSampler5D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),stride3=shape[4],stride2=shape[3]*stride3,stride1=shape[2]*stride2,stride0=shape[1]*stride1,_a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims;if(newShape.length<shape.length){var newInputInfo=squeezeInputInfo(inputInfo,newShape),params=["row","col","depth","depth2","depth3"]
;return"\n      "+getSamplerFromInInfo(newInputInfo)+"\n      float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n      }\n    "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+stride0+", "+stride1+", "+stride2+", "+stride3+")) +\n          depth3;\n        return "+funcName+"Flat(index);\n      }\n    ";var texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1];return texNumC===stride0?"\n      float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(\n          vec4(col, depth, depth2, depth3),\n          vec4("+stride1+", "+stride2+", "+stride3+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":texNumC===stride3?"\n      float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+shape[1]*shape[2]*shape[3]+", "+shape[2]*shape[3]+",\n            "+shape[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":"\n    float "+funcName+"(int row, int col, int depth, int depth2, int depth3) {\n      vec2 uv = UVfrom5D("+texNumR+", "+texNumC+", "+stride0+", "+stride1+",\n          "+stride2+", "+stride3+", row, col, depth, depth2, depth3);\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getSampler6D(inputInfo){var shape=inputInfo.shapeInfo.logicalShape,texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1),stride4=shape[5],stride3=shape[4]*stride4,stride2=shape[3]*stride3,stride1=shape[2]*stride2,stride0=shape[1]*stride1,_a=util.squeezeShape(shape),newShape=_a.newShape,keptDims=_a.keptDims;if(newShape.length<shape.length){var newInputInfo=squeezeInputInfo(inputInfo,newShape),params=["row","col","depth","depth2","depth3","depth4"];return"\n      "+getSamplerFromInInfo(newInputInfo)+"\n      float "+funcName+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+funcName+"("+getSqueezedParams(params,keptDims)+");\n      }\n    "}if(inputInfo.shapeInfo.isUniform)return"\n      float "+funcName+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+stride0+", "+stride1+", "+stride2+", "+stride3+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+stride4+", 1));\n        return "+funcName+"Flat(index);\n      }\n    ";var texShape=inputInfo.shapeInfo.texShape,texNumR=texShape[0],texNumC=texShape[1];return texNumC===stride0?"\n      float "+funcName+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(\n          vec4(col, depth, depth2, depth3),\n          vec4("+stride1+", "+stride2+", "+stride3+", "+stride4+")) + depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":texNumC===stride4?"\n      float "+funcName+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+shape[1]*shape[2]*shape[3]*shape[4]+",\n               "+shape[2]*shape[3]*shape[4]+",\n               "+shape[3]*shape[4]+",\n               "+shape[4]+")) + depth3;\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+texNumC+".0, "+texNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":"\n    float "+funcName+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      vec2 uv = UVfrom6D("+texNumR+", "+texNumC+", "+stride0+", "+stride1+",\n          "+stride2+", "+stride3+", "+stride4+"\n          ,row, col, depth, depth2, depth3, depth4);\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getSamplerFlat(inputInfo){var texName=inputInfo.name,funcName="get"+texName.charAt(0).toUpperCase()+texName.slice(1)+"Flat",inSize=util.sizeFromShape(inputInfo.shapeInfo.logicalShape);if(inputInfo.shapeInfo.isUniform)return 1===inSize?"float "+funcName+"(int index) {return "+texName+";}":"\n      float "+funcName+"(int index) {\n        for (int i = 0; i < "+inSize+"; i++) {\n          if (i == index) {\n            return "+texName+"[i];\n          }\n        }\n      }\n    ";var texShape=inputInfo.shapeInfo.texShape,tNumR=texShape[0],tNumC=texShape[1];return 1===tNumC&&1===tNumR?"\n      float "+funcName+"(int index) {\n        return sampleTexture("+texName+", halfCR);\n      }\n    ":1===tNumC?"\n      float "+funcName+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+tNumR+".0);\n        return sampleTexture("+texName+", uv);\n      }\n    ":1===tNumR?"\n      float "+funcName+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+tNumC+".0, 0.5);\n        return sampleTexture("+texName+", uv);\n      }\n    ":"\n    float "+funcName+"(int index) {\n      vec2 uv = UVfrom1D("+tNumR+", "+tNumC+", index);\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getBroadcastOutputCoordsSampler(inputInfo,outShapeInfo,texFuncSnippet,funcName){var inRank=inputInfo.shapeInfo.logicalShape.length,outRank=outShapeInfo.logicalShape.length,type="int";2===outRank?type="ivec2":3===outRank?type="ivec3":4===outRank&&(type="ivec4");var coordsSnippet,broadcastDims=broadcast_util.getBroadcastDims(inputInfo.shapeInfo.logicalShape,outShapeInfo.logicalShape),rankDiff=outRank-inRank;coordsSnippet=0===inRank?"":outRank<2&&broadcastDims.length>=1?"coords = 0;":broadcastDims.map(function(d){return"coords["+(d+rankDiff)+"] = 0;"}).join("\n");var unpackedCoordsSnippet="";return unpackedCoordsSnippet=outRank<2&&inRank>0?"coords":inputInfo.shapeInfo.logicalShape.map(function(s,i){return"coords["+(i+rankDiff)+"]"}).join(", "),"\n    float "+funcName+"() {\n      "+type+" coords = getOutputCoords();\n      "+coordsSnippet+"\n      return get"+texFuncSnippet+"("+unpackedCoordsSnippet+");\n    }\n  "}function getSamplerAtOutputCoords(inputInfo,outShapeInfo,supportsBroadcasting){var texName=inputInfo.name,texFuncSnippet=texName.charAt(0).toUpperCase()+texName.slice(1),funcName="get"+texFuncSnippet+"AtOutCoords",broadcastDims=broadcast_util.getBroadcastDims(inputInfo.shapeInfo.logicalShape,outShapeInfo.logicalShape),inRank=inputInfo.shapeInfo.logicalShape.length,outRank=outShapeInfo.logicalShape.length,doBroadcast=supportsBroadcasting&&(outRank>inRank||broadcastDims.length>0),broadcastOverOuter=broadcast_util.broadcastDimsAreOuter(broadcastDims),isUniform=inputInfo.shapeInfo.isUniform;if(doBroadcast&&!broadcastOverOuter)return getBroadcastOutputCoordsSampler(inputInfo,outShapeInfo,texFuncSnippet,funcName);var inSize=util.sizeFromShape(inputInfo.shapeInfo.logicalShape),broadcastSnippet="";doBroadcast&&broadcastOverOuter&&(broadcastSnippet="\n        int mainPart = index / "+inSize+";\n        index -= mainPart * "+inSize+";\n      ");var outTexShape=outShapeInfo.texShape;if(isUniform)return 1===inSize?"float "+funcName+"() {return "+texName+";}":"\n      float "+funcName+"() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                              vec2("+outTexShape[0]+", "+outTexShape[1]+"));\n        int index = resTexRC.x * "+outTexShape[1]+" + resTexRC.y;\n        "+broadcastSnippet+"\n        return get"+texFuncSnippet+"Flat(index);\n      }\n    ";var inTexShape=inputInfo.shapeInfo.texShape;return util.arraysEqual(inTexShape,outTexShape)?"\n      float "+funcName+"() {\n        return sampleTexture("+texName+", resultUV);\n      }\n    ":"\n    float "+funcName+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+outTexShape[0]+", "+outTexShape[1]+"));\n      int index = resTexRC.x * "+outTexShape[1]+" + resTexRC.y;\n      "+broadcastSnippet+"\n      int texR = index / "+inTexShape[1]+";\n      int texC = index - texR * "+inTexShape[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+inTexShape[1]+".0, "+inTexShape[0]+".0);\n\n      return sampleTexture("+texName+", uv);\n    }\n  "}function getCoordsDataType(rank){if(rank<=1)return"int";if(2===rank)return"ivec2";if(3===rank)return"ivec3";if(4===rank)return"ivec4";if(5===rank)return"ivec5";if(6===rank)return"ivec6";throw Error("GPU for rank "+rank+" is not yet supported")}function squeezeInputInfo(inInfo,squeezedShape){var newInputInfo=JSON.parse(JSON.stringify(inInfo));return newInputInfo.shapeInfo.logicalShape=squeezedShape,newInputInfo}function getSqueezedParams(params,keptDims){return keptDims.map(function(d){return params[d]}).join(", ")}Object.defineProperty(exports,"__esModule",{value:!0});var broadcast_util=require("../../ops/broadcast_util"),util=require("../../util"),shader_util=require("./shader_compiler_util");exports.makeShader=makeShader;var FLOAT_TEXTURE_SAMPLE_SNIPPET="\n  float sampleTexture(sampler2D textureSampler, vec2 uv) {\n    return texture2D(textureSampler, uv).r;\n  }\n",FLOAT_TEXTURE_SET_R_SNIPPET="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",FLOAT_TEXTURE_SET_RGBA_SNIPPET="\n  void setOutput(vec4 val) {\n    gl_FragColor = val;\n  }\n",SHADER_PREFIX="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  struct ivec5\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n  };\n\n  struct ivec6\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n    int v;\n  };\n\n  bool isNaN(float val) {\n    return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    vec4 v1 = values * values;\n    vec4 v2 = values * values;\n    return any(notEqual(v1, v2));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  //Based on the work of Dave Hoskins\n  //https://www.shadertoy.com/view/4djSRW\n  #define HASHSCALE1 443.8975\n  float random(float seed){\n    vec2 p = resultUV * seed;\n    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n  }\n\n  \nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom4D(int texNumR, int texNumC, int texelsInBatch2,\n    int texelsInBatch, int texelsInLogicalRow, int b2, int b,\n    int row, int col) {\n  int index = b2 * texelsInBatch2 + b * texelsInBatch +\n    (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom5D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int row, int col, int depth,\n    int depth2, int depth3) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 +\n              depth * stride2 + depth2 * stride3 + depth3;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom6D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int stride4,\n    int row, int col, int depth, int depth2, int depth3, int depth4) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *\n    stride3 + depth3 * stride4 + depth4;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n",SHADER_PACKED_PREFIX="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";exports.getCoordsDataType=getCoordsDataType},{"../../ops/broadcast_util":147,"../../util":210,"./shader_compiler_util":129}],129:[function(require,module,exports){"use strict";function getLogicalCoordinatesFromFlatIndex(coords,shape,index){void 0===index&&(index="index");var strides=util.computeStrides(shape);return strides.map(function(stride,i){return"int "+coords[i]+" = "+index+" / "+stride+"; "+(i===strides.length-1?"int "+coords[i+1]+" = "+index+" - "+coords[i]+" * "+stride:"index -= "+coords[i]+" * "+stride)+";"}).join("")}function buildVec(x){return 1===x.length?""+x[0]:"vec"+x.length+"("+x.join(",")+")"}function dotify(x,y){if(x.length!==y.length)throw new Error("Vectors to be dotted must be of the same length -got "+x.length+" and "+y.length);for(var slices=[],nearestVec4=Math.floor(x.length/4),nearestVec4Remainder=x.length%4,i=0;i<nearestVec4;i++){var xSlice=x.slice(4*i,4*i+4),ySlice=y.slice(4*i,4*i+4);slices.push(buildVec(xSlice)+", "+buildVec(ySlice))}if(0!==nearestVec4Remainder){var xSlice=x.slice(4*nearestVec4),ySlice=y.slice(4*nearestVec4);1===xSlice.length&&(xSlice=xSlice.map(function(d){return"float("+d+")"}),ySlice=ySlice.map(function(d){return"float("+d+")"})),slices.push(buildVec(xSlice)+", "+buildVec(ySlice))}return slices.map(function(d,i){return"dot("+d+")"}).join("+")}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../../util");exports.getLogicalCoordinatesFromFlatIndex=getLogicalCoordinatesFromFlatIndex,exports.dotify=dotify},{"../../util":210}],130:[function(require,module,exports){"use strict";function getCoords(rank){if(1===rank)return"sourceLoc";if(2===rank)return"sourceLoc.x, sourceLoc.y";if(3===rank)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===rank)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+rank+" is not yet supported")}Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),SliceProgram=function(){function SliceProgram(destSize){this.variableNames=["source"],this.outputShape=destSize,this.rank=destSize.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),sourceCoords=getCoords(this.rank);this.userCode="\n      uniform "+dtype+" start;\n\n      void main() {\n        "+dtype+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+sourceCoords+"));\n      }\n    "}return SliceProgram.prototype.getCustomSetupFunc=function(start){var _this=this;if(start.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+start.length+")");return function(gpgpu,webGLProgram){if(null!=_this.startLoc||(_this.startLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"start"),null!=_this.startLoc))if(1===_this.rank)gpgpu.gl.uniform1i(_this.startLoc,start[0]);else if(2===_this.rank)gpgpu.gl.uniform2i(_this.startLoc,start[0],start[1]);else if(3===_this.rank)gpgpu.gl.uniform3i(_this.startLoc,start[0],start[1],start[2]);else{if(4!==_this.rank)throw Error("Slicing for rank "+_this.rank+" is not yet supported");gpgpu.gl.uniform4i(_this.startLoc,start[0],start[1],start[2],start[3])}}},SliceProgram}();exports.SliceProgram=SliceProgram},{"./shader_compiler":128}],131:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),StridedSliceProgram=function(){function StridedSliceProgram(begin,strides,size,shrinkAxis){this.variableNames=["x"];var shape=size.filter(function(v,index){return-1===shrinkAxis.indexOf(index)});this.outputShape=shape;var rank=size.length,inputDtype=shader_compiler_1.getCoordsDataType(size.length),dtype=shader_compiler_1.getCoordsDataType(shape.length),newCoords="";if(1===rank)newCoords="coords * strides + begin";else{var outputAxis_1=0;newCoords=size.map(function(_,i){return-1===shrinkAxis.indexOf(i)?(outputAxis_1++,1===shape.length?"coords * strides["+i+"] + begin["+i+"]":"coords["+(outputAxis_1-1)+"] * strides["+i+"] + begin["+i+"]"):"begin["+i+"]"}).join(",")}this.userCode="\n      "+inputDtype+" begin = "+inputDtype+"("+begin+");\n      "+inputDtype+" strides = "+inputDtype+"("+strides+");\n\n      void main() {\n        "+dtype+" coords = getOutputCoords();\n        setOutput(getX("+newCoords+"));\n      }\n    "}return StridedSliceProgram}();exports.StridedSliceProgram=StridedSliceProgram},{"./shader_compiler":128}],132:[function(require,module,exports){"use strict";function getUnpackedMatrixTextureShapeWidthHeight(rows,columns){return[columns,rows]}function getUnpackedArraySizeFromMatrixSize(matrixSize,channelsPerTexture){return matrixSize*channelsPerTexture}function getColorMatrixTextureShapeWidthHeight(rows,columns){return[4*columns,rows]}function getMatrixSizeFromUnpackedArraySize(unpackedSize,channelsPerTexture){if(unpackedSize%channelsPerTexture!=0)throw new Error("unpackedSize ("+unpackedSize+") must be a multiple of "+channelsPerTexture);return unpackedSize/channelsPerTexture}function encodeMatrixToUnpackedArray(matrix,unpackedArray,channelsPerTexture){var requiredSize=getUnpackedArraySizeFromMatrixSize(matrix.length,channelsPerTexture);if(unpackedArray.length<requiredSize)throw new Error("unpackedArray length ("+unpackedArray.length+") must be >= "+requiredSize);for(var dst=0,src=0;src<matrix.length;++src)unpackedArray[dst]=matrix[src],dst+=channelsPerTexture}function decodeMatrixFromUnpackedArray(unpackedArray,matrix,channelsPerTexture){var requiredSize=getMatrixSizeFromUnpackedArraySize(unpackedArray.length,channelsPerTexture);if(matrix.length<requiredSize)throw new Error("matrix length ("+matrix.length+") must be >= "+requiredSize);for(var dst=0,src=0;src<unpackedArray.length;src+=channelsPerTexture)matrix[dst++]=unpackedArray[src]}function decodeMatrixFromUnpackedColorRGBAArray(unpackedArray,matrix,channels){var requiredSize=unpackedArray.length*channels/4;if(matrix.length<requiredSize)throw new Error("matrix length ("+matrix.length+") must be >= "+requiredSize);for(var dst=0,src=0;src<unpackedArray.length;src+=4)for(var c=0;c<channels;c++)matrix[dst++]=unpackedArray[src+c]}function getPackedMatrixTextureShapeWidthHeight(rows,columns){return[Math.ceil(columns/2),Math.ceil(rows/2)]}function getPackedRGBAArraySizeFromMatrixShape(rows,columns){var _a=getPackedMatrixTextureShapeWidthHeight(rows,columns);return _a[0]*_a[1]*4}function encodeMatrixToPackedRGBA(matrix,batches,rows,columns,packedRGBA){var requiredSize=getPackedRGBAArraySizeFromMatrixShape(rows,columns);if(packedRGBA.length<requiredSize)throw new Error("packedRGBA length ("+packedRGBA.length+") must be >=\n        "+requiredSize);for(var oddWidth=columns%2==1,oddHeight=rows%2==1,widthInFullBlocks=Math.floor(columns/2),heightInFullBlocks=Math.floor(rows/2),texelsPerRow=Math.ceil(columns/2),texelsPerBatch=texelsPerRow*Math.ceil(rows/2),flattenedMatrixSize=util.nearestLargerEven(rows)*util.nearestLargerEven(columns),batch=0;batch<batches;batch++){for(var sourceOffset=batch*rows*columns,batchOffset=batch*flattenedMatrixSize,dstStride=oddWidth?4:0,oneRow=columns,dst=batchOffset,blockY=0;blockY<heightInFullBlocks;++blockY){for(var matrixSrcRow=2*blockY*columns,blockX=0;blockX<widthInFullBlocks;++blockX){var matrixSrcCol=2*blockX,src=sourceOffset+matrixSrcRow+matrixSrcCol;packedRGBA[dst]=matrix[src],packedRGBA[dst+1]=matrix[src+1],packedRGBA[dst+2]=matrix[src+oneRow],packedRGBA[dst+3]=matrix[src+oneRow+1],dst+=4}dst+=dstStride}if(oddWidth)for(var src=sourceOffset+columns-1,dst=batchOffset+4*(texelsPerRow-1),srcStride=2*columns,dstStride=4*texelsPerRow,blockY=0;blockY<heightInFullBlocks;++blockY)packedRGBA[dst]=matrix[src],packedRGBA[dst+2]=matrix[src+columns],src+=srcStride,dst+=dstStride;if(oddHeight){for(var src=sourceOffset+(rows-1)*columns,dst=batchOffset+4*(texelsPerBatch-texelsPerRow),blockX=0;blockX<widthInFullBlocks;++blockX)packedRGBA[dst++]=matrix[src++],packedRGBA[dst++]=matrix[src++],dst+=2;oddWidth&&oddHeight&&(packedRGBA[batchOffset+flattenedMatrixSize-4]=matrix[src])}}return packedRGBA}function decodeMatrixFromPackedRGBA(packedRGBA,batches,rows,columns,matrix){var requiredSize=rows*columns;if(matrix.length<requiredSize)throw new Error("matrix length ("+matrix.length+") must be >= "+requiredSize);for(var oddWidth=columns%2==1,oddHeight=rows%2==1,widthInFullBlocks=Math.floor(columns/2),heightInFullBlocks=Math.floor(rows/2),texelsPerRow=Math.ceil(columns/2),texelsPerBatch=texelsPerRow*Math.ceil(rows/2),flattenedMatrixSize=util.nearestLargerEven(rows)*util.nearestLargerEven(columns),batch=0;batch<batches;batch++){for(var batchOffset=batch*rows*columns,sourceOffset=batch*flattenedMatrixSize,srcStride=oddWidth?4:0,dstStride=columns+(oddWidth?1:0),src=sourceOffset,dstRow1=batchOffset,dstRow2=batchOffset+columns,blockY=0;blockY<heightInFullBlocks;++blockY){for(var blockX=0;blockX<widthInFullBlocks;++blockX)matrix[dstRow1++]=packedRGBA[src++],matrix[dstRow1++]=packedRGBA[src++],matrix[dstRow2++]=packedRGBA[src++],matrix[dstRow2++]=packedRGBA[src++];src+=srcStride,dstRow1+=dstStride,dstRow2+=dstStride}if(oddWidth)for(var src=sourceOffset+4*(texelsPerRow-1),dst=batchOffset+columns-1,srcStride=4*texelsPerRow,dstStride=2*columns,blockY=0;blockY<heightInFullBlocks;++blockY)matrix[dst]=packedRGBA[src],matrix[dst+columns]=packedRGBA[src+2],src+=srcStride,dst+=dstStride;if(oddHeight){for(var src=sourceOffset+4*(texelsPerBatch-texelsPerRow),dst=batchOffset+(rows-1)*columns,blockX=0;blockX<widthInFullBlocks;++blockX)matrix[dst++]=packedRGBA[src++],matrix[dst++]=packedRGBA[src++],src+=2;oddWidth&&(matrix[batchOffset+rows*columns-1]=packedRGBA[src])}}return matrix}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../../util");!function(TextureUsage){TextureUsage[TextureUsage.RENDER=0]="RENDER",TextureUsage[TextureUsage.UPLOAD=1]="UPLOAD",TextureUsage[TextureUsage.PIXELS=2]="PIXELS",TextureUsage[TextureUsage.DOWNLOAD=3]="DOWNLOAD"}(exports.TextureUsage||(exports.TextureUsage={}));!function(PhysicalTextureType){PhysicalTextureType[PhysicalTextureType.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",PhysicalTextureType[PhysicalTextureType.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",PhysicalTextureType[PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",PhysicalTextureType[PhysicalTextureType.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",PhysicalTextureType[PhysicalTextureType.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(exports.PhysicalTextureType||(exports.PhysicalTextureType={})),exports.getUnpackedMatrixTextureShapeWidthHeight=getUnpackedMatrixTextureShapeWidthHeight,exports.getUnpackedArraySizeFromMatrixSize=getUnpackedArraySizeFromMatrixSize,exports.getColorMatrixTextureShapeWidthHeight=getColorMatrixTextureShapeWidthHeight,exports.getMatrixSizeFromUnpackedArraySize=getMatrixSizeFromUnpackedArraySize,exports.encodeMatrixToUnpackedArray=encodeMatrixToUnpackedArray,exports.decodeMatrixFromUnpackedArray=decodeMatrixFromUnpackedArray,exports.decodeMatrixFromUnpackedColorRGBAArray=decodeMatrixFromUnpackedColorRGBAArray,exports.getPackedMatrixTextureShapeWidthHeight=getPackedMatrixTextureShapeWidthHeight,exports.getPackedRGBAArraySizeFromMatrixShape=getPackedRGBAArraySizeFromMatrixShape,exports.encodeMatrixToPackedRGBA=encodeMatrixToPackedRGBA,exports.decodeMatrixFromPackedRGBA=decodeMatrixFromPackedRGBA},{"../../util":210}],133:[function(require,module,exports){"use strict";function getPhysicalFromLogicalTextureType(logicalTexType,isPacked){if(isPacked)return environment_1.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")?tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT32:tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT16;if(logicalTexType===tex_util_1.TextureUsage.DOWNLOAD||logicalTexType===tex_util_1.TextureUsage.PIXELS)return tex_util_1.PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE;if(logicalTexType===tex_util_1.TextureUsage.UPLOAD)return tex_util_1.PhysicalTextureType.UNPACKED_FLOAT32;if(logicalTexType===tex_util_1.TextureUsage.RENDER)return environment_1.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")?tex_util_1.PhysicalTextureType.UNPACKED_FLOAT32:tex_util_1.PhysicalTextureType.UNPACKED_FLOAT16;throw new Error("Unknown logical texture type "+logicalTexType)}function getKeyFromTextureShape(shapeRowsCol,physicalTexType,isPacked){return shapeRowsCol[0]+"_"+shapeRowsCol[1]+"_"+physicalTexType+"_"+isPacked}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),tex_util_1=require("./tex_util"),TextureManager=function(){function TextureManager(gpgpu){this.gpgpu=gpgpu,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return TextureManager.prototype.acquireTexture=function(shapeRC,usage,isPacked){var physicalTexType=getPhysicalFromLogicalTextureType(usage,isPacked),shapeKey=getKeyFromTextureShape(shapeRC,physicalTexType,isPacked);if(shapeKey in this.freeTextures||(this.freeTextures[shapeKey]=[]),shapeKey in this.usedTextures||(this.usedTextures[shapeKey]=[]),this.freeTextures[shapeKey].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var newTexture_1=this.freeTextures[shapeKey].shift();return this.usedTextures[shapeKey].push(newTexture_1),newTexture_1}this.numUsedTextures++,this.log();var newTexture;return physicalTexType===tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT32?newTexture=this.gpgpu.createPackedMatrixTexture(shapeRC[0],shapeRC[1]):physicalTexType===tex_util_1.PhysicalTextureType.PACKED_2X2_FLOAT16?newTexture=this.gpgpu.createFloat16PackedMatrixTexture(shapeRC[0],shapeRC[1]):physicalTexType===tex_util_1.PhysicalTextureType.UNPACKED_FLOAT32?newTexture=this.gpgpu.createFloat32MatrixTexture(shapeRC[0],shapeRC[1]):physicalTexType===tex_util_1.PhysicalTextureType.UNPACKED_FLOAT16?newTexture=this.gpgpu.createFloat16MatrixTexture(shapeRC[0],shapeRC[1]):physicalTexType===tex_util_1.PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE&&(newTexture=this.gpgpu.createUnsignedBytesMatrixTexture(shapeRC[0],shapeRC[1])),this.usedTextures[shapeKey].push(newTexture),newTexture},TextureManager.prototype.releaseTexture=function(texture,shape,logicalTexType,isPacked){if(null!=this.freeTextures){var physicalTexType=getPhysicalFromLogicalTextureType(logicalTexType,isPacked),shapeKey=getKeyFromTextureShape(shape,physicalTexType,isPacked);shapeKey in this.freeTextures||(this.freeTextures[shapeKey]=[]),this.freeTextures[shapeKey].push(texture),this.numFreeTextures++,this.numUsedTextures--;var texList=this.usedTextures[shapeKey],texIndex=texList.indexOf(texture);if(texIndex<0)throw new Error("Cannot release a texture that was never provided by this texture manager");texList.splice(texIndex,1),this.log()}},TextureManager.prototype.log=function(){if(this.logEnabled){var total=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+total+")")}},TextureManager.prototype.getNumUsedTextures=function(){return this.numUsedTextures},TextureManager.prototype.getNumFreeTextures=function(){return this.numFreeTextures},TextureManager.prototype.dispose=function(){var _this=this;if(null!=this.freeTextures){for(var texShape in this.freeTextures)this.freeTextures[texShape].forEach(function(tex){_this.gpgpu.deleteMatrixTexture(tex)});for(var texShape in this.usedTextures)this.usedTextures[texShape].forEach(function(tex){_this.gpgpu.deleteMatrixTexture(tex)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},TextureManager}();exports.TextureManager=TextureManager},{"../../environment":58,"./tex_util":132}],134:[function(require,module,exports){"use strict";function getSourceCoords(aShape){var rank=aShape.length;if(rank>5)throw Error("Tile for rank "+rank+" is not yet supported");if(1===rank)return"imod(resRC, "+aShape[0]+")";for(var currentCoords=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],sourceCoords=[],i=0;i<aShape.length;i++)sourceCoords.push("imod("+currentCoords[i]+", "+aShape[i]+")");return sourceCoords.join()}Object.defineProperty(exports,"__esModule",{value:!0});var shader_compiler_1=require("./shader_compiler"),TileProgram=function(){function TileProgram(aShape,reps){this.variableNames=["A"];for(var outputShape=new Array(aShape.length),i=0;i<outputShape.length;i++)outputShape[i]=aShape[i]*reps[i];this.outputShape=outputShape,this.rank=outputShape.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),sourceCoords=getSourceCoords(aShape);this.userCode="\n      void main() {\n        "+dtype+" resRC = getOutputCoords();\n        setOutput(getA("+sourceCoords+"));\n      }\n    "}return TileProgram}();exports.TileProgram=TileProgram},{"./shader_compiler":128}],135:[function(require,module,exports){"use strict";function getSwitchedCoords(newDim){var rank=newDim.length;if(rank>6)throw Error("Transpose for rank "+rank+" is not yet supported");for(var originalOrder=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],switchedCoords=new Array(rank),i=0;i<newDim.length;i++)switchedCoords[newDim[i]]=originalOrder[i];return switchedCoords.join()}Object.defineProperty(exports,"__esModule",{value:!0})
;var shader_compiler_1=require("./shader_compiler"),TransposeProgram=function(){function TransposeProgram(aShape,newDim){this.variableNames=["A"];for(var outputShape=new Array(aShape.length),i=0;i<outputShape.length;i++)outputShape[i]=aShape[newDim[i]];this.outputShape=outputShape,this.rank=outputShape.length;var dtype=shader_compiler_1.getCoordsDataType(this.rank),switched=getSwitchedCoords(newDim);this.userCode="\n    void main() {\n      "+dtype+" resRC = getOutputCoords();\n      setOutput(getA("+switched+"));\n    }\n    "}return TransposeProgram}();exports.TransposeProgram=TransposeProgram},{"./shader_compiler":128}],136:[function(require,module,exports){"use strict";function STEP(alpha){return void 0===alpha&&(alpha=0),CHECK_NAN_SNIPPET+"\n    return x > 0.0 ? 1.0 : float("+alpha+");\n  "}Object.defineProperty(exports,"__esModule",{value:!0});var erf_util=require("../../ops/erf_util"),selu_util=require("../../ops/selu_util"),UnaryOpProgram=function(){function UnaryOpProgram(aShape,opSnippet){this.variableNames=["A"],this.outputShape=aShape,this.userCode="\n      uniform float NAN;\n      float unaryOperation(float x) {\n        "+opSnippet+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return UnaryOpProgram.prototype.getCustomSetupFunc=function(){var _this=this;return function(gpgpu,webGLProgram){null==_this.startLoc&&(_this.startLoc=gpgpu.getUniformLocationNoThrow(webGLProgram,"NAN"),null==_this.startLoc)||gpgpu.gl.uniform1f(_this.startLoc,NaN)}},UnaryOpProgram}();exports.UnaryOpProgram=UnaryOpProgram;var CHECK_NAN_SNIPPET="if (isNaN(x)) return x;";exports.ABS="return abs(x);",exports.RELU=CHECK_NAN_SNIPPET+"\n  return (x < 0.0) ? 0.0 : x;\n",exports.ELU="return (x >= 0.0) ? x : (exp(x) - 1.0);",exports.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+selu_util.SELU_SCALEALPHA+";\n  float scale = "+selu_util.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",exports.STEP=STEP,exports.NEG="return -x;",exports.CEIL="return ceil(x);",exports.FLOOR="return floor(x);",exports.SIGN="\n  if (isNaN(x)) { return 0.0; }\n  return sign(x);\n",exports.ROUND="\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n",exports.EXP="return exp(x);",exports.EXPM1="return exp(x) - 1.0;",exports.LOG="if (x < 0.0) return NAN;\n  return log(x);",exports.LOG1P="return log(1.0 + x);",exports.SQRT="return sqrt(x);",exports.RSQRT="return inversesqrt(x);",exports.SIGMOID="return 1.0 / (1.0 + exp(-1.0 * x));",exports.SOFTPLUS="\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n",exports.SIN=CHECK_NAN_SNIPPET+"\n  return sin(x);\n",exports.COS=CHECK_NAN_SNIPPET+"\n  return cos(x);\n",exports.TAN="return tan(x);",exports.ASIN="return asin(x);",exports.ACOS="return acos(x);",exports.ATAN=CHECK_NAN_SNIPPET+"\n  return atan(x);\n",exports.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",exports.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",exports.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",exports.ASINH="return log(x + sqrt(x * x + 1.0));",exports.ACOSH=CHECK_NAN_SNIPPET+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",exports.ATANH=CHECK_NAN_SNIPPET+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",exports.ERF='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '+erf_util.ERF_P+";\n  float a1 = "+erf_util.ERF_A1+";\n  float a2 = "+erf_util.ERF_A2+";\n  float a3 = "+erf_util.ERF_A3+";\n  float a4 = "+erf_util.ERF_A4+";\n  float a5 = "+erf_util.ERF_A5+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n",exports.SQUARE="return x * x;",exports.RECIPROCAL="return 1.0 / x;",exports.LOGICAL_NOT="return float(!(x >= 1.0));",exports.TO_INT="return float(int(x));"},{"../../ops/erf_util":155,"../../ops/selu_util":179}],137:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var packing_util_1=require("../packing_util"),shader_compiler_1=require("./shader_compiler"),UnpackProgram=function(){function UnpackProgram(outputShape){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=outputShape;var rank=outputShape.length,channels=packing_util_1.getChannels("rc",rank),dtype=shader_compiler_1.getCoordsDataType(rank),sourceCoords=packing_util_1.getSourceCoords(rank,channels),innerDims=channels.slice(-2),coords=1===rank?"rc":"vec2("+innerDims.join(",")+")";this.userCode="\n      void main() {\n        "+dtype+" rc = getOutputCoords();\n        vec4 packedInput = getA("+sourceCoords+");\n\n        setOutput(getChannel(packedInput, "+coords+"));\n      }\n    "}return UnpackProgram}();exports.UnpackProgram=UnpackProgram},{"../packing_util":80,"./shader_compiler":128}],138:[function(require,module,exports){"use strict";function callAndCheck(gl,func){var returnValue=func();return checkWebGLError(gl),returnValue}function enableDebugWebGLErrorChecking(enabled){webGLDebugErrorCheckingEnabled=enabled}function checkWebGLError(gl){if(webGLDebugErrorCheckingEnabled){var error=gl.getError();if(error!==gl.NO_ERROR)throw new Error("WebGL Error: "+getWebGLErrorMessage(gl,error))}}function getWebGLErrorMessage(gl,status){switch(status){case gl.NO_ERROR:return"NO_ERROR";case gl.INVALID_ENUM:return"INVALID_ENUM";case gl.INVALID_VALUE:return"INVALID_VALUE";case gl.INVALID_OPERATION:return"INVALID_OPERATION";case gl.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case gl.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case gl.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+status}}function getExtensionOrThrow(gl,extensionName){return throwIfNull(gl,function(){return gl.getExtension(extensionName)},'Extension "'+extensionName+'" not supported on this browser.')}function createVertexShader(gl,vertexShaderSource){var vertexShader=throwIfNull(gl,function(){return gl.createShader(gl.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(callAndCheck(gl,function(){return gl.shaderSource(vertexShader,vertexShaderSource)}),callAndCheck(gl,function(){return gl.compileShader(vertexShader)}),!1===gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS))throw console.log(gl.getShaderInfoLog(vertexShader)),new Error("Failed to compile vertex shader.");return vertexShader}function createFragmentShader(gl,fragmentShaderSource){var fragmentShader=throwIfNull(gl,function(){return gl.createShader(gl.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(callAndCheck(gl,function(){return gl.shaderSource(fragmentShader,fragmentShaderSource)}),callAndCheck(gl,function(){return gl.compileShader(fragmentShader)}),!1===gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS))throw logShaderSourceAndInfoLog(fragmentShaderSource,gl.getShaderInfoLog(fragmentShader)),new Error("Failed to compile fragment shader.");return fragmentShader}function logShaderSourceAndInfoLog(shaderSource,shaderInfoLog){var lineNumberRegexResult=lineNumberRegex.exec(shaderInfoLog);if(null==lineNumberRegexResult)return console.log("Couldn't parse line number in error: "+shaderInfoLog),void console.log(shaderSource);for(var lineNumber=+lineNumberRegexResult[1],shaderLines=shaderSource.split("\n"),pad=shaderLines.length.toString().length+2,linesWithLineNumbers=shaderLines.map(function(line,lineNumber){return util.rightPad((lineNumber+1).toString(),pad)+line}),maxLineLength=0,i=0;i<linesWithLineNumbers.length;i++)maxLineLength=Math.max(linesWithLineNumbers[i].length,maxLineLength);var beforeErrorLines=linesWithLineNumbers.slice(0,lineNumber-1),errorLine=linesWithLineNumbers.slice(lineNumber-1,lineNumber),afterErrorLines=linesWithLineNumbers.slice(lineNumber);console.log(beforeErrorLines.join("\n")),console.log(shaderInfoLog.split("\n")[0]),console.log("%c "+util.rightPad(errorLine[0],maxLineLength),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(afterErrorLines.join("\n"))}function createProgram(gl){return throwIfNull(gl,function(){return gl.createProgram()},"Unable to create WebGLProgram.")}function linkProgram(gl,program){if(callAndCheck(gl,function(){return gl.linkProgram(program)}),!1===gl.getProgramParameter(program,gl.LINK_STATUS))throw console.log(gl.getProgramInfoLog(program)),new Error("Failed to link vertex and fragment shaders.")}function validateProgram(gl,program){if(callAndCheck(gl,function(){return gl.validateProgram(program)}),!1===gl.getProgramParameter(program,gl.VALIDATE_STATUS))throw console.log(gl.getProgramInfoLog(program)),new Error("Shader program validation failed.")}function createStaticVertexBuffer(gl,data){var buffer=throwIfNull(gl,function(){return gl.createBuffer()},"Unable to create WebGLBuffer");return callAndCheck(gl,function(){return gl.bindBuffer(gl.ARRAY_BUFFER,buffer)}),callAndCheck(gl,function(){return gl.bufferData(gl.ARRAY_BUFFER,data,gl.STATIC_DRAW)}),buffer}function createStaticIndexBuffer(gl,data){var buffer=throwIfNull(gl,function(){return gl.createBuffer()},"Unable to create WebGLBuffer");return callAndCheck(gl,function(){return gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,buffer)}),callAndCheck(gl,function(){return gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,data,gl.STATIC_DRAW)}),buffer}function getNumChannels(){return 2===environment_1.ENV.get("WEBGL_VERSION")?1:4}function createTexture(gl){return throwIfNull(gl,function(){return gl.createTexture()},"Unable to create WebGLTexture.")}function validateTextureSize(width,height){var maxTextureSize=environment_1.ENV.get("WEBGL_MAX_TEXTURE_SIZE");if(width<=0||height<=0){var requested="["+width+"x"+height+"]";throw new Error("Requested texture size "+requested+" is invalid.")}if(width>maxTextureSize||height>maxTextureSize){var requested="["+width+"x"+height+"]",max="["+maxTextureSize+"x"+maxTextureSize+"]";throw new Error("Requested texture size "+requested+" greater than WebGL maximum on this browser / GPU "+max+".")}}function createFramebuffer(gl){return throwIfNull(gl,function(){return gl.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function bindVertexBufferToProgramAttribute(gl,program,attribute,buffer,arrayEntriesPerItem,itemStrideInBytes,itemOffsetInBytes){var loc=gl.getAttribLocation(program,attribute);return-1!==loc&&(callAndCheck(gl,function(){return gl.bindBuffer(gl.ARRAY_BUFFER,buffer)}),callAndCheck(gl,function(){return gl.vertexAttribPointer(loc,arrayEntriesPerItem,gl.FLOAT,!1,itemStrideInBytes,itemOffsetInBytes)}),callAndCheck(gl,function(){return gl.enableVertexAttribArray(loc)}),!0)}function bindTextureUnit(gl,texture,textureUnit){validateTextureUnit(gl,textureUnit),callAndCheck(gl,function(){return gl.activeTexture(gl.TEXTURE0+textureUnit)}),callAndCheck(gl,function(){return gl.bindTexture(gl.TEXTURE_2D,texture)})}function unbindTextureUnit(gl,textureUnit){validateTextureUnit(gl,textureUnit),callAndCheck(gl,function(){return gl.activeTexture(gl.TEXTURE0+textureUnit)}),callAndCheck(gl,function(){return gl.bindTexture(gl.TEXTURE_2D,null)})}function getProgramUniformLocationOrThrow(gl,program,uniformName){return throwIfNull(gl,function(){return gl.getUniformLocation(program,uniformName)},'uniform "'+uniformName+'" not present in program.')}function getProgramUniformLocation(gl,program,uniformName){return gl.getUniformLocation(program,uniformName)}function bindTextureToProgramUniformSampler(gl,program,texture,uniformSamplerLocation,textureUnit){callAndCheck(gl,function(){return bindTextureUnit(gl,texture,textureUnit)}),callAndCheck(gl,function(){return gl.uniform1i(uniformSamplerLocation,textureUnit)})}function bindCanvasToFramebuffer(gl){callAndCheck(gl,function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,null)}),callAndCheck(gl,function(){return gl.viewport(0,0,gl.canvas.width,gl.canvas.height)}),callAndCheck(gl,function(){return gl.scissor(0,0,gl.canvas.width,gl.canvas.height)})}function bindColorTextureToFramebuffer(gl,texture,framebuffer){callAndCheck(gl,function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)}),callAndCheck(gl,function(){return gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0)})}function unbindColorTextureFromFramebuffer(gl,framebuffer){callAndCheck(gl,function(){return gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)}),callAndCheck(gl,function(){return gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,null,0)})}function validateFramebuffer(gl){var status=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(status!==gl.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+getFramebufferErrorMessage(gl,status))}function getFramebufferErrorMessage(gl,status){switch(status){case gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case gl.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+status}}function throwIfNull(gl,returnTOrNull,failureMessage){var tOrNull=callAndCheck(gl,function(){return returnTOrNull()});if(null==tOrNull)throw new Error(failureMessage);return tOrNull}function validateTextureUnit(gl,textureUnit){var maxTextureUnit=gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,glTextureUnit=textureUnit+gl.TEXTURE0;if(glTextureUnit<gl.TEXTURE0||glTextureUnit>maxTextureUnit){var textureUnitRange="[gl.TEXTURE0, gl.TEXTURE"+maxTextureUnit+"]";throw new Error("textureUnit must be in "+textureUnitRange+".")}}function getTextureShapeFromLogicalShape(logShape,isPacked){void 0===isPacked&&(isPacked=!1);var maxTexSize=environment_1.ENV.get("WEBGL_MAX_TEXTURE_SIZE");if(isPacked&&(maxTexSize*=2,logShape=logShape.map(function(d,i){return i>=logShape.length-2?util.nearestLargerEven(logShape[i]):logShape[i]})),2!==logShape.length){var squeezeResult=util.squeezeShape(logShape);logShape=squeezeResult.newShape}var size=util.sizeFromShape(logShape);return logShape.length<=1&&size<=maxTexSize?[size,1]:2===logShape.length&&logShape[0]<=maxTexSize&&logShape[1]<=maxTexSize?logShape:3===logShape.length&&logShape[0]*logShape[1]<=maxTexSize&&logShape[2]<=maxTexSize?[logShape[0]*logShape[1],logShape[2]]:3===logShape.length&&logShape[0]<=maxTexSize&&logShape[1]*logShape[2]<=maxTexSize?[logShape[0],logShape[1]*logShape[2]]:4===logShape.length&&logShape[0]*logShape[1]*logShape[2]<=maxTexSize&&logShape[3]<=maxTexSize?[logShape[0]*logShape[1]*logShape[2],logShape[3]]:4===logShape.length&&logShape[0]<=maxTexSize&&logShape[1]*logShape[2]*logShape[3]<=maxTexSize?[logShape[0],logShape[1]*logShape[2]*logShape[3]]:util.sizeToSquarishShape(size)}function isEven(n){return n%2==0}function isReshapeFree(shape1,shape2){if(shape1=shape1.slice(-2),shape2=shape2.slice(-2),util.arraysEqual(shape1,shape2))return!0;if(!shape1.length||!shape2.length)return!0;if(0===shape1[0]||0===shape1[1]||0===shape2[0]||0===shape2[1])return!0;if(shape1.length!==shape2.length){if(util.arraysEqual(util.squeezeShape(shape1).newShape,util.squeezeShape(shape2).newShape))return!0}else if(isEven(shape1[0])&&isEven(shape2[0])){if(isEven(shape1[1])&&isEven(shape2[1]))return!0;if(shape1[1]===shape2[1])return!0}return!1}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../../environment"),util=require("../../util");exports.callAndCheck=callAndCheck;var webGLDebugErrorCheckingEnabled=!1;exports.enableDebugWebGLErrorChecking=enableDebugWebGLErrorChecking,exports.checkWebGLError=checkWebGLError,exports.getWebGLErrorMessage=getWebGLErrorMessage,exports.getExtensionOrThrow=getExtensionOrThrow,exports.createVertexShader=createVertexShader,exports.createFragmentShader=createFragmentShader;var lineNumberRegex=/ERROR: [0-9]+:([0-9]+):/g;exports.createProgram=createProgram,exports.linkProgram=linkProgram,exports.validateProgram=validateProgram,exports.createStaticVertexBuffer=createStaticVertexBuffer,exports.createStaticIndexBuffer=createStaticIndexBuffer,exports.getNumChannels=getNumChannels,exports.createTexture=createTexture,exports.validateTextureSize=validateTextureSize,exports.createFramebuffer=createFramebuffer,exports.bindVertexBufferToProgramAttribute=bindVertexBufferToProgramAttribute,exports.bindTextureUnit=bindTextureUnit,exports.unbindTextureUnit=unbindTextureUnit,exports.getProgramUniformLocationOrThrow=getProgramUniformLocationOrThrow,exports.getProgramUniformLocation=getProgramUniformLocation,exports.bindTextureToProgramUniformSampler=bindTextureToProgramUniformSampler,exports.bindCanvasToFramebuffer=bindCanvasToFramebuffer,exports.bindColorTextureToFramebuffer=bindColorTextureToFramebuffer,exports.unbindColorTextureFromFramebuffer=unbindColorTextureFromFramebuffer,exports.validateFramebuffer=validateFramebuffer,exports.getFramebufferErrorMessage=getFramebufferErrorMessage,exports.getTextureShapeFromLogicalShape=getTextureShapeFromLogicalShape,exports.isReshapeFree=isReshapeFree},{"../../environment":58,"../../util":210}],139:[function(require,module,exports){"use strict";function whereImpl(condShape,condVals){for(var indices=[],i=0;i<condVals.length;i++)condVals[i]&&indices.push(i);for(var inBuffer=array_ops_1.buffer(condShape,"int32"),out=array_ops_1.buffer([indices.length,condShape.length],"int32"),i=0;i<indices.length;i++){var loc=inBuffer.indexToLoc(indices[i]),offset=i*condShape.length;out.values.set(loc,offset)}return out.toTensor()}Object.defineProperty(exports,"__esModule",{value:!0});var array_ops_1=require("../ops/array_ops");exports.whereImpl=whereImpl},{"../ops/array_ops":142}],140:[function(require,module,exports){"use strict";function warn(){for(var msg=[],_i=0;_i<arguments.length;_i++)msg[_i]=arguments[_i];environment_1.ENV.get("IS_TEST")||console.warn.apply(console,msg)}function log(){for(var msg=[],_i=0;_i<arguments.length;_i++)msg[_i]=arguments[_i];environment_1.ENV.get("IS_TEST")||console.log.apply(console,msg)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment");exports.warn=warn,exports.log=log},{"./environment":58}],141:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var confusion_matrix_1=require("./ops/confusion_matrix");exports.confusionMatrix=confusion_matrix_1.confusionMatrix},{"./ops/confusion_matrix":152}],142:[function(require,module,exports){"use strict";function clone_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","clone"),der=function(dy){return{$x:function(){return dy.toFloat()}}};return environment_1.ENV.engine.runKernel(function(backend){return tensor_1.Tensor.make($x.shape,{dataId:$x.dataId},$x.dtype)},{$x:$x},der)}function eye_(numRows,numColumns,batchShape,dtype){void 0===dtype&&(dtype="float32"),null==numColumns&&(numColumns=numRows);for(var buff=buffer([numRows,numColumns],dtype),n=numRows<=numColumns?numRows:numColumns,i=0;i<n;++i)buff.set(1,i,i);var out=buff.toTensor().as2D(numRows,numColumns);if(null==batchShape)return out;if(1===batchShape.length)return exports.tile(exports.expandDims(out,0),[batchShape[0],1,1]);if(2===batchShape.length)return exports.tile(exports.expandDims(exports.expandDims(out,0),0),[batchShape[0],batchShape[1],1,1]);if(3===batchShape.length)return exports.tile(exports.expandDims(exports.expandDims(exports.expandDims(out,0),0),0),[batchShape[0],batchShape[1],batchShape[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+batchShape.length+"D.")}function randomNormal_(shape,mean,stdDev,dtype,seed){if(void 0===mean&&(mean=0),void 0===stdDev&&(stdDev=1),null!=dtype&&"bool"===dtype)throw new Error("Unsupported data type "+dtype);for(var randGauss=new rand_1.MPRandGauss(mean,stdDev,dtype,!1,seed),res=buffer(shape,dtype),i=0;i<res.values.length;i++)res.values[i]=randGauss.nextValue();return res.toTensor()}function truncatedNormal_(shape,mean,stdDev,dtype,seed){if(void 0===mean&&(mean=0),void 0===stdDev&&(stdDev=1),null!=dtype&&"bool"===dtype)throw new Error("Unsupported data type "+dtype);for(var randGauss=new rand_1.MPRandGauss(mean,stdDev,dtype,!0,seed),res=buffer(shape,dtype),i=0;i<res.values.length;i++)res.values[i]=randGauss.nextValue();return res.toTensor()}function randomUniform_(shape,minval,maxval,dtype){void 0===minval&&(minval=0),void 0===maxval&&(maxval=1),void 0===dtype&&(dtype="float32");for(var res=buffer(shape,dtype),i=0;i<res.values.length;i++)res.values[i]=util.randUniform(minval,maxval);return res.toTensor()}function rand_(shape,randFunction,dtype){var size=util.sizeFromShape(shape),values=null;if(null==dtype||"float32"===dtype)values=new Float32Array(size);else if("int32"===dtype)values=new Int32Array(size);else{if("bool"!==dtype)throw new Error("Unknown data type "+dtype);values=new Uint8Array(size)}for(var i=0;i<size;i++)values[i]=randFunction();return tensor_1.Tensor.make(shape,{values:values},dtype)}function multinomial_(logits,numSamples,seed,normalized){void 0===normalized&&(normalized=!1);var $logits=tensor_util_env_1.convertToTensor(logits,"logits","multinomial"),numOutcomes=$logits.size,origRank=$logits.rank;if(numOutcomes<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+numOutcomes+".");if(origRank>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+origRank);seed=seed||Math.random();var logits2D=1===origRank?$logits.as2D(1,-1):$logits,res=environment_1.ENV.engine.runKernel(function(backend){return backend.multinomial(logits2D,normalized,numSamples,seed)},{logits2D:logits2D});return 1===origRank?res.as1D():res}function oneHot_(indices,depth,onValue,offValue){void 0===onValue&&(onValue=1),void 0===offValue&&(offValue=0);var $indices=tensor_util_env_1.convertToTensor(indices,"indices","oneHot","int32");if(util.assert("int32"===$indices.dtype,"Indices must be of dtype `int32`"),depth<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+depth);var grad=function(dy){return{$indices:function(){return tensor_ops_1.zerosLike($indices)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.oneHot($indices,depth,onValue,offValue)},{$indices:$indices},grad)}function fromPixels_(pixels,numChannels){if(void 0===numChannels&&(numChannels=3),numChannels>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return environment_1.ENV.engine.fromPixels(pixels,numChannels)}function toPixels(img,canvas){return __awaiter(this,void 0,void 0,function(){var $img,_a,height,width,depth,minTensor,maxTensor,min,max,data,multiplier,bytes,i,r,g,b,a,j,ctx,imageData;return __generator(this,function(_b){switch(_b.label){case 0:if($img=tensor_util_env_1.convertToTensor(img,"img","toPixels","int32"),2!==$img.rank&&3!==$img.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+$img.rank+".");if(_a=$img.shape.slice(0,2),height=_a[0],width=_a[1],(depth=2===$img.rank?1:$img.shape[2])>4||2===depth)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+depth);return minTensor=$img.min(),maxTensor=$img.max(),[4,minTensor.data()];case 1:return min=_b.sent()[0],[4,maxTensor.data()];case 2:if(max=_b.sent()[0],minTensor.dispose(),maxTensor.dispose(),"float32"===$img.dtype){if(min<0||max>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+min+" - "+max+"].")}else{if("int32"!==$img.dtype)throw new Error("Unsupported type for toPixels: "+$img.dtype+". Please use float32 or int32 tensors.");if(min<0||max>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+min+" - "+max+"].")}return[4,$img.data()];case 3:for(data=_b.sent(),multiplier="float32"===$img.dtype?255:1,bytes=new Uint8ClampedArray(width*height*4),i=0;i<height*width;++i)r=void 0,g=void 0,b=void 0,a=void 0,1===depth?(r=data[i]*multiplier,g=data[i]*multiplier,b=data[i]*multiplier,a=255):3===depth?(r=data[3*i]*multiplier,g=data[3*i+1]*multiplier,b=data[3*i+2]*multiplier,a=255):4===depth&&(r=data[4*i]*multiplier,g=data[4*i+1]*multiplier,b=data[4*i+2]*multiplier,a=data[4*i+3]*multiplier),j=4*i,bytes[j+0]=Math.round(r),bytes[j+1]=Math.round(g),bytes[j+2]=Math.round(b),bytes[j+3]=Math.round(a);return null!=canvas&&(canvas.width=width,canvas.height=height,ctx=canvas.getContext("2d"),imageData=new ImageData(bytes,width,height),ctx.putImageData(imageData,0,0)),$img!==img&&$img.dispose(),[2,bytes]}})})}function reshape_(x,shape){var $x=tensor_util_env_1.convertToTensor(x,"x","reshape");shape=util.inferFromImplicitShape(shape,$x.size),util.assert($x.size===util.sizeFromShape(shape),"new shape and old shape must have the same number of elements.");var grad=function(dy){return{$x:function(){return dy.reshape($x.shape)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.reshape($x,shape)},{$x:$x},grad)}function squeeze_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","squeeze");return exports.reshape($x,util.squeezeShape($x.shape,axis).newShape)}function cast_(x,dtype){var $x=tensor_util_env_1.convertToTensor(x,"x","cast"),grad=function(dy){return{$x:function(){return dy.clone()}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.cast($x,dtype)},{$x:$x},grad)}function tile_(x,reps){var $x=tensor_util_env_1.convertToTensor(x,"x","tile");util.assert($x.rank===reps.length,"Error in transpose: rank of input "+$x.rank+" must match length of reps "+reps+".");var grad=function(dy){return{$x:function(){var xGrad=tensor_ops_1.zerosLike($x);if(1===$x.rank)for(var i=0;i<reps[0];++i)xGrad=xGrad.add(dy.slice([i*$x.shape[0]],[$x.shape[0]]));else if(2===$x.rank)for(var i=0;i<reps[0];++i)for(var j=0;j<reps[1];++j)xGrad=xGrad.add(dy.slice([i*$x.shape[0],j*$x.shape[1]],[$x.shape[0],$x.shape[1]]));else if(3===$x.rank)for(var i=0;i<reps[0];++i)for(var j=0;j<reps[1];++j)for(var k=0;k<reps[2];++k)xGrad=xGrad.add(dy.slice([i*$x.shape[0],j*$x.shape[1],k*$x.shape[2]],[$x.shape[0],$x.shape[1],$x.shape[2]]));else{if(4!==$x.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+$x.rank+" tensors yet.");for(var i=0;i<reps[0];++i)for(var j=0;j<reps[1];++j)for(var k=0;k<reps[2];++k)for(var l=0;l<reps[3];++l)xGrad=xGrad.add(dy.slice([i*$x.shape[0],j*$x.shape[1],k*$x.shape[2],l*$x.shape[3]],[$x.shape[0],$x.shape[1],$x.shape[2],$x.shape[3]]))}return xGrad}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.tile($x,reps)},{$x:$x},grad)}function pad1d_(x,paddings,constantValue){return void 0===constantValue&&(constantValue=0),util.assert(2===paddings.length,"Invalid number of paddings. Must be length of 2."),exports.pad(x,[paddings],constantValue)}function pad2d_(x,paddings,constantValue){return void 0===constantValue&&(constantValue=0),util.assert(2===paddings.length&&2===paddings[0].length&&2===paddings[1].length,"Invalid number of paddings. Must be length of 2 each."),exports.pad(x,paddings,constantValue)}function pad3d_(x,paddings,constantValue){return void 0===constantValue&&(constantValue=0),util.assert(3===paddings.length&&2===paddings[0].length&&2===paddings[1].length&&2===paddings[2].length,"Invalid number of paddings. Must be length of 2 each."),exports.pad(x,paddings,constantValue)}function pad4d_(x,paddings,constantValue){return void 0===constantValue&&(constantValue=0),util.assert(4===paddings.length&&2===paddings[0].length&&2===paddings[1].length&&2===paddings[2].length&&2===paddings[3].length,"Invalid number of paddings. Must be length of 2 each."),exports.pad(x,paddings,constantValue)}function pad_(x,paddings,constantValue){void 0===constantValue&&(constantValue=0);var $x=tensor_util_env_1.convertToTensor(x,"x","pad");if(0===$x.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var begin=paddings.map(function(p){return p[0]}),grad=function(dy){return{$x:function(){return dy.slice(begin,$x.shape)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.pad($x,paddings,constantValue)},{$x:$x},grad)}function stack_(tensors,axis){void 0===axis&&(axis=0);var $tensors=tensor_util_env_1.convertToTensorArray(tensors,"tensors","stack");if(util.assert($tensors.length>=1,"Pass at least one tensor to tf.stack"),1===$tensors.length)return $tensors[0].expandDims(axis);var rank=$tensors[0].rank,shape=$tensors[0].shape,dtype=$tensors[0].dtype;util.assert(axis<=rank,"Axis must be <= rank of the tensor"),$tensors.forEach(function(t){util.assertShapesMatch(shape,t.shape,"All tensors passed to stack must have matching shapes")}),$tensors.forEach(function(t){util.assert(dtype===t.dtype,"All tensors passed to stack must have matching dtypes")});var expandedTensors=$tensors.map(function(t){return t.expandDims(axis)});return concat_split_1.concat(expandedTensors,axis)}function batchToSpaceND_(x,blockShape,crops){var $x=tensor_util_env_1.convertToTensor(x,"x","batchToSpaceND"),prod=blockShape.reduce(function(a,b){return a*b});util.assert($x.rank>=1+blockShape.length,"input rank is "+$x.rank+" but should be > than blockShape.length "+blockShape.length),util.assert(crops.length===blockShape.length,"crops.length is "+crops.length+" but should be equal to blockShape.length  "+blockShape.length),util.assert($x.shape[0]%prod==0,"input tensor batch is "+$x.shape[0]+" but is not divisible by the product of the elements of blockShape "+blockShape.join(" * ")+" === "+prod);var grad=function(dy){return{$x:function(){return dy.spaceToBatchND(blockShape,crops)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.batchToSpaceND($x,blockShape,crops)},{$x:$x},grad)}function spaceToBatchND_(x,blockShape,paddings){var $x=tensor_util_env_1.convertToTensor(x,"x","spaceToBatchND");util.assert($x.rank>=1+blockShape.length,"input rank "+$x.rank+" should be > than [blockShape] "+blockShape.length),util.assert(paddings.length===blockShape.length,"paddings.shape[0] "+paddings.length+" must be equal to [blockShape] "+blockShape.length),util.assert($x.shape.reduce(function(a,b,i){return i>0&&i<=blockShape.length?a&&(b+paddings[i-1][0]+paddings[i-1][1])%blockShape[i-1]==0:a},!0),"input spatial dimensions "+$x.shape.slice(1)+" with paddings "+paddings.toString()+" must be divisible by blockShapes "+blockShape.toString());var grad=function(dy){return{$x:function(){return dy.batchToSpaceND(blockShape,paddings)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.spaceToBatchND($x,blockShape,paddings)},{$x:$x},grad)}function unstack_(x,axis){void 0===axis&&(axis=0);for(var $x=tensor_util_env_1.convertToTensor(x,"x","unstack"),num=$x.shape[axis],outputShape=Array($x.rank-1).fill(0),outIndex=0,i=0;i<$x.rank;i++)i!==axis&&(outputShape[outIndex]=$x.shape[i],outIndex++);var splitSizes;splitSizes=Array(num).fill(1);var begin=Array($x.rank).fill(0),size=$x.shape.slice();return splitSizes.map(function(s){size[axis]=s;var slice=$x.slice(begin,size);return begin[axis]+=s,slice.reshape(outputShape)})}function cumsum_(x,axis,exclusive,reverse){void 0===axis&&(axis=0),
void 0===exclusive&&(exclusive=!1),void 0===reverse&&(reverse=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","cumsum");axis|=0;var permutation=axis_util_1.getAxesPermutation([axis],$x.rank),permutedX=$x;null!=permutation&&(permutedX=$x.transpose(permutation));var permutedAxis=axis_util_1.getInnerMostAxes(1,$x.rank)[0],grad=function(dy){return{permutedX:function(){return dy.cumsum(axis,exclusive,!reverse)}}},value=environment_1.ENV.engine.runKernel(function(backend){return backend.cumsum(permutedX,permutedAxis,exclusive,reverse)},{permutedX:permutedX},grad);return null!=permutation&&(value=value.transpose(permutation)),value}function expandDims_(x,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","expandDims");util.assert(axis<=$x.rank,"Axis must be <= rank of the tensor");var newShape=$x.shape.slice();return axis<0&&(util.assert(-($x.rank+1)<=axis,"Axis must be in the interval ["+-($x.rank+1)+", "+$x.rank+"]"),axis=$x.rank+axis+1),newShape.splice(axis,0,1),exports.reshape($x,newShape)}function depthToSpace_(x,blockSize,dataFormat){void 0===dataFormat&&(dataFormat="NHWC");var $x=tensor_util_env_1.convertToTensor(x,"x","depthToSpace"),inputHeight="NHWC"===dataFormat?$x.shape[1]:$x.shape[2],inputWidth="NHWC"===dataFormat?$x.shape[2]:$x.shape[3],inputDepth="NHWC"===dataFormat?$x.shape[3]:$x.shape[1];return util.assert(inputHeight*blockSize>=0,"Negative dimension size caused by overflow when multiplying\n      "+inputHeight+" and "+blockSize+"  for depthToSpace with input shape\n      "+$x.shape),util.assert(inputWidth*blockSize>=0,"Negative dimension size caused by overflow when multiplying\n      "+inputWidth+" and "+blockSize+" for depthToSpace with input shape\n          "+$x.shape),util.assert(inputDepth%(blockSize*blockSize)==0,"Dimension size must be evenly divisible by "+blockSize*blockSize+" but is "+inputDepth+" for depthToSpace with input shape "+$x.shape),environment_1.ENV.engine.runKernel(function(backend){return backend.depthToSpace($x,blockSize,dataFormat)},{$x:$x})}function setdiff1dAsync_(x,y){return __awaiter(this,void 0,void 0,function(){var $x,$y,xVals,yVals,ySet,outputSize,i,buffer,indices,i,p;return __generator(this,function(_a){switch(_a.label){case 0:return $x=tensor_util_env_1.convertToTensor(x,"x","setdiff1d"),$y=tensor_util_env_1.convertToTensor(y,"y","setdiff1d"),util.assert($x.dtype===$y.dtype,"x and y should have the same dtype, but got x ("+$x.dtype+") and y ("+$y.dtype+")."),util.assert(1===$x.rank,"x should be 1D tensor, but got x ("+$x.shape+")."),util.assert(1===$y.rank,"y should be 1D tensor, but got y ("+$y.shape+")."),[4,$x.data()];case 1:return xVals=_a.sent(),[4,$y.data()];case 2:for(yVals=_a.sent(),ySet=new Set(yVals),outputSize=0,i=0;i<xVals.length;i++)ySet.has(xVals[i])||outputSize++;for(buffer=new tensor_1.TensorBuffer([outputSize],$x.dtype),indices=new tensor_1.TensorBuffer([outputSize],"int32"),i=0,p=0;i<xVals.length;i++)ySet.has(xVals[i])||(buffer.values[p]=xVals[i],indices.values[p]=i,p++);return[2,[buffer.toTensor(),indices.toTensor()]]}})})}function buffer(shape,dtype,values){return void 0===dtype&&(dtype="float32"),new tensor_1.TensorBuffer(shape,dtype,values)}function print(x,verbose){void 0===verbose&&(verbose=!1),console.log(x.toString(verbose))}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util_1=require("./axis_util"),concat_split_1=require("./concat_split"),operation_1=require("./operation"),rand_1=require("./rand"),tensor_ops_1=require("./tensor_ops");exports.toPixels=toPixels,exports.buffer=buffer,exports.print=print,exports.batchToSpaceND=operation_1.op({batchToSpaceND_:batchToSpaceND_}),exports.cast=operation_1.op({cast_:cast_}),exports.clone=operation_1.op({clone_:clone_}),exports.cumsum=operation_1.op({cumsum_:cumsum_}),exports.depthToSpace=operation_1.op({depthToSpace_:depthToSpace_}),exports.expandDims=operation_1.op({expandDims_:expandDims_}),exports.eye=operation_1.op({eye_:eye_}),exports.fromPixels=operation_1.op({fromPixels_:fromPixels_}),exports.multinomial=operation_1.op({multinomial_:multinomial_}),exports.oneHot=operation_1.op({oneHot_:oneHot_}),exports.pad=operation_1.op({pad_:pad_}),exports.pad1d=operation_1.op({pad1d_:pad1d_}),exports.pad2d=operation_1.op({pad2d_:pad2d_}),exports.pad3d=operation_1.op({pad3d_:pad3d_}),exports.pad4d=operation_1.op({pad4d_:pad4d_}),exports.rand=operation_1.op({rand_:rand_}),exports.randomNormal=operation_1.op({randomNormal_:randomNormal_}),exports.randomUniform=operation_1.op({randomUniform_:randomUniform_}),exports.reshape=operation_1.op({reshape_:reshape_}),exports.spaceToBatchND=operation_1.op({spaceToBatchND_:spaceToBatchND_}),exports.squeeze=operation_1.op({squeeze_:squeeze_}),exports.stack=operation_1.op({stack_:stack_}),exports.tile=operation_1.op({tile_:tile_}),exports.truncatedNormal=operation_1.op({truncatedNormal_:truncatedNormal_}),exports.unstack=operation_1.op({unstack_:unstack_}),exports.setdiff1dAsync=setdiff1dAsync_},{"../environment":58,"../tensor":203,"../tensor_util_env":206,"../util":210,"./axis_util":144,"./concat_split":150,"./operation":167,"./rand":170,"./tensor_ops":187}],143:[function(require,module,exports){"use strict";function getReshaped(inputShape,blockShape,prod,batchToSpace){void 0===batchToSpace&&(batchToSpace=!0);var reshaped=[];if(batchToSpace)reshaped=reshaped.concat(blockShape.slice(0)),reshaped.push(inputShape[0]/prod),reshaped=reshaped.concat(inputShape.slice(1));else{reshaped=reshaped.concat(inputShape[0]);for(var spatialLength=blockShape.length,i=0;i<spatialLength;++i)reshaped=reshaped.concat([inputShape[i+1]/blockShape[i],blockShape[i]]);reshaped=reshaped.concat(inputShape.slice(spatialLength+1))}return reshaped}function getPermuted(reshapedRank,blockShapeRank,batchToSpace){void 0===batchToSpace&&(batchToSpace=!0);var permuted=[];if(batchToSpace){permuted.push(blockShapeRank);for(var i=blockShapeRank+1;i<reshapedRank;++i)i<=2*blockShapeRank?(permuted.push(i),permuted.push(i-(blockShapeRank+1))):permuted.push(i)}else{for(var permutedBeforeBatch=[],permutedAfterBatch=[],i=1;i<reshapedRank;++i)i>=2*blockShapeRank+1||i%2==1?permutedAfterBatch.push(i):permutedBeforeBatch.push(i);permuted.push.apply(permuted,permutedBeforeBatch),permuted.push(0),permuted.push.apply(permuted,permutedAfterBatch)}return permuted}function getReshapedPermuted(inputShape,blockShape,prod,batchToSpace){void 0===batchToSpace&&(batchToSpace=!0);var reshapedPermuted=[];batchToSpace?reshapedPermuted.push(inputShape[0]/prod):reshapedPermuted.push(inputShape[0]*prod);for(var i=1;i<inputShape.length;++i)i<=blockShape.length?batchToSpace?reshapedPermuted.push(blockShape[i-1]*inputShape[i]):reshapedPermuted.push(inputShape[i]/blockShape[i-1]):reshapedPermuted.push(inputShape[i]);return reshapedPermuted}function getSliceBeginCoords(crops,blockShape){for(var sliceBeginCoords=[0],i=0;i<blockShape;++i)sliceBeginCoords.push(crops[i][0]);return sliceBeginCoords}function getSliceSize(uncroppedShape,crops,blockShape){for(var sliceSize=uncroppedShape.slice(0,1),i=0;i<blockShape;++i)sliceSize.push(uncroppedShape[i+1]-crops[i][0]-crops[i][1]);return sliceSize}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getReshaped=getReshaped,exports.getPermuted=getPermuted,exports.getReshapedPermuted=getReshapedPermuted,exports.getSliceBeginCoords=getSliceBeginCoords,exports.getSliceSize=getSliceSize},{}],144:[function(require,module,exports){"use strict";function axesAreInnerMostDims(axes,rank){for(var i=0;i<axes.length;++i)if(axes[axes.length-i-1]!==rank-1-i)return!1;return!0}function combineLocations(outputLoc,reduceLoc,axes){for(var rank=outputLoc.length+reduceLoc.length,loc=[],outIdx=0,reduceIdx=0,dim=0;dim<rank;dim++)-1===axes.indexOf(dim)?loc.push(outputLoc[outIdx++]):loc.push(reduceLoc[reduceIdx++]);return loc}function computeOutAndReduceShapes(aShape,axes){for(var outShape=[],rank=aShape.length,dim=0;dim<rank;dim++)-1===axes.indexOf(dim)&&outShape.push(aShape[dim]);return[outShape,axes.map(function(dim){return aShape[dim]})]}function expandShapeToKeepDim(shape,axes){return combineLocations(shape,axes.map(function(x){return 1}),axes)}function parseAxisParam(axis,shape){var rank=shape.length;return axis=null==axis?shape.map(function(s,i){return i}):[].concat(axis),util.assert(axis.every(function(ax){return ax>=-rank&&ax<rank}),"All values in axis param must be in range [-"+rank+", "+rank+") but got axis "+axis),util.assert(axis.every(function(ax){return util.isInt(ax)}),"All values in axis param must be integers but got axis "+axis),axis.map(function(a){return a<0?rank+a:a})}function assertAxesAreInnerMostDims(msg,axes,rank){util.assert(axesAreInnerMostDims(axes,rank),msg+" supports only inner-most axes for now. Got axes "+axes+" and rank-"+rank+" input.")}function getAxesPermutation(axes,rank){if(axesAreInnerMostDims(axes,rank))return null;for(var result=[],i=0;i<rank;++i)-1===axes.indexOf(i)&&result.push(i);return axes.forEach(function(axis){return result.push(axis)}),result}function getUndoAxesPermutation(axes){return axes.map(function(axis,i){return[i,axis]}).sort(function(a,b){return a[1]-b[1]}).map(function(x){return x[0]})}function getInnerMostAxes(numAxes,rank){for(var res=[],i=rank-numAxes;i<rank;++i)res.push(i);return res}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");exports.axesAreInnerMostDims=axesAreInnerMostDims,exports.combineLocations=combineLocations,exports.computeOutAndReduceShapes=computeOutAndReduceShapes,exports.expandShapeToKeepDim=expandShapeToKeepDim,exports.parseAxisParam=parseAxisParam,exports.assertAxesAreInnerMostDims=assertAxesAreInnerMostDims,exports.getAxesPermutation=getAxesPermutation,exports.getUndoAxesPermutation=getUndoAxesPermutation,exports.getInnerMostAxes=getInnerMostAxes},{"../util":210}],145:[function(require,module,exports){"use strict";function batchNormalization2d_(x,mean,variance,varianceEpsilon,scale,offset){void 0===varianceEpsilon&&(varianceEpsilon=.001);var $scale,$x=tensor_util_env_1.convertToTensor(x,"x","batchNormalization"),$mean=tensor_util_env_1.convertToTensor(mean,"mean","batchNormalization"),$variance=tensor_util_env_1.convertToTensor(variance,"variance","batchNormalization");null!=scale&&($scale=tensor_util_env_1.convertToTensor(scale,"scale","batchNormalization"));var $offset;return null!=offset&&($offset=tensor_util_env_1.convertToTensor(offset,"offset","batchNormalization")),util.assert(2===$x.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+$x.rank+"."),util.assert(2===$mean.rank||1===$mean.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+$mean.rank+"."),util.assert(2===$variance.rank||1===$variance.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+$variance.rank+"."),null!=$scale&&util.assert(2===$scale.rank||1===$scale.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+$scale.rank+"."),null!=$offset&&util.assert(2===$offset.rank||1===$offset.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+$offset.rank+"."),exports.batchNormalization($x,$mean,$variance,varianceEpsilon,$scale,$offset)}function batchNormalization3d_(x,mean,variance,varianceEpsilon,scale,offset){void 0===varianceEpsilon&&(varianceEpsilon=.001);var $scale,$x=tensor_util_env_1.convertToTensor(x,"x","batchNormalization"),$mean=tensor_util_env_1.convertToTensor(mean,"mean","batchNormalization"),$variance=tensor_util_env_1.convertToTensor(variance,"variance","batchNormalization");null!=scale&&($scale=tensor_util_env_1.convertToTensor(scale,"scale","batchNormalization"));var $offset;return null!=offset&&($offset=tensor_util_env_1.convertToTensor(offset,"offset","batchNormalization")),util.assert(3===$x.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+$x.rank+"."),util.assert(3===$mean.rank||1===$mean.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+$mean.rank+"."),util.assert(3===$variance.rank||1===$variance.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+$variance.rank+"."),null!=$scale&&util.assert(3===$scale.rank||1===$scale.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+$scale.rank+"."),null!=$offset&&util.assert(3===$offset.rank||1===$offset.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+$offset.rank+"."),exports.batchNormalization($x,$mean,$variance,varianceEpsilon,$scale,$offset)}function batchNormalization4d_(x,mean,variance,varianceEpsilon,scale,offset){void 0===varianceEpsilon&&(varianceEpsilon=.001);var $scale,$x=tensor_util_env_1.convertToTensor(x,"x","batchNormalization"),$mean=tensor_util_env_1.convertToTensor(mean,"mean","batchNormalization"),$variance=tensor_util_env_1.convertToTensor(variance,"variance","batchNormalization");null!=scale&&($scale=tensor_util_env_1.convertToTensor(scale,"scale","batchNormalization"));var $offset;return null!=offset&&($offset=tensor_util_env_1.convertToTensor(offset,"offset","batchNormalization")),util.assert(4===$x.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+$x.rank+"."),util.assert(4===$mean.rank||1===$mean.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+$mean.rank+"."),util.assert(4===$variance.rank||1===$variance.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+$variance.rank+"."),null!=$scale&&util.assert(4===$scale.rank||1===$scale.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+$scale.rank+"."),null!=$offset&&util.assert(4===$offset.rank||1===$offset.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+$offset.rank+"."),exports.batchNormalization($x,$mean,$variance,varianceEpsilon,$scale,$offset)}function batchNormalization_(x,mean,variance,varianceEpsilon,scale,offset){void 0===varianceEpsilon&&(varianceEpsilon=.001);var $scale,$x=tensor_util_env_1.convertToTensor(x,"x","batchNormalization"),$mean=tensor_util_env_1.convertToTensor(mean,"mean","batchNormalization"),$variance=tensor_util_env_1.convertToTensor(variance,"variance","batchNormalization");null!=scale&&($scale=tensor_util_env_1.convertToTensor(scale,"scale","batchNormalization"));var $offset;null!=offset&&($offset=tensor_util_env_1.convertToTensor(offset,"offset","batchNormalization")),util.assert($mean.rank===$variance.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),util.assert(null==$offset||$mean.rank===$offset.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),util.assert(null==$scale||$mean.rank===$scale.rank,"Batch normalization gradient requires mean and scale to have equal ranks.");var x4D;x4D=0===$x.rank||1===$x.rank?$x.as4D(1,1,1,$x.size):2===$x.rank?$x.as4D(1,1,$x.shape[0],$x.shape[1]):3===$x.rank?$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2]):$x;var der=function(dy){var scaleValue=null==$scale?tensor_ops_1.scalar(1):$scale,reductionAxes=broadcast_util_1.getReductionAxes($mean.shape,x4D.shape),tileShape=[];if(1===$mean.rank){for(var i=0;i<x4D.shape.length-1;++i)tileShape.push(x4D.shape[i]);tileShape.push(1)}var xMinusMean=$x.sub($mean),dyTimesScaleValue=dy.mul(scaleValue),oneOverSqrtVariance=unary_ops_1.rsqrt($variance.add(tensor_ops_1.scalar(varianceEpsilon))),minusHalfRCube=oneOverSqrtVariance.mul(oneOverSqrtVariance).mul(oneOverSqrtVariance).mul(tensor_ops_1.scalar(-.5));return{$x:function(){return 1===$mean.rank?dy.mul(array_ops_1.tile(oneOverSqrtVariance.as4D(1,1,1,$mean.shape[0]),tileShape)).mul(scaleValue).reshape($x.shape):dy.mul(oneOverSqrtVariance).mul(scaleValue).reshape($x.shape)},$mean:function(){var meanDer=oneOverSqrtVariance.mul(tensor_ops_1.scalar(-1)).mul(dyTimesScaleValue);return 1===$mean.rank&&(meanDer=meanDer.sum(reductionAxes)),meanDer.reshape($mean.shape)},$variance:function(){var varianceDer=minusHalfRCube.mul(xMinusMean).mul(dyTimesScaleValue);return 1===$mean.rank&&(varianceDer=varianceDer.sum(reductionAxes)),varianceDer.reshape($mean.shape)},$scale:function(){var xMinusMean2TimesRsqrt=xMinusMean.mul(oneOverSqrtVariance),scaleDer=dy.mul(xMinusMean2TimesRsqrt);return 1===$mean.rank&&(scaleDer=scaleDer.sum(reductionAxes)),scaleDer.reshape($mean.shape)},$offset:function(){var offsetDer=dy;return 1===$mean.rank&&(offsetDer=offsetDer.sum(reductionAxes)),offsetDer.reshape($mean.shape)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.batchNormalization(x4D,batchnormReshape4D($mean),batchnormReshape4D($variance),varianceEpsilon,batchnormReshape4D($scale),batchnormReshape4D($offset))},{$x:$x,$mean:$mean,$variance:$variance,$scale:$scale,$offset:$offset},der).reshape($x.shape)}function batchnormReshape4D(x){return null==x?null:0===x.rank?x.as1D():1===x.rank?x:2===x.rank?x.as4D(1,1,x.shape[0],x.shape[1]):3===x.rank?x.as4D(1,x.shape[0],x.shape[1],x.shape[2]):x}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),array_ops_1=require("./array_ops"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops"),unary_ops_1=require("./unary_ops");exports.batchNormalization2d=operation_1.op({batchNormalization2d_:batchNormalization2d_}),exports.batchNormalization3d=operation_1.op({batchNormalization3d_:batchNormalization3d_}),exports.batchNormalization4d=operation_1.op({batchNormalization4d_:batchNormalization4d_}),exports.batchNormalization=operation_1.op({batchNormalization_:batchNormalization_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./array_ops":142,"./broadcast_util":147,"./operation":167,"./tensor_ops":187,"./unary_ops":190}],146:[function(require,module,exports){"use strict";function add_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","add"),$b=tensor_util_env_1.convertToTensor(b,"b","add");tensor_util_1.assertTypesMatch($a,$b);var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){return{$a:function(){var res=dy,reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($a.shape)},$b:function(){var res=dy,reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($b.shape)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.add($a,$b)},{$a:$a,$b:$b},der)}function addN_(tensors){util.assert(Array.isArray(tensors),function(){return"The argument passed to tf.addN() must be a list of tensors"}),util.assert(tensors.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+tensors.length});var $tensors=tensors.map(function(t,i){return tensor_util_env_1.convertToTensor(t,"tensors"+i,"addN")}),firstTensor=$tensors[0];$tensors.forEach(function(t){if(t.dtype!==firstTensor.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),$tensors.forEach(function(t){if(!util.arraysEqual(t.shape,firstTensor.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var der=function(dy){var ders={};return $tensors.forEach(function(t,i){ders[i]=function(){return dy.clone()}}),ders},inputs=$tensors;return environment_1.ENV.engine.runKernel(function(backend){return backend.addN($tensors)},inputs,der)}function addStrict_(a,b){return util.assertShapesMatch(a.shape,b.shape,"Error in addStrict: "),a.add(b)}function sub_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","sub"),$b=tensor_util_env_1.convertToTensor(b,"b","sub");tensor_util_1.assertTypesMatch($a,$b);var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){return{$a:function(){var res=dy,reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($a.shape)},$b:function(){var res=dy,reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.neg().reshape($b.shape)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.subtract($a,$b)},{$a:$a,$b:$b},der)}function subStrict_(a,b){return util.assertShapesMatch(a.shape,b.shape,"Error in subStrict: "),a.sub(b)}function pow_(base,exp){var $base=tensor_util_env_1.convertToTensor(base,"base","pow"),$exp=tensor_util_env_1.convertToTensor(exp,"exp","pow"),outShape=broadcast_util.assertAndGetBroadcastShape($base.shape,$exp.shape);base=$base.cast(types_1.upcastType($base.dtype,$exp.dtype)),exp=$exp.cast(types_1.upcastType($base.dtype,$exp.dtype));var grad=function(dy,saved){var y=saved[0];return{$base:function(){var expFloat=$exp.toFloat(),res=dy.mul(expFloat.mul($base.pow(expFloat.sub(tensor_ops_1.scalar(1))))),reduceAxes=broadcast_util.getReductionAxes($base.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($base.shape)},$exp:function(){var res=dy.mul(y.mul($base.log()).toFloat()),reduceAxes=broadcast_util.getReductionAxes($exp.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($exp.shape)}}};return environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.pow($base,$exp))},{$base:$base,$exp:$exp},grad)}function powStrict_(base,exp){return util.assertShapesMatch(base.shape,exp.shape,"Error in powStrict: "),base.pow(exp)}function mul_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","mul"),$b=tensor_util_env_1.convertToTensor(b,"b","mul");tensor_util_1.assertTypesMatch($a,$b);var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){return{$a:function(){var res=dy.mul($b.toFloat()),reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($a.shape):res},$b:function(){var res=dy.mul($a.toFloat()),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($b.shape):res}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.multiply($a,$b)},{$a:$a,$b:$b},der)}function mulStrict_(a,b){return util.assertShapesMatch(a.shape,b.shape,"Error in multiplyStrict: "),a.mul(b)}function div_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","div"),$b=tensor_util_env_1.convertToTensor(b,"b","div");tensor_util_1.assertTypesMatch($a,$b);var forwardFunc;if("int32"===$a.dtype&&"int32"===$b.dtype)return exports.floorDiv($a,$b);forwardFunc=function(backend){return backend.realDivide($a,$b)};var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){return{$a:function(){var res=dy.div($b.toFloat()),reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($a.shape):res},$b:function(){var res=dy.mul($a.toFloat()),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);reduceAxes.length>0&&(res=res.sum(reduceAxes).reshape($b.shape));var tmp=$b.square();return res.div(tmp.toFloat()).neg()}}};return environment_1.ENV.engine.runKernel(forwardFunc,{$a:$a,$b:$b},der)}function floorDiv_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","floorDiv"),$b=tensor_util_env_1.convertToTensor(b,"b","floorDiv");tensor_util_1.assertTypesMatch($a,$b);var forwardFunc=function(backend){return backend.floorDiv($a,$b)},outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){return{$a:function(){var res=dy.div($b.toFloat()),reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($a.shape):res},$b:function(){var res=dy.mul($a.toFloat()),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);reduceAxes.length>0&&(res=res.sum(reduceAxes).reshape($b.shape));var tmp=$b.square();return res.div(tmp.toFloat()).neg()}}};return environment_1.ENV.engine.runKernel(forwardFunc,{$a:$a,$b:$b},der)}function divStrict_(a,b){return util.assertShapesMatch(a.shape,b.shape,"Error in divideStrict: "),a.div(b)}function mod_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","mod"),$b=tensor_util_env_1.convertToTensor(b,"b","mod");tensor_util_1.assertTypesMatch($a,$b);var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){return{$a:function(){var reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0?dy.sum(reduceAxes).reshape($a.shape):dy},$b:function(){var res=dy.mul($a.div($b).floor().neg()),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0?res.sum(reduceAxes).reshape($b.shape):res}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.mod($a,$b)},{$a:$a,$b:$b},der)}function modStrict_(a,b){return util.assertShapesMatch(a.shape,b.shape,"Error in modStrict: "),a.mod(b)}function minimum_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","minimum"),$b=tensor_util_env_1.convertToTensor(b,"b","minimum");tensor_util_1.assertTypesMatch($a,$b),"bool"===$a.dtype&&($a=$a.toInt()),"bool"===$b.dtype&&($b=$b.toInt()),broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape);var der=function(dy){return{$a:function(){return dy.mul($a.lessEqual($b).toFloat())},$b:function(){return dy.mul($a.greater($b).toFloat())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.minimum($a,$b)},{$a:$a,$b:$b},der)}function minimumStrict_(a,b){return util.assertShapesMatch(a.shape,b.shape,"Error in minimumStrict: "),a.minimum(b)}function maximum_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","maximum"),$b=tensor_util_env_1.convertToTensor(b,"b","maximum");tensor_util_1.assertTypesMatch($a,$b),"bool"===$a.dtype&&($a=$a.toInt()),"bool"===$b.dtype&&($b=$b.toInt()),broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape);var der=function(dy){return{$a:function(){return dy.mul($a.greaterEqual($b).toFloat())},$b:function(){return dy.mul($a.less($b).toFloat())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.maximum($a,$b)},{$a:$a,$b:$b},der)}function maximumStrict_(a,b){return util.assertShapesMatch(a.shape,b.shape,"Error in maximumStrict: "),a.maximum(b)}function squaredDifference_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","squaredDifference"),$b=tensor_util_env_1.convertToTensor(b,"b","squaredDifference");tensor_util_1.assertTypesMatch($a,$b),broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape);var der=function(dy){var two=tensor_ops_1.scalar(2);return{$a:function(){return dy.mul($a.sub($b).mul(two))},$b:function(){return dy.mul($b.sub($a).mul(two))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.squaredDifference($a,$b)},{$a:$a,$b:$b},der)}function squaredDifferenceStrict_(a,b){return util.assertShapesMatch(a.shape,b.shape,"Error in squaredDifferenceStrict: "),a.squaredDifference(b)}function atan2_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","atan2"),$b=tensor_util_env_1.convertToTensor(b,"b","atan2");tensor_util_1.assertTypesMatch($a,$b);var outShape=broadcast_util.assertAndGetBroadcastShape($a.shape,$b.shape),der=function(dy){return{$a:function(){var d=exports.add($a.square(),$b.square()),res=dy.mul($b.div(d)),reduceAxes=broadcast_util.getReductionAxes($a.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($a.shape)},$b:function(){var d=exports.add($a.square(),$b.square()),res=unary_ops_1.neg(dy.mul($a.div(d))),reduceAxes=broadcast_util.getReductionAxes($b.shape,outShape);return reduceAxes.length>0&&(res=res.sum(reduceAxes)),res.reshape($b.shape)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.atan2($a,$b)},{$a:$a,$b:$b},der)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),types_1=require("../types"),util=require("../util"),broadcast_util=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops"),unary_ops_1=require("./unary_ops");exports.add=operation_1.op({add_:add_}),exports.addN=operation_1.op({addN_:addN_}),exports.addStrict=operation_1.op({addStrict_:addStrict_}),exports.atan2=operation_1.op({atan2_:atan2_}),exports.div=operation_1.op({div_:div_}),exports.divStrict=operation_1.op({divStrict_:divStrict_}),exports.floorDiv=operation_1.op({floorDiv_:floorDiv_}),exports.maximum=operation_1.op({maximum_:maximum_}),exports.maximumStrict=operation_1.op({maximumStrict_:maximumStrict_}),exports.minimum=operation_1.op({minimum_:minimum_}),exports.minimumStrict=operation_1.op({minimumStrict_:minimumStrict_}),exports.mod=operation_1.op({mod_:mod_}),exports.modStrict=operation_1.op({modStrict_:modStrict_}),exports.mul=operation_1.op({mul_:mul_}),exports.mulStrict=operation_1.op({mulStrict_:mulStrict_}),exports.pow=operation_1.op({pow_:pow_}),exports.powStrict=operation_1.op({powStrict_:powStrict_}),exports.squaredDifference=operation_1.op({squaredDifference_:squaredDifference_}),exports.squaredDifferenceStrict=operation_1.op({squaredDifferenceStrict_:squaredDifferenceStrict_}),exports.sub=operation_1.op({sub_:sub_}),exports.subStrict=operation_1.op({subStrict_:subStrict_})},{"../environment":58,"../tensor_util":205,"../tensor_util_env":206,"../types":209,"../util":210,"./broadcast_util":147,"./operation":167,"./tensor_ops":187,"./unary_ops":190}],147:[function(require,module,exports){"use strict";function getBroadcastDims(inShape,outShape){for(var inRank=inShape.length,dims=[],i=0;i<inRank;i++){var dim=inRank-1-i,a=inShape[dim]||1;(outShape[outShape.length-1-i]||1)>1&&1===a&&dims.unshift(dim)}return dims}function getReductionAxes(inShape,outShape){for(var result=[],i=0;i<outShape.length;i++){var inDim=inShape[inShape.length-i-1],outAxis=outShape.length-i-1,outDim=outShape[outAxis];(null==inDim||1===inDim&&outDim>1)&&result.unshift(outAxis)}return result}function broadcastDimsAreOuter(dims){for(var i=0;i<dims.length;i++)if(dims[i]!==i)return!1
;return!0}function assertAndGetBroadcastShape(shapeA,shapeB){for(var result=[],l=Math.max(shapeA.length,shapeB.length),i=0;i<l;i++){var a=shapeA[shapeA.length-i-1];null==a&&(a=1);var b=shapeB[shapeB.length-i-1];if(null==b&&(b=1),1===a)result.unshift(b);else if(1===b)result.unshift(a);else{if(a!==b){var errMsg="Operands could not be broadcast together with shapes "+shapeA+" and "+shapeB+".";throw Error(errMsg)}result.unshift(a)}}return result}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBroadcastDims=getBroadcastDims,exports.getReductionAxes=getReductionAxes,exports.broadcastDimsAreOuter=broadcastDimsAreOuter,exports.assertAndGetBroadcastShape=assertAndGetBroadcastShape},{}],148:[function(require,module,exports){"use strict";function notEqual_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","notEqual"),$b=tensor_util_env_1.convertToTensor(b,"b","notEqual");return tensor_util_1.assertTypesMatch($a,$b),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),environment_1.ENV.engine.runKernel(function(backend){return backend.notEqual($a,$b)},{$a:$a,$b:$b})}function notEqualStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","notEqualStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","notEqualStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in notEqualStrict: "),$a.notEqual($b)}function less_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","less"),$b=tensor_util_env_1.convertToTensor(b,"b","less");return tensor_util_1.assertTypesMatch($a,$b),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),environment_1.ENV.engine.runKernel(function(backend){return backend.less($a,$b)},{$a:$a,$b:$b})}function lessStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","lessStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","lessStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in lessStrict: "),$a.less($b)}function equal_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","equal"),$b=tensor_util_env_1.convertToTensor(b,"b","equal");return tensor_util_1.assertTypesMatch($a,$b),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),environment_1.ENV.engine.runKernel(function(backend){return backend.equal($a,$b)},{$a:$a,$b:$b})}function equalStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","equalStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","equalStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in equalStrict: "),$a.equal($b)}function lessEqual_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","lessEqual"),$b=tensor_util_env_1.convertToTensor(b,"b","lessEqual");return tensor_util_1.assertTypesMatch($a,$b),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),environment_1.ENV.engine.runKernel(function(backend){return backend.lessEqual($a,$b)},{$a:$a,$b:$b})}function lessEqualStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","lessEqualStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","lessEqualStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in lessEqualStrict: "),$a.lessEqual($b)}function greater_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","greater"),$b=tensor_util_env_1.convertToTensor(b,"b","greater");return tensor_util_1.assertTypesMatch($a,$b),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),environment_1.ENV.engine.runKernel(function(backend){return backend.greater($a,$b)},{$a:$a,$b:$b})}function greaterStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","greaterStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","greaterStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in greaterStrict: "),$a.greater($b)}function greaterEqual_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","greaterEqual"),$b=tensor_util_env_1.convertToTensor(b,"b","greaterEqual");tensor_util_1.assertTypesMatch($a,$b),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape);var grad=function(dy){return{$a:function(){return tensor_ops_1.zerosLike($a)},$b:function(){return tensor_ops_1.zerosLike($b)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.greaterEqual($a,$b)},{$a:$a,$b:$b},grad)}function greaterEqualStrict_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","greaterEqualStrict"),$b=tensor_util_env_1.convertToTensor(b,"b","greaterEqualStrict");return util_1.assertShapesMatch($a.shape,$b.shape,"Error in greaterEqualStrict: "),$a.greaterEqual($b)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");exports.equal=operation_1.op({equal_:equal_}),exports.equalStrict=operation_1.op({equalStrict_:equalStrict_}),exports.greater=operation_1.op({greater_:greater_}),exports.greaterEqual=operation_1.op({greaterEqual_:greaterEqual_}),exports.greaterEqualStrict=operation_1.op({greaterEqualStrict_:greaterEqualStrict_}),exports.greaterStrict=operation_1.op({greaterStrict_:greaterStrict_}),exports.less=operation_1.op({less_:less_}),exports.lessEqual=operation_1.op({lessEqual_:lessEqual_}),exports.lessEqualStrict=operation_1.op({lessEqualStrict_:lessEqualStrict_}),exports.lessStrict=operation_1.op({lessStrict_:lessStrict_}),exports.notEqual=operation_1.op({notEqual_:notEqual_}),exports.notEqualStrict=operation_1.op({notEqualStrict_:notEqualStrict_})},{"../environment":58,"../tensor_util":205,"../tensor_util_env":206,"../util":210,"./broadcast_util":147,"./operation":167,"./tensor_ops":187}],149:[function(require,module,exports){"use strict";function complex_(real,imag){var $real=tensor_util_env_1.convertToTensor(real,"real","complex"),$imag=tensor_util_env_1.convertToTensor(imag,"imag","complex");return util.assertShapesMatch($real.shape,$imag.shape,"real and imag shapes, "+$real.shape+" and "+$imag.shape+", must match in call to tf.complex()."),environment_1.ENV.engine.runKernel(function(backend){return backend.complex($real,$imag)},{$real:$real,$imag:$imag})}function real_(input){var $input=tensor_util_env_1.convertToTensor(input,"input","real");return environment_1.ENV.engine.runKernel(function(backend){return backend.real($input)},{$input:$input})}function imag_(input){var $input=tensor_util_env_1.convertToTensor(input,"input","imag");return environment_1.ENV.engine.runKernel(function(backend){return backend.imag($input)},{$input:$input})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");exports.complex=operation_1.op({complex_:complex_}),exports.real=operation_1.op({real_:real_}),exports.imag=operation_1.op({imag_:imag_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./operation":167}],150:[function(require,module,exports){"use strict";function concat1d_(tensors){return exports.concat(tensors,0)}function concat2d_(tensors,axis){return exports.concat(tensors,axis)}function concat3d_(tensors,axis){return exports.concat(tensors,axis)}function concat4d_(tensors,axis){return exports.concat(tensors,axis)}function concat_(tensors,axis){void 0===axis&&(axis=0),util_1.assert(tensors.length>=1,"Pass at least one tensor to concat");var $tensors=tensor_util_env_1.convertToTensorArray(tensors,"tensors","concat");axis=axis_util_1.parseAxisParam(axis,$tensors[0].shape)[0];var outShape=concat_util_1.computeOutShape($tensors.map(function(t){return t.shape}),axis);if(0===util_1.sizeFromShape(outShape))return tensor_ops_1.tensor([],outShape);if($tensors=$tensors.filter(function(t){return t.size>0}),1===$tensors.length)return $tensors[0];var shapes=$tensors.map(function(t){return t.shape});concat_util_1.assertParamsConsistent(shapes,axis);var der=function(dy){var sizeSplits=shapes.map(function(s){return s[axis]});return exports.split(dy,sizeSplits,axis).map(function(t){return function(){return t}})},inputs=$tensors;return environment_1.ENV.engine.runKernel(function(backend){return backend.concat($tensors,axis)},inputs,der)}function split_(x,numOrSizeSplits,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","split");axis=axis_util_1.parseAxisParam(axis,$x.shape)[0];var splitSizes;"number"==typeof numOrSizeSplits?(util_1.assert($x.shape[axis]%numOrSizeSplits==0,"Number of splits must evenly divide the axis."),splitSizes=Array(numOrSizeSplits).fill($x.shape[axis]/numOrSizeSplits)):(util_1.assert($x.shape[axis]===numOrSizeSplits.reduce(function(a,b){return a+b}),"The sum of sizes must match the size of the axis dimension."),splitSizes=numOrSizeSplits);var der=function(dy){return{$x:function(){return exports.concat(dy,axis)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.split($x,splitSizes,axis)},{$x:$x},der)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),axis_util_1=require("./axis_util"),concat_util_1=require("./concat_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");exports.concat=operation_1.op({concat_:concat_}),exports.concat1d=operation_1.op({concat1d_:concat1d_}),exports.concat2d=operation_1.op({concat2d_:concat2d_}),exports.concat3d=operation_1.op({concat3d_:concat3d_}),exports.concat4d=operation_1.op({concat4d_:concat4d_}),exports.split=operation_1.op({split_:split_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./axis_util":144,"./concat_util":151,"./operation":167,"./tensor_ops":187}],151:[function(require,module,exports){"use strict";function assertParamsConsistent(shapes,axis){var rank=shapes[0].length;shapes.forEach(function(shape,i){util.assert(shape.length===rank,"Error in concat"+rank+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+rank+")")}),util.assert(axis>=0&&axis<rank,"Error in concat"+rank+"D: axis must be between 0 and "+(rank-1)+".");var firstShape=shapes[0];shapes.forEach(function(shape,i){for(var r=0;r<rank;r++)util.assert(r===axis||shape[r]===firstShape[r],"Error in concat"+rank+"D: Shape of tensors["+i+"] ("+shape+") does not match the shape of the rest ("+firstShape+") along the non-concatenated axis "+i+".")})}function computeOutShape(shapes,axis){for(var outputShape=shapes[0].slice(),i=1;i<shapes.length;i++)outputShape[axis]+=shapes[i][axis];return outputShape}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");exports.assertParamsConsistent=assertParamsConsistent,exports.computeOutShape=computeOutShape},{"../util":210}],152:[function(require,module,exports){"use strict";function confusionMatrix_(labels,predictions,numClasses){var $labels=tensor_util_env_1.convertToTensor(labels,"label","confusionMatrix","int32"),$predictions=tensor_util_env_1.convertToTensor(predictions,"label","confusionMatrix","int32");util.assert(null==numClasses||numClasses>0&&Number.isInteger(numClasses),"If provided, numClasses must be a positive integer, but got "+numClasses),util.assert(1===$labels.rank,"Expected the rank of labels to be 1, but got "+$labels.rank),util.assert(1===$predictions.rank,"Expected the rank of predictions to be 1, but got "+$predictions.rank),util.assert($labels.shape[0]===$predictions.shape[0],"Mismatch in the number of examples: "+$labels.shape[0]+" vs. "+$predictions.shape[0]+". Labels and predictions should have the same number of elements."),util.assert(numClasses>0&&Number.isInteger(numClasses),"numClasses is required to be a positive integer, but got "+numClasses);var oneHotLabels=array_ops_1.oneHot($labels.asType("int32"),numClasses),oneHotPredictions=array_ops_1.oneHot($predictions.asType("int32"),numClasses);return oneHotLabels.transpose().matMul(oneHotPredictions).asType("int32")}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),array_ops_1=require("./array_ops"),operation_1=require("./operation");exports.confusionMatrix_=confusionMatrix_,exports.confusionMatrix=operation_1.op({confusionMatrix_:confusionMatrix_})},{"../tensor_util_env":206,"../util":210,"./array_ops":142,"./operation":167}],153:[function(require,module,exports){"use strict";function conv1d_(x,filter,stride,pad,dataFormat,dilation,dimRoundingMode){void 0===dataFormat&&(dataFormat="NWC"),void 0===dilation&&(dilation=1);var $x=tensor_util_env_1.convertToTensor(x,"x","conv1d"),$filter=tensor_util_env_1.convertToTensor(filter,"filter","conv1d"),x3D=$x,reshapedTo3D=!1;2===$x.rank&&(reshapedTo3D=!0,x3D=$x.as3D(1,$x.shape[0],$x.shape[1])),util.assert(3===x3D.rank,"Error in conv1d: input must be rank 3, but got rank "+x3D.rank+"."),util.assert(3===$filter.rank,"Error in conv1d: filter must be rank 3, but got rank "+$filter.rank+"."),null!=dimRoundingMode&&util.assert(util.isInt(pad),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."),util.assert(x3D.shape[2]===$filter.shape[1],"Error in conv1d: depth of input ("+x3D.shape[2]+") must match input depth for filter "+$filter.shape[1]+"."),util.assert(conv_util.eitherStridesOrDilationsAreOne(stride,dilation),"Error in conv1D: Either stride or dilation must be 1. Got stride "+stride+" and dilation '"+dilation+"'"),util.assert("NWC"===dataFormat,"Error in conv1d: got dataFormat of "+dataFormat+" but only NWC is currently supported.");var filter4D=$filter.as4D(1,$filter.shape[0],$filter.shape[1],$filter.shape[2]),input4D=x3D.as4D(x3D.shape[0],1,x3D.shape[1],x3D.shape[2]),strides=[1,stride],dilations=[1,dilation],res=exports.conv2d(input4D,filter4D,strides,pad,"NHWC",dilations,dimRoundingMode);return reshapedTo3D?res.as2D(res.shape[2],res.shape[3]):res.as3D(res.shape[0],res.shape[2],res.shape[3])}function conv2d_(x,filter,strides,pad,dataFormat,dilations,dimRoundingMode){void 0===dataFormat&&(dataFormat="NHWC"),void 0===dilations&&(dilations=[1,1]);var $x=tensor_util_env_1.convertToTensor(x,"x","conv2d"),$filter=tensor_util_env_1.convertToTensor(filter,"filter","conv2d"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(4===x4D.rank,"Error in conv2d: input must be rank 4, but got rank "+x4D.rank+"."),util.assert(4===$filter.rank,"Error in conv2d: filter must be rank 4, but got rank "+$filter.rank+"."),null!=dimRoundingMode&&util.assert(util.isInt(pad),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+"."),util.assert(x4D.shape[3]===$filter.shape[2],"Error in conv2d: depth of input ("+x4D.shape[3]+") must match input depth for filter "+$filter.shape[2]+"."),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),"Error in conv2D: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"),util.assert("NHWC"===dataFormat,"Error in conv2d: got dataFormat of "+dataFormat+" but only NHWC is currently supported.");var res,convInfo=conv_util.computeConv2DInfo(x4D.shape,$filter.shape,strides,dilations,pad,dimRoundingMode);if(1!==convInfo.filterHeight||1!==convInfo.filterWidth||1!==convInfo.dilationHeight||1!==convInfo.dilationWidth||1!==convInfo.strideHeight||1!==convInfo.strideWidth||"SAME"!==convInfo.padInfo.type&&"VALID"!==convInfo.padInfo.type){var grad=function(dy){return util.assert(conv_util.tupleValuesAreOne(dilations),"Error in gradient of conv2D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+dilations+"'"),{x:function(){return conv2dDerInput_(x4D.shape,dy,$filter,strides,pad)},$filter:function(){return conv2dDerFilter_(x4D,dy,$filter.shape,strides,pad)}}};res=environment_1.ENV.engine.runKernel(function(backend){return backend.conv2d(x4D,$filter,convInfo)},{x:x4D,$filter:$filter},grad)}else{var x2d=x4D.reshape([-1,convInfo.inChannels]),w2d=$filter.reshape([convInfo.inChannels,convInfo.outChannels]);res=matmul_1.matMul(x2d,w2d).reshape(convInfo.outShape)}return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function conv2dDerInput_(xShape,dy,filter,strides,pad,dimRoundingMode){util.assert(xShape.length===dy.rank,"Length of inShape ("+xShape.length+") and rank of dy ("+dy.rank+") must match");var xShape4D=xShape,dy4D=dy,reshapedTo4D=!1;3===dy.rank&&(reshapedTo4D=!0,dy4D=dy.as4D(1,dy.shape[0],dy.shape[1],dy.shape[2]),xShape4D=[1,xShape[0],xShape[1],xShape[2]]);var inDepth=xShape4D[3],outDepth=dy4D.shape[3];util.assert(4===xShape4D.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+xShape4D.length+"."),util.assert(4===dy4D.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+dy4D.rank),util.assert(4===filter.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+filter.rank),util.assert(inDepth===filter.shape[2],"Error in conv2dDerInput: depth of input ("+inDepth+") must match input depth for filter "+filter.shape[2]+"."),util.assert(outDepth===filter.shape[3],"Error in conv2dDerInput: depth of output ("+outDepth+") must match output depth for filter "+filter.shape[3]+"."),null!=dimRoundingMode&&util.assert(util.isInt(pad),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+".");var grad=function(ddx){return{dy4D:function(){return exports.conv2d(ddx,filter,strides,pad,"NHWC",1,dimRoundingMode)},filter:function(){return exports.conv2dDerFilter(ddx,dy4D,filter.shape,strides,pad,dimRoundingMode)}}},convInfo=conv_util.computeConv2DInfo(xShape4D,filter.shape,strides,1,pad,dimRoundingMode),res=environment_1.ENV.engine.runKernel(function(backend){return backend.conv2dDerInput(dy4D,filter,convInfo)},{dy4D:dy4D,filter:filter},grad);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function conv2dDerFilter_(x,dy,filterShape,strides,pad,dimRoundingMode){var x4D=x;3===x.rank&&(x4D=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]));var dy4D=dy;3===dy4D.rank&&(dy4D=dy.as4D(1,dy.shape[0],dy.shape[1],dy.shape[2])),util.assert(4===x4D.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+x4D.shape+"."),util.assert(4===dy4D.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+dy4D.shape+"."),util.assert(4===filterShape.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+filterShape+"."),util.assert(x4D.shape[3]===filterShape[2],"Error in conv2dDerFilter: depth of input "+x4D.shape[3]+") must match input depth in filter ("+filterShape[2]+"."),util.assert(dy4D.shape[3]===filterShape[3],"Error in conv2dDerFilter: depth of dy ("+dy4D.shape[3]+") must match output depth for filter ("+filterShape[3]+")."),null!=dimRoundingMode&&util.assert(util.isInt(pad),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+".");var convInfo=conv_util.computeConv2DInfo(x4D.shape,filterShape,strides,1,pad,dimRoundingMode);return environment_1.ENV.engine.runKernel(function(backend){return backend.conv2dDerFilter(x4D,dy4D,convInfo)},{x4D:x4D,dy4D:dy4D})}function conv2dTranspose_(x,filter,outputShape,strides,pad,dimRoundingMode){return conv2dDerInput_(outputShape,tensor_util_env_1.convertToTensor(x,"x","conv2dTranspose"),tensor_util_env_1.convertToTensor(filter,"filter","conv2dTranspose"),strides,pad,dimRoundingMode)}function depthwiseConv2d_(x,filter,strides,pad,dataFormat,dilations,dimRoundingMode){void 0===dataFormat&&(dataFormat="NHWC"),void 0===dilations&&(dilations=[1,1]);var $x=tensor_util_env_1.convertToTensor(x,"x","depthwiseConv2d"),$filter=tensor_util_env_1.convertToTensor(filter,"filter","depthwiseConv2d"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(4===x4D.rank,"Error in depthwiseConv2d: input must be rank 4, but got rank "+x4D.rank+"."),util.assert(4===$filter.rank,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+$filter.rank+"."),util.assert(x4D.shape[3]===$filter.shape[2],"Error in depthwiseConv2d: number of input channels ("+x4D.shape[3]+") must match the inChannels dimension in filter "+$filter.shape[2]+"."),null==dilations&&(dilations=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"),null!=dimRoundingMode&&util.assert(util.isInt(pad),"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+".");var convInfo=conv_util.computeConv2DInfo(x4D.shape,$filter.shape,strides,dilations,pad,dimRoundingMode,!0),grad=function(dy){return util.assert(conv_util.tupleValuesAreOne(dilations),"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+dilations+"'"),{x:function(){return depthwiseConv2dDerInput(x4D.shape,dy,$filter,convInfo)},$filter:function(){return depthwiseConv2dDerFilter(x4D,dy,$filter.shape,convInfo)}}},res=environment_1.ENV.engine.runKernel(function(backend){return backend.depthwiseConv2D(x4D,$filter,convInfo)},{x:x4D,$filter:$filter},grad);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function separableConv2d_(x,depthwiseFilter,pointwiseFilter,strides,pad,dilation,dataFormat){void 0===dilation&&(dilation=[1,1]),void 0===dataFormat&&(dataFormat="NHWC");var $x=tensor_util_env_1.convertToTensor(x,"x","separableConv2d"),$depthwiseFilter=tensor_util_env_1.convertToTensor(depthwiseFilter,"depthwiseFilter","separableConv2d"),$pointwiseFilter=tensor_util_env_1.convertToTensor(pointwiseFilter,"pointwiseFilter","separableConv2d"),x4D=$x,reshapedTo4D=!1;if(3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),"NCHW"===dataFormat)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");util.assert(4===x4D.rank,"Error in separableConv2d: input must be rank 4, but got rank "+x4D.rank+"."),util.assert(4===$depthwiseFilter.rank,"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+$depthwiseFilter.rank+"."),util.assert(4===$pointwiseFilter.rank,"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+$depthwiseFilter.rank+"."),util.assert(1===$pointwiseFilter.shape[0],"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+$pointwiseFilter.shape[0]+"."),util.assert(1===$pointwiseFilter.shape[1],"Error in separableConv2d: the second dimension of pointwise filter  must be 1, but got "+$pointwiseFilter.shape[1]+".");var inChannels=$depthwiseFilter.shape[2],channelMultiplier=$depthwiseFilter.shape[3];util.assert($pointwiseFilter.shape[2]===inChannels*channelMultiplier,"Error in separableConv2d: the third dimension of pointwise filter must be "+inChannels*channelMultiplier+", but got "+$pointwiseFilter.shape[2]+".");var depthwise=exports.depthwiseConv2d(x4D,$depthwiseFilter,strides,pad,dataFormat,dilation),res=exports.conv2d(depthwise,$pointwiseFilter,1,"valid",dataFormat);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function depthwiseConv2dDerInput(xShape,dy,filter,convInfo){var dy4D=dy,reshapedTo4D=!1;3===dy.rank&&(reshapedTo4D=!0,dy4D=dy.as4D(1,dy.shape[0],dy.shape[1],dy.shape[2]));var res=environment_1.ENV.engine.runKernel(function(backend){return backend.depthwiseConv2DDerInput(dy4D,filter,convInfo)},{dy4D:dy4D});return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function depthwiseConv2dDerFilter(x,dy,filterShape,convInfo){var x4D=x;3===x.rank&&(x4D=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]));var dy4D=dy;return 3===dy4D.rank&&(dy4D=dy.as4D(1,dy.shape[0],dy.shape[1],dy.shape[2])),environment_1.ENV.engine.runKernel(function(backend){return backend.depthwiseConv2DDerFilter(x4D,dy4D,convInfo)},{x4D:x4D,dy4D:dy4D})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),conv_util=require("./conv_util"),matmul_1=require("./matmul"),operation_1=require("./operation");exports.conv1d=operation_1.op({conv1d_:conv1d_}),exports.conv2d=operation_1.op({conv2d_:conv2d_}),exports.conv2dDerFilter=operation_1.op({conv2dDerFilter_:conv2dDerFilter_}),exports.depthwiseConv2d=operation_1.op({depthwiseConv2d_:depthwiseConv2d_}),exports.separableConv2d=operation_1.op({separableConv2d_:separableConv2d_}),exports.conv2dTranspose=operation_1.op({conv2dTranspose_:conv2dTranspose_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./conv_util":154,"./matmul":164,"./operation":167}],154:[function(require,module,exports){"use strict";function computePool2DInfo(inShape,filterSize,strides,dilations,pad,roundingMode,dataFormat){void 0===dataFormat&&(dataFormat="channelsLast");var filterShape,_a=parseTupleParam(filterSize),filterHeight=_a[0],filterWidth=_a[1];if("channelsLast"===dataFormat)filterShape=[filterHeight,filterWidth,inShape[3],inShape[3]];else{if("channelsFirst"!==dataFormat)throw new Error("Unknown dataFormat "+dataFormat);filterShape=[filterHeight,filterWidth,inShape[1],inShape[1]]}return computeConv2DInfo(inShape,filterShape,strides,dilations,pad,roundingMode,!1,dataFormat)}function computeConv2DInfo(inShape,filterShape,strides,dilations,pad,roundingMode,depthwise,dataFormat){void 0===depthwise&&(depthwise=!1),void 0===dataFormat&&(dataFormat="channelsLast");var _a=[-1,-1,-1,-1],batchSize=_a[0],inHeight=_a[1],inWidth=_a[2],inChannels=_a[3];if("channelsLast"===dataFormat)batchSize=inShape[0],inHeight=inShape[1],inWidth=inShape[2],inChannels=inShape[3];else{if("channelsFirst"!==dataFormat)throw new Error("Unknown dataFormat "+dataFormat);batchSize=inShape[0],inChannels=inShape[1],inHeight=inShape[2],inWidth=inShape[3]}var outShape,filterHeight=filterShape[0],filterWidth=filterShape[1],filterChannels=filterShape[3],_b=parseTupleParam(strides),strideHeight=_b[0],strideWidth=_b[1],_c=parseTupleParam(dilations),dilationHeight=_c[0],dilationWidth=_c[1],effectiveFilterHeight=getEffectiveFilterSize(filterHeight,dilationHeight),effectiveFilterWidth=getEffectiveFilterSize(filterWidth,dilationWidth),_d=getPadAndOutInfo(pad,inHeight,inWidth,strideHeight,strideWidth,effectiveFilterHeight,effectiveFilterWidth,roundingMode),padInfo=_d.padInfo,outHeight=_d.outHeight,outWidth=_d.outWidth,outChannels=depthwise?filterChannels*inChannels:filterChannels;return"channelsFirst"===dataFormat?outShape=[batchSize,outChannels,outHeight,outWidth]:"channelsLast"===dataFormat&&(outShape=[batchSize,outHeight,outWidth,outChannels]),{batchSize:batchSize,dataFormat:dataFormat,inHeight:inHeight,inWidth:inWidth,inChannels:inChannels,outHeight:outHeight,outWidth:outWidth,outChannels:outChannels,padInfo:padInfo,strideHeight:strideHeight,strideWidth:strideWidth,filterHeight:filterHeight,filterWidth:filterWidth,effectiveFilterHeight:effectiveFilterHeight,effectiveFilterWidth:effectiveFilterWidth,dilationHeight:dilationHeight,dilationWidth:dilationWidth,inShape:inShape,outShape:outShape,filterShape:filterShape}}function computeOutputShape3D(inShape,fieldSize,outDepth,stride,zeroPad,roundingMode){null==zeroPad&&(zeroPad=computeDefaultPad(inShape,fieldSize,stride));var inputRows=inShape[0],inputCols=inShape[1],outputRows=conditionalRound((inputRows-fieldSize+2*zeroPad)/stride+1,roundingMode);util.assert(util.isInt(outputRows),"The output # of rows ("+outputRows+") must be an integer. Change the stride and/or zero pad parameters");var outputCols=conditionalRound((inputCols-fieldSize+2*zeroPad)/stride+1,roundingMode);return util.assert(util.isInt(outputCols),"The output # of columns ("+outputCols+") must be an integer. Change the stride and/or zero pad parameters"),[outputRows,outputCols,outDepth]}function computeDefaultPad(inputShape,fieldSize,stride,dilation){void 0===dilation&&(dilation=1);var effectiveFieldSize=getEffectiveFilterSize(fieldSize,dilation);return Math.floor((inputShape[0]*(stride-1)-stride+effectiveFieldSize)/2)}function parseTupleParam(param){return"number"==typeof param?[param,param]:param}function getEffectiveFilterSize(filterSize,dilation){return dilation<=1?filterSize:filterSize+(filterSize-1)*(dilation-1)}function getPadAndOutInfo(pad,inHeight,inWidth,strideHeight,strideWidth,filterHeight,filterWidth,roundingMode){var padInfo,outHeight,outWidth;if("number"==typeof pad){padInfo={top:pad,bottom:pad,left:pad,right:pad,type:0===pad?"VALID":"NUMBER"};var outShape=computeOutputShape3D([inHeight,inWidth,1],filterHeight,1,strideHeight,pad,roundingMode);outHeight=outShape[0],outWidth=outShape[1]}else if("same"===pad){outHeight=Math.ceil(inHeight/strideHeight),outWidth=Math.ceil(inWidth/strideWidth);var padAlongHeight=(outHeight-1)*strideHeight+filterHeight-inHeight,padAlongWidth=(outWidth-1)*strideWidth+filterWidth-inWidth,top_1=Math.floor(padAlongHeight/2),bottom=padAlongHeight-top_1,left=Math.floor(padAlongWidth/2),right=padAlongWidth-left;padInfo={top:top_1,bottom:bottom,left:left,right:right,type:"SAME"}}else{if("valid"!==pad)throw Error("Unknown padding parameter: "+pad);padInfo={top:0,bottom:0,left:0,right:0,type:"VALID"},outHeight=Math.ceil((inHeight-filterHeight+1)/strideHeight),outWidth=Math.ceil((inWidth-filterWidth+1)/strideWidth)}return{padInfo:padInfo,outHeight:outHeight,outWidth:outWidth}}function conditionalRound(value,roundingMode){if(!roundingMode)return value;switch(roundingMode){case"round":return Math.round(value);case"ceil":return Math.ceil(value);case"floor":return Math.floor(value);default:throw new Error("Unknown roundingMode "+roundingMode)}}function tupleValuesAreOne(param){var _a=parseTupleParam(param),dimA=_a[0],dimB=_a[1];return 1===dimA&&1===dimB}function eitherStridesOrDilationsAreOne(strides,dilations){return tupleValuesAreOne(strides)||tupleValuesAreOne(dilations)}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");exports.computePool2DInfo=computePool2DInfo,exports.computeConv2DInfo=computeConv2DInfo,exports.computeDefaultPad=computeDefaultPad,exports.tupleValuesAreOne=tupleValuesAreOne,exports.eitherStridesOrDilationsAreOne=eitherStridesOrDilationsAreOne},{"../util":210}],155:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ERF_P=.3275911,exports.ERF_A1=.254829592,exports.ERF_A2=-.284496736,exports.ERF_A3=1.421413741,exports.ERF_A4=-1.453152027,exports.ERF_A5=1.061405429},{}],156:[function(require,module,exports){"use strict";function gatherND_(x,indices){var $indices=tensor_util_env_1.convertToTensor(indices,"indices","gatherND","int32"),$x=tensor_util_env_1.convertToTensor(x,"x","gatherND");return environment_1.ENV.engine.runKernel(function(backend){return backend.gatherND($x,$indices)},{$x:$x,$indices:$indices})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");exports.gatherND=operation_1.op({gatherND_:gatherND_})},{"../environment":58,"../tensor_util_env":206,"./operation":167}],157:[function(require,module,exports){"use strict";function prepareAndValidate(tensor,indices){if(tensor.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+tensor.rank+".");if(indices.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+indices.rank+".");if("int32"!==indices.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+indices.dtype+".");if(indices.shape[indices.rank-1]>tensor.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+indices.shape[indices.rank-1]+" vs. "+tensor.rank)
;if(0===tensor.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+tensor.shape+".");for(var indicesShape=indices.shape,sliceRank=indicesShape[indicesShape.length-1],nResult=1,i=0;i<indicesShape.length-1;++i)nResult*=indicesShape[i];var inputShape=tensor.shape,resultShape=indicesShape.slice();resultShape.pop();for(var sliceSize=1,i=sliceRank;i<tensor.rank;++i)sliceSize*=inputShape[i],resultShape.push(inputShape[i]);var strides=util_1.computeStrides(tensor.shape).map(function(stride){return stride/sliceSize}).concat([1]).slice(0,sliceRank);return[resultShape,nResult,sliceSize,strides]}Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");exports.prepareAndValidate=prepareAndValidate},{"../util":210}],158:[function(require,module,exports){"use strict";function resizeBilinear_(images,size,alignCorners){void 0===alignCorners&&(alignCorners=!1);var $images=tensor_util_env_1.convertToTensor(images,"images","resizeBilinear");util.assert(3===$images.rank||4===$images.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+$images.rank+"."),util.assert(2===size.length,"Error in resizeBilinear: new shape must 2D, but got shape "+size+".");var batchImages=$images,reshapedTo4D=!1;3===$images.rank&&(reshapedTo4D=!0,batchImages=$images.as4D(1,$images.shape[0],$images.shape[1],$images.shape[2]));var newHeight=size[0],newWidth=size[1],forward=function(backend,save){return backend.resizeBilinear(batchImages,newHeight,newWidth,alignCorners)},backward=function(dy,saved){return{batchImages:function(){return environment_1.ENV.engine.runKernel(function(backend){return backend.resizeBilinearBackprop(dy,batchImages,alignCorners)},{})}}},res=environment_1.ENV.engine.runKernel(forward,{batchImages:batchImages},backward);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function resizeNearestNeighbor_(images,size,alignCorners){void 0===alignCorners&&(alignCorners=!1);var $images=tensor_util_env_1.convertToTensor(images,"images","resizeNearestNeighbor");util.assert(3===$images.rank||4===$images.rank,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+$images.rank+"."),util.assert(2===size.length,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+size+"."),util.assert("float32"===$images.dtype||"int32"===$images.dtype,"`images` must have `int32` or `float32` as dtype");var batchImages=$images,reshapedTo4D=!1;3===$images.rank&&(reshapedTo4D=!0,batchImages=$images.as4D(1,$images.shape[0],$images.shape[1],$images.shape[2]));var newHeight=size[0],newWidth=size[1],forward=function(backend,save){return backend.resizeNearestNeighbor(batchImages,newHeight,newWidth,alignCorners)},backward=function(dy,saved){return{batchImages:function(){return environment_1.ENV.engine.runKernel(function(backend){return backend.resizeNearestNeighborBackprop(dy,batchImages,alignCorners)},{})}}},res=environment_1.ENV.engine.runKernel(forward,{batchImages:batchImages},backward);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function nonMaxSuppression_(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){void 0===iouThreshold&&(iouThreshold=.5),void 0===scoreThreshold&&(scoreThreshold=Number.NEGATIVE_INFINITY);var $boxes=tensor_util_env_1.convertToTensor(boxes,"boxes","nonMaxSuppression"),$scores=tensor_util_env_1.convertToTensor(scores,"scores","nonMaxSuppression"),inputs=nonMaxSuppSanityCheck($boxes,$scores,maxOutputSize,iouThreshold,scoreThreshold);return maxOutputSize=inputs.maxOutputSize,iouThreshold=inputs.iouThreshold,scoreThreshold=inputs.scoreThreshold,environment_1.ENV.engine.runKernel(function(b){return b.nonMaxSuppression($boxes,$scores,maxOutputSize,iouThreshold,scoreThreshold)},{$boxes:$boxes})}function nonMaxSuppressionAsync_(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){return void 0===iouThreshold&&(iouThreshold=.5),void 0===scoreThreshold&&(scoreThreshold=Number.NEGATIVE_INFINITY),__awaiter(this,void 0,void 0,function(){var $boxes,$scores,inputs,boxesVals,scoresVals,res;return __generator(this,function(_a){switch(_a.label){case 0:return $boxes=tensor_util_env_1.convertToTensor(boxes,"boxes","nonMaxSuppressionAsync"),$scores=tensor_util_env_1.convertToTensor(scores,"scores","nonMaxSuppressionAsync"),inputs=nonMaxSuppSanityCheck($boxes,$scores,maxOutputSize,iouThreshold,scoreThreshold),maxOutputSize=inputs.maxOutputSize,iouThreshold=inputs.iouThreshold,scoreThreshold=inputs.scoreThreshold,[4,$boxes.data()];case 1:return boxesVals=_a.sent(),[4,$scores.data()];case 2:return scoresVals=_a.sent(),res=non_max_suppression_impl_1.nonMaxSuppressionImpl(boxesVals,scoresVals,maxOutputSize,iouThreshold,scoreThreshold),$boxes!==boxes&&$boxes.dispose(),$scores!==scores&&$scores.dispose(),[2,res]}})})}function nonMaxSuppSanityCheck(boxes,scores,maxOutputSize,iouThreshold,scoreThreshold){null==iouThreshold&&(iouThreshold=.5),null==scoreThreshold&&(scoreThreshold=Number.NEGATIVE_INFINITY);var numBoxes=boxes.shape[0];return maxOutputSize=Math.min(maxOutputSize,numBoxes),util.assert(0<=iouThreshold&&iouThreshold<=1,"iouThreshold must be in [0, 1], but was '"+iouThreshold+"'"),util.assert(2===boxes.rank,"boxes must be a 2D tensor, but was of rank '"+boxes.rank+"'"),util.assert(4===boxes.shape[1],"boxes must have 4 columns, but 2nd dimension was "+boxes.shape[1]),util.assert(1===scores.rank,"scores must be a 1D tensor"),util.assert(scores.shape[0]===numBoxes,"scores has incompatible shape with boxes. Expected "+numBoxes+", but was "+scores.shape[0]),{maxOutputSize:maxOutputSize,iouThreshold:iouThreshold,scoreThreshold:scoreThreshold}}function cropAndResize_(image,boxes,boxInd,cropSize,method,extrapolationValue){var $image=tensor_util_env_1.convertToTensor(image,"image","cropAndResize","float32"),$boxes=tensor_util_env_1.convertToTensor(boxes,"boxes","cropAndResize","float32"),$boxInd=tensor_util_env_1.convertToTensor(boxInd,"boxInd","cropAndResize","int32");method=method||"bilinear",extrapolationValue=extrapolationValue||0;var numBoxes=$boxes.shape[0];util.assert(4===$image.rank,"Error in cropAndResize: image must be rank 4,but got rank "+$image.rank+"."),util.assert(2===$boxes.rank&&4===$boxes.shape[1],"Error in cropAndResize: boxes must be have size ["+numBoxes+",4] but had shape "+$boxes.shape+"."),util.assert(1===$boxInd.rank&&$boxInd.shape[0]===numBoxes,"Error in cropAndResize: boxInd must be have size ["+numBoxes+"] but had shape "+$boxes.shape+"."),util.assert("int32"===$boxInd.dtype,"Error in cropAndResize: boxInd must be of dtype int32, but got dtype "+$boxInd.dtype+"."),util.assert(2===cropSize.length,"Error in cropAndResize: cropSize must be of length 2, but got length "+cropSize.length+"."),util.assert(cropSize[0]>=1&&cropSize[1]>=1,"cropSize must be atleast [1,1], but was "+cropSize),util.assert("bilinear"===method||"nearest"===method,"method must be bilinear or nearest, but was "+method);var forward=function(backend,save){return backend.cropAndResize($image,$boxes,$boxInd,cropSize,method,extrapolationValue)};return environment_1.ENV.engine.runKernel(forward,{$image:$image,$boxes:$boxes})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),non_max_suppression_impl_1=require("../kernels/non_max_suppression_impl"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");exports.resizeBilinear=operation_1.op({resizeBilinear_:resizeBilinear_}),exports.resizeNearestNeighbor=operation_1.op({resizeNearestNeighbor_:resizeNearestNeighbor_}),exports.nonMaxSuppression=operation_1.op({nonMaxSuppression_:nonMaxSuppression_}),exports.nonMaxSuppressionAsync=nonMaxSuppressionAsync_,exports.cropAndResize=cropAndResize_},{"../environment":58,"../kernels/non_max_suppression_impl":79,"../tensor_util_env":206,"../util":210,"./operation":167}],159:[function(require,module,exports){"use strict";function gramSchmidt_(xs){var inputIsTensor2D;if(Array.isArray(xs)){inputIsTensor2D=!1,util_1.assert(null!=xs&&xs.length>0,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var dim=xs[0].shape[0],i=1;i<xs.length;++i)util_1.assert(xs[i].shape[0]===dim,"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+xs[i].shape[0]+" vs. "+dim+")")}else inputIsTensor2D=!0,xs=concat_split_1.split(xs,xs.shape[0],0).map(function(x){return array_ops_1.squeeze(x,[0])});util_1.assert(xs.length<=xs[0].shape[0],"Gram-Schmidt: Number of vectors ("+xs.length+") exceeds number of dimensions ("+xs[0].shape[0]+").");for(var ys=[],xs1d=xs,i=0;i<xs.length;++i)!function(i){ys.push(environment_1.ENV.engine.tidy(function(){var x=xs1d[i];if(i>0)for(var j=0;j<i;++j){var proj=reduction_ops_1.sum(ys[j].mulStrict(x)).mul(ys[j]);x=x.sub(proj)}return x.div(norm_1.norm(x,"euclidean"))}))}(i);return inputIsTensor2D?array_ops_1.stack(ys,0):ys}function qr_(x,fullMatrices){if(void 0===fullMatrices&&(fullMatrices=!1),x.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+x.rank);if(2===x.rank)return qr2d(x,fullMatrices);var outerDimsProd=x.shape.slice(0,x.shape.length-2).reduce(function(value,prev){return value*prev}),x2ds=array_ops_1.unstack(x.reshape([outerDimsProd,x.shape[x.shape.length-2],x.shape[x.shape.length-1]]),0),q2ds_1=[],r2ds_1=[];return x2ds.forEach(function(x2d){var _a=qr2d(x2d,fullMatrices),q2d=_a[0],r2d=_a[1];q2ds_1.push(q2d),r2ds_1.push(r2d)}),[array_ops_1.stack(q2ds_1,0).reshape(x.shape),array_ops_1.stack(r2ds_1,0).reshape(x.shape)]}function qr2d(x,fullMatrices){return void 0===fullMatrices&&(fullMatrices=!1),environment_1.ENV.engine.tidy(function(){if(2!==x.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+x.shape.length+"D Tensor.");for(var m=x.shape[0],n=x.shape[1],q=array_ops_1.eye(m),r=x.clone(),one2D=tensor_ops_1.tensor2d([[1]],[1,1]),w=one2D.clone(),iters=m>=n?n:m,j=0;j<iters;++j)!function(j){var _a,rTemp=r,wTemp=w,qTemp=q;_a=environment_1.ENV.engine.tidy(function(){var rjEnd1=r.slice([j,j],[m-j,1]),normX=rjEnd1.norm(),rjj=r.slice([j,j],[1,1]),s=rjj.sign().neg(),u1=rjj.sub(s.mul(normX)),wPre=rjEnd1.div(u1);w=1===wPre.shape[0]?one2D.clone():one2D.concat(wPre.slice([1,0],[wPre.shape[0]-1,wPre.shape[1]]),0);var tau=s.matMul(u1).div(normX).neg(),rjEndAll=r.slice([j,0],[m-j,n]),tauTimesW=tau.mul(w);r=0===j?rjEndAll.sub(tauTimesW.matMul(w.transpose().matMul(rjEndAll))):r.slice([0,0],[j,n]).concat(rjEndAll.sub(tauTimesW.matMul(w.transpose().matMul(rjEndAll))),0);var qAllJEnd=q.slice([0,j],[m,q.shape[1]-j]);return q=0===j?qAllJEnd.sub(qAllJEnd.matMul(w).matMul(tauTimesW.transpose())):q.slice([0,0],[m,j]).concat(qAllJEnd.sub(qAllJEnd.matMul(w).matMul(tauTimesW.transpose())),1),[w,r,q]}),w=_a[0],r=_a[1],q=_a[2],globals_1.dispose([rTemp,wTemp,qTemp])}(j);return!fullMatrices&&m>n&&(q=q.slice([0,0],[m,n]),r=r.slice([0,0],[n,n])),[q,r]})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),util_1=require("../util"),array_ops_1=require("./array_ops"),concat_split_1=require("./concat_split"),norm_1=require("./norm"),operation_1=require("./operation"),reduction_ops_1=require("./reduction_ops"),tensor_ops_1=require("./tensor_ops");exports.gramSchmidt=operation_1.op({gramSchmidt_:gramSchmidt_}),exports.qr=operation_1.op({qr_:qr_})},{"../environment":58,"../globals":60,"../util":210,"./array_ops":142,"./concat_split":150,"./norm":166,"./operation":167,"./reduction_ops":172,"./tensor_ops":187}],160:[function(require,module,exports){"use strict";function logicalNot_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","logicalNot","bool");return util_1.assert("bool"===$x.dtype,"Error Array must be of type bool."),environment_1.ENV.engine.runKernel(function(backend){return backend.logicalNot($x)},{$x:$x})}function logicalAnd_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","logicalAnd","bool"),$b=tensor_util_env_1.convertToTensor(b,"b","logicalAnd","bool");return util_1.assert("bool"===$a.dtype&&"bool"===$b.dtype,"Error Array must be of type bool."),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),environment_1.ENV.engine.runKernel(function(backend){return backend.logicalAnd($a,$b)},{$a:$a,$b:$b})}function logicalOr_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","logicalOr","bool"),$b=tensor_util_env_1.convertToTensor(b,"b","logicalOr","bool");return util_1.assert("bool"===$a.dtype&&"bool"===$b.dtype,"Error Array must be of type bool."),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),environment_1.ENV.engine.runKernel(function(backend){return backend.logicalOr($a,$b)},{$a:$a,$b:$b})}function logicalXor_(a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","logicalXor","bool"),$b=tensor_util_env_1.convertToTensor(b,"b","logicalXor","bool");return util_1.assert("bool"===$a.dtype&&"bool"===$b.dtype,"Error Array must be of type bool."),broadcast_util_1.assertAndGetBroadcastShape($a.shape,$b.shape),exports.logicalOr(a,b).logicalAnd(exports.logicalAnd(a,b).logicalNot())}function where_(condition,a,b){var $a=tensor_util_env_1.convertToTensor(a,"a","where"),$b=tensor_util_env_1.convertToTensor(b,"b","where"),$condition=tensor_util_env_1.convertToTensor(condition,"condition","where","bool");util_1.assert("bool"===$condition.dtype,"Error Condition must be of type bool."),util_1.assertShapesMatch($a.shape,$b.shape,"Error in where: "),1===$condition.rank?util_1.assert($condition.shape[0]===$a.shape[0],"The first dimension of `a` must match the size of `condition`."):util_1.assertShapesMatch($condition.shape,$b.shape,"Error in where: ");var grad=function(dy){return{$condition:function(){return tensor_ops_1.zerosLike($condition)},$a:function(){return dy.mul($condition.cast($a.dtype))},$b:function(){return dy.mul($condition.logicalNot().cast($b.dtype))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.select($condition,$a,$b)},{$condition:$condition,$a:$a,$b:$b},grad)}function whereAsync_(condition){return __awaiter(this,void 0,void 0,function(){var $condition,vals,res;return __generator(this,function(_a){switch(_a.label){case 0:return $condition=tensor_util_env_1.convertToTensor(condition,"condition","where","bool"),util_1.assert("bool"===$condition.dtype,"Condition must be of type bool."),[4,$condition.data()];case 1:return vals=_a.sent(),res=where_impl_1.whereImpl($condition.shape,vals),condition!==$condition&&$condition.dispose(),[2,res]}})})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),where_impl_1=require("../kernels/where_impl"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),broadcast_util_1=require("./broadcast_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");exports.logicalAnd=operation_1.op({logicalAnd_:logicalAnd_}),exports.logicalNot=operation_1.op({logicalNot_:logicalNot_}),exports.logicalOr=operation_1.op({logicalOr_:logicalOr_}),exports.logicalXor=operation_1.op({logicalXor_:logicalXor_}),exports.where=operation_1.op({where_:where_}),exports.whereAsync=whereAsync_},{"../environment":58,"../kernels/where_impl":139,"../tensor_util_env":206,"../util":210,"./broadcast_util":147,"./operation":167,"./tensor_ops":187}],161:[function(require,module,exports){"use strict";function computeWeightedLoss_(losses,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $losses=tensor_util_env_1.convertToTensor(losses,"losses","computeWeightedLoss"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","computeWeightedLoss"));var weightedLoss=null==$weights?$losses:$losses.mul($weights);if(reduction===Reduction.NONE)return weightedLoss;if(reduction===Reduction.SUM)return weightedLoss.sum();if(reduction===Reduction.MEAN){if(null==$weights)return weightedLoss.mean();var broadcastFactor=util_1.sizeFromShape($losses.shape)/util_1.sizeFromShape($weights.shape),result=weightedLoss.sum().div($weights.sum());return broadcastFactor>1?result.div(tensor_ops_1.scalar(broadcastFactor)):result}if(reduction===Reduction.SUM_BY_NONZERO_WEIGHTS){if(null==$weights)return weightedLoss.sum().div(tensor_ops_1.scalar($losses.size));var broadcastedWeights=$weights.mul(tensor_ops_1.ones($losses.shape)),numNonZeros=broadcastedWeights.notEqual(tensor_ops_1.scalar(0)).sum().toFloat();return weightedLoss.sum().div(numNonZeros)}throw Error("Unknown reduction: "+reduction)}function absoluteDifference_(labels,predictions,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","absoluteDifference"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","absoluteDifference"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","absoluteDifference")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in absoluteDifference: ");var losses=$labels.sub($predictions).abs();return exports.computeWeightedLoss(losses,$weights,reduction)}function meanSquaredError_(labels,predictions,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","meanSquaredError"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","meanSquaredError"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","meanSquaredError")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in meanSquaredError: ");var losses=$labels.squaredDifference($predictions);return exports.computeWeightedLoss(losses,$weights,reduction)}function cosineDistance_(labels,predictions,axis,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","cosineDistance"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","cosineDistance"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","cosineDistance")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in cosineDistance: ");var one=tensor_ops_1.scalar(1),losses=one.sub($labels.mul($predictions).sum(axis,!0));return exports.computeWeightedLoss(losses,$weights,reduction)}function hingeLoss_(labels,predictions,weights,reduction){void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","hingeLoss"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","hingeLoss"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","hingeLoss")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in hingeLoss: ");var one=tensor_ops_1.scalar(1);$labels=tensor_ops_1.scalar(2).mul($labels).sub(one);var losses=one.sub($labels.mul($predictions)).relu();return exports.computeWeightedLoss(losses,$weights,reduction)}function logLoss_(labels,predictions,weights,epsilon,reduction){void 0===epsilon&&(epsilon=1e-7),void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","logLoss"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","logLoss"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","logLoss")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in logLoss: ");var one=tensor_ops_1.scalar(1),epsilonScalar=tensor_ops_1.scalar(epsilon),losses=$labels.mul($predictions.add(epsilonScalar).log()).neg().sub(one.sub($labels).mul(one.sub($predictions).add(epsilonScalar).log()));return exports.computeWeightedLoss(losses,$weights,reduction)}function sigmoidCrossEntropyWithLogits_(labels,logits){var $labels=tensor_util_env_1.convertToTensor(labels,"labels","sigmoidCrossEntropyWithLogits"),$logits=tensor_util_env_1.convertToTensor(logits,"logits","sigmoidCrossEntropyWithLogits");util_1.assertShapesMatch($labels.shape,$logits.shape,"Error in sigmoidCrossEntropyWithLogits: ");var maxOutput=$logits.relu(),outputXTarget=$logits.mul($labels),sigmoidOutput=$logits.abs().neg().exp().log1p();return maxOutput.sub(outputXTarget).add(sigmoidOutput)}function sigmoidCrossEntropy_(multiClassLabels,logits,weights,labelSmoothing,reduction){void 0===labelSmoothing&&(labelSmoothing=0),void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $multiClassLabels=tensor_util_env_1.convertToTensor(multiClassLabels,"multiClassLabels","sigmoidCrossEntropy"),$logits=tensor_util_env_1.convertToTensor(logits,"logits","sigmoidCrossEntropy"),$weights=null;if(null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","sigmoidCrossEntropy")),util_1.assertShapesMatch($multiClassLabels.shape,$logits.shape,"Error in sigmoidCrossEntropy: "),labelSmoothing>0){var labelSmoothingScalar=tensor_ops_1.scalar(labelSmoothing),one=tensor_ops_1.scalar(1),half=tensor_ops_1.scalar(.5);$multiClassLabels=$multiClassLabels.mul(one.sub(labelSmoothingScalar)).add(half.mul(labelSmoothingScalar))}var losses=sigmoidCrossEntropyWithLogits_($multiClassLabels,$logits);return exports.computeWeightedLoss(losses,$weights,reduction)}function huberLoss_(labels,predictions,weights,delta,reduction){void 0===delta&&(delta=1),void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $labels=tensor_util_env_1.convertToTensor(labels,"labels","huberLoss"),$predictions=tensor_util_env_1.convertToTensor(predictions,"predictions","huberLoss"),$weights=null;null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","huberLoss")),util_1.assertShapesMatch($labels.shape,$predictions.shape,"Error in huberLoss: ");var deltaScalar=tensor_ops_1.scalar(delta),error=$predictions.sub($labels).abs(),quadratic=binary_ops_1.minimum(error,deltaScalar),linear=error.sub(quadratic),losses=tensor_ops_1.scalar(.5).mul(quadratic.square()).add(deltaScalar.mul(linear));return exports.computeWeightedLoss(losses,$weights,reduction)}function softmaxCrossEntropyWithLogits_(labels,logits,dim){if(void 0===dim&&(dim=-1),-1===dim&&(dim=logits.rank-1),dim!==logits.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+logits.rank+" and dim was "+dim);return globals_1.customGrad(function(labels,logits){var lse=logits.logSumExp([dim],!0),logResult=logits.toFloat().sub(lse);return{value:logResult.mul(labels).neg().sum([dim]),gradFunc:function(dy){var dyShape=axis_util_1.expandShapeToKeepDim(dy.shape,[dim]);return[dy.reshape(dyShape).mul(labels.toFloat().sub(logResult.exp())),dy.reshape(dyShape).mul(logResult.exp().sub(labels.toFloat()))]}}})(labels,logits)}function softmaxCrossEntropy_(onehotLabels,logits,weights,labelSmoothing,reduction){void 0===labelSmoothing&&(labelSmoothing=0),void 0===reduction&&(reduction=Reduction.SUM_BY_NONZERO_WEIGHTS);var $onehotLabels=tensor_util_env_1.convertToTensor(onehotLabels,"onehotLabels","softmaxCrossEntropy"),$logits=tensor_util_env_1.convertToTensor(logits,"logits","softmaxCrossEntropy"),$weights=null;if(null!=weights&&($weights=tensor_util_env_1.convertToTensor(weights,"weights","softmaxCrossEntropy")),util_1.assertShapesMatch($onehotLabels.shape,$logits.shape,"Error in softmaxCrossEntropy: "),labelSmoothing>0){var labelSmoothingScalar=tensor_ops_1.scalar(labelSmoothing),one=tensor_ops_1.scalar(1),numClasses=tensor_ops_1.scalar($onehotLabels.shape[1]);$onehotLabels=$onehotLabels.mul(one.sub(labelSmoothingScalar)).add(labelSmoothingScalar.div(numClasses))}var losses=softmaxCrossEntropyWithLogits_($onehotLabels,$logits);return exports.computeWeightedLoss(losses,$weights,reduction)}Object.defineProperty(exports,"__esModule",{value:!0});var Reduction,globals_1=require("../globals"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),axis_util_1=require("./axis_util"),binary_ops_1=require("./binary_ops"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");!function(Reduction){Reduction[Reduction.NONE=0]="NONE",Reduction[Reduction.MEAN=1]="MEAN",Reduction[Reduction.SUM=2]="SUM",Reduction[Reduction.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Reduction=exports.Reduction||(exports.Reduction={})),exports.absoluteDifference=operation_1.op({absoluteDifference_:absoluteDifference_}),exports.computeWeightedLoss=operation_1.op({computeWeightedLoss_:computeWeightedLoss_}),exports.cosineDistance=operation_1.op({cosineDistance_:cosineDistance_}),exports.hingeLoss=operation_1.op({hingeLoss_:hingeLoss_}),exports.huberLoss=operation_1.op({huberLoss_:huberLoss_}),exports.logLoss=operation_1.op({logLoss_:logLoss_}),exports.meanSquaredError=operation_1.op({meanSquaredError_:meanSquaredError_}),exports.sigmoidCrossEntropy=operation_1.op({sigmoidCrossEntropy_:sigmoidCrossEntropy_}),exports.softmaxCrossEntropy=operation_1.op({softmaxCrossEntropy_:softmaxCrossEntropy_})},{"../globals":60,"../tensor_util_env":206,"../util":210,"./axis_util":144,"./binary_ops":146,"./operation":167,"./tensor_ops":187}],162:[function(require,module,exports){"use strict";function localResponseNormalization_(x,depthRadius,bias,alpha,beta){void 0===depthRadius&&(depthRadius=5),void 0===bias&&(bias=1),void 0===alpha&&(alpha=1),void 0===beta&&(beta=.5);var $x=tensor_util_env_1.convertToTensor(x,"x","localResponseNormalization");util.assert(4===$x.rank||3===$x.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+$x.rank+"."),util.assert(util.isInt(depthRadius),"Error in localResponseNormalization: depthRadius must be an integer\n                     but got depthRadius "+depthRadius+".");var x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2]));var backward=function(dy,saved){var outputImage=saved[0];return{x4D:function(){return environment_1.ENV.engine.runKernel(function(backend){return backend.LRNGrad(dy,x4D,outputImage,depthRadius,bias,alpha,beta)},{})}}},res=environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.localResponseNormalization4D(x4D,depthRadius,bias,alpha,beta))},{x4D:x4D},backward);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");exports.localResponseNormalization=operation_1.op({localResponseNormalization_:localResponseNormalization_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./operation":167}],163:[function(require,module,exports){"use strict";function multiRNNCell_(lstmCells,data,c,h){for(var $data=tensor_util_env_1.convertToTensor(data,"data","multiRNNCell"),$c=tensor_util_env_1.convertToTensorArray(c,"c","multiRNNCell"),$h=tensor_util_env_1.convertToTensorArray(h,"h","multiRNNCell"),input=$data,newStates=[],i=0;i<lstmCells.length;i++){var output=lstmCells[i](input,$c[i],$h[i]);newStates.push(output[0]),newStates.push(output[1]),input=output[1]}for(var newC=[],newH=[],i=0;i<newStates.length;i+=2)newC.push(newStates[i]),newH.push(newStates[i+1]);return[newC,newH]}function basicLSTMCell_(forgetBias,lstmKernel,lstmBias,data,c,h){var $forgetBias=tensor_util_env_1.convertToTensor(forgetBias,"forgetBias","basicLSTMCell"),$lstmKernel=tensor_util_env_1.convertToTensor(lstmKernel,"lstmKernel","basicLSTMCell"),$lstmBias=tensor_util_env_1.convertToTensor(lstmBias,"lstmBias","basicLSTMCell"),$data=tensor_util_env_1.convertToTensor(data,"data","basicLSTMCell"),$c=tensor_util_env_1.convertToTensor(c,"c","basicLSTMCell"),$h=tensor_util_env_1.convertToTensor(h,"h","basicLSTMCell"),combined=$data.concat($h,1),weighted=combined.matMul($lstmKernel),res=weighted.add($lstmBias),batchSize=res.shape[0],sliceCols=res.shape[1]/4,sliceSize=[batchSize,sliceCols],i=res.slice([0,0],sliceSize),j=res.slice([0,sliceCols],sliceSize),f=res.slice([0,2*sliceCols],sliceSize),o=res.slice([0,3*sliceCols],sliceSize),newC=i.sigmoid().mulStrict(j.tanh()).addStrict($c.mulStrict($forgetBias.add(f).sigmoid()));return[newC,newC.tanh().mulStrict(o.sigmoid())]}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");exports.basicLSTMCell=operation_1.op({basicLSTMCell_:basicLSTMCell_}),exports.multiRNNCell=operation_1.op({multiRNNCell_:multiRNNCell_})},{"../tensor_util_env":206,"./operation":167}],164:[function(require,module,exports){"use strict"
;function matMul_(a,b,transposeA,transposeB){void 0===transposeA&&(transposeA=!1),void 0===transposeB&&(transposeB=!1);var $a=tensor_util_env_1.convertToTensor(a,"a","matMul"),$b=tensor_util_env_1.convertToTensor(b,"b","matMul"),innerShapeA=transposeA?$a.shape[$a.rank-2]:$a.shape[$a.rank-1],innerShapeB=transposeB?$b.shape[$b.rank-1]:$b.shape[$b.rank-2],outerShapeA=transposeA?$a.shape[$a.rank-1]:$a.shape[$a.rank-2],outerShapeB=transposeB?$b.shape[$b.rank-2]:$b.shape[$b.rank-1],outerDimsA=$a.shape.slice(0,-2),outerDimsB=$b.shape.slice(0,-2),batchDimA=util.sizeFromShape(outerDimsA),batchDimB=util.sizeFromShape(outerDimsB);util.assert($a.rank>=2&&$b.rank>=2&&$a.rank===$b.rank,"Error in matMul: inputs must have the same rank of at least 2, got ranks "+$a.rank+" and "+$b.rank+"."),util.assert(util.arraysEqual(outerDimsA,outerDimsB),"Error in matMul: outer dimensions ("+outerDimsA+") and ("+outerDimsB+") of Tensors with shapes "+$a.shape+" and "+$b.shape+" must match."),util.assert(innerShapeA===innerShapeB,"Error in matMul: inner shapes ("+innerShapeA+") and ("+innerShapeB+") of Tensors with shapes "+$a.shape+" and "+$b.shape+" and transposeA="+transposeA+" and transposeB="+transposeB+" must match.");var outShape=$a.shape.slice(0,-2).concat([outerShapeA,outerShapeB]),a3D=transposeA?$a.as3D(batchDimA,innerShapeA,outerShapeA):$a.as3D(batchDimA,outerShapeA,innerShapeA),b3D=transposeB?$b.as3D(batchDimB,outerShapeB,innerShapeB):$b.as3D(batchDimB,innerShapeB,outerShapeB),grad=function(dy){return transposeA||transposeB?!transposeA&&transposeB?{$a:function(){return dy.matMul(b3D.toFloat(),!1,!1)},$b:function(){return dy.matMul(a3D.toFloat(),!0,!1)}}:transposeA&&!transposeB?{$a:function(){return b3D.toFloat().matMul(dy,!1,!0)},$b:function(){return a3D.toFloat().matMul(dy,!1,!1)}}:{$a:function(){return b3D.toFloat().matMul(dy,!0,!0)},$b:function(){return dy.matMul(a3D.toFloat(),!0,!0)}}:{$a:function(){return dy.matMul(b3D.toFloat(),!1,!0)},$b:function(){return a3D.toFloat().matMul(dy,!0,!1)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.batchMatMul(a3D,b3D,transposeA,transposeB)},{$a:a3D,$b:b3D},grad).reshape(outShape)}function outerProduct_(v1,v2){var $v1=tensor_util_env_1.convertToTensor(v1,"v1","outerProduct"),$v2=tensor_util_env_1.convertToTensor(v2,"v2","outerProduct");return util.assert(1===$v1.rank&&1===$v2.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+$v1.rank+" and "+$v2.rank+"."),$v1.as2D(-1,1).matMul($v2.as2D(1,-1))}function dot_(t1,t2){var $t1=tensor_util_env_1.convertToTensor(t1,"t1","dot"),$t2=tensor_util_env_1.convertToTensor(t2,"t2","dot");util.assert(!(1!==$t1.rank&&2!==$t1.rank||1!==$t2.rank&&2!==$t2.rank),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+$t1.rank+" and "+$t2.rank+".");var t1Inner=1===$t1.rank?$t1.size:$t1.shape[1],t2Inner=1===$t2.rank?$t2.size:$t2.shape[0];return util.assert(t1Inner===t2Inner,"Error in dot: inner dimensions of inputs must match, but got "+t1Inner+" and "+t2Inner+"."),1===$t1.rank&&1===$t2.rank?$t1.as2D(1,-1).matMul($t2.as2D(-1,1)).asScalar():1===$t1.rank&&2===$t2.rank?$t1.as2D(1,-1).matMul($t2.as2D($t2.shape[0],$t2.shape[1])).as1D():2===$t1.rank&&1===$t2.rank?$t1.matMul($t2.as2D(-1,1)).as1D():$t1.matMul($t2.as2D($t2.shape[0],$t2.shape[1]))}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation");exports.matMul=operation_1.op({matMul_:matMul_}),exports.dot=operation_1.op({dot_:dot_}),exports.outerProduct=operation_1.op({outerProduct_:outerProduct_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./operation":167}],165:[function(require,module,exports){"use strict";function movingAverage_(v,x,decay,step,zeroDebias){void 0===zeroDebias&&(zeroDebias=!0);var $v=tensor_util_env_1.convertToTensor(v,"v","movingAverage"),$x=tensor_util_env_1.convertToTensor(x,"x","movingAverage"),$decay=tensor_util_env_1.convertToTensor(decay,"decay","movingAverage");tensor_util_1.assertTypesMatch($v,$x),util.assert(util.arraysEqual($v.shape,$x.shape),"Shape mismatch in v and x");var one=tensor_ops_1.scalar(1),oneMinusDecay=one.sub($decay),update=$x.sub($v).mul(oneMinusDecay);if(zeroDebias){util.assert(null!=step,"When using zeroDebias: true, step is required.");var $step=tensor_util_env_1.convertToTensor(step,"step","movingAverage");update=update.div(one.sub(binary_ops_1.pow($decay,$step)))}return $v.add(update)}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_1=require("../tensor_util"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),binary_ops_1=require("./binary_ops"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");exports.movingAverage=operation_1.op({movingAverage_:movingAverage_})},{"../tensor_util":205,"../tensor_util_env":206,"../util":210,"./binary_ops":146,"./operation":167,"./tensor_ops":187}],166:[function(require,module,exports){"use strict";function norm_(x,ord,axis,keepDims){void 0===ord&&(ord="euclidean"),void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),x=tensor_util_env_1.convertToTensor(x,"x","norm");var norm=normImpl(x,ord,axis),keepDimsShape=norm.shape;if(keepDims){var axes=axis_util.parseAxisParam(axis,x.shape);keepDimsShape=axis_util.expandShapeToKeepDim(norm.shape,axes)}return norm.reshape(keepDimsShape)}function normImpl(x,p,axis){if(void 0===axis&&(axis=null),0===x.rank)return x.abs();if(1!==x.rank&&null===axis)return normImpl(x.reshape([-1]),p,axis);if(1===x.rank||"number"==typeof axis||axis instanceof Array&&1===axis.length){if(1===p)return x.abs().sum(axis);if(p===1/0)return x.abs().max(axis);if(p===-1/0)return x.abs().min(axis);if("euclidean"===p||2===p)return x.abs().pow(tensor_ops_1.scalar(2,"int32")).sum(axis).sqrt();throw new Error("Error in norm: invalid ord value: "+p)}if(axis instanceof Array&&2===axis.length){if(1===p)return x.abs().sum(axis[0]).max(axis[1]-1);if(p===1/0)return x.abs().sum(axis[1]).max(axis[0]);if(p===-1/0)return x.abs().sum(axis[1]).min(axis[0]);if("fro"===p||"euclidean"===p)return x.square().sum(axis).sqrt();throw new Error("Error in norm: invalid ord value: "+p)}throw new Error("Error in norm: invalid axis: "+axis)}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_util_env_1=require("../tensor_util_env"),axis_util=require("./axis_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");exports.norm=operation_1.op({norm_:norm_})},{"../tensor_util_env":206,"./axis_util":144,"./operation":167,"./tensor_ops":187}],167:[function(require,module,exports){"use strict";function op(f){var keys=Object.keys(f);if(1!==keys.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+keys.length+" keys.");var opName=keys[0],fn=f[opName];opName.endsWith("_")&&(opName=opName.substring(0,opName.length-1));var f2=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];environment_1.ENV.engine.startScope(opName);try{var result=fn.apply(void 0,args);return result instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),environment_1.ENV.engine.endScope(result),result}catch(ex){throw environment_1.ENV.engine.endScope(null),ex}};return Object.defineProperty(f2,"name",{value:opName,configurable:!0}),f2}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment");exports.op=op},{"../environment":58}],168:[function(require,module,exports){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0}),__export(require("./batchnorm")),__export(require("./complex_ops")),__export(require("./concat_split")),__export(require("./conv")),__export(require("./matmul")),__export(require("./reverse")),__export(require("./pool")),__export(require("./slice")),__export(require("./unary_ops")),__export(require("./reduction_ops")),__export(require("./compare")),__export(require("./binary_ops")),__export(require("./relu_ops")),__export(require("./logical_ops")),__export(require("./array_ops")),__export(require("./tensor_ops")),__export(require("./transpose")),__export(require("./softmax")),__export(require("./lrn")),__export(require("./norm")),__export(require("./segment_ops")),__export(require("./lstm")),__export(require("./moving_average")),__export(require("./strided_slice")),__export(require("./topk")),__export(require("./scatter_nd")),__export(require("./spectral_ops")),__export(require("./sparse_to_dense")),__export(require("./gather_nd"));var operation_1=require("./operation");exports.op=operation_1.op;var losses=require("./loss_ops");exports.losses=losses;var linalg=require("./linalg_ops");exports.linalg=linalg;var image=require("./image_ops");exports.image=image;var spectral=require("./spectral_ops");exports.spectral=spectral},{"./array_ops":142,"./batchnorm":145,"./binary_ops":146,"./compare":148,"./complex_ops":149,"./concat_split":150,"./conv":153,"./gather_nd":156,"./image_ops":158,"./linalg_ops":159,"./logical_ops":160,"./loss_ops":161,"./lrn":162,"./lstm":163,"./matmul":164,"./moving_average":165,"./norm":166,"./operation":167,"./pool":169,"./reduction_ops":172,"./relu_ops":173,"./reverse":174,"./scatter_nd":175,"./segment_ops":177,"./slice":180,"./softmax":182,"./sparse_to_dense":183,"./spectral_ops":185,"./strided_slice":186,"./tensor_ops":187,"./topk":188,"./transpose":189,"./unary_ops":190}],169:[function(require,module,exports){"use strict";function maxPoolImpl_(x,filterSize,strides,dilations,pad,dimRoundingMode){var $x=tensor_util_env_1.convertToTensor(x,"x","maxPool"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),null==dilations&&(dilations=[1,1]),util.assert(4===x4D.rank,"Error in maxPool: input must be rank 4 but got rank "+x4D.rank+"."),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),"Error in maxPool: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"),null!=dimRoundingMode&&util.assert(util.isInt(pad),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+".");var convInfo=conv_util.computePool2DInfo(x4D.shape,filterSize,strides,dilations,pad,dimRoundingMode),grad=function(dy,saved){var y4D=saved[0];return{x:function(){return maxPoolBackprop(dy,x4D,y4D,filterSize,strides,dilations,pad)}}},res=environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.maxPool(x4D,convInfo))},{x:x4D},grad);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function maxPool_(x,filterSize,strides,pad,dimRoundingMode){return maxPoolImpl_(x,filterSize,strides,1,pad,dimRoundingMode)}function avgPoolImpl_(x,filterSize,strides,dilations,pad,dimRoundingMode){var $x=tensor_util_env_1.convertToTensor(x,"x","avgPool");util.assert("float32"===$x.dtype,"The input dtype to avgPool must be float32"),null==dilations&&(dilations=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),"Error in avgPool: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'");var x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(4===x4D.rank,"Error in avgPool: x must be rank 4 but got rank "+x4D.rank+"."),null!=dimRoundingMode&&util.assert(util.isInt(pad),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+".");var convInfo=conv_util.computePool2DInfo(x4D.shape,filterSize,strides,dilations,pad),grad=function(dy){return{x:function(){return avgPoolBackprop(dy,x4D,filterSize,strides,dilations,pad)}}},res=environment_1.ENV.engine.runKernel(function(backend){return backend.avgPool(x4D,convInfo)},{x:x4D},grad);return res=res.cast($x.dtype),reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function avgPool_(x,filterSize,strides,pad,dimRoundingMode){return avgPoolImpl_(x,filterSize,strides,1,pad,dimRoundingMode)}function pool_(input,windowShape,poolingType,pad,dilations,strides){null==dilations&&(dilations=[1,1]),null==strides&&(strides=1),0===pad&&(pad="valid");var $x=tensor_util_env_1.convertToTensor(input,"x","maxPool"),x4D=$x,reshapedTo4D=!1;3===$x.rank&&(reshapedTo4D=!0,x4D=$x.as4D(1,$x.shape[0],$x.shape[1],$x.shape[2])),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),"Error in pool: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'");var basePadding,convInfo=conv_util.computePool2DInfo(x4D.shape,windowShape,strides,dilations,pad),dilation=[convInfo.dilationHeight,convInfo.dilationWidth];basePadding="same"===pad?withSpaceToBatchBasePaddings([convInfo.filterHeight,convInfo.filterWidth],dilation):[[0,0],[0,0]];var isDilationOne=1===dilation[0]&&1===dilation[1],_a=requiredSpaceToBatchPaddings([convInfo.inHeight,convInfo.inWidth],dilation,basePadding),adjustedPadding=_a[0],adjustedCrops=_a[1],convertedPad=isDilationOne?pad:"valid",convertedX=isDilationOne?x4D:array_ops_1.spaceToBatchND(x4D,dilation,adjustedPadding),forwardOp="avg"===poolingType?function(){return avgPoolImpl_(convertedX,windowShape,strides,1,convertedPad)}:function(){return maxPoolImpl_(convertedX,windowShape,strides,1,convertedPad)},y=forwardOp(),res=isDilationOne?y:array_ops_1.batchToSpaceND(y,dilation,adjustedCrops);return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function maxPoolBackprop(dy,input,output,filterSize,strides,dilations,pad,dimRoundingMode){var $dy=tensor_util_env_1.convertToTensor(dy,"dy","maxPoolBackprop"),$input=tensor_util_env_1.convertToTensor(input,"input","maxPoolBackprop"),$output=tensor_util_env_1.convertToTensor(output,"output","maxPoolBackprop");util.assert($input.rank===$dy.rank,"Rank of input ("+$input.rank+") does not match rank of dy ("+$dy.rank+")"),null==dilations&&(dilations=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'"),util.assert(4===$dy.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+$dy.rank+"."),util.assert(4===$input.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+$input.rank+"."),null!=dimRoundingMode&&util.assert(util.isInt(pad),"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+dimRoundingMode+" but got pad "+pad+".");var convInfo=conv_util.computePool2DInfo($input.shape,filterSize,strides,dilations,pad,dimRoundingMode);return environment_1.ENV.engine.runKernel(function(backend){return backend.maxPoolBackprop($dy,$input,$output,convInfo)},{$dy:$dy,$input:$input})}function avgPoolBackprop(dy,input,filterSize,strides,dilations,pad){var $dy=tensor_util_env_1.convertToTensor(dy,"dy","avgPoolBackprop"),$input=tensor_util_env_1.convertToTensor(input,"input","avgPoolBackprop");util.assert($input.rank===$dy.rank,"Rank of input ("+$input.rank+") does not match rank of dy ("+$dy.rank+")"),null==dilations&&(dilations=[1,1]),util.assert(conv_util.eitherStridesOrDilationsAreOne(strides,dilations),"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+strides+" and dilations '"+dilations+"'");var input4D=$input,dy4D=$dy,reshapedTo4D=!1;3===$input.rank&&(reshapedTo4D=!0,input4D=$input.as4D(1,$input.shape[0],$input.shape[1],$input.shape[2]),dy4D=$dy.as4D(1,$dy.shape[0],$dy.shape[1],$dy.shape[2])),util.assert(4===dy4D.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+dy4D.rank+"."),util.assert(4===input4D.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+input4D.rank+".");var convInfo=conv_util.computePool2DInfo(input4D.shape,filterSize,strides,dilations,pad),res=environment_1.ENV.engine.runKernel(function(backend){return backend.avgPoolBackprop(dy4D,input4D,convInfo)},{dy4D:dy4D,input4D:input4D});return reshapedTo4D?res.as3D(res.shape[1],res.shape[2],res.shape[3]):res}function requiredSpaceToBatchPaddings(inputShape,blockShape,basePadding){var padStart=basePadding.map(function(b){return b[0]}),origPadEnd=basePadding.map(function(b){return b[1]}),fullInputShape=inputShape.concat(padStart,origPadEnd),padEndExtra=blockShape.map(function(b,i){return(b-fullInputShape[i]%b)%b}),padEnd=origPadEnd.map(function(s,i){return s+padEndExtra[i]});return[blockShape.map(function(_,i){return[padStart[i],padEnd[i]]}),blockShape.map(function(_,i){return[0,padEndExtra[i]]})]}function withSpaceToBatchBasePaddings(filterShape,dilation){var dilatedFilterShape=filterShape.map(function(s,i){return s+(s-1)*(dilation[i]-1)}),padExtraShape=dilatedFilterShape.map(function(s){return s-1}),padExtraStart=padExtraShape.map(function(s){return Math.floor(s/2)}),padExtraEnd=padExtraShape.map(function(s,i){return s-padExtraStart[i]});return padExtraShape.map(function(_,i){return[padExtraStart[i],padExtraEnd[i]]})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),array_ops_1=require("./array_ops"),conv_util=require("./conv_util"),operation_1=require("./operation");exports.maxPool=operation_1.op({maxPool_:maxPool_}),exports.avgPool=operation_1.op({avgPool_:avgPool_}),exports.pool=operation_1.op({pool_:pool_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./array_ops":142,"./conv_util":154,"./operation":167}],170:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var seedrandom=require("seedrandom"),MPRandGauss=function(){function MPRandGauss(mean,stdDeviation,dtype,truncated,seed){this.mean=mean,this.stdDev=stdDeviation,this.dtype=dtype,this.nextVal=NaN,this.truncated=truncated,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var seedValue=seed||Math.random();this.random=seedrandom.alea(seedValue.toString())}return MPRandGauss.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var value=this.nextVal;return this.nextVal=NaN,value}for(var resultX,resultY,isValid=!1;!isValid;){var v1=void 0,v2=void 0,s=void 0;do{v1=2*this.random()-1,v2=2*this.random()-1,s=v1*v1+v2*v2}while(s>=1||0===s);var mul=Math.sqrt(-2*Math.log(s)/s);resultX=this.mean+this.stdDev*v1*mul,resultY=this.mean+this.stdDev*v2*mul,this.truncated&&!this.isValidTruncated(resultX)||(isValid=!0)}return this.truncated&&!this.isValidTruncated(resultY)||(this.nextVal=this.convertValue(resultY)),this.convertValue(resultX)},MPRandGauss.prototype.convertValue=function(value){return null==this.dtype||"float32"===this.dtype?value:Math.round(value)},MPRandGauss.prototype.isValidTruncated=function(value){return value<=this.upper&&value>=this.lower},MPRandGauss}();exports.MPRandGauss=MPRandGauss},{seedrandom:286}],171:[function(require,module,exports){"use strict";function computeOptimalWindowSize(inSize){return inSize<=exports.PARALLELIZE_THRESHOLD?inSize:util_1.nearestDivisor(inSize,Math.floor(Math.sqrt(inSize)))}Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");exports.PARALLELIZE_THRESHOLD=30,exports.computeOptimalWindowSize=computeOptimalWindowSize},{"../util":210}],172:[function(require,module,exports){"use strict";function logSumExp_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","logSumExp"),axes=axis_util.parseAxisParam(axis,$x.shape),xMax=$x.max(axes,!0),a=$x.sub(xMax),b=a.exp(),c=b.sum(axes),d=c.log(),res=xMax.reshape(d.shape).add(d);if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,axes);return res.reshape(newShape)}return res}function sum_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","sum");"bool"===$x.dtype&&($x=$x.toInt());var axes=axis_util.parseAxisParam(axis,$x.shape);return globals_1.customGrad(function(x){var permutation=axis_util.getAxesPermutation(axes,x.rank),reductionAxes=axes,permutedX=x;null!=permutation&&(permutedX=x.transpose(permutation),reductionAxes=axis_util.getInnerMostAxes(reductionAxes.length,x.rank));var value=environment_1.ENV.engine.runKernel(function(backend){return backend.sum(permutedX,reductionAxes)},{permutedX:permutedX});if(keepDims){var newShape=axis_util.expandShapeToKeepDim(value.shape,axes);value=value.reshape(newShape)}return{value:value,gradFunc:function(dy){var expandedDyShape=x.shape.slice();return axes.forEach(function(axis){expandedDyShape[axis]=1}),dy.reshape(expandedDyShape).mul(tensor_ops_1.ones(x.shape,"float32"))}}})($x)}function prod_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","prod");"bool"===$x.dtype&&($x=$x.toInt());var axes=axis_util.parseAxisParam(axis,$x.shape),permutation=axis_util.getAxesPermutation(axes,$x.rank),reductionAxes=axes,permutedX=$x;null!=permutation&&(permutedX=$x.transpose(permutation),reductionAxes=axis_util.getInnerMostAxes(reductionAxes.length,$x.rank));var value=environment_1.ENV.engine.runKernel(function(backend){return backend.prod(permutedX,reductionAxes)},{permutedX:permutedX});if(keepDims){var newShape=axis_util.expandShapeToKeepDim(value.shape,axes);value=value.reshape(newShape)}return value}function mean_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","mean"),axes=axis_util.parseAxisParam(axis,$x.shape),shapes=axis_util.computeOutAndReduceShapes($x.shape,axes),reduceShape=shapes[1],reduceSize=util.sizeFromShape(reduceShape);return globals_1.customGrad(function(x){var reduceSizeScalar=tensor_ops_1.scalar(reduceSize);return{value:(reduceSizeScalar.dtype===x.dtype?x:x.cast(reduceSizeScalar.dtype)).div(reduceSizeScalar).sum(axis,keepDims),gradFunc:function(dy){var expandedDyShape=x.shape.slice();return axes.forEach(function(axis){expandedDyShape[axis]=1}),dy.reshape(expandedDyShape).mul(tensor_ops_1.ones(x.shape,"float32")).div(reduceSizeScalar)}}})($x)}function gradForMinAndMax(dy,saved,xOrig,origAxes,permutedAxes){var y=saved[0];return y.rank<xOrig.rank&&(y=y.reshape(axis_util.expandShapeToKeepDim(y.shape,origAxes))),dy.rank<xOrig.rank&&(dy=dy.reshape(axis_util.expandShapeToKeepDim(dy.shape,origAxes))),{$x:function(){var dx=dy.mul(xOrig.equal(y).cast(dy.dtype));return null==permutedAxes?dx:dx.transpose(permutedAxes)}}}function min_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","min"),xOrig=$x,origAxes=axis_util.parseAxisParam(axis,$x.shape),axes=origAxes,permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var grad=function(dy,saved){return gradForMinAndMax(dy,saved,xOrig,origAxes,permutedAxes)},res=environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.min($x,axes))},{$x:$x},grad);if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,origAxes);res=res.reshape(newShape)}return res}function max_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","max"),xOrig=$x,origAxes=axis_util.parseAxisParam(axis,$x.shape),axes=origAxes,permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var grad=function(dy,saved){return gradForMinAndMax(dy,saved,xOrig,origAxes,permutedAxes)},res=environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.max($x,axes))},{$x:$x},grad);if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,origAxes);res=res.reshape(newShape)}return res}function argMin_(x,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","argMin");null==axis&&(axis=0);var axes=axis_util.parseAxisParam(axis,$x.shape),permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike($x)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.argMin($x,axes[0])},{$x:$x},grad)}function argMax_(x,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","argMax");null==axis&&(axis=0);var axes=axis_util.parseAxisParam(axis,$x.shape),permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike($x)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.argMax($x,axes[0])},{$x:$x},grad)}function all_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","all","bool");util.assert("bool"===$x.dtype,"Error Tensor must be of type bool. Got: "+$x.dtype);var origAxes=axis_util.parseAxisParam(axis,$x.shape),axes=origAxes,permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var res=environment_1.ENV.engine.runKernel(function(backend){return backend.all($x,axes)},{$x:$x});if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,origAxes);return res.reshape(newShape)}return res}function any_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1);var $x=tensor_util_env_1.convertToTensor(x,"x","any","bool");util.assert("bool"===$x.dtype,"Error Tensor must be of type bool. Got: "+$x.dtype);var origAxes=axis_util.parseAxisParam(axis,$x.shape),axes=origAxes,permutedAxes=axis_util.getAxesPermutation(axes,$x.rank);null!=permutedAxes&&($x=$x.transpose(permutedAxes),axes=axis_util.getInnerMostAxes(axes.length,$x.rank));var res=environment_1.ENV.engine.runKernel(function(backend){return backend.any($x,axes)},{$x:$x});if(keepDims){var newShape=axis_util.expandShapeToKeepDim(res.shape,origAxes);return res.reshape(newShape)}return res}function moments_(x,axis,keepDims){void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),x=tensor_util_env_1.convertToTensor(x,"x","moments");var axes=axis_util.parseAxisParam(axis,x.shape),mean=x.mean(axes,keepDims),keepDimsShape=mean.shape;return keepDims||(keepDimsShape=axis_util.expandShapeToKeepDim(mean.shape,axes)),{mean:mean,variance:x.toFloat().sub(mean.reshape(keepDimsShape)).square().mean(axes,keepDims)}}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");exports.all=operation_1.op({all_:all_}),exports.any=operation_1.op({any_:any_}),exports.argMax=operation_1.op({argMax_:argMax_}),exports.argMin=operation_1.op({argMin_:argMin_}),exports.logSumExp=operation_1.op({logSumExp_:logSumExp_}),exports.max=operation_1.op({max_:max_}),exports.mean=operation_1.op({mean_:mean_}),exports.min=operation_1.op({min_:min_}),exports.moments=operation_1.op({moments_:moments_}),exports.sum=operation_1.op({sum_:sum_}),exports.prod=operation_1.op({prod_:prod_})},{"../environment":58,"../globals":60,"../tensor_util_env":206,"../util":210,"./axis_util":144,"./operation":167,"./tensor_ops":187}],173:[function(require,module,exports){"use strict";function relu_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","relu");if("bool"===$x.dtype)return $x.toInt();var grad=function(dy){var stepRes=$x.step();return{$x:function(){return dy.mulStrict(stepRes.toFloat())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.relu($x)},{$x:$x},grad)}function elu_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","elu"),grad=function(dy,saved){var y=saved[0];return{$x:function(){return environment_1.ENV.engine.runKernel(function(backend){return backend.eluDer(dy,y)},{dy:dy,y:y})}}};return environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.elu($x))},{$x:$x},grad)}function selu_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","selu"),grad=function(dy){return{$x:function(){var mask=$x.greater(tensor_ops_1.scalar(0)),scaleAlpha=tensor_ops_1.scalar(selu_util_1.SELU_SCALEALPHA),scale=tensor_ops_1.scalar(selu_util_1.SELU_SCALE),greaterThanZeroDer=dy.mul(scale),lessEqualZeroDer=dy.mul(scaleAlpha).mul($x.toFloat().exp());return logical_ops_1.where(mask,greaterThanZeroDer,lessEqualZeroDer)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.selu($x)},{$x:$x},grad)}function leakyRelu_(x,alpha){void 0===alpha&&(alpha=.2);var $x=tensor_util_env_1.convertToTensor(x,"x","leakyRelu");return binary_ops_1.maximum(tensor_ops_1.scalar(alpha).mul($x),$x)}function prelu_(x,alpha){var $x=tensor_util_env_1.convertToTensor(x,"x","prelu"),$alpha=tensor_util_env_1.convertToTensor(alpha,"alpha","prelu"),zero=tensor_ops_1.scalar(0);return binary_ops_1.maximum(zero,$x).add($alpha.mul(binary_ops_1.minimum(zero,$x)))}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),binary_ops_1=require("./binary_ops"),logical_ops_1=require("./logical_ops"),operation_1=require("./operation"),selu_util_1=require("./selu_util"),tensor_ops_1=require("./tensor_ops");exports.elu=operation_1.op({elu_:elu_}),exports.leakyRelu=operation_1.op({leakyRelu_:leakyRelu_}),exports.prelu=operation_1.op({prelu_:prelu_}),exports.relu=operation_1.op({relu_:relu_}),exports.selu=operation_1.op({selu_:selu_})},{"../environment":58,"../tensor_util_env":206,"./binary_ops":146,"./logical_ops":160,"./operation":167,"./selu_util":179,"./tensor_ops":187}],174:[function(require,module,exports){"use strict";function reverse1d_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");return util.assert(1===$x.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+$x.rank+"."),exports.reverse($x,0)}function reverse2d_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");return util.assert(2===$x.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+$x.rank+"."),exports.reverse($x,axis)}function reverse3d_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");return util.assert(3===$x.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+$x.rank+"."),exports.reverse($x,axis)}function reverse4d_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");return util.assert(4===$x.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+$x.rank+"."),exports.reverse($x,axis)}function reverse_(x,axis){var $x=tensor_util_env_1.convertToTensor(x,"x","reverse");if(0===$x.rank)return $x.clone();var axes=axis_util_1.parseAxisParam(axis,$x.shape),grad=function(dy){return{$x:function(){return dy.reverse(axes)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.reverse($x,axes)},{$x:$x},grad).reshapeAs($x)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util_1=require("./axis_util"),operation_1=require("./operation");exports.reverse=operation_1.op({reverse_:reverse_}),exports.reverse1d=operation_1.op({reverse1d_:reverse1d_}),exports.reverse2d=operation_1.op({reverse2d_:reverse2d_}),exports.reverse3d=operation_1.op({reverse3d_:reverse3d_}),
exports.reverse4d=operation_1.op({reverse4d_:reverse4d_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./axis_util":144,"./operation":167}],175:[function(require,module,exports){"use strict";function scatterND_(indices,updates,shape){var $indices=tensor_util_env_1.convertToTensor(indices,"indices","scatterND","int32"),$updates=tensor_util_env_1.convertToTensor(updates,"updates","scatterND");return scatter_nd_util.validateInput($updates,$indices,shape),environment_1.ENV.engine.runKernel(function(backend){return backend.scatterND($indices,$updates,shape)},{$indices:$indices,$updates:$updates})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation"),scatter_nd_util=require("./scatter_nd_util");exports.scatterND=operation_1.op({scatterND_:scatterND_})},{"../environment":58,"../tensor_util_env":206,"./operation":167,"./scatter_nd_util":176}],176:[function(require,module,exports){"use strict";function validateUpdateShape(shape,indices,updates){var sliceDim=indices.rank>1?indices.shape[indices.rank-1]:1,batchDim=indices.rank>1?indices.rank-1:1,shapeError="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+updates.shape+", indices.shape: "+indices.shape+", shape: "+shape+", sliceDim: "+sliceDim+", and batchDim: "+batchDim+".";if(updates.rank<batchDim)throw new Error(shapeError+" update.rank < "+batchDim+". ");if(shape.length<sliceDim+(updates.rank-batchDim))throw new Error(shapeError+" Output shape length < "+(sliceDim+(updates.rank-batchDim)));if(updates.rank!==batchDim+shape.length-sliceDim)throw new Error(shapeError+" update.rank != "+(batchDim+shape.length-sliceDim));for(var d=0;d<batchDim;++d)if(updates.shape[d]!==indices.shape[d])throw new Error(shapeError+" updates.shape["+d+"] ("+updates.shape[d]+") != indices.shape["+d+"] ("+indices.shape[d]+").");for(var d=0;d<updates.rank-batchDim;++d)if(updates.shape[d+batchDim]!==shape[d+sliceDim])throw new Error(shapeError+" updates.shape["+(d+batchDim)+"] ("+updates.shape[d+batchDim]+") != shape["+(d+batchDim)+"] ("+shape[d+batchDim]+")")}function validateInput(updates,indices,shape){if(indices.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+indices.rank+".");if(updates.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+updates.rank+".");if("int32"!==indices.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+indices.dtype);if(shape.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+shape);if(0===shape.length){if(0===indices.size)throw new Error("Indices specified for empty output. indices shape: "+indices.shape);if(0===updates.size)throw new Error("Updates specified for empty output. updates shape: "+updates.shape)}validateUpdateShape(shape,indices,updates)}function calculateShapes(updates,indices,shape){for(var sliceRank=indices.rank>1?indices.shape[indices.rank-1]:1,totalNd=shape.length,sliceSize=1,i=sliceRank;i<totalNd;++i)sliceSize*=shape[i];var safeSliceDim=sliceRank<1?1:sliceRank,numUpdates=indices.size/safeSliceDim,outputStrides=util_1.computeStrides(shape).concat([1]);return{sliceRank:sliceRank,numUpdates:numUpdates,sliceSize:sliceSize,strides:outputStrides.slice(outputStrides.length-sliceRank,outputStrides.length),outputSize:util_1.sizeFromShape(shape)}}Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util");exports.validateUpdateShape=validateUpdateShape,exports.validateInput=validateInput,exports.calculateShapes=calculateShapes},{"../util":210}],177:[function(require,module,exports){"use strict";function unsortedSegmentSum_(x,segmentIds,numSegments){var $x=tensor_util_env_1.convertToTensor(x,"x","unsortedSegmentSum"),$segmentIds=tensor_util_env_1.convertToTensor(segmentIds,"segmentIds","unsortedSegmentSum","int32");util_1.assert("int32"===$segmentIds.dtype,"segmentIds must be of dtype `int32`"),util_1.assert(util_1.isInt(numSegments),"numSegments must be of dtype int");var gradFunc=function(dy){return{$x:function(){return gatherDropNegatives(dy,$segmentIds)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.unsortedSegmentSum($x,$segmentIds,numSegments)},{$x:$x},gradFunc)}function gather_(x,indices,axis){void 0===axis&&(axis=0);var $x=tensor_util_env_1.convertToTensor(x,"x","gather"),$indices=tensor_util_env_1.convertToTensor(indices,"indices","gather","int32");util_1.assert("int32"===$indices.dtype,"Indices must be of dtype `int32`"),axis=axis_util_1.parseAxisParam(axis,$x.shape)[0];var grad=function(dy){return{$x:function(){if(0===axis)return exports.unsortedSegmentSum(dy,$indices,$x.shape[axis]);var paramsShape=$x.shape,indicesSize=$indices.size,outerShape=paramsShape.slice(0,axis),outerDims=outerShape.length,innerShape=paramsShape.slice(axis,paramsShape.length).slice(1),innerDims=innerShape.length,outerAxesIndices=arrayRange(0,outerDims),innerAxesIndices=arrayRange(outerDims+1,outerDims+1+innerDims),valuesShape=arrayConcat([outerShape,[indicesSize],innerShape]),values=dy.reshape(valuesShape),reshapedIndices=$indices.reshape([indicesSize]),transposeDims=arrayConcat([[outerDims],outerAxesIndices,innerAxesIndices]),valuesTranspose=values.transpose(transposeDims),paramsGrad=exports.unsortedSegmentSum(valuesTranspose,reshapedIndices,$x.shape[axis]),invertTransposeDims=axis_util_1.getUndoAxesPermutation(transposeDims);return paramsGrad=paramsGrad.transpose(invertTransposeDims)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.gather($x,$indices,axis)},{$x:$x},grad)}function arrayRange(start,stop){for(var result=[],i=start;i<stop;++i)result.push(i);return result}function arrayConcat(arrays){for(var result=[],i=0;i<arrays.length;++i)for(var j=0;j<arrays[i].length;++j)result.push(arrays[i][j]);return result}function gatherDropNegatives(x,indices){for(var zeroClippedIndices=binary_ops_1.maximum(indices,tensor_ops_1.zerosLike(indices)),gathered=exports.gather(x,zeroClippedIndices),isPositive=compare_1.greaterEqual(indices,tensor_ops_1.scalar(0,"int32")),numIters=gathered.rank-isPositive.rank,i=0;i<numIters;++i)isPositive=array_ops_1.expandDims(isPositive,i+1);isPositive=logical_ops_1.logicalAnd(isPositive,tensor_ops_1.ones(gathered.shape,"bool"));var zeroSlice=tensor_ops_1.zerosLike(gathered);return logical_ops_1.where(isPositive,gathered,zeroSlice)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util_1=require("../util"),array_ops_1=require("./array_ops"),axis_util_1=require("./axis_util"),binary_ops_1=require("./binary_ops"),compare_1=require("./compare"),logical_ops_1=require("./logical_ops"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");exports.gather=operation_1.op({gather_:gather_}),exports.unsortedSegmentSum=operation_1.op({unsortedSegmentSum_:unsortedSegmentSum_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./array_ops":142,"./axis_util":144,"./binary_ops":146,"./compare":148,"./logical_ops":160,"./operation":167,"./tensor_ops":187}],178:[function(require,module,exports){"use strict";function segOpComputeOptimalWindowSize(inSize,numSegments){var res,done=!1;for(inSize<=reduce_util_1.PARALLELIZE_THRESHOLD?(res=inSize,done=!0):res=util_1.nearestDivisor(inSize,Math.floor(Math.sqrt(inSize)));!done;){if(res>numSegments||res===inSize){done=!0;break}res=util_1.nearestDivisor(inSize,res+1)}return res}function computeOutShape(aShape,axis,numSegments){for(var outShape=[],rank=aShape.length,dim=0;dim<rank;dim++)dim!==axis?outShape.push(aShape[dim]):outShape.push(numSegments);return outShape}Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("../util"),reduce_util_1=require("./reduce_util");exports.segOpComputeOptimalWindowSize=segOpComputeOptimalWindowSize,exports.computeOutShape=computeOutShape},{"../util":210,"./reduce_util":171}],179:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SELU_SCALEALPHA=1.7580993408473768,exports.SELU_SCALE=1.0507009873554805},{}],180:[function(require,module,exports){"use strict";function slice1d_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice1d");return util.assert(1===$x.rank,"slice1d expects a rank-1 tensor, but got a rank-"+$x.rank+" tensor"),exports.slice($x,[begin],[size])}function slice2d_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice2d");return util.assert(2===$x.rank,"slice2d expects a rank-2 tensor, but got a rank-"+$x.rank+" tensor"),exports.slice($x,begin,size)}function slice3d_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice3d");return util.assert(3===$x.rank,"slice3d expects a rank-3 tensor, but got a rank-"+$x.rank+" tensor"),exports.slice($x,begin,size)}function slice4d_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice4d");return util.assert(4===$x.rank,"slice4d expects a rank-4 tensor, but got a rank-"+$x.rank+" tensor"),exports.slice($x,begin,size)}function slice_(x,begin,size){var $x=tensor_util_env_1.convertToTensor(x,"x","slice");if(0===$x.rank)throw new Error("Slicing scalar is not possible");var begin_;begin_="number"==typeof begin?[begin].concat(new Array($x.rank-1).fill(0)):begin.length<$x.rank?begin.concat(new Array($x.rank-begin.length).fill(0)):begin.slice();var size_;size_=null==size?new Array($x.rank).fill(-1):"number"==typeof size?[size].concat(new Array($x.rank-1).fill(-1)):size.length<$x.rank?size.concat(new Array($x.rank-size.length).fill(-1)):size,size_=size_.map(function(d,i){return d>=0?d:(util.assert(-1===d,"Bad value in size"),$x.shape[i]-begin_[i])}),slice_util.assertParamsValid($x,begin_,size_);var inputShape=$x.shape,grad=function(dy){for(var paddings=[],i=0;i<dy.rank;i++)paddings.push([begin_[i],inputShape[i]-begin_[i]-size_[i]]);return{$x:function(){return dy.pad(paddings)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.slice($x,begin_,size_)},{$x:$x},grad)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation"),slice_util=require("./slice_util");exports.slice=operation_1.op({slice_:slice_}),exports.slice1d=operation_1.op({slice1d_:slice1d_}),exports.slice2d=operation_1.op({slice2d_:slice2d_}),exports.slice3d=operation_1.op({slice3d_:slice3d_}),exports.slice4d=operation_1.op({slice4d_:slice4d_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./operation":167,"./slice_util":181}],181:[function(require,module,exports){"use strict";function assertParamsValid(input,begin,size){util.assert(input.rank===begin.length,"Error in slice"+input.rank+"D: Length of begin "+begin+" must match the rank of the array ("+input.rank+")."),util.assert(input.rank===size.length,"Error in slice"+input.rank+"D: Length of size "+size+" must match the rank of the array ("+input.rank+").");for(var i=0;i<input.rank;++i)util.assert(begin[i]+size[i]<=input.shape[i],"Error in slice"+input.rank+"D: begin["+i+"] + size["+i+"] ("+(begin[i]+size[i])+") would overflow input.shape["+i+"] ("+input.shape[i]+")")}function getStridedSlicedInfo(shape,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){if(void 0===beginMask&&(beginMask=0),void 0===endMask&&(endMask=0),void 0===ellipsisMask&&(ellipsisMask=0),void 0===newAxisMask&&(newAxisMask=0),void 0===shrinkAxisMask&&(shrinkAxisMask=0),0!==ellipsisMask)throw new Error("ellipsis mask is not yet supported");if(0!==newAxisMask)throw new Error("new axis mask is not yet supported");for(var startIndex=[],endIndex=[],shrinkAxis=[],i=0;i<shape.length;i++)startIndex[i]=startForAxis(beginMask,begin,strides,shape,i),endIndex[i]=stopForAxis(endMask,end,strides,shape,i),shrinkAxisMask&1<<i&&(endIndex[i]=startIndex[i]+1,shrinkAxis.push(i));var size=new Array(shape.length).fill(0);return size=size.map(function(d,i){for(var count=0,start=startIndex[i];!(strides[i]>0?start>=endIndex[i]:start<=endIndex[i]);start+=strides[i])count+=1;return count}),[startIndex,size,shrinkAxis]}function startForAxis(beginMask,startIndices,strides,inputShape,axis){var start=startIndices[axis];beginMask&1<<axis&&(start=strides[axis]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var axisSize=inputShape[axis];return start<0&&(start+=axisSize),start=util.clamp(0,start,axisSize-1)}function stopForAxis(endMask,stopIndices,strides,inputShape,axis){var stop=stopIndices[axis];endMask&1<<axis&&(stop=strides[axis]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var axisSize=inputShape[axis];return stop<0&&(stop+=axisSize),stop=strides[axis]>0?util.clamp(0,stop,axisSize):util.clamp(-1,stop,axisSize-1)}Object.defineProperty(exports,"__esModule",{value:!0});var util=require("../util");exports.assertParamsValid=assertParamsValid,exports.getStridedSlicedInfo=getStridedSlicedInfo,exports.startForAxis=startForAxis,exports.stopForAxis=stopForAxis},{"../util":210}],182:[function(require,module,exports){"use strict";function softmax_(logits,dim){void 0===dim&&(dim=-1);var $logits=tensor_util_env_1.convertToTensor(logits,"logits","softmax");if(-1===dim&&(dim=$logits.rank-1),dim!==$logits.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+$logits.rank+" and dim was "+dim);return gradients_1.customGrad(function(logits){var lse=logits.logSumExp([dim],!0),logResult=logits.toFloat().sub(lse),y=logResult.exp();return{value:y,gradFunc:function(dy){var dyTimesY=dy.mul(y);return dyTimesY.sub(dyTimesY.sum([dim],!0).mul(y))}}})($logits)}function logSoftmax_(logits,axis){void 0===axis&&(axis=-1);var $logits=tensor_util_env_1.convertToTensor(logits,"logits","logSoftmax");if(-1===axis&&(axis=$logits.rank-1),axis!==$logits.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+$logits.rank+" and axis was "+axis);return gradients_1.customGrad(function(logits){var xMax=logits.max(axis,!0),shifted=logits.sub(xMax),value=shifted.toFloat().sub(shifted.exp().sum(axis,!0).log());return{value:value,gradFunc:function(dy){var softmax=value.exp();return dy.sub(dy.sum(axis,!0).mul(softmax))}}})($logits)}Object.defineProperty(exports,"__esModule",{value:!0});var gradients_1=require("../gradients"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");exports.softmax=operation_1.op({softmax_:softmax_}),exports.logSoftmax=operation_1.op({logSoftmax_:logSoftmax_})},{"../gradients":61,"../tensor_util_env":206,"./operation":167}],183:[function(require,module,exports){"use strict";function sparseToDense_(sparseIndices,sparseValues,outputShape,defaultValue){var $sparseIndices=tensor_util_env_1.convertToTensor(sparseIndices,"sparseIndices","sparseToDense","int32"),$sparseValues=tensor_util_env_1.convertToTensor(sparseValues,"sparseValues","sparseToDense"),$defaultValue=tensor_util_env_1.convertToTensor(defaultValue,"defaultValue","sparseToDense",$sparseValues.dtype);return sparse_to_dense.validateInput($sparseIndices,$sparseValues,outputShape,$defaultValue),environment_1.ENV.engine.runKernel(function(backend){return backend.sparseToDense($sparseIndices,$sparseValues,outputShape,$defaultValue)},{$sparseIndices:$sparseIndices,$sparseValues:$sparseValues,$defaultValue:$defaultValue})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),sparse_to_dense=require("../ops/sparse_to_dense_util"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");exports.sparseToDense=operation_1.op({sparseToDense_:sparseToDense_})},{"../environment":58,"../ops/sparse_to_dense_util":184,"../tensor_util_env":206,"./operation":167}],184:[function(require,module,exports){"use strict";function validateInput(sparseIndices,sparseValues,outputShape,defaultValues){if("int32"!==sparseIndices.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+sparseIndices.dtype+".");if(sparseIndices.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+sparseIndices.shape+".");var numElems=sparseIndices.rank>0?sparseIndices.shape[0]:1,numDims=sparseIndices.rank>1?sparseIndices.shape[1]:1;if(outputShape.length!==numDims)throw new Error("outputShape has incorrect number of elements:, "+outputShape.length+", should be: "+numDims+".");var numValues=sparseValues.size;if(0!==sparseValues.rank&&(1!==sparseValues.rank||numValues!==numElems))throw new Error("sparseValues has incorrect shape "+sparseValues.shape+", should be [] or ["+numElems+"]");if(sparseValues.dtype!==defaultValues.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateInput=validateInput},{}],185:[function(require,module,exports){"use strict";function fft_(input){util_1.assert("complex64"===input.dtype,"The dtype for tf.spectral.fft() must be complex64 but got "+input.dtype+".");var innerDimensionSize=input.shape[input.shape.length-1],batch=input.size/innerDimensionSize,input2D=input.as2D(batch,innerDimensionSize);return environment_1.ENV.engine.runKernel(function(backend){return backend.fft(input2D)},{input:input}).reshape(input.shape)}function ifft_(input){util_1.assert("complex64"===input.dtype,"The dtype for tf.spectral.ifft() must be complex64 but got "+input.dtype+".");var innerDimensionSize=input.shape[input.shape.length-1],batch=input.size/innerDimensionSize,input2D=input.as2D(batch,innerDimensionSize);return environment_1.ENV.engine.runKernel(function(backend){return backend.ifft(input2D)},{input:input}).reshape(input.shape)}function rfft_(input){util_1.assert("float32"===input.dtype,"The dtype for rfft() must be real value but\n    got "+input.dtype);var innerDimensionSize=input.shape[input.shape.length-1],batch=input.size/innerDimensionSize,zeros=input.zerosLike(),complexInput=complex_ops_1.complex(input,zeros).as2D(batch,innerDimensionSize),ret=environment_1.ENV.engine.runKernel(function(backend){return backend.fft(complexInput)},{complexInput:complexInput}),half=Math.floor(innerDimensionSize/2)+1,realValues=complex_ops_1.real(ret),imagValues=complex_ops_1.imag(ret),realComplexConjugate=realValues.split([half,innerDimensionSize-half],realValues.shape.length-1),imagComplexConjugate=imagValues.split([half,innerDimensionSize-half],imagValues.shape.length-1),outputShape=input.shape.slice();return outputShape[input.shape.length-1]=half,complex_ops_1.complex(realComplexConjugate[0],imagComplexConjugate[0]).reshape(outputShape)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),complex_ops_1=require("../ops/complex_ops"),operation_1=require("../ops/operation"),util_1=require("../util");exports.fft=operation_1.op({fft_:fft_}),exports.ifft=operation_1.op({ifft_:ifft_}),exports.rfft=operation_1.op({rfft_:rfft_})},{"../environment":58,"../ops/complex_ops":149,"../ops/operation":167,"../util":210}],186:[function(require,module,exports){"use strict";function stridedSlice_(x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask){if(void 0===beginMask&&(beginMask=0),void 0===endMask&&(endMask=0),void 0===ellipsisMask&&(ellipsisMask=0),void 0===newAxisMask&&(newAxisMask=0),void 0===shrinkAxisMask&&(shrinkAxisMask=0),0!==ellipsisMask)throw new Error("ellipsis mask is not yet supported");if(0!==newAxisMask)throw new Error("new axis mask is not yet supported");var $x=tensor_util_env_1.convertToTensor(x,"x","stridedSlice");return environment_1.ENV.engine.runKernel(function(backend){return backend.stridedSlice($x,begin,end,strides,beginMask,endMask,ellipsisMask,newAxisMask,shrinkAxisMask)},{$x:$x})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");exports.stridedSlice=operation_1.op({stridedSlice_:stridedSlice_})},{"../environment":58,"../tensor_util_env":206,"./operation":167}],187:[function(require,module,exports){"use strict";function tensor(values,shape,dtype){if(void 0===dtype&&(dtype="float32"),"complex64"===dtype)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!util_1.isTypedArray(values)&&!Array.isArray(values)&&"number"!=typeof values&&"boolean"!=typeof values)throw new Error("values passed to tensor(values) must be an array of numbers or booleans, or a TypedArray");var inferredShape=tensor_util_env_2.inferShape(values);return null!=shape&&1!==inferredShape.length&&util_1.assertShapesMatch(shape,inferredShape,"Error creating a new Tensor. Inferred shape ("+inferredShape+") does not match the provided shape ("+shape+"). "),util_1.isTypedArray(values)||Array.isArray(values)||(values=[values]),shape=shape||inferredShape,tensor_1.Tensor.make(shape,{values:util_1.toTypedArray(values,dtype,environment_1.ENV.get("DEBUG"))},dtype)}function scalar(value,dtype){if(void 0===dtype&&(dtype="float32"),(util_1.isTypedArray(value)||Array.isArray(value))&&"complex64"!==dtype)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean)");return tensor(value,[],dtype)}function tensor1d(values,dtype){void 0===dtype&&(dtype="float32"),util_1.assertNonNull(values);var inferredShape=tensor_util_env_2.inferShape(values);if(1!==inferredShape.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return tensor(values,inferredShape,dtype)}function tensor2d(values,shape,dtype){if(void 0===dtype&&(dtype="float32"),util_1.assertNonNull(values),null!=shape&&2!==shape.length)throw new Error("tensor2d() requires shape to have two numbers");var inferredShape=tensor_util_env_2.inferShape(values);if(2!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return shape=shape||inferredShape,tensor(values,shape,dtype)}function tensor3d(values,shape,dtype){if(void 0===dtype&&(dtype="float32"),util_1.assertNonNull(values),null!=shape&&3!==shape.length)throw new Error("tensor3d() requires shape to have three numbers");var inferredShape=tensor_util_env_2.inferShape(values);if(3!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return shape=shape||inferredShape,tensor(values,shape,dtype)}function tensor4d(values,shape,dtype){if(void 0===dtype&&(dtype="float32"),util_1.assertNonNull(values),null!=shape&&4!==shape.length)throw new Error("tensor4d() requires shape to have four numbers");var inferredShape=tensor_util_env_2.inferShape(values);if(4!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return shape=shape||inferredShape,tensor(values,shape,dtype)}function tensor5d(values,shape,dtype){if(void 0===dtype&&(dtype="float32"),util_1.assertNonNull(values),null!=shape&&5!==shape.length)throw new Error("tensor5d() requires shape to have five numbers");var inferredShape=tensor_util_env_2.inferShape(values);if(5!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return shape=shape||inferredShape,tensor(values,shape,dtype)}function tensor6d(values,shape,dtype){if(void 0===dtype&&(dtype="float32"),util_1.assertNonNull(values),null!=shape&&6!==shape.length)throw new Error("tensor6d() requires shape to have six numbers");var inferredShape=tensor_util_env_2.inferShape(values);if(6!==inferredShape.length&&1!==inferredShape.length)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(1===inferredShape.length&&null==shape)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return shape=shape||inferredShape,tensor(values,shape,dtype)}function ones(shape,dtype){if(void 0===dtype&&(dtype="float32"),"complex64"===dtype){var real=ones(shape,"float32"),imag=ones(shape,"float32");return complex_ops_1.complex(real,imag)}var values=util_1.makeOnesTypedArray(util_1.sizeFromShape(shape),dtype);return tensor_1.Tensor.make(shape,{values:values},dtype)}function zeros(shape,dtype){if(void 0===dtype&&(dtype="float32"),"complex64"===dtype){var real=zeros(shape,"float32"),imag=zeros(shape,"float32");return complex_ops_1.complex(real,imag)}var values=util_1.makeZerosTypedArray(util_1.sizeFromShape(shape),dtype);return tensor_1.Tensor.make(shape,{values:values},dtype)}function fill(shape,value,dtype){void 0===dtype&&(dtype="float32");var values=util_1.getTypedArrayFromDType(dtype,util_1.sizeFromShape(shape));return values.fill(value),tensor_1.Tensor.make(shape,{values:values},dtype)}function onesLike_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","onesLike");return ones($x.shape,$x.dtype)}function zerosLike_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","zerosLike");return zeros($x.shape,$x.dtype)}function linspace(start,stop,num){if(0===num)throw new Error("Cannot request zero samples");var step=(stop-start)/(num-1),values=util_1.makeZerosTypedArray(num,"float32");values[0]=start;for(var i=1;i<values.length;i++)values[i]=values[i-1]+step;return tensor1d(values,"float32")}function range(start,stop,step,dtype){if(void 0===step&&(step=1),void 0===dtype&&(dtype="float32"),0===step)throw new Error("Cannot have a step of zero");var sameStartStop=start===stop,increasingRangeNegativeStep=start<stop&&step<0,decreasingRangePositiveStep=stop<start&&step>1;if(sameStartStop||increasingRangeNegativeStep||decreasingRangePositiveStep)return zeros([0],dtype);var numElements=Math.abs(Math.ceil((stop-start)/step)),values=util_1.makeZerosTypedArray(numElements,dtype);stop<start&&1===step&&(step=-1),values[0]=start;for(var i=1;i<values.length;i++)values[i]=values[i-1]+step;return tensor1d(values,dtype)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_1=require("../tensor"),tensor_util_env_1=require("../tensor_util_env"),tensor_util_env_2=require("../tensor_util_env"),util_1=require("../util"),complex_ops_1=require("./complex_ops"),operation_1=require("./operation");exports.tensor=tensor,exports.scalar=scalar,exports.tensor1d=tensor1d,exports.tensor2d=tensor2d,exports.tensor3d=tensor3d,exports.tensor4d=tensor4d,exports.tensor5d=tensor5d,exports.tensor6d=tensor6d,exports.ones=ones,exports.zeros=zeros,exports.fill=fill,exports.linspace=linspace,exports.range=range,exports.onesLike=operation_1.op({onesLike_:onesLike_}),exports.zerosLike=operation_1.op({zerosLike_:zerosLike_})},{"../environment":58,"../tensor":203,"../tensor_util_env":206,"../util":210,"./complex_ops":149,"./operation":167}],188:[function(require,module,exports){"use strict";function topk_(x,k,sorted){void 0===k&&(k=1),void 0===sorted&&(sorted=!0);var $x=tensor_util_env_1.convertToTensor(x,"x","topk");if(0===$x.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var lastDim=$x.shape[$x.shape.length-1];if(k>lastDim)throw new Error("'k' passed to topk() must be <= the last dimension ("+lastDim+") but got "+k);var _a=environment_1.ENV.engine.runKernel(function(b){return b.topk($x,k,sorted)},{$x:$x});return{values:_a[0],indices:_a[1]}}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),operation_1=require("./operation");exports.topk=operation_1.op({topk_:topk_})},{"../environment":58,"../tensor_util_env":206,"./operation":167}],189:[function(require,module,exports){"use strict";function transpose_(x,perm){var $x=tensor_util_env_1.convertToTensor(x,"x","transpose");if(null==perm&&(perm=$x.shape.map(function(s,i){return i}).reverse()),util.assert($x.rank===perm.length,"Error in transpose: rank of input "+$x.rank+" must match length of perm "+perm+"."),perm.forEach(function(axis){util.assert(axis>=0&&axis<$x.rank,"All entries in 'perm' must be between 0 and "+($x.rank-1)+" but got "+perm)}),$x.rank<=1)return $x.clone();var der=function(dy){var undoPerm=axis_util.getUndoAxesPermutation(perm);return{$x:function(){return dy.transpose(undoPerm)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.transpose($x,perm)},{$x:$x},der)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),axis_util=require("./axis_util"),operation_1=require("./operation");exports.transpose=operation_1.op({transpose_:transpose_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./axis_util":144,"./operation":167}],190:[function(require,module,exports){"use strict";function neg_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","neg"),grad=function(dy){return{$x:function(){return dy.neg()}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.neg($x)},{$x:$x},grad)}function ceil_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","ceil"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.ceil($x)},{$x:$x},grad)}function floor_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","floor"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.floor($x)},{$x:$x},grad)}function sign_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sign"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.sign($x)},{$x:$x},grad)}function round_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","round"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.round($x)},{$x:$x},grad)}function exp_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","exp"),bck=function(dy,saved){var y=saved[0];return{$x:function(){return dy.mulStrict(y)}}};return environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.exp($x))},{$x:$x},bck)}function expm1_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","expm1"),grad=function(dy){return{$x:function(){return dy.mulStrict($x.exp())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.expm1($x)},{$x:$x},grad)}function log_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","log"),grad=function(dy){return{$x:function(){return dy.divStrict($x.toFloat())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.log($x)},{$x:$x},grad)}function log1p_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","log1p"),grad=function(dy){return{$x:function(){return dy.divStrict($x.add(tensor_ops_1.scalar(1)))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.log1p($x)},{$x:$x},grad)}function sqrt_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sqrt"),grad=function(dy){return{$x:function(){
return dy.divStrict($x.toFloat().sqrt().mul(tensor_ops_1.scalar(2)))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.sqrt($x)},{$x:$x},grad)}function rsqrt_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","rsqrt"),grad=function(dy){return{$x:function(){return dy.divStrict($x.pow(tensor_ops_1.scalar(1.5)).mul(tensor_ops_1.scalar(2))).neg()}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.rsqrt($x)},{$x:$x},grad)}function square_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","square"),grad=function(dy){return{$x:function(){return dy.mulStrict($x.toFloat().mul(tensor_ops_1.scalar(2)))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.square($x)},{$x:$x},grad)}function reciprocal_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","reciprocal"),grad=function(dy){return{$x:function(){return dy.divStrict($x.square().neg())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.reciprocal($x)},{$x:$x},grad)}function abs_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","abs");if("complex64"===$x.dtype)return environment_1.ENV.engine.runKernel(function(backend){return backend.complexAbs($x)},{$x:$x});var grad=function(dy){return{$x:function(){return dy.mulStrict($x.toFloat().step(-1))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.abs($x)},{$x:$x},grad)}function clipByValue_(x,clipValueMin,clipValueMax){var $x=tensor_util_env_1.convertToTensor(x,"x","clipByValue");util.assert(clipValueMin<=clipValueMax,"Error in clip: min ("+clipValueMin+") must be less than or equal to max ("+clipValueMax+").");var grad=function(dy){return{$x:function(){return dy.where($x.greaterEqual(tensor_ops_1.scalar(clipValueMin)).logicalAnd($x.lessEqual(tensor_ops_1.scalar(clipValueMax))),tensor_ops_1.zerosLike(dy))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.clip($x,clipValueMin,clipValueMax)},{$x:$x},grad)}function sigmoid_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sigmoid"),grad=function(dy,saved){var y=saved[0];return{$x:function(){return dy.mulStrict(y.mul(tensor_ops_1.scalar(1).sub(y)))}}};return environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.sigmoid($x))},{$x:$x},grad)}function logSigmoid_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","logSigmoid"),grad=function(dy){return{$x:function(){return dy.mulStrict($x.neg().sigmoid())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.softplus($x.neg()).neg()},{$x:$x},grad)}function softplus_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","softplus"),grad=function(dy){return{$x:function(){return dy.mulStrict($x.sigmoid())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.softplus($x)},{$x:$x},grad)}function sin_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sin"),grad=function(dy){return{$x:function(){return $x.toFloat().cos().mulStrict(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.sin($x)},{$x:$x},grad)}function cos_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","cos"),grad=function(dy){return{$x:function(){return $x.toFloat().sin().neg().mulStrict(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.cos($x)},{$x:$x},grad)}function tan_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","tan"),grad=function(dy){return{$x:function(){return dy.divStrict($x.cos().square())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.tan($x)},{$x:$x},grad)}function asin_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","asin"),grad=function(dy){return{$x:function(){return dy.divStrict(tensor_ops_1.scalar(1).sub($x.toFloat().square()).sqrt())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.asin($x)},{$x:$x},grad)}function acos_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","acos"),grad=function(dy){return{$x:function(){return dy.divStrict(tensor_ops_1.scalar(1).sub($x.toFloat().square()).sqrt()).neg()}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.acos($x)},{$x:$x},grad)}function atan_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","atan"),grad=function(dy){return{$x:function(){return dy.divStrict(tensor_ops_1.scalar(1).add($x.toFloat().square()))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.atan($x)},{$x:$x},grad)}function sinh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","sinh"),grad=function(dy){return{$x:function(){return $x.toFloat().cosh().mulStrict(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.sinh($x)},{$x:$x},grad)}function cosh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","cosh"),grad=function(dy){return{$x:function(){return $x.toFloat().sinh().mulStrict(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.cosh($x)},{$x:$x},grad)}function tanh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","tanh"),grad=function(dy,saved){var y=saved[0];return{$x:function(){return tensor_ops_1.scalar(1).sub(y.square()).mulStrict(dy)}}};return environment_1.ENV.engine.runKernel(function(backend,save){return save(backend.tanh($x))},{$x:$x},grad)}function asinh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","asinh"),grad=function(dy){return{$x:function(){return dy.divStrict(tensor_ops_1.scalar(1).add($x.toFloat().square()).sqrt())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.asinh($x)},{$x:$x},grad)}function acosh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","acosh"),grad=function(dy){return{$x:function(){return dy.divStrict($x.toFloat().square().sub(tensor_ops_1.scalar(1)).sqrt())}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.acosh($x)},{$x:$x},grad)}function atanh_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","atanh"),grad=function(dy){return{$x:function(){return dy.divStrict(tensor_ops_1.scalar(1).sub($x.toFloat().square()))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.atanh($x)},{$x:$x},grad)}function erf_(x){var $x=tensor_util_env_1.convertToTensor(x,"x","erf");util.assert("int32"===$x.dtype||"float32"===$x.dtype,"Input dtype must be `int32` or `float32`."),"int32"===$x.dtype&&($x=$x.toFloat());var grad=function(dy){return{$x:function(){return dy.mulStrict(tensor_ops_1.scalar(2/Math.sqrt(Math.PI)).mul($x.square().neg().exp()))}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.erf($x)},{$x:$x},grad)}function step_(x,alpha){void 0===alpha&&(alpha=0);var $x=tensor_util_env_1.convertToTensor(x,"x","step"),grad=function(dy){return{$x:function(){return tensor_ops_1.zerosLike(dy)}}};return environment_1.ENV.engine.runKernel(function(backend){return backend.step($x,alpha)},{$x:$x},grad)}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),tensor_util_env_1=require("../tensor_util_env"),util=require("../util"),operation_1=require("./operation"),tensor_ops_1=require("./tensor_ops");exports.abs=operation_1.op({abs_:abs_}),exports.acos=operation_1.op({acos_:acos_}),exports.acosh=operation_1.op({acosh_:acosh_}),exports.asin=operation_1.op({asin_:asin_}),exports.asinh=operation_1.op({asinh_:asinh_}),exports.atan=operation_1.op({atan_:atan_}),exports.atanh=operation_1.op({atanh_:atanh_}),exports.ceil=operation_1.op({ceil_:ceil_}),exports.clipByValue=operation_1.op({clipByValue_:clipByValue_}),exports.cos=operation_1.op({cos_:cos_}),exports.cosh=operation_1.op({cosh_:cosh_}),exports.erf=operation_1.op({erf_:erf_}),exports.exp=operation_1.op({exp_:exp_}),exports.expm1=operation_1.op({expm1_:expm1_}),exports.floor=operation_1.op({floor_:floor_}),exports.log=operation_1.op({log_:log_}),exports.log1p=operation_1.op({log1p_:log1p_}),exports.logSigmoid=operation_1.op({logSigmoid_:logSigmoid_}),exports.neg=operation_1.op({neg_:neg_}),exports.reciprocal=operation_1.op({reciprocal_:reciprocal_}),exports.round=operation_1.op({round_:round_}),exports.rsqrt=operation_1.op({rsqrt_:rsqrt_}),exports.sigmoid=operation_1.op({sigmoid_:sigmoid_}),exports.sign=operation_1.op({sign_:sign_}),exports.sin=operation_1.op({sin_:sin_}),exports.sinh=operation_1.op({sinh_:sinh_}),exports.softplus=operation_1.op({softplus_:softplus_}),exports.sqrt=operation_1.op({sqrt_:sqrt_}),exports.square=operation_1.op({square_:square_}),exports.step=operation_1.op({step_:step_}),exports.tan=operation_1.op({tan_:tan_}),exports.tanh=operation_1.op({tanh_:tanh_})},{"../environment":58,"../tensor_util_env":206,"../util":210,"./operation":167,"./tensor_ops":187}],191:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),AdadeltaOptimizer=function(_super){function AdadeltaOptimizer(learningRate,rho,epsilon){void 0===epsilon&&(epsilon=null);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.rho=rho,_this.epsilon=epsilon,_this.accumulatedGrads={},_this.accumulatedUpdates={},_this.c=globals_1.keep(ops_1.scalar(-learningRate)),_this.rhoScalar=globals_1.keep(ops_1.scalar(rho)),_this.oneMinusRho=globals_1.keep(ops_1.scalar(1-rho)),null===epsilon&&(epsilon=environment_1.ENV.get("EPSILON")),_this.epsilonScalar=globals_1.keep(ops_1.scalar(epsilon)),_this}return __extends(AdadeltaOptimizer,_super),AdadeltaOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,this_1=this;for(var variableName in variableGradients)!function(variableName){var value=environment_1.ENV.engine.registeredVariables[variableName];if(null==this_1.accumulatedGrads[variableName]){globals_1.tidy(function(){_this.accumulatedGrads[variableName]=ops_1.zerosLike(value).variable(!1)})}if(null==this_1.accumulatedUpdates[variableName]){globals_1.tidy(function(){_this.accumulatedUpdates[variableName]=ops_1.zerosLike(value).variable(!1)})}var gradient=variableGradients[variableName],accumulatedGrad=this_1.accumulatedGrads[variableName],accumulatedUpdate=this_1.accumulatedUpdates[variableName];globals_1.tidy(function(){var newAccumulatedGrad=_this.rhoScalar.mul(accumulatedGrad).add(_this.oneMinusRho.mul(gradient.square())),updates=accumulatedUpdate.add(_this.epsilonScalar).sqrt().div(accumulatedGrad.add(_this.epsilonScalar).sqrt()).mul(gradient),newAccumulatedUpdate=_this.rhoScalar.mul(accumulatedUpdate).add(_this.oneMinusRho.mul(updates.square()));_this.accumulatedGrads[variableName].assign(newAccumulatedGrad),_this.accumulatedUpdates[variableName].assign(newAccumulatedUpdate);var newValue=_this.c.mul(updates).add(value);value.assign(newValue)})}(variableName)},AdadeltaOptimizer.prototype.dispose=function(){var _this=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(name){return _this.accumulatedUpdates[name].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(name){return _this.accumulatedGrads[name].dispose()}))},AdadeltaOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},AdadeltaOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.rho,config.epsilon)},AdadeltaOptimizer.className="AdadeltaOptimizer",AdadeltaOptimizer}(optimizer_1.Optimizer);exports.AdadeltaOptimizer=AdadeltaOptimizer,serialization_1.registerClass(AdadeltaOptimizer)},{"../environment":58,"../globals":60,"../ops/ops":168,"../serialization":201,"./optimizer":196}],192:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),AdagradOptimizer=function(_super){function AdagradOptimizer(learningRate,initialAccumulatorValue){void 0===initialAccumulatorValue&&(initialAccumulatorValue=.1);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.initialAccumulatorValue=initialAccumulatorValue,_this.accumulatedGrads={},_this.c=globals_1.keep(ops_1.scalar(-learningRate)),_this.epsilon=globals_1.keep(ops_1.scalar(environment_1.ENV.get("EPSILON"))),_this}return __extends(AdagradOptimizer,_super),AdagradOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,this_1=this;for(var variableName in variableGradients)!function(variableName){var value=environment_1.ENV.engine.registeredVariables[variableName];if(null==this_1.accumulatedGrads[variableName]){globals_1.tidy(function(){_this.accumulatedGrads[variableName]=ops_1.fill(value.shape,_this.initialAccumulatorValue).variable(!1)})}var gradient=variableGradients[variableName],accumulatedGrad=this_1.accumulatedGrads[variableName];globals_1.tidy(function(){var newAccumulatedGrad=accumulatedGrad.add(gradient.square());_this.accumulatedGrads[variableName].assign(newAccumulatedGrad);var newValue=_this.c.mul(gradient.div(newAccumulatedGrad.add(_this.epsilon).sqrt())).add(value);value.assign(newValue)})}(variableName)},AdagradOptimizer.prototype.dispose=function(){var _this=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(name){return _this.accumulatedGrads[name].dispose()})},AdagradOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},AdagradOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.initialAccumulatorValue)},AdagradOptimizer.className="AdagradOptimizer",AdagradOptimizer}(optimizer_1.Optimizer);exports.AdagradOptimizer=AdagradOptimizer,serialization_1.registerClass(AdagradOptimizer)},{"../environment":58,"../globals":60,"../ops/ops":168,"../serialization":201,"./optimizer":196}],193:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),AdamOptimizer=function(_super){function AdamOptimizer(learningRate,beta1,beta2,epsilon){void 0===epsilon&&(epsilon=null);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.beta1=beta1,_this.beta2=beta2,_this.epsilon=epsilon,_this.accumulatedFirstMoment={},_this.accumulatedSecondMoment={},_this.c=globals_1.keep(ops_1.scalar(-learningRate)),_this.beta1Scalar=globals_1.keep(ops_1.scalar(beta1)),_this.beta2Scalar=globals_1.keep(ops_1.scalar(beta2)),globals_1.tidy(function(){_this.accBeta1=ops_1.scalar(beta1).variable(),_this.accBeta2=ops_1.scalar(beta2).variable()}),_this.oneMinusBeta1=globals_1.keep(ops_1.scalar(1-beta1)),_this.oneMinusBeta2=globals_1.keep(ops_1.scalar(1-beta2)),_this.one=globals_1.keep(ops_1.scalar(1)),null===epsilon&&(epsilon=environment_1.ENV.get("EPSILON")),_this.epsScalar=globals_1.keep(ops_1.scalar(epsilon)),_this}return __extends(AdamOptimizer,_super),AdamOptimizer.prototype.applyGradients=function(variableGradients){var _this=this;globals_1.tidy(function(){var oneMinusAccBeta1=_this.one.sub(_this.accBeta1),oneMinusAccBeta2=_this.one.sub(_this.accBeta2);for(var variableName in variableGradients){var value=environment_1.ENV.engine.registeredVariables[variableName];if(null==_this.accumulatedFirstMoment[variableName]){var trainable=!1;_this.accumulatedFirstMoment[variableName]=ops_1.zerosLike(value).variable(trainable)}if(null==_this.accumulatedSecondMoment[variableName]){var trainable=!1;_this.accumulatedSecondMoment[variableName]=ops_1.zerosLike(value).variable(trainable)}var gradient=variableGradients[variableName],firstMoment=_this.accumulatedFirstMoment[variableName],secondMoment=_this.accumulatedSecondMoment[variableName],newFirstMoment=_this.beta1Scalar.mul(firstMoment).add(_this.oneMinusBeta1.mul(gradient)),newSecondMoment=_this.beta2Scalar.mul(secondMoment).add(_this.oneMinusBeta2.mul(gradient.square())),biasCorrectedFirstMoment=newFirstMoment.div(oneMinusAccBeta1),biasCorrectedSecondMoment=newSecondMoment.div(oneMinusAccBeta2);_this.accumulatedFirstMoment[variableName].assign(newFirstMoment),_this.accumulatedSecondMoment[variableName].assign(newSecondMoment);var newValue=_this.c.mul(biasCorrectedFirstMoment.div(_this.epsScalar.add(biasCorrectedSecondMoment.sqrt()))).add(value);value.assign(newValue)}_this.accBeta1.assign(_this.accBeta1.mul(_this.beta1Scalar)),_this.accBeta2.assign(_this.accBeta2.mul(_this.beta2Scalar))})},AdamOptimizer.prototype.dispose=function(){var _this=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(name){return _this.accumulatedFirstMoment[name].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(name){return _this.accumulatedSecondMoment[name].dispose()})},AdamOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},AdamOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.beta1,config.beta2,config.epsilon)},AdamOptimizer.className="AdamOptimizer",AdamOptimizer}(optimizer_1.Optimizer);exports.AdamOptimizer=AdamOptimizer,serialization_1.registerClass(AdamOptimizer)},{"../environment":58,"../globals":60,"../ops/ops":168,"../serialization":201,"./optimizer":196}],194:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),AdamaxOptimizer=function(_super){function AdamaxOptimizer(learningRate,beta1,beta2,epsilon,decay){void 0===epsilon&&(epsilon=null),void 0===decay&&(decay=0);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.beta1=beta1,_this.beta2=beta2,_this.epsilon=epsilon,_this.decay=decay,_this.accumulatedFirstMoment={},_this.accumulatedWeightedInfNorm={},_this.c=globals_1.keep(ops_1.scalar(-learningRate)),_this.beta1Scalar=globals_1.keep(ops_1.scalar(beta1)),_this.beta2Scalar=globals_1.keep(ops_1.scalar(beta2)),_this.decayScalar=globals_1.keep(ops_1.scalar(decay)),globals_1.tidy(function(){_this.iteration=ops_1.scalar(0).variable(),_this.accBeta1=ops_1.scalar(beta1).variable()}),_this.oneMinusBeta1=globals_1.keep(ops_1.scalar(1-beta1)),_this.one=globals_1.keep(ops_1.scalar(1)),null===epsilon&&(epsilon=environment_1.ENV.get("EPSILON")),_this.epsScalar=globals_1.keep(ops_1.scalar(epsilon)),_this}return __extends(AdamaxOptimizer,_super),AdamaxOptimizer.prototype.applyGradients=function(variableGradients){var _this=this;globals_1.tidy(function(){var oneMinusAccBeta1=_this.one.sub(_this.accBeta1),lr=_this.c.div(_this.one.add(_this.decayScalar.mul(_this.iteration)));for(var variableName in variableGradients){var value=environment_1.ENV.engine.registeredVariables[variableName];if(null==_this.accumulatedFirstMoment[variableName]){var trainable=!1;_this.accumulatedFirstMoment[variableName]=ops_1.zerosLike(value).variable(trainable)}if(null==_this.accumulatedWeightedInfNorm[variableName]){var trainable=!1;_this.accumulatedWeightedInfNorm[variableName]=ops_1.zerosLike(value).variable(trainable)}var gradient=variableGradients[variableName],firstMoment=_this.accumulatedFirstMoment[variableName],weightedInfNorm=_this.accumulatedWeightedInfNorm[variableName],newFirstMoment=_this.beta1Scalar.mul(firstMoment).add(_this.oneMinusBeta1.mul(gradient)),ut0=_this.beta2Scalar.mul(weightedInfNorm),ut1=gradient.abs(),newWeightedInfNorm=ut0.maximum(ut1);_this.accumulatedFirstMoment[variableName].assign(newFirstMoment),_this.accumulatedWeightedInfNorm[variableName].assign(newWeightedInfNorm);var newValue=lr.div(oneMinusAccBeta1).mul(newFirstMoment.div(_this.epsScalar.add(newWeightedInfNorm))).add(value);value.assign(newValue)}_this.iteration.assign(_this.iteration.add(_this.one)),_this.accBeta1.assign(_this.accBeta1.mul(_this.beta1Scalar))})},AdamaxOptimizer.prototype.dispose=function(){var _this=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(name){return _this.accumulatedFirstMoment[name].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(name){return _this.accumulatedWeightedInfNorm[name].dispose()})},AdamaxOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},AdamaxOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.beta1,config.beta2,config.epsilon,config.decay)},AdamaxOptimizer.className="AdamaxOptimizer",AdamaxOptimizer}(optimizer_1.Optimizer);exports.AdamaxOptimizer=AdamaxOptimizer,serialization_1.registerClass(AdamaxOptimizer)},{"../environment":58,"../globals":60,"../ops/ops":168,"../serialization":201,"./optimizer":196}],195:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),sgd_optimizer_1=require("./sgd_optimizer"),MomentumOptimizer=function(_super){function MomentumOptimizer(learningRate,momentum,useNesterov){void 0===useNesterov&&(useNesterov=!1);var _this=_super.call(this,learningRate)||this;return _this.learningRate=learningRate,_this.momentum=momentum,_this.useNesterov=useNesterov,_this.m=ops_1.scalar(_this.momentum),_this.accumulations={},_this}return __extends(MomentumOptimizer,_super),MomentumOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,this_1=this;for(var variableName in variableGradients)!function(variableName){var value=environment_1.ENV.engine.registeredVariables[variableName];if(null==this_1.accumulations[variableName]){globals_1.tidy(function(){_this.accumulations[variableName]=ops_1.zerosLike(value).variable(!1)})}var accumulation=this_1.accumulations[variableName],gradient=variableGradients[variableName];globals_1.tidy(function(){var newValue,newAccumulation=_this.m.mul(accumulation).add(gradient);newValue=_this.useNesterov?_this.c.mul(gradient.add(newAccumulation.mul(_this.m))).add(value):_this.c.mul(newAccumulation).add(value),_this.accumulations[variableName].assign(newAccumulation),value.assign(newValue)})}(variableName)},MomentumOptimizer.prototype.dispose=function(){if(_super.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var variableName in this.accumulations)this.accumulations[variableName].dispose()},MomentumOptimizer.prototype.setMomentum=function(momentum){this.momentum=momentum},MomentumOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},MomentumOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.momentum,config.useNesterov)},MomentumOptimizer.className="MomentumOptimizer",MomentumOptimizer}(sgd_optimizer_1.SGDOptimizer);exports.MomentumOptimizer=MomentumOptimizer,serialization_1.registerClass(MomentumOptimizer)},{"../environment":58,"../globals":60,"../ops/ops":168,"../serialization":201,"./sgd_optimizer":199}],196:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var globals_1=require("../globals"),serialization_1=require("../serialization"),Optimizer=function(_super){function Optimizer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Optimizer,_super),Optimizer.prototype.minimize=function(f,returnCost,varList){void 0===returnCost&&(returnCost=!1);var _a=this.computeGradients(f,varList),value=_a.value,grads=_a.grads;return this.applyGradients(grads),Object.keys(grads).forEach(function(varName){return grads[varName].dispose()}),returnCost?value:(value.dispose(),null)},Optimizer.prototype.computeGradients=function(f,varList){return globals_1.variableGrads(f,varList)},Optimizer}(serialization_1.Serializable);exports.Optimizer=Optimizer},{"../globals":60,"../serialization":201}],197:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var adadelta_optimizer_1=require("./adadelta_optimizer"),adagrad_optimizer_1=require("./adagrad_optimizer"),adam_optimizer_1=require("./adam_optimizer"),adamax_optimizer_1=require("./adamax_optimizer"),momentum_optimizer_1=require("./momentum_optimizer"),rmsprop_optimizer_1=require("./rmsprop_optimizer"),sgd_optimizer_1=require("./sgd_optimizer"),OptimizerConstructors=function(){function OptimizerConstructors(){}return OptimizerConstructors.sgd=function(learningRate){return new sgd_optimizer_1.SGDOptimizer(learningRate)},OptimizerConstructors.momentum=function(learningRate,momentum,useNesterov){return void 0===useNesterov&&(useNesterov=!1),new momentum_optimizer_1.MomentumOptimizer(learningRate,momentum,useNesterov)},OptimizerConstructors.rmsprop=function(learningRate,decay,momentum,epsilon,centered){return void 0===decay&&(decay=.9),void 0===momentum&&(momentum=0),void 0===epsilon&&(epsilon=null),void 0===centered&&(centered=!1),new rmsprop_optimizer_1.RMSPropOptimizer(learningRate,decay,momentum,epsilon,centered)},OptimizerConstructors.adam=function(learningRate,beta1,beta2,epsilon){return void 0===learningRate&&(learningRate=.001),void 0===beta1&&(beta1=.9),void 0===beta2&&(beta2=.999),void 0===epsilon&&(epsilon=null),new adam_optimizer_1.AdamOptimizer(learningRate,beta1,beta2,epsilon)},OptimizerConstructors.adadelta=function(learningRate,rho,epsilon){return void 0===learningRate&&(learningRate=.001),void 0===rho&&(rho=.95),void 0===epsilon&&(epsilon=null),new adadelta_optimizer_1.AdadeltaOptimizer(learningRate,rho,epsilon)},OptimizerConstructors.adamax=function(learningRate,beta1,beta2,epsilon,decay){return void 0===learningRate&&(learningRate=.002),void 0===beta1&&(beta1=.9),void 0===beta2&&(beta2=.999),void 0===epsilon&&(epsilon=null),void 0===decay&&(decay=0),new adamax_optimizer_1.AdamaxOptimizer(learningRate,beta1,beta2,epsilon,decay)},OptimizerConstructors.adagrad=function(learningRate,initialAccumulatorValue){return void 0===initialAccumulatorValue&&(initialAccumulatorValue=.1),new adagrad_optimizer_1.AdagradOptimizer(learningRate,initialAccumulatorValue)},OptimizerConstructors}();exports.OptimizerConstructors=OptimizerConstructors},{"./adadelta_optimizer":191,"./adagrad_optimizer":192,"./adam_optimizer":193,"./adamax_optimizer":194,"./momentum_optimizer":195,"./rmsprop_optimizer":198,"./sgd_optimizer":199}],198:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),RMSPropOptimizer=function(_super){function RMSPropOptimizer(learningRate,decay,momentum,epsilon,centered){void 0===decay&&(decay=.9),void 0===momentum&&(momentum=0),void 0===epsilon&&(epsilon=null),void 0===centered&&(centered=!1);var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.decay=decay,_this.momentum=momentum,_this.epsilon=epsilon,_this.accumulatedMeanSquares={},_this.accumulatedMeanGrads={},_this.accumulatedMoments={},_this.c=globals_1.keep(ops_1.scalar(learningRate)),_this.decayScalar=globals_1.keep(ops_1.scalar(decay)),_this.momentumScalar=globals_1.keep(ops_1.scalar(momentum)),_this.oneMinusDecay=globals_1.keep(ops_1.scalar(1-decay)),_this.centered=centered,null===epsilon&&(epsilon=environment_1.ENV.get("EPSILON")),_this.epsilonScalar=globals_1.keep(ops_1.scalar(epsilon)),_this}return __extends(RMSPropOptimizer,_super),RMSPropOptimizer.prototype.applyGradients=function(variableGradients){var _this=this,this_1=this;for(var variableName in variableGradients)!function(variableName){var value=environment_1.ENV.engine.registeredVariables[variableName];if(null==this_1.accumulatedMeanSquares[variableName]){globals_1.tidy(function(){_this.accumulatedMeanSquares[variableName]=ops_1.zerosLike(value).variable(!1)})}if(null==this_1.accumulatedMeanGrads[variableName]&&this_1.centered){globals_1.tidy(function(){_this.accumulatedMeanGrads[variableName]=ops_1.zerosLike(value).variable(!1)})}if(null==this_1.accumulatedMoments[variableName]){globals_1.tidy(function(){_this.accumulatedMoments[variableName]=ops_1.zerosLike(value).variable(!1)})}
var accumulatedMeanSquare=this_1.accumulatedMeanSquares[variableName],accumulatedMeanGrad=this_1.accumulatedMeanGrads[variableName],accumulatedMoments=this_1.accumulatedMoments[variableName],gradient=variableGradients[variableName];globals_1.tidy(function(){var newAccumulatedMeanSquare=_this.decayScalar.mul(accumulatedMeanSquare).add(_this.oneMinusDecay.mul(gradient.square()));if(_this.centered){var newAccumulatedMeanGrad=_this.decayScalar.mul(accumulatedMeanGrad).add(_this.oneMinusDecay.mul(gradient)),newAccumulatedMoments=_this.momentumScalar.mul(accumulatedMoments).add(_this.c.mul(gradient).div(newAccumulatedMeanSquare.sub(newAccumulatedMeanGrad.square().add(_this.epsilonScalar)).sqrt()));_this.accumulatedMeanSquares[variableName].assign(newAccumulatedMeanSquare),_this.accumulatedMeanGrads[variableName].assign(newAccumulatedMeanGrad),_this.accumulatedMoments[variableName].assign(newAccumulatedMoments);var newValue=value.sub(newAccumulatedMoments);value.assign(newValue)}else{var newAccumulatedMeanSquare_1=_this.decayScalar.mul(accumulatedMeanSquare).add(_this.oneMinusDecay.mul(gradient.square())),newAccumulatedMoments=_this.momentumScalar.mul(accumulatedMoments).add(_this.c.mul(gradient).div(newAccumulatedMeanSquare_1.add(_this.epsilonScalar).sqrt()));_this.accumulatedMeanSquares[variableName].assign(newAccumulatedMeanSquare_1),_this.accumulatedMoments[variableName].assign(newAccumulatedMoments);var newValue=value.sub(newAccumulatedMoments);value.assign(newValue)}})}(variableName)},RMSPropOptimizer.prototype.dispose=function(){var _this=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(name){return _this.accumulatedMeanSquares[name].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(name){return _this.accumulatedMeanGrads[name].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(name){return _this.accumulatedMoments[name].dispose()})},RMSPropOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},RMSPropOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate,config.decay,config.momentum,config.epsilon,config.centered)},RMSPropOptimizer.className="RMSPropOptimizer",RMSPropOptimizer}(optimizer_1.Optimizer);exports.RMSPropOptimizer=RMSPropOptimizer,serialization_1.registerClass(RMSPropOptimizer)},{"../environment":58,"../globals":60,"../ops/ops":168,"../serialization":201,"./optimizer":196}],199:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("../environment"),globals_1=require("../globals"),ops_1=require("../ops/ops"),serialization_1=require("../serialization"),optimizer_1=require("./optimizer"),SGDOptimizer=function(_super){function SGDOptimizer(learningRate){var _this=_super.call(this)||this;return _this.learningRate=learningRate,_this.setLearningRate(learningRate),_this}return __extends(SGDOptimizer,_super),SGDOptimizer.prototype.applyGradients=function(variableGradients){var _this=this;Object.keys(variableGradients).forEach(function(varName){var gradient=variableGradients[varName],value=environment_1.ENV.engine.registeredVariables[varName];globals_1.tidy(function(){var newValue=_this.c.mul(gradient).add(value);value.assign(newValue)})})},SGDOptimizer.prototype.setLearningRate=function(learningRate){this.learningRate=learningRate,null!=this.c&&this.c.dispose(),this.c=globals_1.keep(ops_1.scalar(-learningRate))},SGDOptimizer.prototype.dispose=function(){this.c.dispose()},SGDOptimizer.prototype.getConfig=function(){return{learningRate:this.learningRate}},SGDOptimizer.fromConfig=function(cls,config){return new cls(config.learningRate)},SGDOptimizer.className="SGDOptimizer",SGDOptimizer}(optimizer_1.Optimizer);exports.SGDOptimizer=SGDOptimizer,serialization_1.registerClass(SGDOptimizer)},{"../environment":58,"../globals":60,"../ops/ops":168,"../serialization":201,"./optimizer":196}],200:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util=require("./util"),Profiler=function(){function Profiler(backendTimer,logger){this.backendTimer=backendTimer,this.logger=logger,null==logger&&(this.logger=new Logger)}return Profiler.prototype.profileKernel=function(name,f){var result,_this=this,holdResultWrapperFn=function(){result=f()},timer=this.backendTimer.time(holdResultWrapperFn);return(Array.isArray(result)?result:[result]).forEach(function(r){var vals=r.dataSync();util.checkComputationForNaN(vals,r.dtype,name),timer.then(function(timing){var extraInfo="";null!=timing.getExtraProfileInfo&&(extraInfo=timing.getExtraProfileInfo()),_this.logger.logKernelProfile(name,r,vals,timing.kernelMs,extraInfo)})}),result},Profiler}();exports.Profiler=Profiler;var Logger=function(){function Logger(){}return Logger.prototype.logKernelProfile=function(name,result,vals,timeMs,extraInfo){var time=util.rightPad(timeMs+"ms",9),paddedName=util.rightPad(name,25),rank=result.rank,size=result.size,shape=util.rightPad(result.shape.toString(),14);console.log("%c"+paddedName+"\t%c"+time+"\t%c"+rank+"D "+shape+"\t%c"+size+"\t%c"+extraInfo,"font-weight:bold","color:red","color:blue","color: orange","color: green")},Logger}();exports.Logger=Logger},{"./util":210}],201:[function(require,module,exports){"use strict";function registerClass(cls){util_1.assert(null!=cls.className,"Class being registered does not have the static className property defined."),util_1.assert("string"==typeof cls.className,"className is required to be a string, but got type "+typeof cls.className),util_1.assert(cls.className.length>0,"Class being registered has an empty-string as its className, which is disallowed."),SerializationMap.register(cls)}Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("./util"),Serializable=function(){function Serializable(){}return Serializable.prototype.getClassName=function(){return this.constructor.className},Serializable.fromConfig=function(cls,config){return new cls(config)},Serializable}();exports.Serializable=Serializable;var SerializationMap=function(){function SerializationMap(){this.classNameMap={}}return SerializationMap.getMap=function(){return null==SerializationMap.instance&&(SerializationMap.instance=new SerializationMap),SerializationMap.instance},SerializationMap.register=function(cls){SerializationMap.getMap().classNameMap[cls.className]=[cls,cls.fromConfig]},SerializationMap}();exports.SerializationMap=SerializationMap,exports.registerClass=registerClass},{"./util":210}],202:[function(require,module,exports){"use strict";function getFilteredNodesXToY(tape,xs,y){for(var tensorsFromX={},nodesFromX={},i=0;i<xs.length;i++)tensorsFromX[xs[i].id]=!0;for(var i=0;i<tape.length;i++){var node=tape[i],nodeInputs=node.inputs;for(var inputName in nodeInputs){for(var input=nodeInputs[inputName],anyInputFromX=!1,j=0;j<xs.length;j++)if(tensorsFromX[input.id]){node.outputs.forEach(function(output){return tensorsFromX[output.id]=!0}),anyInputFromX=!0,nodesFromX[node.id]=!0;break}if(anyInputFromX)break}}var tensorsLeadToY={};tensorsLeadToY[y.id]=!0;for(var nodesToY={},i=tape.length-1;i>=0;i--)for(var node=tape[i],nodeInputs=node.inputs,j=0;j<node.outputs.length;j++)if(tensorsLeadToY[node.outputs[j].id]){for(var inputName in nodeInputs)tensorsLeadToY[nodeInputs[inputName].id]=!0,nodesToY[node.id]=!0;break}for(var filteredTape=[],i=0;i<tape.length;i++){var node=tape[i];if(nodesFromX[node.id]&&nodesToY[node.id]){var prunedInputs={};for(var inputName in node.inputs){var nodeInput=node.inputs[inputName];tensorsFromX[nodeInput.id]&&(prunedInputs[inputName]=nodeInput)}var prunedNode=Object.assign({},node);prunedNode.inputs=prunedInputs,prunedNode.outputs=node.outputs,filteredTape.push(prunedNode)}}return filteredTape}function backpropagateGradients(tensorAccumulatedGradientMap,filteredTape){for(var i=filteredTape.length-1;i>=0;i--)!function(i){var node=filteredTape[i],dys=[];if(node.outputs.forEach(function(o){var gradTensor=tensorAccumulatedGradientMap[o.id];if(null!=gradTensor)dys.push(gradTensor);else{var dy=tensor_1.Tensor.make(o.shape,{values:util.makeZerosTypedArray(o.size,o.dtype)},o.dtype);dys.push(dy)}}),null==node.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+node.name+".");var inputGradients=node.gradient(1===node.outputs.length?dys[0]:dys);for(var inputName in node.inputs){if(!(inputName in inputGradients))throw new Error("Cannot backprop through input "+inputName+". Available gradients found: "+Object.keys(inputGradients)+".");var dx=inputGradients[inputName](),x=node.inputs[inputName];if(!util.arraysEqual(dx.shape,x.shape))throw new Error("Error in gradient for op "+node.name+". The gradient of input '"+inputName+"' has shape '"+dx.shape+"', which does not match the shape of the input '"+x.shape+"'");if(null==tensorAccumulatedGradientMap[x.id])tensorAccumulatedGradientMap[x.id]=dx;else{var curGradient=tensorAccumulatedGradientMap[x.id];tensorAccumulatedGradientMap[x.id]=curGradient.add(dx),curGradient.dispose()}}}(i)}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("./tensor"),util=require("./util");exports.getFilteredNodesXToY=getFilteredNodesXToY,exports.backpropagateGradients=backpropagateGradients},{"./tensor":203,"./util":210}],203:[function(require,module,exports){"use strict";function setTensorTracker(fn){trackerFn=fn}function setOpHandler(handler){opHandler=handler}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tensor_format_1=require("./tensor_format"),util=require("./util"),util_1=require("./util"),TensorBuffer=function(){function TensorBuffer(shape,dtype,values){if(this.dtype=dtype,this.shape=shape.slice(),this.size=util.sizeFromShape(shape),null!=values){var n=values.length;util.assert(n===this.size,"Length of values '"+n+"' does not match the size inferred by the shape '"+this.size+"'.")}if("complex64"===dtype)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=values||util.getTypedArrayFromDType(dtype,util.sizeFromShape(this.shape)),this.strides=util_1.computeStrides(shape)}return TensorBuffer.prototype.set=function(value){for(var locs=[],_i=1;_i<arguments.length;_i++)locs[_i-1]=arguments[_i];0===locs.length&&(locs=[0]),util.assert(locs.length===this.rank,"The number of provided coordinates ("+locs.length+") must match the rank ("+this.rank+")");var index=this.locToIndex(locs);this.values[index]=value},TensorBuffer.prototype.get=function(){for(var locs=[],_i=0;_i<arguments.length;_i++)locs[_i]=arguments[_i];0===locs.length&&(locs=[0]);for(var index=locs[locs.length-1],i=0;i<locs.length-1;++i)index+=this.strides[i]*locs[i];return this.values[index]},TensorBuffer.prototype.locToIndex=function(locs){if(0===this.rank)return 0;if(1===this.rank)return locs[0];for(var index=locs[locs.length-1],i=0;i<locs.length-1;++i)index+=this.strides[i]*locs[i];return index},TensorBuffer.prototype.indexToLoc=function(index){if(0===this.rank)return[];if(1===this.rank)return[index];for(var locs=new Array(this.shape.length),i=0;i<locs.length-1;++i)locs[i]=Math.floor(index/this.strides[i]),index-=locs[i]*this.strides[i];return locs[locs.length-1]=index,locs},Object.defineProperty(TensorBuffer.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),TensorBuffer.prototype.toTensor=function(){return Tensor.make(this.shape,{values:this.values},this.dtype)},TensorBuffer}();exports.TensorBuffer=TensorBuffer;var trackerFn=null,opHandler=null;exports.setTensorTracker=setTensorTracker,exports.setOpHandler=setOpHandler;var Tensor=function(){function Tensor(shape,dtype,values,dataId){this.isDisposedInternal=!1,this.shape=shape.slice(),this.dtype=dtype||"float32",this.size=util.sizeFromShape(shape),null!=values&&util.assert(this.size===values.length,"Based on the provided shape, ["+shape+"], and dtype "+this.dtype+", the tensor should have "+this.size+" values but has "+values.length),this.strides=util_1.computeStrides(shape),this.dataId=null!=dataId?dataId:{},this.id=trackerFn().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",trackerFn().registerTensor(this),null!=values&&trackerFn().write(this.dataId,values)}return Tensor.make=function(shape,data,dtype){return new Tensor(shape,dtype,data.values,data.dataId)},Tensor.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},Tensor.prototype.asScalar=function(){return this.throwIfDisposed(),util.assert(1===this.size,"The array must have only 1 element."),this.reshape([])},Tensor.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},Tensor.prototype.as2D=function(rows,columns){return this.throwIfDisposed(),this.reshape([rows,columns])},Tensor.prototype.as3D=function(rows,columns,depth){return this.throwIfDisposed(),this.reshape([rows,columns,depth])},Tensor.prototype.as4D=function(rows,columns,depth,depth2){return this.throwIfDisposed(),this.reshape([rows,columns,depth,depth2])},Tensor.prototype.asType=function(dtype){return this.throwIfDisposed(),opHandler.cast(this,dtype)},Object.defineProperty(Tensor.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),Tensor.prototype.get=function(){for(var locs=[],_i=0;_i<arguments.length;_i++)locs[_i]=arguments[_i];util.assert(locs.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),util.assert("complex64"!==this.dtype,"Tensor.get() is not supported for complex64 tensors yet."),this.throwIfDisposed(),0===locs.length&&(locs=[0]);for(var index=locs[locs.length-1],i=0;i<locs.length-1;++i)index+=this.strides[i]*locs[i];return this.dataSync()[index]},Tensor.prototype.buffer=function(){return opHandler.buffer(this.shape,this.dtype,this.dataSync())},Tensor.prototype.data=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return this.throwIfDisposed(),[2,trackerFn().read(this.dataId)]})})},Tensor.prototype.dataSync=function(){return this.throwIfDisposed(),trackerFn().readSync(this.dataId)},Tensor.prototype.dispose=function(){this.isDisposed||(trackerFn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(Tensor.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),Tensor.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},Tensor.prototype.toFloat=function(){return this.asType("float32")},Tensor.prototype.toInt=function(){return this.asType("int32")},Tensor.prototype.toBool=function(){return this.asType("bool")},Tensor.prototype.print=function(verbose){return void 0===verbose&&(verbose=!1),opHandler.print(this,verbose)},Tensor.prototype.reshape=function(newShape){return this.throwIfDisposed(),opHandler.reshape(this,newShape)},Tensor.prototype.reshapeAs=function(x){return this.throwIfDisposed(),this.reshape(x.shape)},Tensor.prototype.expandDims=function(axis){return void 0===axis&&(axis=0),opHandler.expandDims(this,axis)},Tensor.prototype.cumsum=function(axis,exclusive,reverse){return void 0===axis&&(axis=0),void 0===exclusive&&(exclusive=!1),void 0===reverse&&(reverse=!1),opHandler.cumsum(this,axis,exclusive,reverse)},Tensor.prototype.squeeze=function(axis){return this.throwIfDisposed(),opHandler.squeeze(this,axis)},Tensor.prototype.clone=function(){return this.throwIfDisposed(),opHandler.clone(this)},Tensor.prototype.toString=function(verbose){void 0===verbose&&(verbose=!1);var vals=this.dataSync();return tensor_format_1.tensorToString(vals,this.shape,this.dtype,verbose)},Tensor.prototype.tile=function(reps){return this.throwIfDisposed(),opHandler.tile(this,reps)},Tensor.prototype.gather=function(indices,axis){return void 0===axis&&(axis=0),this.throwIfDisposed(),opHandler.gather(this,indices,axis)},Tensor.prototype.matMul=function(b,transposeA,transposeB){return void 0===transposeA&&(transposeA=!1),void 0===transposeB&&(transposeB=!1),this.throwIfDisposed(),opHandler.matMul(this,b,transposeA,transposeB)},Tensor.prototype.dot=function(b){return this.throwIfDisposed(),opHandler.dot(this,b)},Tensor.prototype.norm=function(ord,axis,keepDims){return void 0===ord&&(ord="euclidean"),void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.norm(this,ord,axis,keepDims)},Tensor.prototype.slice=function(begin,size){return this.throwIfDisposed(),opHandler.slice(this,begin,size)},Tensor.prototype.reverse=function(axis){return this.throwIfDisposed(),opHandler.reverse(this,axis)},Tensor.prototype.concat=function(x,axis){return void 0===axis&&(axis=0),this.throwIfDisposed(),opHandler.concat([this,x],axis)},Tensor.prototype.split=function(numOrSizeSplits,axis){return void 0===axis&&(axis=0),this.throwIfDisposed(),opHandler.split(this,numOrSizeSplits,axis)},Tensor.prototype.stack=function(x,axis){return void 0===axis&&(axis=0),opHandler.stack([this,x],axis)},Tensor.prototype.unstack=function(x,axis){return void 0===axis&&(axis=0),opHandler.unstack(this,axis)},Tensor.prototype.pad=function(paddings,constantValue){return void 0===constantValue&&(constantValue=0),opHandler.pad(this,paddings,constantValue)},Tensor.prototype.batchNormalization=function(mean,variance,varianceEpsilon,scale,offset){return void 0===varianceEpsilon&&(varianceEpsilon=.001),this.throwIfDisposed(),opHandler.batchNormalization(this,mean,variance,varianceEpsilon,scale,offset)},Tensor.prototype.all=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.all(this,axis,keepDims)},Tensor.prototype.any=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.any(this,axis,keepDims)},Tensor.prototype.logSumExp=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.logSumExp(this,axis,keepDims)},Tensor.prototype.sum=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.sum(this,axis,keepDims)},Tensor.prototype.prod=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.prod(this,axis,keepDims)},Tensor.prototype.mean=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.mean(this,axis,keepDims)},Tensor.prototype.min=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.min(this,axis,keepDims)},Tensor.prototype.max=function(axis,keepDims){return void 0===axis&&(axis=null),void 0===keepDims&&(keepDims=!1),this.throwIfDisposed(),opHandler.max(this,axis,keepDims)},Tensor.prototype.argMin=function(axis){return void 0===axis&&(axis=null),this.throwIfDisposed(),opHandler.argMin(this,axis)},Tensor.prototype.argMax=function(axis){return void 0===axis&&(axis=null),this.throwIfDisposed(),opHandler.argMax(this,axis)},Tensor.prototype.cast=function(dtype){return this.throwIfDisposed(),opHandler.cast(this,dtype)},Tensor.prototype.add=function(x){return this.throwIfDisposed(),opHandler.add(this,x)},Tensor.prototype.addStrict=function(x){return this.throwIfDisposed(),opHandler.addStrict(this,x)},Tensor.prototype.atan2=function(x){return this.throwIfDisposed(),opHandler.atan2(this,x)},Tensor.prototype.sub=function(x){return this.throwIfDisposed(),opHandler.sub(this,x)},Tensor.prototype.subStrict=function(x){return this.throwIfDisposed(),opHandler.subStrict(this,x)},Tensor.prototype.pow=function(exp){return this.throwIfDisposed(),opHandler.pow(this,exp)},Tensor.prototype.powStrict=function(exp){return this.throwIfDisposed(),opHandler.powStrict(this,exp)},Tensor.prototype.mul=function(x){return this.throwIfDisposed(),opHandler.mul(this,x)},Tensor.prototype.mulStrict=function(x){return this.throwIfDisposed(),opHandler.mulStrict(this,x)},Tensor.prototype.div=function(x){return this.throwIfDisposed(),opHandler.div(this,x)},Tensor.prototype.floorDiv=function(x){return this.throwIfDisposed(),opHandler.floorDiv(this,x)},Tensor.prototype.divStrict=function(x){return this.throwIfDisposed(),opHandler.divStrict(this,x)},Tensor.prototype.minimum=function(x){return this.throwIfDisposed(),opHandler.minimum(this,x)},Tensor.prototype.minimumStrict=function(x){return this.throwIfDisposed(),opHandler.minimumStrict(this,x)},Tensor.prototype.maximum=function(x){return this.throwIfDisposed(),opHandler.maximum(this,x)},Tensor.prototype.maximumStrict=function(x){return this.throwIfDisposed(),opHandler.maximumStrict(this,x)},Tensor.prototype.mod=function(x){return this.throwIfDisposed(),opHandler.mod(this,x)},Tensor.prototype.modStrict=function(x){return this.throwIfDisposed(),opHandler.modStrict(this,x)},Tensor.prototype.squaredDifference=function(x){return this.throwIfDisposed(),opHandler.squaredDifference(this,x)},Tensor.prototype.squaredDifferenceStrict=function(x){return this.throwIfDisposed(),opHandler.squaredDifferenceStrict(this,x)},Tensor.prototype.transpose=function(perm){return this.throwIfDisposed(),opHandler.transpose(this,perm)},Tensor.prototype.notEqual=function(x){return this.throwIfDisposed(),opHandler.notEqual(this,x)},Tensor.prototype.notEqualStrict=function(x){return this.throwIfDisposed(),opHandler.notEqualStrict(this,x)},Tensor.prototype.less=function(x){return this.throwIfDisposed(),opHandler.less(this,x)},Tensor.prototype.lessStrict=function(x){return this.throwIfDisposed(),opHandler.lessStrict(this,x)},Tensor.prototype.equal=function(x){return this.throwIfDisposed(),opHandler.equal(this,x)},Tensor.prototype.equalStrict=function(x){return this.throwIfDisposed(),opHandler.equalStrict(this,x)},Tensor.prototype.lessEqual=function(x){return this.throwIfDisposed(),opHandler.lessEqual(this,x)},Tensor.prototype.lessEqualStrict=function(x){return this.throwIfDisposed(),opHandler.lessEqualStrict(this,x)},Tensor.prototype.greater=function(x){return this.throwIfDisposed(),opHandler.greater(this,x)},Tensor.prototype.greaterStrict=function(x){return this.throwIfDisposed(),opHandler.greaterStrict(this,x)},Tensor.prototype.greaterEqual=function(x){return this.throwIfDisposed(),opHandler.greaterEqual(this,x)},Tensor.prototype.greaterEqualStrict=function(x){return this.throwIfDisposed(),opHandler.greaterEqualStrict(this,x)},Tensor.prototype.logicalAnd=function(x){return this.throwIfDisposed(),opHandler.logicalAnd(this,x)},Tensor.prototype.logicalOr=function(x){return this.throwIfDisposed(),opHandler.logicalOr(this,x)},Tensor.prototype.logicalNot=function(){return this.throwIfDisposed(),opHandler.logicalNot(this)},Tensor.prototype.logicalXor=function(x){return this.throwIfDisposed(),opHandler.logicalXor(this,x)},Tensor.prototype.where=function(condition,x){return this.throwIfDisposed(),opHandler.where(condition,this,x)},Tensor.prototype.neg=function(){return this.throwIfDisposed(),opHandler.neg(this)},Tensor.prototype.ceil=function(){return this.throwIfDisposed(),opHandler.ceil(this)},Tensor.prototype.floor=function(){return this.throwIfDisposed(),opHandler.floor(this)},Tensor.prototype.sign=function(){return this.throwIfDisposed(),opHandler.sign(this)},Tensor.prototype.exp=function(){return this.throwIfDisposed(),opHandler.exp(this)},Tensor.prototype.expm1=function(){return this.throwIfDisposed(),opHandler.expm1(this)},Tensor.prototype.log=function(){return this.throwIfDisposed(),opHandler.log(this)},Tensor.prototype.log1p=function(){return this.throwIfDisposed(),opHandler.log1p(this)},Tensor.prototype.sqrt=function(){return this.throwIfDisposed(),opHandler.sqrt(this)},Tensor.prototype.rsqrt=function(){return this.throwIfDisposed(),opHandler.rsqrt(this)},Tensor.prototype.square=function(){return this.throwIfDisposed(),opHandler.square(this)},Tensor.prototype.reciprocal=function(){return this.throwIfDisposed(),opHandler.reciprocal(this)},Tensor.prototype.abs=function(){return this.throwIfDisposed(),opHandler.abs(this)},Tensor.prototype.clipByValue=function(min,max){return this.throwIfDisposed(),opHandler.clipByValue(this,min,max)},Tensor.prototype.relu=function(){return this.throwIfDisposed(),opHandler.relu(this)},Tensor.prototype.elu=function(){return this.throwIfDisposed(),opHandler.elu(this)},Tensor.prototype.selu=function(){return this.throwIfDisposed(),opHandler.selu(this)},Tensor.prototype.leakyRelu=function(alpha){return void 0===alpha&&(alpha=.2),this.throwIfDisposed(),opHandler.leakyRelu(this,alpha)},Tensor.prototype.prelu=function(alpha){return this.throwIfDisposed(),opHandler.prelu(this,alpha)},Tensor.prototype.sigmoid=function(){return this.throwIfDisposed(),opHandler.sigmoid(this)},Tensor.prototype.logSigmoid=function(){return this.throwIfDisposed(),opHandler.logSigmoid(this)},Tensor.prototype.softplus=function(){return this.throwIfDisposed(),opHandler.softplus(this)},Tensor.prototype.zerosLike=function(){return this.throwIfDisposed(),opHandler.zerosLike(this)},Tensor.prototype.onesLike=function(){return this.throwIfDisposed(),opHandler.onesLike(this)},Tensor.prototype.sin=function(){return this.throwIfDisposed(),opHandler.sin(this)},Tensor.prototype.cos=function(){return this.throwIfDisposed(),opHandler.cos(this)},Tensor.prototype.tan=function(){return this.throwIfDisposed(),opHandler.tan(this)},Tensor.prototype.asin=function(){return this.throwIfDisposed(),opHandler.asin(this)},Tensor.prototype.acos=function(){return this.throwIfDisposed(),opHandler.acos(this)},Tensor.prototype.atan=function(){return this.throwIfDisposed(),opHandler.atan(this)},Tensor.prototype.sinh=function(){return this.throwIfDisposed(),opHandler.sinh(this)},Tensor.prototype.cosh=function(){return this.throwIfDisposed(),opHandler.cosh(this)},Tensor.prototype.tanh=function(){return this.throwIfDisposed(),opHandler.tanh(this)},Tensor.prototype.asinh=function(){return this.throwIfDisposed(),opHandler.asinh(this)},Tensor.prototype.acosh=function(){return this.throwIfDisposed(),opHandler.acosh(this)},Tensor.prototype.atanh=function(){return this.throwIfDisposed(),opHandler.atanh(this)},Tensor.prototype.erf=function(){return this.throwIfDisposed(),opHandler.erf(this)},Tensor.prototype.round=function(){return this.throwIfDisposed(),opHandler.round(this)},Tensor.prototype.step=function(alpha){return void 0===alpha&&(alpha=0),this.throwIfDisposed(),opHandler.step(this,alpha)},Tensor.prototype.softmax=function(dim){return void 0===dim&&(dim=-1),this.throwIfDisposed(),opHandler.softmax(this,dim)},Tensor.prototype.logSoftmax=function(axis){return void 0===axis&&(axis=-1),this.throwIfDisposed(),opHandler.logSoftmax(this,axis)},Tensor.prototype.resizeBilinear=function(newShape2D,alignCorners){return void 0===alignCorners&&(alignCorners=!1),this.throwIfDisposed(),opHandler.image.resizeBilinear(this,newShape2D,alignCorners)},Tensor.prototype.resizeNearestNeighbor=function(newShape2D,alignCorners){return void 0===alignCorners&&(alignCorners=!1),this.throwIfDisposed(),opHandler.image.resizeNearestNeighbor(this,newShape2D,alignCorners)},Tensor.prototype.conv1d=function(filter,stride,pad,dataFormat,dilation,dimRoundingMode){return void 0===dataFormat&&(dataFormat="NWC"),void 0===dilation&&(dilation=1),this.throwIfDisposed(),opHandler.conv1d(this,filter,stride,pad,dataFormat,dilation,dimRoundingMode)},Tensor.prototype.conv2d=function(filter,strides,pad,dataFormat,dilations,dimRoundingMode){return void 0===dataFormat&&(dataFormat="NHWC"),void 0===dilations&&(dilations=[1,1]),this.throwIfDisposed(),opHandler.conv2d(this,filter,strides,pad,dataFormat,dilations,dimRoundingMode)},Tensor.prototype.conv2dTranspose=function(filter,outputShape,strides,pad,dimRoundingMode){return this.throwIfDisposed(),opHandler.conv2dTranspose(this,filter,outputShape,strides,pad,dimRoundingMode)},Tensor.prototype.depthwiseConv2D=function(filter,strides,pad,dataFormat,dilations,dimRoundingMode){return void 0===dataFormat&&(dataFormat="NHWC"),void 0===dilations&&(dilations=[1,1]),this.throwIfDisposed(),opHandler.depthwiseConv2d(this,filter,strides,pad,dataFormat,dilations,dimRoundingMode)},Tensor.prototype.separableConv2d=function(depthwiseFilter,pointwiseFilter,strides,pad,dilation,dataFormat){return void 0===dilation&&(dilation=[1,1]),void 0===dataFormat&&(dataFormat="NHWC"),this.throwIfDisposed(),opHandler.separableConv2d(this,depthwiseFilter,pointwiseFilter,strides,pad,dilation,dataFormat)},Tensor.prototype.avgPool=function(filterSize,strides,pad,dimRoundingMode){return this.throwIfDisposed(),opHandler.avgPool(this,filterSize,strides,pad,dimRoundingMode)},Tensor.prototype.maxPool=function(filterSize,strides,pad,dimRoundingMode){return this.throwIfDisposed(),opHandler.maxPool(this,filterSize,strides,pad,dimRoundingMode)},Tensor.prototype.localResponseNormalization=function(radius,bias,alpha,beta){return void 0===radius&&(radius=5),void 0===bias&&(bias=1),void 0===alpha&&(alpha=1),void 0===beta&&(beta=.5),opHandler.localResponseNormalization(this,radius,bias,alpha,beta)},Tensor.prototype.pool=function(windowShape,poolingType,padding,dilationRate,strides){return this.throwIfDisposed(),opHandler.pool(this,windowShape,poolingType,padding,dilationRate,strides)},
Tensor.prototype.variable=function(trainable,name,dtype){return void 0===trainable&&(trainable=!0),this.throwIfDisposed(),Variable.variable(this,trainable,name,dtype)},Tensor.prototype.unsortedSegmentSum=function(segmentIds,numSegments){return this.throwIfDisposed(),opHandler.unsortedSegmentSum(this,segmentIds,numSegments)},Tensor.prototype.batchToSpaceND=function(blockShape,crops){return this.throwIfDisposed(),opHandler.batchToSpaceND(this,blockShape,crops)},Tensor.prototype.spaceToBatchND=function(blockShape,paddings){return this.throwIfDisposed(),opHandler.spaceToBatchND(this,blockShape,paddings)},Tensor.prototype.topk=function(k,sorted){return void 0===k&&(k=1),void 0===sorted&&(sorted=!0),this.throwIfDisposed(),opHandler.topk(this,k,sorted)},Tensor.prototype.stridedSlice=function(begin,end,strides,beginMask,endMask){return void 0===beginMask&&(beginMask=0),void 0===endMask&&(endMask=0),this.throwIfDisposed(),opHandler.stridedSlice(this,begin,end,strides,beginMask,endMask)},Tensor.prototype.depthToSpace=function(blockSize,dataFormat){return this.throwIfDisposed(),opHandler.depthToSpace(this,blockSize,dataFormat)},Tensor.prototype.fft=function(){return this.throwIfDisposed(),opHandler.spectral.fft(this)},Tensor.prototype.ifft=function(){return this.throwIfDisposed(),opHandler.spectral.ifft(this)},Tensor}();exports.Tensor=Tensor,Object.defineProperty(Tensor,Symbol.hasInstance,{value:function(instance){return!!instance&&null!=instance.shape&&null!=instance.dtype}});var Variable=function(_super){function Variable(initialValue,trainable,name){void 0===trainable&&(trainable=!0);var _this=_super.call(this,initialValue.shape,initialValue.dtype,null,initialValue.dataId)||this;_this.trainable=trainable,_this.name=name,null==_this.name&&(_this.name=trackerFn().nextVariableId().toString());try{trackerFn().registerVariable(_this)}catch(ex){throw trackerFn().disposeTensor(_this),ex}return _this}return __extends(Variable,_super),Variable.variable=function(initialValue,trainable,name,dtype){return void 0===trainable&&(trainable=!0),null!=dtype&&dtype!==initialValue.dtype&&(initialValue=initialValue.asType(dtype)),new Variable(initialValue,trainable,name)},Variable.prototype.assign=function(newValue){if(newValue.dtype!==this.dtype)throw new Error("dtype of the new value ("+newValue.dtype+") and previous value ("+this.dtype+") must match");if(!util.arraysEqual(newValue.shape,this.shape))throw new Error("shape of the new value ("+newValue.shape+") and previous value ("+this.shape+") must match");trackerFn().disposeTensor(this),this.dataId=newValue.dataId,trackerFn().registerTensor(this)},Variable}(Tensor);exports.Variable=Variable,Object.defineProperty(Variable,Symbol.hasInstance,{value:function(instance){return instance instanceof Tensor&&null!=instance.assign&&instance.assign instanceof Function}});var variable=Variable.variable;exports.variable=variable},{"./tensor_format":204,"./util":210}],204:[function(require,module,exports){"use strict";function tensorToString(vals,shape,dtype,verbose){var strides=util_1.computeStrides(shape),padPerCol=computeMaxSizePerColumn(vals,shape,dtype,strides),rank=shape.length,valsLines=subTensorToString(vals,shape,dtype,strides,padPerCol),lines=["Tensor"];return verbose&&(lines.push("  dtype: "+dtype),lines.push("  rank: "+rank),lines.push("  shape: ["+shape+"]"),lines.push("  values:")),lines.push(valsLines.map(function(l){return"    "+l}).join("\n")),lines.join("\n")}function computeMaxSizePerColumn(vals,shape,dtype,strides){var n=util_1.sizeFromShape(shape),numCols=strides[strides.length-1],padPerCol=new Array(numCols).fill(0),rank=shape.length,valuesOrTuples="complex64"===dtype?createComplexTuples(vals):vals;if(rank>1)for(var row=0;row<n/numCols;row++)for(var offset=row*numCols,j=0;j<numCols;j++)padPerCol[j]=Math.max(padPerCol[j],valToString(valuesOrTuples[offset+j],0).length);return padPerCol}function valToString(val,pad){var valStr;return valStr=Array.isArray(val)?parseFloat(val[0].toFixed(FORMAT_NUM_SIG_DIGITS))+" + "+parseFloat(val[1].toFixed(FORMAT_NUM_SIG_DIGITS))+"j":parseFloat(val.toFixed(FORMAT_NUM_SIG_DIGITS)).toString(),util_1.rightPad(valStr,pad)}function subTensorToString(vals,shape,dtype,strides,padPerCol,isLast){void 0===isLast&&(isLast=!0);var storagePerElement="complex64"===dtype?2:1,size=shape[0],rank=shape.length;if(0===rank){if("complex64"===dtype){return[valToString(createComplexTuples(vals)[0],0)]}return[vals[0].toString()]}if(1===rank){if(size>FORMAT_LIMIT_NUM_VALS){var firstValsSize=FORMAT_NUM_FIRST_LAST_VALS*storagePerElement,firstVals=Array.from(vals.subarray(0,firstValsSize)),lastVals=Array.from(vals.subarray(size-FORMAT_NUM_FIRST_LAST_VALS*storagePerElement,size));return"complex64"===dtype&&(firstVals=createComplexTuples(firstVals),lastVals=createComplexTuples(lastVals)),["["+firstVals.map(function(x,i){return valToString(x,padPerCol[i])}).join(", ")+", ..., "+lastVals.map(function(x,i){return valToString(x,padPerCol[size-FORMAT_NUM_FIRST_LAST_VALS+i])}).join(", ")+"]"]}return["["+("complex64"===dtype?createComplexTuples(vals):Array.from(vals)).map(function(x,i){return valToString(x,padPerCol[i])}).join(", ")+"]"]}var subshape=shape.slice(1),substrides=strides.slice(1),stride=strides[0]*storagePerElement,lines=[];if(size>FORMAT_LIMIT_NUM_VALS){for(var i=0;i<FORMAT_NUM_FIRST_LAST_VALS;i++){var start=i*stride,end=start+stride;lines.push.apply(lines,subTensorToString(vals.subarray(start,end),subshape,dtype,substrides,padPerCol,!1))}lines.push("...");for(var i=size-FORMAT_NUM_FIRST_LAST_VALS;i<size;i++){var start=i*stride,end=start+stride;lines.push.apply(lines,subTensorToString(vals.subarray(start,end),subshape,dtype,substrides,padPerCol,i===size-1))}}else for(var i=0;i<size;i++){var start=i*stride,end=start+stride;lines.push.apply(lines,subTensorToString(vals.subarray(start,end),subshape,dtype,substrides,padPerCol,i===size-1))}var sep=2===rank?",":"";lines[0]="["+lines[0]+sep;for(var i=1;i<lines.length-1;i++)lines[i]=" "+lines[i]+sep;for(var newLineSep=",\n",i=2;i<rank;i++)newLineSep+="\n";return lines[lines.length-1]=" "+lines[lines.length-1]+"]"+(isLast?"":newLineSep),lines}function createComplexTuples(vals){for(var complexTuples=[],i=0;i<vals.length;i+=2)complexTuples.push([vals[i],vals[i+1]]);return complexTuples}Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("./util"),FORMAT_LIMIT_NUM_VALS=20,FORMAT_NUM_FIRST_LAST_VALS=3,FORMAT_NUM_SIG_DIGITS=7;exports.tensorToString=tensorToString},{"./util":210}],205:[function(require,module,exports){"use strict";function assertTypesMatch(a,b){util_1.assert(a.dtype===b.dtype,"The dtypes of the first("+a.dtype+") and second("+b.dtype+") input must match")}function isTensorInList(tensor,tensorList){for(var i=0;i<tensorList.length;i++)if(tensorList[i].id===tensor.id)return!0;return!1}function flattenNameArrayMap(nameArrayMap,keys){var xs=[];if(nameArrayMap instanceof tensor_1.Tensor)xs.push(nameArrayMap);else for(var xMap=nameArrayMap,i=0;i<keys.length;i++)xs.push(xMap[keys[i]]);return xs}function unflattenToNameArrayMap(keys,flatArrays){if(keys.length!==flatArrays.length)throw new Error("Cannot unflatten Tensor[], keys and arrays are not of same length.");for(var result={},i=0;i<keys.length;i++)result[keys[i]]=flatArrays[i];return result}function getTensorsInContainer(result){var list=[];return walkTensorContainer(result,list,new Set),list}function walkTensorContainer(container,list,seen){if(null!=container){if(container instanceof tensor_1.Tensor)return void list.push(container);if(isIterable(container)){var iterable=container;for(var k in iterable){var val=iterable[k];seen.has(val)||(seen.add(val),walkTensorContainer(val,list,seen))}}}}function isIterable(obj){return Array.isArray(obj)||"object"==typeof obj}Object.defineProperty(exports,"__esModule",{value:!0});var tensor_1=require("./tensor"),util_1=require("./util");exports.assertTypesMatch=assertTypesMatch,exports.isTensorInList=isTensorInList,exports.flattenNameArrayMap=flattenNameArrayMap,exports.unflattenToNameArrayMap=unflattenToNameArrayMap,exports.getTensorsInContainer=getTensorsInContainer},{"./tensor":203,"./util":210}],206:[function(require,module,exports){"use strict";function inferShape(val){var firstElem=val;if(util_1.isTypedArray(val))return[val.length];if(!Array.isArray(val))return[];for(var shape=[];firstElem instanceof Array;)shape.push(firstElem.length),firstElem=firstElem[0];return val instanceof Array&&environment_1.ENV.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&deepAssertShapeConsistency(val,shape,[]),shape}function deepAssertShapeConsistency(val,shape,indices){if(indices=indices||[],!(val instanceof Array))return void util_1.assert(0===shape.length,function(){return"Element arr["+indices.join("][")+"] is a primitive, but should be an array of "+shape[0]+" elements"});util_1.assert(shape.length>0,function(){return"Element arr["+indices.join("][")+"] should be a primitive, but is an array of "+val.length+" elements"}),util_1.assert(val.length===shape[0],function(){return"Element arr["+indices.join("][")+"] should have "+shape[0]+" elements, but has "+val.length+" elements"});for(var subShape=shape.slice(1),i=0;i<val.length;++i)deepAssertShapeConsistency(val[i],subShape,indices.concat(i))}function convertToTensor(x,argName,functionName,dtype){if(void 0===dtype&&(dtype="float32"),dtype=dtype||"float32",x instanceof tensor_1.Tensor)return x;if(!util_1.isTypedArray(x)&&!Array.isArray(x)&&"number"!=typeof x&&"boolean"!=typeof x)throw new Error("Argument '"+argName+"' passed to '"+functionName+"' must be a Tensor or TensorLike, but got "+x.constructor.name);var inferredShape=inferShape(x);return util_1.isTypedArray(x)||Array.isArray(x)||(x=[x]),tensor_1.Tensor.make(inferredShape,{values:util_1.toTypedArray(x,dtype,environment_1.ENV.get("DEBUG"))},dtype)}function convertToTensorArray(arg,argName,functionName){if(!Array.isArray(arg))throw new Error("Argument "+argName+" passed to "+functionName+" must be a `Tensor[]` or `TensorLike[]`");return arg.map(function(t,i){return convertToTensor(t,argName+"["+i+"]",functionName)})}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),tensor_1=require("./tensor"),util_1=require("./util");exports.inferShape=inferShape,exports.convertToTensor=convertToTensor,exports.convertToTensorArray=convertToTensorArray},{"./environment":58,"./tensor":203,"./util":210}],207:[function(require,module,exports){"use strict";function expectArraysClose(actual,expected,epsilon){if(null==epsilon&&(epsilon=environment_1.ENV.get("TEST_EPSILON")),actual instanceof tensor_1.Tensor||expected instanceof tensor_1.Tensor){if(actual instanceof tensor_1.Tensor&&expected instanceof tensor_1.Tensor){if(actual.dtype!==expected.dtype)throw new Error("Arrays are of different type actual: "+actual.dtype+" vs expected: "+expected.dtype+".");if(!util.arraysEqual(actual.shape,expected.shape))throw new Error("Arrays are of different shape actual: "+actual.shape+" vs expected: "+expected.shape+".")}}else{var aType=actual.constructor.name,bType=expected.constructor.name;if(aType!==bType)throw new Error("Arrays are of different type actual: "+aType+" vs expected: "+bType)}var actualValues,expectedValues;if(actualValues=actual instanceof tensor_1.Tensor?actual.dataSync():actual,expectedValues=expected instanceof tensor_1.Tensor?expected.dataSync():expected,actualValues.length!==expectedValues.length)throw new Error("Arrays have different lengths actual: "+actualValues.length+" vs expected: "+expectedValues.length+".\nActual:   "+actualValues+".\nExpected: "+expectedValues+".");for(var i=0;i<expectedValues.length;++i){var a=actualValues[i],e=expectedValues[i];if(!areClose(a,Number(e),epsilon))throw new Error("Arrays differ: actual["+i+"] = "+a+", expected["+i+"] = "+e+".\nActual:   "+actualValues+".\nExpected: "+expectedValues+".")}}function expectPromiseToFail(fn,done){fn().then(function(){return done.fail()},function(){return done()})}function expectArraysEqual(actual,expected){return expectArraysClose(actual,expected,0)}function expectNumbersClose(a,e,epsilon){if(null==epsilon&&(epsilon=environment_1.ENV.get("TEST_EPSILON")),!areClose(a,e,epsilon))throw new Error("Numbers differ: actual === "+a+", expected === "+e)}function areClose(a,e,epsilon){return!(!isNaN(a)||!isNaN(e))||!(isNaN(a)||isNaN(e)||Math.abs(a-e)>epsilon)}function expectValuesInRange(actual,low,high){var actualVals;actualVals=actual instanceof tensor_1.Tensor?actual.dataSync():actual;for(var i=0;i<actualVals.length;i++)if(actualVals[i]<low||actualVals[i]>high)throw new Error("Value out of range:"+actualVals[i]+" low: "+low+", high: "+high)}function expectArrayBuffersEqual(actual,expected){expect(new Float32Array(actual)).toEqual(new Float32Array(expected))}Object.defineProperty(exports,"__esModule",{value:!0});var environment_1=require("./environment"),tensor_1=require("./tensor"),util=require("./util");exports.WEBGL_ENVS={HAS_WEBGL:!0},exports.NODE_ENVS={IS_NODE:!0},exports.CHROME_ENVS={IS_CHROME:!0},exports.BROWSER_ENVS={IS_BROWSER:!0},exports.CPU_ENVS={HAS_WEBGL:!1},exports.BROWSER_CPU_ENVS={BACKEND:"test-cpu"},exports.ALL_ENVS={},exports.expectArraysClose=expectArraysClose,exports.expectPromiseToFail=expectPromiseToFail,exports.expectArraysEqual=expectArraysEqual,exports.expectNumbersClose=expectNumbersClose,exports.expectValuesInRange=expectValuesInRange,exports.expectArrayBuffersEqual=expectArrayBuffersEqual},{"./environment":58,"./tensor":203,"./util":210}],208:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var adadelta_optimizer_1=require("./optimizers/adadelta_optimizer"),adagrad_optimizer_1=require("./optimizers/adagrad_optimizer"),adam_optimizer_1=require("./optimizers/adam_optimizer"),adamax_optimizer_1=require("./optimizers/adamax_optimizer"),momentum_optimizer_1=require("./optimizers/momentum_optimizer"),optimizer_constructors_1=require("./optimizers/optimizer_constructors"),rmsprop_optimizer_1=require("./optimizers/rmsprop_optimizer"),sgd_optimizer_1=require("./optimizers/sgd_optimizer");momentum_optimizer_1.MomentumOptimizer,sgd_optimizer_1.SGDOptimizer,adadelta_optimizer_1.AdadeltaOptimizer,adagrad_optimizer_1.AdagradOptimizer,rmsprop_optimizer_1.RMSPropOptimizer,adamax_optimizer_1.AdamaxOptimizer,adam_optimizer_1.AdamOptimizer,exports.train={sgd:optimizer_constructors_1.OptimizerConstructors.sgd,momentum:optimizer_constructors_1.OptimizerConstructors.momentum,adadelta:optimizer_constructors_1.OptimizerConstructors.adadelta,adagrad:optimizer_constructors_1.OptimizerConstructors.adagrad,rmsprop:optimizer_constructors_1.OptimizerConstructors.rmsprop,adamax:optimizer_constructors_1.OptimizerConstructors.adamax,adam:optimizer_constructors_1.OptimizerConstructors.adam}},{"./optimizers/adadelta_optimizer":191,"./optimizers/adagrad_optimizer":192,"./optimizers/adam_optimizer":193,"./optimizers/adamax_optimizer":194,"./optimizers/momentum_optimizer":195,"./optimizers/optimizer_constructors":197,"./optimizers/rmsprop_optimizer":198,"./optimizers/sgd_optimizer":199}],209:[function(require,module,exports){"use strict";function upcastType(typeA,typeB){return upcastTypeMap[typeA][typeB]}function sumOutType(type){return upcastType(type,"int32")}Object.defineProperty(exports,"__esModule",{value:!0});!function(DType){DType.float32="float32",DType.int32="int32",DType.bool="bool"}(exports.DType||(exports.DType={}));!function(Rank){Rank.R0="R0",Rank.R1="R1",Rank.R2="R2",Rank.R3="R3",Rank.R4="R4",Rank.R5="R5",Rank.R6="R6"}(exports.Rank||(exports.Rank={}));var UpcastInt32AndMap;!function(UpcastInt32AndMap){UpcastInt32AndMap.float32="float32",UpcastInt32AndMap.int32="int32",UpcastInt32AndMap.bool="int32",UpcastInt32AndMap.complex64="complex64"}(UpcastInt32AndMap||(UpcastInt32AndMap={}));var UpcastBoolAndMap;!function(UpcastBoolAndMap){UpcastBoolAndMap.float32="float32",UpcastBoolAndMap.int32="int32",UpcastBoolAndMap.bool="bool",UpcastBoolAndMap.complex64="complex64"}(UpcastBoolAndMap||(UpcastBoolAndMap={}));var UpcastFloat32AndMap;!function(UpcastFloat32AndMap){UpcastFloat32AndMap.float32="float32",UpcastFloat32AndMap.int32="float32",UpcastFloat32AndMap.bool="float32",UpcastFloat32AndMap.complex64="complex64"}(UpcastFloat32AndMap||(UpcastFloat32AndMap={}));var UpcastComplex64AndMap;!function(UpcastComplex64AndMap){UpcastComplex64AndMap.float32="complex64",UpcastComplex64AndMap.int32="complex64",UpcastComplex64AndMap.bool="complex64",UpcastComplex64AndMap.complex64="complex64"}(UpcastComplex64AndMap||(UpcastComplex64AndMap={}));var upcastTypeMap={float32:UpcastFloat32AndMap,int32:UpcastInt32AndMap,bool:UpcastBoolAndMap,complex64:UpcastComplex64AndMap};exports.upcastType=upcastType,exports.sumOutType=sumOutType},{}],210:[function(require,module,exports){(function(process){"use strict";function shuffle(array){for(var counter=array.length,temp=0,index=0;counter>0;)index=Math.random()*counter|0,counter--,temp=array[counter],array[counter]=array[index],array[index]=temp}function clamp(min,x,max){return Math.max(min,Math.min(x,max))}function nearestLargerEven(val){return val%2==0?val:val+1}function sum(arr){for(var sum=0,i=0;i<arr.length;i++)sum+=arr[i];return sum}function randUniform(a,b){var r=Math.random();return b*r+(1-r)*a}function distSquared(a,b){for(var result=0,i=0;i<a.length;i++){var diff=Number(a[i])-Number(b[i]);result+=diff*diff}return result}function assert(expr,msg){if(!expr)throw new Error("string"==typeof msg?msg:msg())}function assertShapesMatch(shapeA,shapeB,errorMessagePrefix){void 0===errorMessagePrefix&&(errorMessagePrefix=""),assert(arraysEqual(shapeA,shapeB),errorMessagePrefix+" Shapes "+shapeA+" and "+shapeB+" must match")}function assertNonNull(a){assert(null!=a,"The input to the tensor constructor must be a non-null value.")}function flatten(arr,ret){if(void 0===ret&&(ret=[]),Array.isArray(arr))for(var i=0;i<arr.length;++i)flatten(arr[i],ret);else ret.push(arr);return ret}function sizeFromShape(shape){if(0===shape.length)return 1;for(var size=shape[0],i=1;i<shape.length;i++)size*=shape[i];return size}function isScalarShape(shape){return 0===shape.length}function arraysEqual(n1,n2){if(n1===n2)return!0;if(null==n1||null==n2)return!1;if(n1.length!==n2.length)return!1;for(var i=0;i<n1.length;i++)if(n1[i]!==n2[i])return!1;return!0}function isInt(a){return a%1==0}function tanh(x){if(null!=Math.tanh)return Math.tanh(x);if(x===1/0)return 1;if(x===-1/0)return-1;var e2x=Math.exp(2*x);return(e2x-1)/(e2x+1)}function sizeToSquarishShape(size){for(var a=Math.floor(Math.sqrt(size));a>1;--a)if(size%a==0)return[a,size/a];return[1,size]}function createShuffledIndices(n){for(var shuffledIndices=new Uint32Array(n),i=0;i<n;++i)shuffledIndices[i]=i;return shuffle(shuffledIndices),shuffledIndices}function rightPad(a,size){return size<=a.length?a:a+" ".repeat(size-a.length)}function repeatedTry(checkFn,delayFn,maxCounter){return void 0===delayFn&&(delayFn=function(counter){return 0}),new Promise(function(resolve,reject){var tryCount=0,tryFn=function(){if(checkFn())return void resolve();tryCount++;var nextBackoff=delayFn(tryCount);if(null!=maxCounter&&tryCount>=maxCounter)return void reject();setTimeout(tryFn,nextBackoff)};tryFn()})}function inferFromImplicitShape(shape,size){for(var shapeProd=1,implicitIdx=-1,i=0;i<shape.length;++i)if(shape[i]>=0)shapeProd*=shape[i];else if(-1===shape[i]){if(-1!==implicitIdx)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+implicitIdx+" and dim "+i);implicitIdx=i}else if(shape[i]<0)throw Error("Shapes can not be < 0. Found "+shape[i]+" at dim "+i);if(-1===implicitIdx){if(size>0&&size!==shapeProd)throw Error("Size("+size+") must match the product of shape "+shape);return shape}if(0===shapeProd)throw Error("Cannot infer the missing size in ["+shape+"] when there are 0 elements");if(size%shapeProd!=0)throw Error("The implicit shape can't be a fractional number. Got "+size+" / "+shapeProd);var newShape=shape.slice();return newShape[implicitIdx]=size/shapeProd,newShape}function squeezeShape(shape,axis){for(var newShape=[],keptDims=[],j=0,i=0;i<shape.length;++i){if(null!=axis){if(axis[j]===i&&1!==shape[i])throw new Error("Can't squeeze axis "+i+" since its dim '"+shape[i]+"' is not 1");(null==axis[j]||axis[j]>i)&&1===shape[i]&&(newShape.push(shape[i]),keptDims.push(i)),axis[j]<=i&&j++}1!==shape[i]&&(newShape.push(shape[i]),keptDims.push(i))}return{newShape:newShape,keptDims:keptDims}}function getTypedArrayFromDType(dtype,size){var values=null;if(null==dtype||"float32"===dtype)values=new Float32Array(size);else if("int32"===dtype)values=new Int32Array(size);else{if("bool"!==dtype)throw new Error("Unknown data type "+dtype);values=new Uint8Array(size)}return values}function checkComputationForNaN(vals,dtype,name){if("float32"===dtype)for(var i=0;i<vals.length;i++)if(isNaN(vals[i]))throw Error("The result of the '"+name+"' has NaNs.")}function checkConversionForNaN(vals,dtype){if("float32"!==dtype)for(var i=0;i<vals.length;i++)if(isNaN(vals[i]))throw Error("NaN is not a valid value for dtype: '"+dtype+"'.")}function hasEncodingLoss(oldType,newType){return"complex64"!==newType&&(("float32"!==newType||"complex64"===oldType)&&(("int32"!==newType||"float32"===oldType||"complex64"===oldType)&&("bool"!==newType||"bool"!==oldType)))}function copyTypedArray(array,dtype,debugMode){if(null==dtype||"float32"===dtype||"complex64"===dtype)return new Float32Array(array);if("int32"===dtype)return debugMode&&checkConversionForNaN(array,dtype),new Int32Array(array);if("bool"===dtype){for(var bool=new Uint8Array(array.length),i=0;i<bool.length;++i)0!==Math.round(array[i])&&(bool[i]=1);return bool}throw new Error("Unknown data type "+dtype)}function isTypedArray(a){return a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array}function bytesPerElement(dtype){if("float32"===dtype||"int32"===dtype)return 4;if("complex64"===dtype)return 8;if("bool"===dtype)return 1;throw new Error("Unknown dtype "+dtype)}function isFunction(f){return!!(f&&f.constructor&&f.call&&f.apply)}function nearestDivisor(size,start){for(var i=start;i<size;++i)if(size%i==0)return i;return size}function computeStrides(shape){var rank=shape.length;if(rank<2)return[];var strides=new Array(rank-1);strides[rank-2]=shape[rank-1];for(var i=rank-3;i>=0;--i)strides[i]=strides[i+1]*shape[i+1];return strides}function toTypedArray(a,dtype,debugMode){return noConversionNeeded(a,dtype)?a:(Array.isArray(a)&&(a=flatten(a)),copyTypedArray(a,dtype,debugMode))}function noConversionNeeded(a,dtype){return a instanceof Float32Array&&"float32"===dtype||a instanceof Int32Array&&"int32"===dtype||a instanceof Uint8Array&&"bool"===dtype}function makeOnesTypedArray(size,dtype){for(var array=makeZerosTypedArray(size,dtype),i=0;i<array.length;i++)array[i]=1;return array}function makeZerosTypedArray(size,dtype){if(null==dtype||"float32"===dtype||"complex64"===dtype)return new Float32Array(size);if("int32"===dtype)return new Int32Array(size);if("bool"===dtype)return new Uint8Array(size);throw new Error("Unknown data type "+dtype)}function now(){if("undefined"!=typeof performance)return performance.now();if(void 0!==process){var time=process.hrtime();return 1e3*time[0]+time[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.shuffle=shuffle,exports.clamp=clamp,exports.nearestLargerEven=nearestLargerEven,exports.sum=sum,exports.randUniform=randUniform,exports.distSquared=distSquared,exports.assert=assert,exports.assertShapesMatch=assertShapesMatch,exports.assertNonNull=assertNonNull,exports.flatten=flatten,exports.sizeFromShape=sizeFromShape,exports.isScalarShape=isScalarShape,exports.arraysEqual=arraysEqual,exports.isInt=isInt,exports.tanh=tanh,exports.sizeToSquarishShape=sizeToSquarishShape,exports.createShuffledIndices=createShuffledIndices,exports.rightPad=rightPad,exports.repeatedTry=repeatedTry,exports.inferFromImplicitShape=inferFromImplicitShape,exports.squeezeShape=squeezeShape,exports.getTypedArrayFromDType=getTypedArrayFromDType,exports.checkComputationForNaN=checkComputationForNaN,exports.checkConversionForNaN=checkConversionForNaN,exports.hasEncodingLoss=hasEncodingLoss,exports.isTypedArray=isTypedArray,exports.bytesPerElement=bytesPerElement,exports.isFunction=isFunction,exports.nearestDivisor=nearestDivisor,exports.computeStrides=computeStrides,exports.toTypedArray=toTypedArray,exports.makeOnesTypedArray=makeOnesTypedArray,exports.makeZerosTypedArray=makeZerosTypedArray,exports.now=now}).call(this,require("_process"))},{_process:274}],211:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.version="0.13.11"},{}],212:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var gpgpu_util=require("./kernels/webgl/gpgpu_util");exports.gpgpu_util=gpgpu_util;var webgl_util=require("./kernels/webgl/webgl_util");exports.webgl_util=webgl_util;var backend_webgl_1=require("./kernels/backend_webgl");exports.MathBackendWebGL=backend_webgl_1.MathBackendWebGL;var gpgpu_context_1=require("./kernels/webgl/gpgpu_context");exports.GPGPUContext=gpgpu_context_1.GPGPUContext},{"./kernels/backend_webgl":77,"./kernels/webgl/gpgpu_context":104,"./kernels/webgl/gpgpu_util":106,"./kernels/webgl/webgl_util":138}],213:[function(require,module,exports){"use strict";function serializeActivation(activation){return activation.getClassName()}function deserializeActivation(config,customObjects){return void 0===customObjects&&(customObjects={}),generic_utils_1.deserializeKerasObject(config,tfjs_core_1.serialization.SerializationMap.getMap().classNameMap,customObjects,"activation")}function getActivation(identifier){if(null==identifier){var config={className:"linear",config:{}};return deserializeActivation(config)}if("string"==typeof identifier){var config={className:identifier,config:{}};return deserializeActivation(config)}return identifier instanceof Activation?identifier:deserializeActivation(identifier)}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),K=require("./backend/tfjs_backend"),state_1=require("./backend/state"),generic_utils_1=require("./utils/generic_utils"),Activation=function(_super){function Activation(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Activation,_super),Activation.prototype.getConfig=function(){return{}},Activation}(tfjs_core_1.serialization.Serializable);exports.Activation=Activation;var Elu=function(_super){function Elu(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Elu,_super),Elu.prototype.apply=function(x,alpha){return void 0===alpha&&(alpha=1),K.elu(x,alpha)},Elu.className="elu",Elu}(Activation);exports.Elu=Elu,tfjs_core_1.serialization.registerClass(Elu);var Selu=function(_super){function Selu(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Selu,_super),Selu.prototype.apply=function(x){return tfc.selu(x)},Selu.className="selu",Selu}(Activation);exports.Selu=Selu,tfjs_core_1.serialization.registerClass(Selu);var Relu=function(_super){function Relu(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Relu,_super),Relu.prototype.apply=function(x){return tfc.relu(x)},Relu.className="relu",Relu}(Activation);exports.Relu=Relu,tfjs_core_1.serialization.registerClass(Relu);var Relu6=function(_super){function Relu6(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Relu6,_super),Relu6.prototype.apply=function(x){return tfjs_core_1.tidy(function(){return tfc.minimum(state_1.getScalar(6),tfc.relu(x))})},Relu6.className="relu6",Relu6}(Activation);exports.Relu6=Relu6,tfjs_core_1.serialization.registerClass(Relu6);var Linear=function(_super){function Linear(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Linear,_super),Linear.prototype.apply=function(x){return x},Linear.className="linear",Linear}(Activation);exports.Linear=Linear,tfjs_core_1.serialization.registerClass(Linear);var Sigmoid=function(_super){function Sigmoid(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Sigmoid,_super),Sigmoid.prototype.apply=function(x){return tfc.sigmoid(x)},Sigmoid.className="sigmoid",Sigmoid}(Activation);exports.Sigmoid=Sigmoid,tfjs_core_1.serialization.registerClass(Sigmoid);var HardSigmoid=function(_super){function HardSigmoid(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(HardSigmoid,_super),HardSigmoid.prototype.apply=function(x){return K.hardSigmoid(x)},HardSigmoid.className="hardSigmoid",HardSigmoid}(Activation);exports.HardSigmoid=HardSigmoid,tfjs_core_1.serialization.registerClass(HardSigmoid);var Softplus=function(_super){function Softplus(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Softplus,_super),Softplus.prototype.apply=function(x){return tfc.softplus(x)},Softplus.className="softplus",Softplus}(Activation);exports.Softplus=Softplus,tfjs_core_1.serialization.registerClass(Softplus);var Softsign=function(_super){function Softsign(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Softsign,_super),Softsign.prototype.apply=function(x){return K.softsign(x)},Softsign.className="softsign",Softsign}(Activation);exports.Softsign=Softsign,tfjs_core_1.serialization.registerClass(Softsign);var Tanh=function(_super){function Tanh(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Tanh,_super),Tanh.prototype.apply=function(x){return tfc.tanh(x)},Tanh.className="tanh",Tanh}(Activation);exports.Tanh=Tanh,tfjs_core_1.serialization.registerClass(Tanh);var Softmax=function(_super){function Softmax(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Softmax,_super),Softmax.prototype.apply=function(x,axis){return void 0===axis&&(axis=-1),tfc.softmax(x,axis)},Softmax.className="softmax",Softmax}(Activation);exports.Softmax=Softmax,tfjs_core_1.serialization.registerClass(Softmax),exports.serializeActivation=serializeActivation,exports.deserializeActivation=deserializeActivation,exports.getActivation=getActivation},{"./backend/state":215,"./backend/tfjs_backend":216,"./utils/generic_utils":257,"@tensorflow/tfjs-core":62}],214:[function(require,module,exports){"use strict";function epsilon(){return _epsilon}function setEpsilon(e){_epsilon=e}function imageDataFormat(){return"channelsLast"}Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),_epsilon=tfjs_core_1.ENV.get("EPSILON");exports.epsilon=epsilon,exports.setEpsilon=setEpsilon,exports.imageDataFormat=imageDataFormat},{"@tensorflow/tfjs-core":62}],215:[function(require,module,exports){"use strict";function getNextUniqueTensorId(){return _nextUniqueTensorId++}function getUid(prefix){return void 0===prefix&&(prefix=""),prefix in _uidPrefixes||(_uidPrefixes[prefix]=0),_uidPrefixes[prefix]+=1,prefix+_uidPrefixes[prefix].toString()}function getScalar(value,dtype){return void 0===dtype&&(dtype=DEFAULT_DTYPE),null==scalarCache[dtype][value]&&(scalarCache[dtype][value]=tfjs_core_1.scalar(value,dtype),tfjs_core_1.keep(scalarCache[dtype][value])),scalarCache[dtype][value]}function disposeScalarCache(){for(var typeKey in scalarCache)for(var key in scalarCache[typeKey])scalarCache[typeKey][key].dispose(),delete scalarCache[typeKey][key]}Object.defineProperty(exports,"__esModule",{value:!0})
;var tfjs_core_1=require("@tensorflow/tfjs-core"),_nextUniqueTensorId=0;exports.getNextUniqueTensorId=getNextUniqueTensorId;var _uidPrefixes={};exports.getUid=getUid;var scalarCache={float32:{},int32:{}},DEFAULT_DTYPE="float32";exports.getScalar=getScalar,exports.disposeScalarCache=disposeScalarCache},{"@tensorflow/tfjs-core":62}],216:[function(require,module,exports){"use strict";function setBackend(requestedBackend){tfc.setBackend(requestedBackend),backend=requestedBackend,state_1.disposeScalarCache()}function getBackend(){return backend}function isBackendSymbolic(){return!1}function countParams(x){var shape=x.shape;return shape.length>0?shape.reduce(function(a,b){return a*b}):1}function cast(x,dtype){return x.asType(dtype)}function expandDims(x,axis){void 0===axis&&(axis=-1);var outShape=x.shape.slice();return axis<0&&(axis=outShape.length+axis+1),outShape.splice(axis,0,1),x.reshape(outShape)}function repeat(x,n){return tfjs_core_1.tidy(function(){if(2!==x.shape.length)throw new errors_1.ValueError("repeat() expects a rank-2 tensor, but received a rank-"+x.shape.length+" tensor.");return tile(expandDims(x,1),[1,n,1])})}function flatten(x){var newShape=[math_utils.arrayProd(x.shape)];return x.reshape(newShape)}function batchFlatten(x){if(x.rank<=1)throw new errors_1.ValueError("batchFlatten requires a minimum rank of 2. Got rank: "+x.rank+".");var newShape=[x.shape[0],math_utils.arrayProd(x.shape,1)];return x.reshape(newShape)}function sliceAlongFirstAxis(array,start,size){return tfjs_core_1.tidy(function(){switch(array.rank){case 1:return tfc.slice1d(array,start,size);case 2:return tfc.slice2d(array,[start,0],[size,array.shape[1]]);case 3:return tfc.slice3d(array,[start,0,0],[size,array.shape[1],array.shape[2]]);case 4:return tfc.slice4d(array,[start,0,0,0],[size,array.shape[1],array.shape[2],array.shape[3]]);default:throw new errors_1.ValueError("sliceAlongFirstAxis() received an unsupported tensor rank: "+array.rank)}})}function sliceAlongLastAxis(array,start,size){return tfjs_core_1.tidy(function(){switch(array.rank){case 1:return tfc.slice1d(array,start,size);case 2:return tfc.slice2d(array,[0,start],[array.shape[0],size]);case 3:return tfc.slice3d(array,[0,0,start],[array.shape[0],array.shape[1],size]);case 4:return tfc.slice4d(array,[0,0,0,start],[array.shape[0],array.shape[1],array.shape[2],size]);default:throw new errors_1.ValueError("sliceAlongLastAxis() received an unsupported tensor rank: "+array.rank)}})}function sliceAlongAxis(array,start,size,axis){return tfjs_core_1.tidy(function(){switch(array.rank){case 1:return tfc.slice1d(array,start,size);case 2:switch(axis){case 1:return sliceAlongFirstAxis(array,start,size);case 2:return sliceAlongLastAxis(array,start,size);default:throw new errors_1.ValueError("The axis is not within the rank of the tensor "+axis)}case 3:switch(axis){case 1:return sliceAlongFirstAxis(array,start,size);case 2:return tfc.slice3d(array,[0,start,0],[array.shape[0],size,array.shape[2]]);case 3:return sliceAlongLastAxis(array,start,size);default:throw new errors_1.ValueError("The axis is not within the rank of the tensor "+axis)}case 4:switch(axis){case 1:return sliceAlongFirstAxis(array,start,size);case 2:return tfc.slice4d(array,[0,start,0,0],[array.shape[0],size,array.shape[2],array.shape[3]]);case 3:return tfc.slice4d(array,[0,0,start,0],[array.shape[0],array.shape[1],size,array.shape[3]]);case 4:return sliceAlongLastAxis(array,start,size);default:throw new errors_1.ValueError("The axis is not within the rank of the tensor "+axis)}default:throw new errors_1.ValueError("sliceAlongLastAxis() received an unsupported tensor rank: "+array.rank)}})}function concatenate(tensors,axis){void 0===axis&&(axis=-1);var rank;return axis<0&&(rank=tensors[0].rank,axis=0!==rank?rank:0),axis===tensors[0].rank&&(axis=-1),tfc.concat(tensors,axis)}function concatAlongFirstAxis(a,b){switch(a.rank){case 1:return tfc.concat1d([a,b]);case 2:return tfc.concat2d([a,b],0);case 3:return tfc.concat3d([a,b],0);case 4:return tfc.concat4d([a,b],0);default:throw new errors_1.ValueError("concatAlongFirstAxis() received an unsupported tensor rank: "+a.rank)}}function tile(x,n){if(Array.isArray(n)||(n=[n]),x.rank!==n.length)throw new errors_1.ValueError("The length of input n ("+n.length+") does not match the number of dimensions in input x ("+x.rank+")");return tfc.tile(x,n)}function randomNormal(shape,mean,stddev,dtype,seed){return void 0===mean&&(mean=0),void 0===stddev&&(stddev=1),tfc.randomNormal(shape,mean,stddev,dtype,seed)}function dot(x,y){if(x.rank<2||y.rank<2)throw new errors_1.NotImplementedError("dot requires both inputs to be rank >= 2 but got x shape = "+x.shape+" and y shape = "+y.shape);if(y.rank>=3){var xLastDim=x.shape.slice(-1)[0],ySecondLastDim=y.shape.slice(-2)[0];if(xLastDim!==ySecondLastDim)throw new errors_1.NotImplementedError("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = "+x.shape+" and  y shape = "+y.shape)}if(2===x.rank&&2===y.rank)return tfc.matMul(x,y);var xFirstDims=x.shape.slice(),xLastDim=xFirstDims.pop();x=x.reshape([-1,xLastDim]);var yShape=y.shape.slice(),yLastDim=yShape.pop(),ySecondLastDim=yShape.pop(),yOtherDims=yShape.concat([yLastDim]),perm=Array.from({length:y.rank},function(_,i){return 0===i?y.rank-2:i<=y.rank-2?i-1:i});y=y.transpose(perm).reshape([ySecondLastDim,-1]);var outputShape=xFirstDims.concat(yOtherDims);return tfc.matMul(x,y).reshape(outputShape)}function sign(x){return tfjs_core_1.tidy(function(){var zerosLikeX=tfjs_core_1.zerosLike(x),onesLikeX=tfjs_core_1.onesLike(x);return tfjs_core_1.where(tfc.equal(x,zerosLikeX),zerosLikeX,tfjs_core_1.where(tfc.greater(x,tfjs_core_1.zerosLike(x)),onesLikeX,tfc.mul(state_1.getScalar(-1),onesLikeX)))})}function oneHot(indices,numClasses){return tfjs_core_1.tidy(function(){if(1!==indices.rank)throw new Error("Only 1D one-hot tensors are supported in the deeplearn backend, at present.");return indices=indices.toInt(),tfc.oneHot(indices,numClasses).toFloat()})}function gather(reference,indices,axis){return tfjs_core_1.tidy(function(){return indices=Array.isArray(indices)?tfjs_core_1.tensor1d(indices,"int32"):indices.toInt(),tfc.gather(reference,indices,axis)})}function square(x){return tfc.mulStrict(x,x)}function pow(x,a){return tfjs_core_1.tidy(function(){if("number"==typeof a&&(a=tfjs_core_1.scalar(Math.round(a),"int32")),"int32"!==a.dtype)throw new errors_1.NotImplementedError("Non-int32 dtype ("+a.dtype+") is not supported by pow() yet");return tfc.pow(x,a)})}function biasAdd(x,bias,dataFormat){return tfjs_core_1.tidy(function(){if(null==dataFormat&&(dataFormat=common_2.imageDataFormat()),common_1.checkDataFormat(dataFormat),1!==bias.rank&&bias.rank!==x.rank)throw new errors_1.ValueError("Unexpected bias dimensions: "+bias.rank+"; expected it to be 1 or "+x.rank);var y,biasShape=bias.shape;if(5===x.rank)"channelsFirst"===dataFormat?y=1===biasShape.length?x.add(bias.reshape([1,biasShape[0],1,1,1])):x.add(bias.reshape([1,biasShape[3],biasShape[0],biasShape[1],biasShape[2]])):"channelsLast"===dataFormat&&(y=1===biasShape.length?x.add(bias.reshape([1,1,1,1,biasShape[0]])):x.add(bias.reshape([1].concat(biasShape))));else if(4===x.rank)"channelsFirst"===dataFormat?y=1===biasShape.length?x.add(bias.reshape([1,biasShape[0],1,1])):x.add(bias.reshape([1,biasShape[2],biasShape[0],biasShape[1]])):"channelsLast"===dataFormat&&(y=1===biasShape.length?x.add(bias.reshape([1,1,1,biasShape[0]])):x.add(bias.reshape([1].concat(biasShape))));else if(3===x.rank)"channelsFirst"===dataFormat?y=1===biasShape.length?x.add(bias.reshape([1,biasShape[0],1])):x.add(bias.reshape([1,biasShape[1],biasShape[0]])):"channelsLast"===dataFormat&&(y=1===biasShape.length?x.add(bias.reshape([1,1,biasShape[0]])):x.add(bias.reshape([1].concat(biasShape))));else{if(!(x.rank<3))throw new errors_1.ValueError("Unsupported input rank by biasAdd: "+x.rank);y=x.add(bias)}return y})}function elu(x,alpha){if(void 0===alpha&&(alpha=1),1!==alpha)throw new errors_1.NotImplementedError("Support for alpha values other than 1 ("+alpha+") is not implemented yet.");return tfc.elu(x)}function softsign(x){return tfjs_core_1.tidy(function(){return tfc.div(x,tfc.add(state_1.getScalar(1),tfc.abs(x)))})}function dropout(x,level,noiseShape,seed){return tfjs_core_1.tidy(function(){if(null!=noiseShape&&!tfjs_core_1.util.arraysEqual(x.shape,noiseShape))throw new errors_1.NotImplementedError("Non-default noise shape is not implemented yet: "+JSON.stringify(noiseShape));if(null!=seed)throw new errors_1.NotImplementedError("seed is not implemented for dropout yet.");var multiplier=tfc.step(tfc.add(tfc.neg(level),tfc.randomUniform(x.shape,0,1,"float32")));return multiplier=tfc.mul(tfc.div(state_1.getScalar(1),tfc.sub(state_1.getScalar(1),level)),multiplier),tfc.mul(x,multiplier)})}function hardSigmoid(x){return tfjs_core_1.tidy(function(){var y=tfc.add(state_1.getScalar(.5),tfc.mul(state_1.getScalar(.2),x));return tfc.clipByValue(y,0,1)})}function inTrainPhase(x,alt,training){return void 0===training&&(training=!1),training?x():alt()}Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("../backend/state"),common_1=require("../common"),errors_1=require("../errors"),math_utils=require("../utils/math_utils"),common_2=require("./common"),backend="webgl";exports.setBackend=setBackend,exports.getBackend=getBackend,exports.isBackendSymbolic=isBackendSymbolic,exports.countParams=countParams,exports.cast=cast,exports.expandDims=expandDims,exports.repeat=repeat,exports.flatten=flatten,exports.batchFlatten=batchFlatten,exports.sliceAlongFirstAxis=sliceAlongFirstAxis,exports.sliceAlongLastAxis=sliceAlongLastAxis,exports.sliceAlongAxis=sliceAlongAxis,exports.concatenate=concatenate,exports.concatAlongFirstAxis=concatAlongFirstAxis,exports.tile=tile,exports.randomNormal=randomNormal,exports.dot=dot,exports.sign=sign,exports.oneHot=oneHot,exports.gather=gather,exports.square=square,exports.pow=pow,exports.biasAdd=biasAdd,exports.elu=elu,exports.softsign=softsign,exports.dropout=dropout,exports.hardSigmoid=hardSigmoid,exports.inTrainPhase=inTrainPhase},{"../backend/state":215,"../common":219,"../errors":228,"../utils/math_utils":259,"./common":214,"@tensorflow/tfjs-core":62}],217:[function(require,module,exports){"use strict";function standardizeCallbacks(callbacks){return null==callbacks?null:callbacks instanceof BaseCallback?[callbacks]:Array.isArray(callbacks)&&callbacks[0]instanceof BaseCallback?callbacks:generic_utils.toList(callbacks).map(function(callbackConfig){return new CustomCallback(callbackConfig)})}function configureCallbacks(callbacks,yieldEvery,verbose,epochs,initialEpoch,numTrainSamples,stepsPerEpoch,batchSize,doValidation,callbackMetrics){var history=new History,actualCallbacks=[new BaseLogger(yieldEvery)].concat(CallbackConstructorRegistry.createCallbacks(verbose));null!=callbacks&&actualCallbacks.push.apply(actualCallbacks,callbacks),actualCallbacks.push(history);var callbackList=new CallbackList(actualCallbacks);return callbackList.setParams({epochs:epochs,initialEpoch:initialEpoch,samples:numTrainSamples,steps:stepsPerEpoch,batchSize:batchSize,verbose:verbose,doValidation:doValidation,metrics:callbackMetrics}),{callbackList:callbackList,history:history}}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("./backend/state"),errors_1=require("./errors"),logs_1=require("./logs"),generic_utils=require("./utils/generic_utils");!function(ModelLoggingVerbosity){ModelLoggingVerbosity[ModelLoggingVerbosity.SILENT=0]="SILENT",ModelLoggingVerbosity[ModelLoggingVerbosity.VERBOSE=1]="VERBOSE"}(exports.ModelLoggingVerbosity||(exports.ModelLoggingVerbosity={}));var BaseCallback=function(){function BaseCallback(){this.validationData=null}return BaseCallback.prototype.setParams=function(params){this.params=params},BaseCallback.prototype.onEpochBegin=function(epoch,logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})},BaseCallback.prototype.onEpochEnd=function(epoch,logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})},BaseCallback.prototype.onBatchBegin=function(batch,logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})},BaseCallback.prototype.onBatchEnd=function(batch,logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})},BaseCallback.prototype.onTrainBegin=function(logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})},BaseCallback.prototype.onTrainEnd=function(logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})},BaseCallback.prototype.setModel=function(model){},BaseCallback}();exports.BaseCallback=BaseCallback;var CallbackList=function(){function CallbackList(callbacks,queueLength){void 0===queueLength&&(queueLength=10),null==callbacks&&(callbacks=[]),this.callbacks=callbacks,this.queueLength=queueLength}return CallbackList.prototype.append=function(callback){this.callbacks.push(callback)},CallbackList.prototype.setParams=function(params){for(var _i=0,_a=this.callbacks;_i<_a.length;_i++){_a[_i].setParams(params)}},CallbackList.prototype.setModel=function(model){for(var _i=0,_a=this.callbacks;_i<_a.length;_i++){_a[_i].setModel(model)}},CallbackList.prototype.onEpochBegin=function(epoch,logs){return __awaiter(this,void 0,void 0,function(){var _i,_a,callback;return __generator(this,function(_b){switch(_b.label){case 0:null==logs&&(logs={}),_i=0,_a=this.callbacks,_b.label=1;case 1:return _i<_a.length?(callback=_a[_i],[4,callback.onEpochBegin(epoch,logs)]):[3,4];case 2:_b.sent(),_b.label=3;case 3:return _i++,[3,1];case 4:return[2]}})})},CallbackList.prototype.onEpochEnd=function(epoch,logs){return __awaiter(this,void 0,void 0,function(){var _i,_a,callback;return __generator(this,function(_b){switch(_b.label){case 0:null==logs&&(logs={}),_i=0,_a=this.callbacks,_b.label=1;case 1:return _i<_a.length?(callback=_a[_i],[4,callback.onEpochEnd(epoch,logs)]):[3,4];case 2:_b.sent(),_b.label=3;case 3:return _i++,[3,1];case 4:return[2]}})})},CallbackList.prototype.onBatchBegin=function(batch,logs){return __awaiter(this,void 0,void 0,function(){var _i,_a,callback;return __generator(this,function(_b){switch(_b.label){case 0:null==logs&&(logs={}),_i=0,_a=this.callbacks,_b.label=1;case 1:return _i<_a.length?(callback=_a[_i],[4,callback.onBatchBegin(batch,logs)]):[3,4];case 2:_b.sent(),_b.label=3;case 3:return _i++,[3,1];case 4:return[2]}})})},CallbackList.prototype.onBatchEnd=function(batch,logs){return __awaiter(this,void 0,void 0,function(){var _i,_a,callback;return __generator(this,function(_b){switch(_b.label){case 0:return null==logs&&(logs={}),[4,logs_1.resolveScalarsInLogs(logs)];case 1:_b.sent(),_i=0,_a=this.callbacks,_b.label=2;case 2:return _i<_a.length?(callback=_a[_i],[4,callback.onBatchEnd(batch,logs)]):[3,5];case 3:_b.sent(),_b.label=4;case 4:return _i++,[3,2];case 5:return[2]}})})},CallbackList.prototype.onTrainBegin=function(logs){return __awaiter(this,void 0,void 0,function(){var _i,_a,callback;return __generator(this,function(_b){switch(_b.label){case 0:null==logs&&(logs={}),_i=0,_a=this.callbacks,_b.label=1;case 1:return _i<_a.length?(callback=_a[_i],[4,callback.onTrainBegin(logs)]):[3,4];case 2:_b.sent(),_b.label=3;case 3:return _i++,[3,1];case 4:return[2]}})})},CallbackList.prototype.onTrainEnd=function(logs){return __awaiter(this,void 0,void 0,function(){var _i,_a,callback;return __generator(this,function(_b){switch(_b.label){case 0:null==logs&&(logs={}),_i=0,_a=this.callbacks,_b.label=1;case 1:return _i<_a.length?(callback=_a[_i],[4,callback.onTrainEnd(logs)]):[3,4];case 2:_b.sent(),_b.label=3;case 3:return _i++,[3,1];case 4:return[2]}})})},CallbackList}();exports.CallbackList=CallbackList;var ModelTrainingYielder=function(){function ModelTrainingYielder(yieldEvery){this.yieldEvery=yieldEvery,this.batchCount=0,this.batchDurationsMillis=[],this.autoYieldEveryBatches=null,this.batchStartMillis=tfjs_core_1.util.now()}return ModelTrainingYielder.prototype.resolveOneTensorInLogs=function(logs){return __awaiter(this,void 0,void 0,function(){var _a,_b,_i,key,value;return __generator(this,function(_c){switch(_c.label){case 0:_a=[];for(_b in logs)_a.push(_b);_i=0,_c.label=1;case 1:return _i<_a.length?(key=_a[_i],value=logs[key],"number"==typeof value?[3,3]:[4,value.data()]):[3,4];case 2:return _c.sent(),[3,4];case 3:return _i++,[3,1];case 4:return[2]}})})},ModelTrainingYielder.prototype.maybeYieldOnBatch=function(logs){return __awaiter(this,void 0,void 0,function(){var t,meanBatchDuration;return __generator(this,function(_a){switch(_a.label){case 0:return"auto"!==this.yieldEvery?[3,7]:(this.batchCount++,null!=this.autoYieldEveryBatches?[3,3]:[4,this.resolveOneTensorInLogs(logs)]);case 1:return _a.sent(),t=tfjs_core_1.util.now(),[4,tfjs_core_1.nextFrame()];case 2:return _a.sent(),this.batchCount>ModelTrainingYielder.SKIP_FIRST_BATCHES&&(this.batchDurationsMillis.push(t-this.batchStartMillis),this.batchDurationsMillis.length>=ModelTrainingYielder.DECISION_BATCH_COUNT&&(meanBatchDuration=this.batchDurationsMillis.reduce(function(dur,prev){return dur+prev})/this.batchDurationsMillis.length,this.autoYieldEveryBatches=Math.round(ModelTrainingYielder.THRESHOLD_MILLIS/meanBatchDuration),this.autoYieldEveryBatches<1&&(this.autoYieldEveryBatches=1))),this.batchStartMillis=tfjs_core_1.util.now(),this.lastYieldBatchCount=this.batchCount,[3,6];case 3:return this.batchCount-this.lastYieldBatchCount>=this.autoYieldEveryBatches?[4,tfjs_core_1.nextFrame()]:[3,6];case 4:return _a.sent(),[4,this.resolveOneTensorInLogs(logs)];case 5:_a.sent(),this.lastYieldBatchCount=this.batchCount,_a.label=6;case 6:return[3,9];case 7:return"batch"!==this.yieldEvery?[3,9]:[4,tfjs_core_1.nextFrame()];case 8:_a.sent(),_a.label=9;case 9:return[2]}})})},ModelTrainingYielder.prototype.maybeYieldOnEpoch=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return"epoch"!==this.yieldEvery?[3,2]:[4,tfjs_core_1.nextFrame()];case 1:_a.sent(),_a.label=2;case 2:return[2]}})})},ModelTrainingYielder.SKIP_FIRST_BATCHES=1,ModelTrainingYielder.DECISION_BATCH_COUNT=2,ModelTrainingYielder.THRESHOLD_MILLIS=16,ModelTrainingYielder}();exports.ModelTrainingYielder=ModelTrainingYielder;var BaseLogger=function(_super){function BaseLogger(yieldEvery){var _this=_super.call(this)||this;return _this.yieldEvery=yieldEvery||"auto",_this}return __extends(BaseLogger,_super),BaseLogger.prototype.onTrainBegin=function(logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return this.autoYielder=new ModelTrainingYielder(this.yieldEvery),[2]})})},BaseLogger.prototype.onEpochBegin=function(epoch){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return this.seen=0,this.totals={},[2]})})},BaseLogger.prototype.onBatchEnd=function(batch,logs){return __awaiter(this,void 0,void 0,function(){var batchSize,_loop_1,this_1,key,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.autoYielder.maybeYieldOnBatch(logs)];case 1:_a.sent(),null==logs&&(logs={}),batchSize=null==logs.size?0:logs.size,this.seen+=batchSize,_loop_1=function(key){var value=logs[key];if("number"==typeof value)this_1.totals.hasOwnProperty(key)||(this_1.totals[key]=0),this_1.totals[key]=this_1.totals[key]+value*batchSize;else{var oldTotalsToDispose=void 0;key in this_1.totals?oldTotalsToDispose=this_1.totals[key]:this_1.totals[key]=state_1.getScalar(0),this_1.totals[key]=tfjs_core_1.tidy(function(){return tfjs_core_1.add(_this.totals[key],tfjs_core_1.mul(value,state_1.getScalar(batchSize)))}),null!=oldTotalsToDispose&&oldTotalsToDispose.dispose()}},this_1=this;for(key in logs)_loop_1(key);return[2]}})})},BaseLogger.prototype.onEpochEnd=function(epoch,logs){return __awaiter(this,void 0,void 0,function(){var _loop_2,this_2,_i,_a,key,_this=this;return __generator(this,function(_b){switch(_b.label){case 0:return[4,this.autoYielder.maybeYieldOnEpoch()];case 1:if(_b.sent(),null!=logs)for(_loop_2=function(key){if(null==this_2.totals[key])return"continue";"number"==typeof this_2.totals[key]?logs[key]=this_2.totals[key]/this_2.seen:tfjs_core_1.tidy(function(){logs[key]=tfjs_core_1.mul(tfjs_core_1.div(state_1.getScalar(1),state_1.getScalar(_this.seen)),_this.totals[key]),_this.totals[key].dispose(),tfjs_core_1.keep(logs[key])})},this_2=this,_i=0,_a=this.params.metrics;_i<_a.length;_i++)key=_a[_i],_loop_2(key);return[2]}})})},BaseLogger}(BaseCallback);exports.BaseLogger=BaseLogger;var History=function(_super){function History(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(History,_super),History.prototype.onTrainBegin=function(logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return this.epoch=[],this.history={},[2]})})},History.prototype.onEpochEnd=function(epoch,logs){return __awaiter(this,void 0,void 0,function(){var key;return __generator(this,function(_a){null==logs&&(logs={}),this.epoch.push(epoch);for(key in logs)null==this.history[key]&&(this.history[key]=[]),this.history[key].push(logs[key]);return[2]})})},History.prototype.syncData=function(){return __awaiter(this,void 0,void 0,function(){var promises,keys,indices,key,valueArray,i,valueScalar,values,n,tensorToDispose;return __generator(this,function(_a){switch(_a.label){case 0:promises=[],keys=[],indices=[];for(key in this.history)for(valueArray=this.history[key],i=0;i<valueArray.length;++i)"number"!=typeof valueArray[i]&&(valueScalar=valueArray[i],promises.push(valueScalar.data()),keys.push(key),indices.push(i));return[4,Promise.all(promises)];case 1:for(values=_a.sent(),n=0;n<values.length;++n)tensorToDispose=this.history[keys[n]][indices[n]],tensorToDispose.dispose(),this.history[keys[n]][indices[n]]=values[n][0];return[2]}})})},History}(BaseCallback);exports.History=History;var CustomCallback=function(_super){function CustomCallback(config){var _this=_super.call(this)||this;return _this.trainBegin=config.onTrainBegin,_this.trainEnd=config.onTrainEnd,_this.epochBegin=config.onEpochBegin,_this.epochEnd=config.onEpochEnd,_this.batchBegin=config.onBatchBegin,_this.batchEnd=config.onBatchEnd,_this}return __extends(CustomCallback,_super),CustomCallback.prototype.onEpochBegin=function(epoch,logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return null==this.epochBegin?[3,3]:[4,logs_1.resolveScalarsInLogs(logs)];case 1:return _a.sent(),[4,this.epochBegin(epoch,logs)];case 2:_a.sent(),_a.label=3;case 3:return[2]}})})},CustomCallback.prototype.onEpochEnd=function(epoch,logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return null==this.epochEnd?[3,3]:[4,logs_1.resolveScalarsInLogs(logs)];case 1:return _a.sent(),[4,this.epochEnd(epoch,logs)];case 2:_a.sent(),_a.label=3;case 3:return[2]}})})},CustomCallback.prototype.onBatchBegin=function(batch,logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return null==this.batchBegin?[3,3]:[4,logs_1.resolveScalarsInLogs(logs)];case 1:return _a.sent(),[4,this.batchBegin(batch,logs)];case 2:_a.sent(),_a.label=3;case 3:return[2]}})})},CustomCallback.prototype.onBatchEnd=function(batch,logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return null==this.batchEnd?[3,3]:[4,logs_1.resolveScalarsInLogs(logs)];case 1:return _a.sent(),[4,this.batchEnd(batch,logs)];case 2:_a.sent(),_a.label=3;case 3:return[2]}})})},CustomCallback.prototype.onTrainBegin=function(logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return null==this.trainBegin?[3,3]:[4,logs_1.resolveScalarsInLogs(logs)];case 1:return _a.sent(),[4,this.trainBegin(logs)];case 2:_a.sent(),_a.label=3;case 3:return[2]}})})},CustomCallback.prototype.onTrainEnd=function(logs){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return null==this.trainEnd?[3,3]:[4,logs_1.resolveScalarsInLogs(logs)];case 1:return _a.sent(),[4,this.trainEnd(logs)];case 2:_a.sent(),_a.label=3;case 3:return[2]}})})},CustomCallback}(BaseCallback);exports.CustomCallback=CustomCallback,exports.standardizeCallbacks=standardizeCallbacks;var CallbackConstructorRegistry=function(){function CallbackConstructorRegistry(){}return CallbackConstructorRegistry.registerCallbackConstructor=function(verbosityLevel,callbackConstructor){tfjs_core_1.util.assert(verbosityLevel>=0&&Number.isInteger(verbosityLevel),"Verbosity level is expected to be an integer >= 0, but got "+verbosityLevel),CallbackConstructorRegistry.checkForDuplicate(callbackConstructor),null==CallbackConstructorRegistry.constructors[verbosityLevel]&&(CallbackConstructorRegistry.constructors[verbosityLevel]=[]),CallbackConstructorRegistry.constructors[verbosityLevel].push(callbackConstructor)},CallbackConstructorRegistry.checkForDuplicate=function(callbackConstructor){for(var levelName in CallbackConstructorRegistry.constructors){CallbackConstructorRegistry.constructors[+levelName].forEach(function(ctor){if(ctor===callbackConstructor)throw new errors_1.ValueError("Duplicate callback constructor.")})}},CallbackConstructorRegistry.clear=function(){CallbackConstructorRegistry.constructors={}},CallbackConstructorRegistry.createCallbacks=function(verbosityLevel){var constructors=[];for(var levelName in CallbackConstructorRegistry.constructors){var level=+levelName;verbosityLevel>=level&&constructors.push.apply(constructors,CallbackConstructorRegistry.constructors[level])}return constructors.map(function(ctor){return new ctor})},CallbackConstructorRegistry.constructors={},CallbackConstructorRegistry}();exports.CallbackConstructorRegistry=CallbackConstructorRegistry,exports.configureCallbacks=configureCallbacks},{"./backend/state":215,"./errors":228,"./logs":250,"./utils/generic_utils":257,"@tensorflow/tfjs-core":62}],218:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var base_callbacks_1=require("./base_callbacks"),training_1=require("./engine/training"),Callback=function(_super){function Callback(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.model=null,_this}return __extends(Callback,_super),Callback.prototype.setModel=function(model){if(!(model instanceof training_1.Model))throw new Error("model must be a Model, not some other Container");this.model=model},Callback}(base_callbacks_1.BaseCallback);exports.Callback=Callback},{"./base_callbacks":217,"./engine/training":225}],219:[function(require,module,exports){"use strict";function checkDataFormat(value){generic_utils_1.checkStringTypeUnionValue(exports.VALID_DATA_FORMAT_VALUES,"DataFormat",value)}function checkPaddingMode(value){generic_utils_1.checkStringTypeUnionValue(exports.VALID_PADDING_MODE_VALUES,"PaddingMode",value)}function checkPoolMode(value){generic_utils_1.checkStringTypeUnionValue(exports.VALID_POOL_MODE_VALUES,"PoolMode",value)}function nameScope(name,fn){_nameScopeStack.push(name);try{var val=fn();return _nameScopeStack.pop(),val}catch(e){throw _nameScopeStack.pop(),e}}function currentNameScopePrefix(){return 0===_nameScopeStack.length?"":_nameScopeStack.join(_nameScopeDivider)+_nameScopeDivider}function getScopedTensorName(tensorName){if(!isValidTensorName(tensorName))throw new Error("Not a valid tensor name: '"+tensorName+"'");return currentNameScopePrefix()+tensorName}function getUniqueTensorName(scopedName){if(!isValidTensorName(scopedName))throw new Error("Not a valid tensor name: '"+scopedName+"'");nameMap.has(scopedName)||nameMap.set(scopedName,0);var index=nameMap.get(scopedName);if(nameMap.set(scopedName,nameMap.get(scopedName)+1),index>0){var result=scopedName+"_"+index;return nameMap.set(result,1),result}return scopedName}function isValidTensorName(name){return!!name.match(tensorNameRegex)}Object.defineProperty(exports,"__esModule",{value:!0});var generic_utils_1=require("./utils/generic_utils"),nameMap=new Map;exports.VALID_DATA_FORMAT_VALUES=["channelsFirst","channelsLast"],exports.checkDataFormat=checkDataFormat,exports.VALID_PADDING_MODE_VALUES=["valid","same","causal"],exports.checkPaddingMode=checkPaddingMode,exports.VALID_POOL_MODE_VALUES=["max","avg"],exports.checkPoolMode=checkPoolMode;var _nameScopeStack=[],_nameScopeDivider="/";exports.nameScope=nameScope,exports.getScopedTensorName=getScopedTensorName,exports.getUniqueTensorName=getUniqueTensorName;var tensorNameRegex=new RegExp(/^[A-Za-z][-A-Za-z0-9\._\/]*$/);exports.isValidTensorName=isValidTensorName},{"./utils/generic_utils":257}],220:[function(require,module,exports){"use strict";function calcL2Norms(w,axis){return tfjs_core_1.tidy(function(){return tfc.sqrt(tfc.sum(tfc.mulStrict(w,w),axis,!0))})}function serializeConstraint(constraint){return generic_utils_1.serializeKerasObject(constraint)}function deserializeConstraint(config,customObjects){return void 0===customObjects&&(customObjects={}),generic_utils_1.deserializeKerasObject(config,tfjs_core_1.serialization.SerializationMap.getMap().classNameMap,customObjects,"constraint")}function getConstraint(identifier){if(null==identifier)return null
;if("string"==typeof identifier){return deserializeConstraint({className:identifier in exports.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP?exports.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP[identifier]:identifier,config:{}})}return identifier instanceof Constraint?identifier:deserializeConstraint(identifier)}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),common_1=require("./backend/common"),state_1=require("./backend/state"),generic_utils_1=require("./utils/generic_utils"),Constraint=function(_super){function Constraint(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Constraint,_super),Constraint.prototype.getConfig=function(){return{}},Constraint}(tfjs_core_1.serialization.Serializable);exports.Constraint=Constraint;var MaxNorm=function(_super){function MaxNorm(config){var _this=_super.call(this)||this;return _this.defaultMaxValue=2,_this.defaultAxis=0,_this.maxValue=null!=config.maxValue?config.maxValue:_this.defaultMaxValue,_this.axis=null!=config.axis?config.axis:_this.defaultAxis,_this}return __extends(MaxNorm,_super),MaxNorm.prototype.apply=function(w){var _this=this;return tfjs_core_1.tidy(function(){var norms=calcL2Norms(w,_this.axis),desired=tfc.clipByValue(norms,0,_this.maxValue);return tfc.mul(w,tfc.div(desired,tfc.add(state_1.getScalar(common_1.epsilon()),norms)))})},MaxNorm.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},MaxNorm.className="MaxNorm",MaxNorm}(Constraint);exports.MaxNorm=MaxNorm,tfjs_core_1.serialization.registerClass(MaxNorm);var UnitNorm=function(_super){function UnitNorm(config){var _this=_super.call(this)||this;return _this.defaultAxis=0,_this.axis=null!=config.axis?config.axis:_this.defaultAxis,_this}return __extends(UnitNorm,_super),UnitNorm.prototype.apply=function(w){var _this=this;return tfjs_core_1.tidy(function(){return tfc.div(w,tfc.add(state_1.getScalar(common_1.epsilon()),calcL2Norms(w,_this.axis)))})},UnitNorm.prototype.getConfig=function(){return{axis:this.axis}},UnitNorm.className="UnitNorm",UnitNorm}(Constraint);exports.UnitNorm=UnitNorm,tfjs_core_1.serialization.registerClass(UnitNorm);var NonNeg=function(_super){function NonNeg(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(NonNeg,_super),NonNeg.prototype.apply=function(w){return tfc.relu(w)},NonNeg.className="NonNeg",NonNeg}(Constraint);exports.NonNeg=NonNeg,tfjs_core_1.serialization.registerClass(NonNeg);var MinMaxNorm=function(_super){function MinMaxNorm(config){var _this=_super.call(this)||this;return _this.defaultMinValue=0,_this.defaultMaxValue=1,_this.defaultRate=1,_this.defaultAxis=0,_this.minValue=null!=config.minValue?config.minValue:_this.defaultMinValue,_this.maxValue=null!=config.maxValue?config.maxValue:_this.defaultMaxValue,_this.rate=null!=config.rate?config.rate:_this.defaultRate,_this.axis=null!=config.axis?config.axis:_this.defaultAxis,_this}return __extends(MinMaxNorm,_super),MinMaxNorm.prototype.apply=function(w){var _this=this;return tfjs_core_1.tidy(function(){var norms=calcL2Norms(w,_this.axis),desired=tfc.add(tfc.mul(state_1.getScalar(_this.rate),tfc.clipByValue(norms,_this.minValue,_this.maxValue)),tfc.mul(state_1.getScalar(1-_this.rate),norms));return tfc.mul(w,tfc.div(desired,tfc.add(state_1.getScalar(common_1.epsilon()),norms)))})},MinMaxNorm.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},MinMaxNorm.className="MinMaxNorm",MinMaxNorm}(Constraint);exports.MinMaxNorm=MinMaxNorm,tfjs_core_1.serialization.registerClass(MinMaxNorm),exports.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"},exports.serializeConstraint=serializeConstraint,exports.deserializeConstraint=deserializeConstraint,exports.getConstraint=getConstraint},{"./backend/common":214,"./backend/state":215,"./utils/generic_utils":257,"@tensorflow/tfjs-core":62}],221:[function(require,module,exports){"use strict";function preprocessWeightsForLoading(layer,weights,originalKerasVersion,originalBackend){if(!originalKerasVersion.startsWith("2."))throw new errors_1.ValueError("Unsupported Keras version in weights being loaded: "+originalKerasVersion);return weights}function loadTensor(dtype,shape,value){var dataType=generic_utils.stringToDType(dtype);return tfjs_core_1.Tensor.make(shape,{values:0===shape.length?value:tfjs_core_1.util.flatten(value)},dataType)}function loadWeightsFromJson(weightsJSON,layers,skipMismatch){void 0===skipMismatch&&(skipMismatch=!1);for(var originalKerasVersion=weightsJSON.keras_version,originalBackend=weightsJSON.backend,layerNames=layers.map(function(layer){return layer.name}),index={},_i=0,layers_1=layers;_i<layers_1.length;_i++){var layer=layers_1[_i];null!=layer.name&&(null==index[layer.name]&&(index[layer.name]=[]),index[layer.name].push(layer))}for(var nameToWeights=weightsJSON.weights,weightValueTuples=[],k=0;k<layerNames.length;++k){var name_1=layerNames[k],layerWeights=nameToWeights[name_1];null==layerWeights&&(layerWeights=[]);for(var weightValues=[],n=0;n<layerWeights.length;++n){var weightEntry=layerWeights[n];weightValues.push(new variables_1.LayerVariable(loadTensor(weightEntry.dtype,weightEntry.shape,weightEntry.value)))}for(var _a=0,_b=index[name_1];_a<_b.length;_a++){var layer=_b[_a],symbolicWeights=layer.weights;if(weightValues=preprocessWeightsForLoading(layer,weightValues,originalKerasVersion,originalBackend),weightValues.length!==symbolicWeights.length){if(!skipMismatch)throw new errors_1.ValueError("Layer #"+k+' (named "'+layer.name+'") expects '+symbolicWeights.length+" weight(s), but the saved weights have "+weightValues.length+" element(s).");console.warn("Skipping loading of weights of layer "+layer.name+" due to mismatch in number of weights: ("+weightValues.length+" vs "+symbolicWeights.length+").")}for(var i=0;i<weightValues.length;++i)!skipMismatch||tfjs_core_1.util.arraysEqual(symbolicWeights[i].shape,weightValues[i].shape)?weightValueTuples.push([symbolicWeights[i],weightValues[i].read()]):console.warn("Skipping loading of weights for layer "+layer.name+" due to mismatch in shape ("+symbolicWeights[i].shape+" vs "+weightValues[i].shape+")")}}variables_1.batchSetValue(weightValueTuples)}function loadWeightsFromNamedTensorMap(weights,layers,strict){void 0===strict&&(strict=!0);for(var nameToWeight={},totalWeightsCount=0,_i=0,layers_2=layers;_i<layers_2.length;_i++)for(var layer=layers_2[_i],_a=0,_b=layer.weights;_a<_b.length;_a++){var weight=_b[_a];if(null!=nameToWeight[weight.originalName])throw new errors_1.ValueError("Duplicate weight name: "+weight.originalName);nameToWeight[weight.originalName]=weight,totalWeightsCount++}var weightValueTuples=[];for(var name_2 in weights){if(null!=nameToWeight[name_2])weightValueTuples.push([nameToWeight[name_2],weights[name_2]]);else if(strict)throw new errors_1.ValueError("Provided weight data has no target variable: "+name_2);delete nameToWeight[name_2]}if(strict){var unsetNames=[];for(var name_3 in nameToWeight)unsetNames.push(name_3);if(unsetNames.length>0)throw new errors_1.ValueError(unsetNames.length+" of "+totalWeightsCount+" weights are not set: "+unsetNames)}variables_1.batchSetValue(weightValueTuples)}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("../backend/state"),errors_1=require("../errors"),serialization_1=require("../layers/serialization"),generic_utils=require("../utils/generic_utils"),serialization_utils_1=require("../utils/serialization_utils"),types_utils=require("../utils/types_utils"),variables_1=require("../variables"),version_1=require("../version"),input_layer_1=require("./input_layer"),topology_1=require("./topology");exports.loadWeightsFromJson=loadWeightsFromJson,exports.loadWeightsFromNamedTensorMap=loadWeightsFromNamedTensorMap;var Container=function(_super){function Container(config){var _this=_super.call(this,{})||this;if(_this.containerNodes=new Set,_this.name=config.name,null==_this.name){var prefix=_this.getClassName().toLowerCase();_this.name=state_1.getUid(prefix)}if(_this.supportsMasking=!1,_this.trainable=!0,_this.updatable=!0,Array.isArray(config.inputs)?_this.inputs=config.inputs.slice():_this.inputs=[config.inputs],Array.isArray(config.outputs)?_this.outputs=config.outputs.slice():_this.outputs=[config.outputs],generic_utils.unique(_this.inputs).length!==_this.inputs.length)throw new errors_1.ValueError("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+_this.inputs.map(function(x){return x.name}));generic_utils.unique(_this.outputs).length!==_this.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+_this.outputs.map(function(x){return x.name})),_this.inputLayers=[],_this.inputLayersNodeIndices=[],_this.inputLayersTensorIndices=[],_this.outputLayers=[],_this.outputLayersNodeIndices=[],_this.outputLayersTensorIndices=[],_this.layers=[];for(var _i=0,_a=_this.outputs;_i<_a.length;_i++){var x=_a[_i],layer=x.sourceLayer,nodeIndex=x.nodeIndex,tensorIndex=x.tensorIndex;_this.outputLayers.push(layer),_this.outputLayersNodeIndices.push(nodeIndex),_this.outputLayersTensorIndices.push(tensorIndex)}for(var _b=0,_c=_this.inputs;_b<_c.length;_b++){var x=_c[_b],layer=x.sourceLayer,nodeIndex=x.nodeIndex,tensorIndex=x.tensorIndex;generic_utils.assert(0===nodeIndex,"input layer has >1 nodes"),generic_utils.assert(0===tensorIndex,"input layer has >1 tensors"),_this.inputLayers.push(layer),_this.inputLayersNodeIndices.push(nodeIndex),_this.inputLayersTensorIndices.push(tensorIndex)}_this.inputNames=[],_this.outputNames=[],_this.feedInputShapes=[],_this.feedInputNames=[],_this.feedOutputNames=[];for(var i=0;i<_this.inputLayers.length;i++){var layer=_this.inputLayers[i];if(!(layer instanceof input_layer_1.InputLayer))throw new TypeError("Input layers to a Model must be InputLayer objects. Received inputs: "+config.inputs+". Input "+i+" (0-based) originates from layer type "+layer.getClassName()+".");_this.inputNames.push(layer.name),_this.feedInputShapes.push(layer.batchInputShape),_this.feedInputNames.push(layer.name)}for(var _d=0,_e=_this.outputLayers;_d<_e.length;_d++){var layer=_e[_d];_this.outputNames.push(layer.name)}_this.internalInputShapes=_this.inputs.map(function(x){return x.shape}),_this.internalOutputShapes=_this.outputs.map(function(x){return x.shape});for(var nodesDepths={},nodeIDToNode={},layersDepths={},layerIDToLayer={},layerIndices={},nodesInDecreasingDepth=[],buildMapOfGraph=(function(tensor,finishedNodes,nodesInProgress,layer,nodeIndex,tensorIndex){null!=layer&&null!=nodeIndex&&null!=tensorIndex||(layer=tensor.sourceLayer,nodeIndex=tensor.nodeIndex,tensorIndex=tensor.tensorIndex);var node=layer.inboundNodes[nodeIndex];if(-1!==nodesInProgress.indexOf(node))throw new errors_1.RuntimeError("The tensor "+tensor.name+' at layer "'+layer.name+'" is part of a cycle.');if(-1===finishedNodes.indexOf(node)){_this.containerNodes.add(Container.nodeKey(layer,nodeIndex)),layer.id in layerIndices||(layerIndices[layer.id]=Object.keys(layerIndices).length),-1===nodesInProgress.indexOf(node)&&nodesInProgress.push(node);for(var numInboundLayers=node.inboundLayers.length,i=0;i<numInboundLayers;i++){var x=node.inputTensors[i],layer_1=node.inboundLayers[i],nodeIndex_1=node.nodeIndices[i],tensorIndex_1=node.tensorIndices[i];buildMapOfGraph(x,finishedNodes,nodesInProgress,layer_1,nodeIndex_1,tensorIndex_1)}for(finishedNodes.push(node);nodesInProgress.indexOf(node)>=0;)nodesInProgress.splice(nodesInProgress.indexOf(node),1);nodesInDecreasingDepth.push(node)}}),finishedNodes=[],nodesInProgress=[],_f=0,_g=_this.outputs;_f<_g.length;_f++){var x=_g[_f];buildMapOfGraph(x,finishedNodes,nodesInProgress)}for(var reversedNodesInDecreasingDepth=nodesInDecreasingDepth.slice().reverse(),_h=0,reversedNodesInDecreasingDepth_1=reversedNodesInDecreasingDepth;_h<reversedNodesInDecreasingDepth_1.length;_h++){var node=reversedNodesInDecreasingDepth_1[_h];nodeIDToNode[node.id]=node,node.id in nodesDepths||(nodesDepths[node.id]=0);var depth=nodesDepths[node.id],previousDepth=null==layersDepths[node.outboundLayer.id]?0:layersDepths[node.outboundLayer.id];depth=Math.max(depth,previousDepth),layersDepths[node.outboundLayer.id]=depth,layerIDToLayer[node.outboundLayer.id]=node.outboundLayer,nodesDepths[node.id]=depth;for(var i=0;i<node.inboundLayers.length;i++){var inboundLayer=node.inboundLayers[i],nodeIndex=node.nodeIndices[i],inboundNode=inboundLayer.inboundNodes[nodeIndex],previousDepth_1=null==nodesDepths[inboundNode.id]?0:nodesDepths[inboundNode.id];nodesDepths[inboundNode.id]=Math.max(depth+1,previousDepth_1),nodeIDToNode[inboundNode.id]=inboundNode}}var nodesByDepth={};for(var nodeID in nodesDepths){var depth=nodesDepths[nodeID];depth in nodesByDepth||(nodesByDepth[depth]=[]),nodesByDepth[depth].push(nodeIDToNode[nodeID])}var layersByDepth={};for(var layerID in layersDepths){var depth=layersDepths[layerID];depth in layersByDepth||(layersByDepth[depth]=[]),layersByDepth[depth].push(layerIDToLayer[layerID])}var depthKeys=Object.keys(layersByDepth).map(function(x){return parseInt(x,10)}).sort(generic_utils.reverseNumberCompare);_this.layers=[];for(var _j=0,depthKeys_1=depthKeys;_j<depthKeys_1.length;_j++){var depth=depthKeys_1[_j],layersForDepth=layersByDepth[depth];layersForDepth.sort(function(a,b){var aIndex=layerIndices[a.id],bIndex=layerIndices[b.id];return aIndex<bIndex?-1:aIndex>bIndex?1:0});for(var _k=0,layersForDepth_1=layersForDepth;_k<layersForDepth_1.length;_k++){var layer=layersForDepth_1[_k];_this.layers.push(layer)}}_this.layersByDepth=layersByDepth,depthKeys=Object.keys(nodesByDepth).map(function(x){return parseInt(x,10)}).sort(generic_utils.reverseNumberCompare);for(var computableTensors=_this.inputs.slice(),layersWithCompleteInput=[],_l=0,depthKeys_2=depthKeys;_l<depthKeys_2.length;_l++)for(var depth=depthKeys_2[_l],_m=0,_o=nodesByDepth[depth];_m<_o.length;_m++){var node=_o[_m],layer=node.outboundLayer;if(null!=layer){for(var _p=0,_q=node.inputTensors;_p<_q.length;_p++){var x=_q[_p];if(-1===computableTensors.indexOf(x))throw new errors_1.RuntimeError("Graph disconnected: cannot obtain value for tensor "+x+' at layer "'+layer.name+'". The following previous layers were accessed without issue: '+layersWithCompleteInput)}for(var _r=0,_s=node.outputTensors;_r<_s.length;_r++){var x=_s[_r];computableTensors.push(x)}layersWithCompleteInput.push(layer.name)}}_this.nodesByDepth=nodesByDepth;for(var allNames=_this.layers.map(function(x){return x.name}),_t=0,allNames_1=allNames;_t<allNames_1.length;_t++){var name_4=allNames_1[_t];!function(name_4){var numOccurrences=allNames.filter(function(x){return x===name_4}).length;if(1!==numOccurrences)throw new errors_1.RuntimeError('The name "'+name_4+'" is used '+numOccurrences+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(allNames))}(name_4)}return _this.outboundNodes=[],_this.inboundNodes=[],new topology_1.Node({outboundLayer:_this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:_this.inputs,outputTensors:_this.outputs,inputMasks:_this.inputs.map(function(x){return null}),outputMasks:_this.outputs.map(function(x){return null}),inputShapes:_this.inputs.map(function(x){return x.shape}),outputShapes:_this.outputs.map(function(x){return x.shape})}),_this.built=!0,_this._refCount=1,_this}return __extends(Container,_super),Container.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},Container.prototype.dispose=function(){this.assertNotDisposed();var result={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount)for(var _i=0,_a=this.layers;_i<_a.length;_i++){var layer=_a[_i];result.numDisposedVariables+=layer.dispose().numDisposedVariables}return result.refCountAfterDispose=this._refCount,result},Object.defineProperty(Container.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new errors_1.ValueError("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var weights=[],_i=0,_a=this.layers;_i<_a.length;_i++){var layer=_a[_i];weights=weights.concat(layer.trainableWeights)}return weights},enumerable:!0,configurable:!0}),Object.defineProperty(Container.prototype,"nonTrainableWeights",{get:function(){for(var weights=[],_i=0,_a=this.layers;_i<_a.length;_i++){var layer=_a[_i];weights.push.apply(weights,layer.nonTrainableWeights)}if(!this.trainable){for(var trainableWeights=[],_b=0,_c=this.layers;_b<_c.length;_b++){var layer=_c[_b];trainableWeights.push.apply(trainableWeights,layer.trainableWeights)}return trainableWeights.concat(weights)}return weights},enumerable:!0,configurable:!0}),Object.defineProperty(Container.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Container.prototype.loadWeights=function(weightsJSON,skipMismatch,isNamedTensorMap,strict){void 0===skipMismatch&&(skipMismatch=!1),void 0===isNamedTensorMap&&(isNamedTensorMap=!1),void 0===strict&&(strict=!0),isNamedTensorMap?loadWeightsFromNamedTensorMap(weightsJSON,this.layers,strict):loadWeightsFromJson(weightsJSON,this.layers,skipMismatch)},Container.prototype.updatedConfig=function(){var theConfig=this.getConfig();return{className:this.getClassName(),config:theConfig,kerasVersion:"tfjs-layers "+version_1.version,backend:"TensorFlow.js"}},Container.prototype.toJSON=function(unused,returnString){void 0===returnString&&(returnString=!0);var modelConfig=serialization_utils_1.convertTsToPythonic(this.updatedConfig());return returnString?JSON.stringify(modelConfig):modelConfig},Container.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){inputs=generic_utils.toList(inputs);var masks;return masks="mask"in kwargs?generic_utils.toList(kwargs.mask):generic_utils.pyListRepeat(null,inputs.length),_this.runInternalGraph(inputs,masks)[0]})},Container.prototype.computeMask=function(inputs,mask){var _this=this;return tfjs_core_1.tidy(function(){inputs=generic_utils.toList(inputs);var masks;return masks=null==mask?generic_utils.pyListRepeat(null,inputs.length):generic_utils.toList(mask),_this.runInternalGraph(inputs,masks)[1]})},Container.prototype.computeOutputShape=function(inputShape){var inputShapes=types_utils.normalizeShapeList(inputShape);if(inputShapes.length!==this.inputLayers.length)throw new errors_1.ValueError("Invalid inputShape argument "+inputShape+": model has "+this.inputLayers.length+" tensor inputs.");for(var layersToOutputShapes={},i=0;i<inputShapes.length;i++){var layer=this.inputLayers[i],inputShape_1=inputShapes[i],shapeKey=layer.name+"_0_0";layersToOutputShapes[shapeKey]=inputShape_1}var depthKeys=Object.keys(this.nodesByDepth).map(function(x){return parseInt(x,10)}).sort(generic_utils.reverseNumberCompare);if(depthKeys.length>1)for(var _i=0,depthKeys_3=depthKeys;_i<depthKeys_3.length;_i++)for(var depth=depthKeys_3[_i],nodes=this.nodesByDepth[depth],_a=0,nodes_1=nodes;_a<nodes_1.length;_a++){var node=nodes_1[_a],layer=node.outboundLayer;if(-1===this.inputLayers.map(function(x){return x.id}).indexOf(layer.id)){for(var inputShapes_1=[],j=0;j<node.inboundLayers.length;j++){var inboundLayer=node.inboundLayers[j],nodeIndex_2=node.nodeIndices[j],tensorIndex=node.tensorIndices[j],shapeKey=inboundLayer.name+"_"+nodeIndex_2+"_"+tensorIndex,inputShape_2=layersToOutputShapes[shapeKey];inputShapes_1.push(inputShape_2)}for(var outputShape=layer.computeOutputShape(generic_utils.singletonOrArray(inputShapes_1)),outputShapes_1=types_utils.normalizeShapeList(outputShape),nodeIndex=layer.inboundNodes.indexOf(node),j=0;j<outputShapes_1.length;j++){var shapeKey=layer.name+"_"+nodeIndex+"_"+j;layersToOutputShapes[shapeKey]=outputShapes_1[j]}}}for(var outputShapes=[],outputShapeKeys=[],i=0;i<this.outputLayers.length;i++){var layer=this.outputLayers[i],nodeIndex=this.outputLayersNodeIndices[i],tensorIndex=this.outputLayersTensorIndices[i],shapeKey=layer.name+"_"+nodeIndex+"_"+tensorIndex;outputShapeKeys.push(shapeKey)}for(var i=0;i<outputShapeKeys.length;i++){var key=outputShapeKeys[i];generic_utils.assert(key in layersToOutputShapes),outputShapes.push(layersToOutputShapes[key])}return generic_utils.singletonOrArray(outputShapes)},Container.prototype.runInternalGraph=function(inputs,masks){null==masks&&(masks=generic_utils.pyListRepeat(null,inputs.length));for(var tensorMap={},i=0;i<this.inputs.length;++i){var x=this.inputs[i],y=inputs[i],mask=masks[i];tensorMap[x.id]=[y,mask]}for(var depthKeys=Object.keys(this.nodesByDepth).map(function(x){return parseInt(x,10)}).sort(generic_utils.reverseNumberCompare),_i=0,depthKeys_4=depthKeys;_i<depthKeys_4.length;_i++)for(var depth=depthKeys_4[_i],nodes=this.nodesByDepth[depth],_a=0,nodes_2=nodes;_a<nodes_2.length;_a++){for(var node=nodes_2[_a],layer=node.outboundLayer,referenceInputTensors=node.inputTensors,referenceOutputTensors=node.outputTensors,computedData=new Array,_b=0,referenceInputTensors_1=referenceInputTensors;_b<referenceInputTensors_1.length;_b++){var x=referenceInputTensors_1[_b];x.id in tensorMap&&computedData.push(tensorMap[x.id])}if(computedData.length===referenceInputTensors.length){var kwargs={},computedTensors=void 0,computedMasks=void 0,outputTensors_1=void 0,outputMasks_1=void 0;if(null!=node.callArgs&&(kwargs=node.callArgs),1===computedData.length){var _c=computedData[0],computedTensor=_c[0],computedMask=_c[1];null==kwargs.mask&&(kwargs.mask=computedMask),outputTensors_1=generic_utils.toList(layer.call(computedTensor,kwargs)),outputMasks_1=generic_utils.toList(layer.computeMask(computedTensor,computedMask)),computedTensors=[computedTensor],computedMasks=[computedMask]}else computedTensors=computedData.map(function(x){return x[0]}),computedMasks=computedData.map(function(x){return x[1]}),null==kwargs.mask&&(kwargs.mask=computedMasks),outputTensors_1=generic_utils.toList(layer.call(computedTensors,kwargs)),outputMasks_1=generic_utils.toList(layer.computeMask(computedTensors,computedMasks));if(layer.activityRegularizer)throw new errors_1.NotImplementedError("Model invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var i=0;i<referenceOutputTensors.length;++i){var x=referenceOutputTensors[i],y=outputTensors_1[i],mask=outputMasks_1[i];tensorMap[x.id]=[y,mask]}}}for(var outputTensors=[],outputMasks=[],outputShapes=[],_d=0,_e=this.outputs;_d<_e.length;_d++){var x=_e[_d];generic_utils.assert(x.id in tensorMap,"Could not compute output "+x.name+" : "+x.id);var _f=tensorMap[x.id],tensor=_f[0],mask=_f[1];outputShapes.push(tensor.shape),outputTensors.push(tensor),outputMasks.push(mask)}return[outputTensors,outputMasks,outputShapes]},Container.prototype.buildNodeConversionMap=function(layers){for(var keptNodes,nodeConversionMap={},_i=0,_a=this.layers;_i<_a.length;_i++){var layer=_a[_i];keptNodes=layer instanceof Container?1:0;for(var originalNodeIndex=0;originalNodeIndex<layer.inboundNodes.length;originalNodeIndex++){var nodeKey=Container.nodeKey(layer,originalNodeIndex);this.containerNodes.has(nodeKey)&&(nodeConversionMap[nodeKey]=keptNodes,keptNodes+=1)}}return nodeConversionMap},Container.prototype.getLayer=function(name,index){if(null!=index){if(this.layers.length<=index)throw new errors_1.ValueError("Was asked to retrieve layer at index "+index+", but model only has "+this.layers.length+" layer(s).");return this.layers[index]}if(null==name)throw new errors_1.ValueError("Provide either a layer name or layer index");for(var _i=0,_a=this.layers;_i<_a.length;_i++){var layer=_a[_i];if(layer.name===name)return layer}throw new errors_1.ValueError("No such layer: "+name)},Container.prototype.calculateLosses=function(){var _this=this;return tfjs_core_1.tidy(function(){for(var losses=[],_i=0,_a=_this.layers;_i<_a.length;_i++)for(var layer=_a[_i],nodeIndex=0;nodeIndex<layer.inboundNodes.length;++nodeIndex){var nodeKey=Container.nodeKey(layer,nodeIndex);_this.containerNodes.has(nodeKey)&&losses.push.apply(losses,layer.calculateLosses())}return losses})},Container.prototype.getConfig=function(){for(var config={name:this.name},nodeConversionMap=this.buildNodeConversionMap(this.layers),layerConfigs=[],_i=0,_a=this.layers;_i<_a.length;_i++){for(var layer=_a[_i],layerClassName=layer.getClassName(),layerConfig=layer.getConfig(),filteredInboundNodes=[],originalNodeIndex=0;originalNodeIndex<layer.inboundNodes.length;originalNodeIndex++){var node=layer.inboundNodes[originalNodeIndex],nodeKey=Container.nodeKey(layer,originalNodeIndex),kwargs={};if(this.containerNodes.has(nodeKey)){if(node.callArgs)try{JSON.stringify(node.callArgs),kwargs=node.callArgs}catch(err){console.warn("Layer "+layer.name+" was passed non-serializable keyword arguments: "+node.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),kwargs={}}if(node.inboundLayers.length>0){for(var nodeData=[],i=0;i<node.inboundLayers.length;i++){var inboundLayer=node.inboundLayers[i],nodeIndex=node.nodeIndices[i],tensorIndex=node.tensorIndices[i],nodeKey_1=Container.nodeKey(inboundLayer,nodeIndex),newNodeIndex=nodeConversionMap[nodeKey_1];null==newNodeIndex&&(newNodeIndex=0),nodeData.push([inboundLayer.name,newNodeIndex,tensorIndex,kwargs])}filteredInboundNodes.push(nodeData)}}}layerConfigs.push({name:layer.name,className:layerClassName,config:layerConfig,inboundNodes:filteredInboundNodes})}config.layers=layerConfigs;for(var modelInputs=[],i=0;i<this.inputLayers.length;i++){var layer=this.inputLayers[i],nodeIndex=this.inputLayersNodeIndices[i],nodeKey=Container.nodeKey(layer,nodeIndex);if(this.containerNodes.has(nodeKey)){var newNodeIndex=nodeConversionMap[nodeKey];null!==newNodeIndex&&void 0!==newNodeIndex||(newNodeIndex=0);var tensorIndex=this.inputLayersTensorIndices[i];modelInputs.push([layer.name,newNodeIndex,tensorIndex])}}config.inputLayers=modelInputs;for(var modelOutputs=[],i=0;i<this.outputLayers.length;i++){var layer=this.outputLayers[i],nodeIndex=this.outputLayersNodeIndices[i],nodeKey=Container.nodeKey(layer,nodeIndex);if(this.containerNodes.has(nodeKey)){var newNodeIndex=nodeConversionMap[nodeKey];null!==newNodeIndex&&void 0!==newNodeIndex||(newNodeIndex=0);var tensorIndex=this.outputLayersTensorIndices[i];modelOutputs.push([layer.name,newNodeIndex,tensorIndex])}}return config.outputLayers=modelOutputs,config},Container.fromConfig=function(cls,config){function addUnprocessedNode(layer,nodeData){layer.name in unprocessedNodes?unprocessedNodes[layer.name].push(nodeData):unprocessedNodes[layer.name]=[nodeData]}for(var createdLayers={},unprocessedNodes={},name=config.name,layersFromConfig=config.layers,_i=0,layersFromConfig_1=layersFromConfig;_i<layersFromConfig_1.length;_i++){var layerData=layersFromConfig_1[_i];!function(layerData){var layerName=layerData.name,layer=serialization_1.deserialize(layerData,null!=config.customObjects?config.customObjects:{});createdLayers[layerName]=layer;for(var inboundNodesData=layerData.inboundNodes,_i=0,inboundNodesData_1=inboundNodesData;_i<inboundNodesData_1.length;_i++){var nodeData=inboundNodesData_1[_i];if(!(nodeData instanceof Array))throw new errors_1.ValueError("Corrupted configuration, expected array for nodeData: "+nodeData);addUnprocessedNode(layer,nodeData)}}(layerData)}for(;!generic_utils.isObjectEmpty(unprocessedNodes);)for(var _a=0,layersFromConfig_2=layersFromConfig;_a<layersFromConfig_2.length;_a++){var layerData=layersFromConfig_2[_a],layer=createdLayers[layerData.name];if(layer.name in unprocessedNodes){var currentUnprocessedNodesForLayer=unprocessedNodes[layer.name];delete unprocessedNodes[layer.name];for(var _b=0,currentUnprocessedNodesForLayer_1=currentUnprocessedNodesForLayer;_b<currentUnprocessedNodesForLayer_1.length;_b++){var nodeData=currentUnprocessedNodesForLayer_1[_b];!function(layer,nodeData){for(var kwargs,inputTensors=[],_i=0,nodeData_1=nodeData;_i<nodeData_1.length;_i++){var inputData=nodeData_1[_i],inboundLayerName=inputData[0],inboundNodeIndex=inputData[1],inboundTensorIndex=inputData[2];if(3===inputData.length)kwargs={};else{if(4!==inputData.length)throw new errors_1.ValueError("Improperly formatted model config for layer "+JSON.stringify(layer)+": "+JSON.stringify(inputData));kwargs=inputData[3]}if(!(inboundLayerName in createdLayers))return void addUnprocessedNode(layer,nodeData);var inboundLayer=createdLayers[inboundLayerName];if(inboundLayer.inboundNodes.length<=inboundNodeIndex)return void addUnprocessedNode(layer,nodeData);var inboundNode=inboundLayer.inboundNodes[inboundNodeIndex];inputTensors.push(inboundNode.outputTensors[inboundTensorIndex])}inputTensors.length>0&&layer.apply(generic_utils.singletonOrArray(inputTensors),kwargs)}(layer,nodeData)}}}for(var inputTensors=[],outputTensors=[],inputLayersFromConfig=config.inputLayers,_c=0,inputLayersFromConfig_1=inputLayersFromConfig;_c<inputLayersFromConfig_1.length;_c++){var layerData=inputLayersFromConfig_1[_c],layerName=layerData[0],nodeIndex=layerData[1],tensorIndex=layerData[2];generic_utils.assert(layerName in createdLayers);var layer=createdLayers[layerName],layerOutputTensors=layer.inboundNodes[nodeIndex].outputTensors;inputTensors.push(layerOutputTensors[tensorIndex])}for(var outputLayersFromConfig=config.outputLayers,_d=0,outputLayersFromConfig_1=outputLayersFromConfig;_d<outputLayersFromConfig_1.length;_d++){var layerData=outputLayersFromConfig_1[_d],layerName=layerData[0],nodeIndex=layerData[1],tensorIndex=layerData[2];generic_utils.assert(layerName in createdLayers);var layer=createdLayers[layerName],layerOutputTensors=layer.inboundNodes[nodeIndex].outputTensors;outputTensors.push(layerOutputTensors[tensorIndex])}return new cls({inputs:inputTensors,outputs:outputTensors,name:name})},Object.defineProperty(Container.prototype,"stateful",{get:function(){if(this._stateful)throw new errors_1.ValueError("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var _i=0,_a=this.layers;_i<_a.length;_i++){if(_a[_i].stateful)return!0}return!1},enumerable:!0,configurable:!0}),Container.prototype.resetStates=function(){var _this=this;tfjs_core_1.tidy(function(){_this.layers.forEach(function(layer){layer.stateful&&layer.resetStates()})})},Container}(topology_1.Layer);exports.Container=Container},{"../backend/state":215,"../errors":228,"../layers/serialization":248,"../utils/generic_utils":257,"../utils/serialization_utils":260,"../utils/types_utils":261,"../variables":263,"../version":264,"./input_layer":223,"./topology":224,"@tensorflow/tfjs-core":62}],222:[function(require,module,exports){"use strict";function assertFeedCompatibility(key,val){if(null!=key.shape){
if(key.shape.length!==val.shape.length)throw new errors_1.ValueError("The rank of feed ("+val.shape.length+") does not match the rank of the key ("+key.shape.length+").");for(var i=0;i<key.shape.length;++i)if(null!=key.shape[i]&&key.shape[i]!==val.shape[i])throw new errors_1.ValueError("The "+i+"-th dimension of the feed ("+val.shape[i]+") is incompatible with that of the key ("+key.shape[i]+").")}if(null==key.dtype||key.dtype===val.dtype)return val;try{return tfjs_core_1.cast(val,key.dtype)}catch(err){throw new errors_1.ValueError("The dtype of the feed ("+val.dtype+") can not be cast to the dtype of the key '"+key.name+"' ("+key.dtype+").")}}function execute(fetches,feedDict,kwargs){for(var arrayFetches=Array.isArray(fetches),fetchArray=arrayFetches?fetches:[fetches],outputs=[],internalFeedDict=new FeedDict(feedDict),_i=0,fetchArray_1=fetchArray;_i<fetchArray_1.length;_i++){var fetch_1=fetchArray_1[_i];outputs.push(executeInternal(fetch_1,internalFeedDict,kwargs))}return arrayFetches?outputs:outputs[0]}function executeInternal(fetch,internalFeedDict,kwargs){if(internalFeedDict.hasKey(fetch))return internalFeedDict.getValue(fetch);if(fetch.sourceLayer instanceof input_layer_1.InputLayer)throw new errors_1.ValueError("Missing a feed value for SymbolicTensor from InputLayer '"+input_layer_1.InputLayer.name+"'");for(var inputs=fetch.inputs,inputValues=[],_i=0,inputs_1=inputs;_i<inputs_1.length;_i++){var input=inputs_1[_i],inputVal=executeInternal(input,internalFeedDict,kwargs);inputValues.push(inputVal)}var output=fetch.sourceLayer.apply(inputValues,kwargs);Array.isArray(output)||(output=[output]);for(var layerOutputs=getNodeOutputs(fetch),outputSymbolicTensors=Array.isArray(layerOutputs)?layerOutputs:[layerOutputs],i=0;i<outputSymbolicTensors.length;++i)internalFeedDict.add(outputSymbolicTensors[i],output[i]);return 1===output.length?output[0]:output[fetch.outputTensorIndex]}function getNodeOutputs(fetch){var layerOutputs;if(1===fetch.sourceLayer.inboundNodes.length)layerOutputs=fetch.sourceLayer.output;else{for(var nodeIndex=null,i=0;i<fetch.sourceLayer.inboundNodes.length;++i)for(var _i=0,_a=fetch.sourceLayer.inboundNodes[i].outputTensors;_i<_a.length;_i++){var outputTensor=_a[_i];if(outputTensor.id===fetch.id){nodeIndex=i;break}}layerOutputs=fetch.sourceLayer.getOutputAt(nodeIndex)}return layerOutputs}Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),errors_1=require("../errors"),input_layer_1=require("./input_layer"),FeedDict=function(){function FeedDict(feeds){if(this.id2Value={},feeds instanceof FeedDict)for(var id in feeds.id2Value)this.id2Value[id]=feeds.id2Value[id];else{if(null==feeds)return;for(var _i=0,feeds_1=feeds;_i<feeds_1.length;_i++){var feed=feeds_1[_i];this.add(feed.key,feed.value)}}}return FeedDict.prototype.add=function(key,value){if(null!=this.id2Value[key.id])throw new errors_1.ValueError("Duplicate key: name="+key.name+", id="+key.id);return this.id2Value[key.id]=assertFeedCompatibility(key,value),this},FeedDict.prototype.addFeed=function(feed){this.add(feed.key,feed.value)},FeedDict.prototype.hasKey=function(key){return null!=this.id2Value[key.id]},FeedDict.prototype.getValue=function(key){if(null==this.id2Value[key.id])throw new errors_1.ValueError("Nonexistent key: "+JSON.stringify(key));return this.id2Value[key.id]},FeedDict}();exports.FeedDict=FeedDict,exports.execute=execute},{"../errors":228,"./input_layer":223,"@tensorflow/tfjs-core":62}],223:[function(require,module,exports){"use strict";function Input(config){if(null==config.batchShape&&null==config.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=config.batchShape&&null!=config.shape)throw new errors_1.ValueError("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var batchShape=config.batchShape;null!=config.shape&&null==batchShape&&(batchShape=[null].concat(config.shape));var dtype=config.dtype;return null==dtype&&(dtype="float32"),new InputLayer({batchInputShape:batchShape,name:config.name,dtype:dtype,sparse:config.sparse}).inboundNodes[0].outputTensors[0]}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("../backend/state"),errors_1=require("../errors"),topology_1=require("./topology"),InputLayer=function(_super){function InputLayer(config){var _this=_super.call(this,{dtype:config.dtype,name:null!=config.name?config.name:state_1.getUid("input").toString()})||this;if(null==config.batchSize&&(config.batchSize=null),null==config.sparse&&(config.sparse=!1),_this.trainable=!1,_this.built=!0,_this.sparse=config.sparse,null!=config.inputShape&&null!=config.batchInputShape)throw new errors_1.ValueError("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var batchInputShape=config.batchInputShape;if(null==batchInputShape){if(null==config.inputShape)throw new errors_1.ValueError("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");batchInputShape=[config.batchSize].concat(config.inputShape)}else if(null!=config.batchSize)throw new errors_1.ValueError("Cannot specify batchSize if batchInputShape isspecified when creating an InputLayer.");var dtype=config.dtype||"float32";_this.batchInputShape=batchInputShape,_this.dtype=dtype,_this.inputSpec=[{shape:batchInputShape}];var inputTensor=new topology_1.SymbolicTensor(_this.dtype,_this.batchInputShape,_this,[],{},_this.name);return inputTensor.nodeIndex=0,inputTensor.tensorIndex=0,new topology_1.Node({outboundLayer:_this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[inputTensor],outputTensors:[inputTensor],inputMasks:[null],outputMasks:[null],inputShapes:[batchInputShape],outputShapes:[batchInputShape]}),_this}return __extends(InputLayer,_super),InputLayer.prototype.apply=function(inputs,kwargs){throw new errors_1.ValueError("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},InputLayer.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},InputLayer.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},InputLayer.className="InputLayer",InputLayer}(topology_1.Layer);exports.InputLayer=InputLayer,tfjs_core_1.serialization.registerClass(InputLayer),exports.Input=Input},{"../backend/state":215,"../errors":228,"./topology":224,"@tensorflow/tfjs-core":62}],224:[function(require,module,exports){"use strict";function collectInputShape(inputTensors){inputTensors=generic_utils.toList(inputTensors);for(var shapes=[],_i=0,inputTensors_1=inputTensors;_i<inputTensors_1.length;_i++){var x=inputTensors_1[_i];shapes.push(x.shape)}return generic_utils.singletonOrArray(shapes)}function getSourceInputs(tensor,layer,nodeIndex){if((null==layer||null!=nodeIndex&&nodeIndex>0)&&(layer=tensor.sourceLayer,nodeIndex=tensor.nodeIndex),0===layer.inboundNodes.length)return[tensor];var node=layer.inboundNodes[nodeIndex];if(0===node.inboundLayers.length)return node.inputTensors;for(var sourceTensors=[],i=0;i<node.inboundLayers.length;i++)for(var x=node.inputTensors[i],layer_1=node.inboundLayers[i],nodeIndex_1=node.nodeIndices[i],previousSources=getSourceInputs(x,layer_1,nodeIndex_1),_i=0,previousSources_1=previousSources;_i<previousSources_1.length;_i++){var x_1=previousSources_1[_i];-1===sourceTensors.indexOf(x_1)&&sourceTensors.push(x_1)}return sourceTensors}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("../backend/state"),common_1=require("../common"),errors_1=require("../errors"),generic_utils=require("../utils/generic_utils"),types_utils=require("../utils/types_utils"),variable_utils=require("../utils/variable_utils"),variables_1=require("../variables"),InputSpec=function(){function InputSpec(config){this.dtype=config.dtype,this.shape=config.shape,null!=config.shape?this.ndim=config.shape.length:this.ndim=config.ndim,this.maxNDim=config.maxNDim,this.minNDim=config.minNDim,this.axes=config.axes||{}}return InputSpec}();exports.InputSpec=InputSpec;var SymbolicTensor=function(){function SymbolicTensor(dtype,shape,sourceLayer,inputs,callArgs,name,outputTensorIndex){this.dtype=dtype,this.shape=shape,this.sourceLayer=sourceLayer,this.inputs=inputs,this.callArgs=callArgs,this.outputTensorIndex=outputTensorIndex,this.id=state_1.getNextUniqueTensorId(),null!=name&&(this.originalName=common_1.getScopedTensorName(name),this.name=common_1.getUniqueTensorName(this.originalName)),this.rank=shape.length}return SymbolicTensor}();exports.SymbolicTensor=SymbolicTensor;var _nextNodeID=0,Node=function(){function Node(config,callArgs){this.callArgs=callArgs,this.id=_nextNodeID++,this.outboundLayer=config.outboundLayer,this.inboundLayers=config.inboundLayers,this.nodeIndices=config.nodeIndices,this.tensorIndices=config.tensorIndices,this.inputTensors=config.inputTensors,this.outputTensors=config.outputTensors,this.inputMasks=config.inputMasks,this.outputMasks=config.outputMasks,this.inputShapes=config.inputShapes,this.outputShapes=config.outputShapes;for(var _i=0,_a=config.inboundLayers;_i<_a.length;_i++){var layer=_a[_i];null!=layer&&layer.outboundNodes.push(this)}config.outboundLayer.inboundNodes.push(this)}return Node.prototype.getConfig=function(){for(var inboundNames=[],_i=0,_a=this.inboundLayers;_i<_a.length;_i++){var layer=_a[_i];null!=layer?inboundNames.push(layer.name):inboundNames.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:inboundNames,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},Node}();exports.Node=Node;var _nextLayerID=0,Layer=function(_super){function Layer(config){var _this=_super.call(this)||this;_this._callHook=null,_this._addedWeightNames=[],_this._stateful=!1,_this.id=_nextLayerID++,_this.activityRegularizer=null,_this.inputSpec=null,_this.supportsMasking=!1,_this._trainableWeights=[],_this._nonTrainableWeights=[],_this._losses=[],_this._updates=[],_this._built=!1,_this.inboundNodes=[],_this.outboundNodes=[];var name=config.name;if(!name){var prefix=_this.getClassName();name=generic_utils.toSnakeCase(prefix)+"_"+state_1.getUid(prefix)}if(_this.name=name,_this.trainable=null==config.trainable||config.trainable,_this.updatable=null==config.updatable||config.updatable,null!=config.inputShape||null!=config.batchInputShape){var batchInputShape=void 0;if(null!=config.batchInputShape)batchInputShape=config.batchInputShape;else if(null!=config.inputShape){var batchSize=null;null!=config.batchSize&&(batchSize=config.batchSize),batchInputShape=[batchSize].concat(config.inputShape)}_this.batchInputShape=batchInputShape;var dtype=config.dtype;null==dtype&&(dtype=config.inputDType),null==dtype&&(dtype="float32"),_this.dtype=dtype}return null!=config.weights?_this.initialWeights=config.weights:_this.initialWeights=null,_this._refCount=null,_this}return __extends(Layer,_super),Layer.nodeKey=function(layer,nodeIndex){return layer.name+"_ib-"+nodeIndex.toString()},Layer.prototype.getNodeAtIndex=function(nodeIndex,attrName){if(0===this.inboundNodes.length)throw new errors_1.RuntimeError("The layer has never been called and thus has no defined "+attrName+".");if(this.inboundNodes.length<=nodeIndex)throw new errors_1.ValueError("Asked to get "+attrName+" at node "+nodeIndex+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[nodeIndex]},Layer.prototype.getInputAt=function(nodeIndex){return generic_utils.singletonOrArray(this.getNodeAtIndex(nodeIndex,"input").inputTensors)},Layer.prototype.getOutputAt=function(nodeIndex){return generic_utils.singletonOrArray(this.getNodeAtIndex(nodeIndex,"output").outputTensors)},Object.defineProperty(Layer.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new errors_1.AttributeError("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new errors_1.AttributeError("Layer "+this.name+" is not connected, no input to return.");return generic_utils.singletonOrArray(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new errors_1.AttributeError("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new errors_1.AttributeError("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return generic_utils.singletonOrArray(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),Layer.prototype.calculateLosses=function(){return this.losses.map(function(lossFn){return lossFn()})},Object.defineProperty(Layer.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"built",{get:function(){return this._built},set:function(built){this._built=built},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"trainableWeights",{get:function(){return this.trainable?this._trainableWeights:[]},set:function(weights){this._trainableWeights=weights},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._nonTrainableWeights:this._trainableWeights.concat(this._nonTrainableWeights)},set:function(weights){this._nonTrainableWeights=weights},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(Layer.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),Layer.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},Layer.prototype.assertInputCompatibility=function(inputs){if(inputs=generic_utils.toList(inputs),null!=this.inputSpec&&0!==this.inputSpec.length){var inputSpec=generic_utils.toList(this.inputSpec);if(inputs.length!==inputSpec.length)throw new errors_1.ValueError("Layer "+this.name+" expects "+inputSpec.length+" inputs, but it received "+inputs.length+" input tensors. Input received: "+inputs);for(var inputIndex=0;inputIndex<inputs.length;inputIndex++){var x=inputs[inputIndex],spec=inputSpec[inputIndex];if(null!=spec){var ndim=x.rank;if(null!=spec.ndim&&ndim!==spec.ndim)throw new errors_1.ValueError("Input "+inputIndex+" is incompatible with layer "+this.name+": expected ndim="+spec.ndim+", found ndim="+ndim);if(null!=spec.maxNDim&&ndim>spec.maxNDim)throw new errors_1.ValueError("Input "+inputIndex+" is incompatible with layer "+this.name+": expected max_ndim="+spec.maxNDim+", found ndim="+ndim);if(null!=spec.minNDim&&ndim<spec.minNDim)throw new errors_1.ValueError("Input "+inputIndex+" is incompatible with layer "+this.name+": expected min_ndim="+spec.minNDim+", found ndim="+ndim+".");if(null!=spec.dtype&&x.dtype!==spec.dtype)throw new errors_1.ValueError("Input "+inputIndex+" is incompatible with layer "+this.name+" : expected dtype="+spec.dtype+", found dtype="+x.dtype+".");if(spec.axes){var xShape=x.shape;for(var key in spec.axes){var axis=Number(key),value=spec.axes[key],xShapeAtAxis=axis>=0?xShape[axis]:xShape[xShape.length+axis];if(null!=value&&-1===[value,null].indexOf(xShapeAtAxis))throw new errors_1.ValueError("Input "+inputIndex+" is incompatible with layer "+this.name+": expected axis "+axis+" of input shape to have value "+value+" but got shape "+xShape+".")}}if(null!=spec.shape)for(var i=0;i<spec.shape.length;++i){var specDim=spec.shape[i],dim=x.shape[i];if(null!=specDim&&null!=dim&&specDim!==dim)throw new errors_1.ValueError("Input "+inputIndex+" is incompatible with layer "+this.name+": expected shape="+spec.shape+", found shape=${xShape}.")}}}}},Layer.prototype.call=function(inputs,kwargs){return inputs},Layer.prototype.invokeCallHook=function(inputs,kwargs){null!=this._callHook&&this._callHook(inputs,kwargs)},Layer.prototype.setCallHook=function(callHook){this._callHook=callHook},Layer.prototype.clearCallHook=function(){this._callHook=null},Layer.prototype.apply=function(inputs,kwargs){var _this=this;kwargs=kwargs||{},this.assertNotDisposed();for(var inputsList=generic_utils.toList(inputs),allAreSymbolic=!0,_i=0,inputsList_1=inputsList;_i<inputsList_1.length;_i++){var input=inputsList_1[_i];if(!(input instanceof SymbolicTensor)){allAreSymbolic=!1;break}}for(var noneAreSymbolic=!0,_a=0,inputsList_2=inputsList;_a<inputsList_2.length;_a++){var input=inputsList_2[_a];if(input instanceof SymbolicTensor){noneAreSymbolic=!1;break}}if(allAreSymbolic===noneAreSymbolic)throw new errors_1.ValueError("Arguments to apply() must be all SymbolicTensors or all Tensors");return common_1.nameScope(this.name,function(){if(!_this.built){_this.assertInputCompatibility(inputs);for(var inputShapes=[],_i=0,_a=generic_utils.toList(inputs);_i<_a.length;_i++){var xElem=_a[_i];inputShapes.push(xElem.shape)}_this.build(generic_utils.singletonOrArray(inputShapes)),_this.built=!0,_this.initialWeights&&_this.setWeights(_this.initialWeights),null===_this._refCount&&noneAreSymbolic&&(_this._refCount=1)}if(_this.assertInputCompatibility(inputs),noneAreSymbolic){for(var output=_this.call(inputs,kwargs),outputList=generic_utils.toList(output),outputListCopy=[],_b=0,outputList_1=outputList;_b<outputList_1.length;_b++){var x=outputList_1[_b];-1!==inputsList.indexOf(x)&&(x=x.clone()),outputListCopy.push(x)}if(output=generic_utils.singletonOrArray(outputListCopy),null!=_this.activityRegularizer)throw new errors_1.NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return output}var inputShape=collectInputShape(inputs),outputShape=_this.computeOutputShape(inputShape),output=void 0;if(_this.warnOnIncompatibleInputShape(Array.isArray(inputs)?inputShape[0]:inputShape),output=null!=outputShape&&outputShape.length>0&&Array.isArray(outputShape[0])?outputShape.map(function(shape,index){return new SymbolicTensor("float32",shape,_this,generic_utils.toList(inputs),kwargs,_this.name,index)}):new SymbolicTensor("float32",outputShape,_this,generic_utils.toList(inputs),kwargs,_this.name),_this.addInboundNode(inputs,output,null,null,inputShape,outputShape,kwargs),_this._refCount++,null!=_this.activityRegularizer)throw new errors_1.NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return output})},Layer.prototype.warnOnIncompatibleInputShape=function(inputShape){if(null!=this.batchInputShape)if(inputShape.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(inputShape)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var dimMismatch_1=!1;this.batchInputShape.forEach(function(dimension,i){null!=dimension&&null!=inputShape[i]&&inputShape[i]!==dimension&&(dimMismatch_1=!0)}),dimMismatch_1&&console.warn("The shape of the input tensor ("+JSON.stringify(inputShape)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(Layer.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new errors_1.AttributeError("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var allOutputShapes=[],_i=0,_a=this.inboundNodes;_i<_a.length;_i++){var node=_a[_i],shapeString=JSON.stringify(node.outputShapes);-1===allOutputShapes.indexOf(shapeString)&&allOutputShapes.push(shapeString)}if(1===allOutputShapes.length){var outputShapes=this.inboundNodes[0].outputShapes;return Array.isArray(outputShapes)&&Array.isArray(outputShapes[0])&&1===outputShapes.length?outputShapes[0]:outputShapes}throw new errors_1.AttributeError("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),Layer.prototype.countParams=function(){if(!this.built)throw new errors_1.RuntimeError("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return variable_utils.countParamsInWeights(this.weights)},Layer.prototype.build=function(inputShape){this.built=!0},Layer.prototype.getWeights=function(trainableOnly){return void 0===trainableOnly&&(trainableOnly=!1),variables_1.batchGetValue(trainableOnly?this.trainableWeights:this.weights)},Layer.prototype.setWeights=function(weights){var _this=this;tfjs_core_1.tidy(function(){var params=_this.weights;if(params.length!==weights.length)throw new errors_1.ValueError('You called setWeights(weights) on layer "'+_this.name+'" with a weight list of length '+weights.length+", but the layer was expecting "+params.length+" weights. Provided weights: "+weights+"...");if(0!==params.length){for(var weightValueTuples=[],paramValues=variables_1.batchGetValue(params),i=0;i<paramValues.length;++i){var pv=paramValues[i],p=params[i],w=weights[i];if(!tfjs_core_1.util.arraysEqual(pv.shape,w.shape))throw new errors_1.ValueError("Layer weight shape "+pv.shape+" not compatible with provided weight shape "+w.shape);weightValueTuples.push([p,w])}variables_1.batchSetValue(weightValueTuples)}})},Layer.prototype.addWeight=function(name,shape,dtype,initializer,regularizer,trainable,constraint){if(-1!==this._addedWeightNames.indexOf(name))throw new errors_1.ValueError("Duplicate weight name "+name+" for layer "+this.name);this._addedWeightNames.push(name),null==dtype&&(dtype="float32");var weight=new variables_1.LayerVariable(initializer.apply(shape,dtype),dtype,name,trainable,constraint);return null!=regularizer&&this.addLoss(function(){return regularizer.apply(weight.read())}),null==trainable&&(trainable=!0),trainable?this._trainableWeights.push(weight):this._nonTrainableWeights.push(weight),weight},Layer.prototype.addLoss=function(losses){if(!(null==losses||Array.isArray(losses)&&0===losses.length)){losses=generic_utils.toList(losses),void 0!==this._losses&&null!==this._losses&&(_a=this.losses).push.apply(_a,losses);var _a}},Layer.prototype.computeOutputShape=function(inputShape){return inputShape},Layer.prototype.computeMask=function(inputs,mask){var _this=this;if(!this.supportsMasking){if(null!=mask){if(!Array.isArray(mask))throw new TypeError("Layer "+this.name+" does not support masking,but was passed an inputMask.");mask.forEach(function(maskElement){if(null!=maskElement)throw new TypeError("Layer "+_this.name+" does not support masking,but was passed an inputMask.")})}return null}return mask},Layer.prototype.addInboundNode=function(inputTensors,outputTensors,inputMasks,outputMasks,inputShapes,outputShapes,kwargs){void 0===kwargs&&(kwargs=null);var inputTensorList=generic_utils.toList(inputTensors);outputTensors=generic_utils.toList(outputTensors),inputMasks=generic_utils.toList(inputMasks),outputMasks=generic_utils.toList(outputMasks),inputShapes=types_utils.normalizeShapeList(inputShapes),outputShapes=types_utils.normalizeShapeList(outputShapes);for(var inboundLayers=[],nodeIndices=[],tensorIndices=[],_i=0,inputTensorList_1=inputTensorList;_i<inputTensorList_1.length;_i++){var x=inputTensorList_1[_i];inboundLayers.push(x.sourceLayer),nodeIndices.push(x.nodeIndex),tensorIndices.push(x.tensorIndex)}new Node({outboundLayer:this,inboundLayers:inboundLayers,nodeIndices:nodeIndices,tensorIndices:tensorIndices,inputTensors:inputTensorList,outputTensors:outputTensors,inputMasks:inputMasks,outputMasks:outputMasks,inputShapes:inputShapes,outputShapes:outputShapes},kwargs);for(var i=0;i<outputTensors.length;i++)outputTensors[i].sourceLayer=this,outputTensors[i].nodeIndex=this.inboundNodes.length-1,outputTensors[i].tensorIndex=i},Layer.prototype.getConfig=function(){var config={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(config.batchInputShape=this.batchInputShape),null!=this.dtype&&(config.dtype=this.dtype),config},Layer.prototype.disposeWeights=function(){return this.weights.forEach(function(weight){return weight.dispose()}),this.weights.length},Layer.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},Layer.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var numDisposedVariables=0;return 0==--this._refCount&&(numDisposedVariables=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:numDisposedVariables}},Layer}(tfjs_core_1.serialization.Serializable);exports.Layer=Layer,exports.getSourceInputs=getSourceInputs},{"../backend/state":215,"../common":219,"../errors":228,"../utils/generic_utils":257,"../utils/types_utils":261,"../utils/variable_utils":262,"../variables":263,"@tensorflow/tfjs-core":62}],225:[function(require,module,exports){"use strict";function isDataTensor(x){return x instanceof tfjs_core_1.Tensor}function isDataArray(x){return Array.isArray(x)}function isDataDict(x){return!isDataTensor(x)&&!isDataArray(x)}function standardizeInputData(data,names,shapes,checkBatchAxis,exceptionPrefix){if(void 0===checkBatchAxis&&(checkBatchAxis=!0),void 0===exceptionPrefix&&(exceptionPrefix=""),null==names||0===names.length){if(null!=data){var gotUnexpectedData=!1;if(isDataArray(data)&&data.length>0)gotUnexpectedData=!0;else if(isDataDict(data)){for(var key in data)if(data.hasOwnProperty(key)){gotUnexpectedData=!0;break}}else gotUnexpectedData=!0;if(gotUnexpectedData)throw new errors_1.ValueError("Error when checking model "+exceptionPrefix+" expected no data, but got "+data)}return[]}if(null==data)return names.map(function(name){return null});var arrays;if(isDataDict(data)){data=data,arrays=[];for(var _i=0,names_1=names;_i<names_1.length;_i++){var name_1=names_1[_i];if(null==data[name_1])throw new errors_1.ValueError('No data provided for "'+name_1+'". Need data for each key in: '+names);arrays.push(data[name_1])}}else if(isDataArray(data)){if(data=data,data.length!==names.length)throw new errors_1.ValueError("Error when checking model "+exceptionPrefix+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+names.length+" Tensor(s), but instead got the following list of Tensor(s): "+data);arrays=data}else{if(data=data,names.length>1)throw new errors_1.ValueError("The model "+exceptionPrefix+" expects "+names.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+data.shape);arrays=[data]}if(arrays=training_tensors_1.ensureTensorsRank2OrHigher(arrays),null!=shapes)for(var i=0;i<names.length;++i)if(null!=shapes[i]){var array=arrays[i];if(array.shape.length!==shapes[i].length)throw new errors_1.ValueError("Error when checking "+exceptionPrefix+": expected "+names[i]+" to have "+shapes[i].length+" dimension(s). but got array with shape "+array.shape);for(var j=0;j<shapes[i].length;++j)if(0!==j||checkBatchAxis){var dim=array.shape[j],refDim=shapes[i][j];if(null!=refDim&&refDim>=0&&dim!==refDim)throw new errors_1.ValueError("Error when checking "+exceptionPrefix+": expected "+names[i]+" to have shape ["+shapes[i]+"], but got array with shape ["+array.shape+"].")}}return arrays}function checkArrayLengths(inputs,targets,weights){var setX=generic_utils_1.unique(inputs.map(function(input){return input.shape[0]}));setX.sort();var setY=generic_utils_1.unique(targets.map(function(target){return target.shape[0]}));if(setY.sort(),setX.length>1)throw new errors_1.ValueError("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(inputs.map(function(input){return input.shape})));if(setY.length>1)throw new errors_1.ValueError("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(targets.map(function(target){return target.shape})));if(setX.length>0&&setY.length>0&&!tfjs_core_1.util.arraysEqual(setX,setY))throw new errors_1.ValueError("Input Tensors should have the same number of samples as target Tensors. Found "+setX[0]+" input sample(s) and "+setY[0]+" target sample(s).")}function checkLossAndTargetCompatibility(targets,lossFns,outputShapes){for(var keyLosses=[losses.meanSquaredError,losses.binaryCrossentropy,losses.categoricalCrossentropy],i=0;i<targets.length;++i){var y=targets[i],loss=lossFns[i],shape=outputShapes[i];if(null!=loss){if(loss===losses.categoricalCrossentropy&&1===y.shape[y.shape.length-1])throw new errors_1.ValueError("You are passing a target array of shape "+y.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==keyLosses.indexOf(loss))for(var slicedYShape=y.shape.slice(1),slicedShape=shape.slice(1),j=0;j<slicedYShape.length;++j){var targetDim=slicedYShape[j],outDim=slicedShape[j];if(null!=outDim&&targetDim!==outDim)throw new errors_1.ValueError("A target Tensor with shape "+y.shape+" was passed for an output of shape "+shape+", while using a loss function that expects targets to have the same shape as the output.")}}}}function checkInputData(data,names,shapes,checkBatchAxis,exceptionPrefix){void 0===checkBatchAxis&&(checkBatchAxis=!0),void 0===exceptionPrefix&&(exceptionPrefix="");var arrays;if(Array.isArray(data)){if(data.length!==names.length)throw new errors_1.ValueError("Error when checking model "+exceptionPrefix+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+names.length+" Tensor(s), but instead got "+data.length+" Tensors(s).");arrays=data}else{if(names.length>1)throw new errors_1.ValueError("The model expects "+names.length+" "+exceptionPrefix+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(data.shape)+".");arrays=[data]}if(null!=shapes)for(var i=0;i<names.length;++i)if(null!=shapes[i]){var array=arrays[i];if(array.shape.length!==shapes[i].length)throw new errors_1.ValueError("Error when checking "+exceptionPrefix+": expected "+names[i]+" to have "+shapes[i].length+" dimension(s), but got array with shape "+JSON.stringify(array.shape));for(var j=0;j<shapes[i].length;++j)if(0!==j||checkBatchAxis){var dim=array.shape[j],refDim=shapes[i][j];if(null!=refDim&&refDim!==dim)throw new errors_1.ValueError("Error when checking "+exceptionPrefix+": expected "+names[i]+" to have shape "+JSON.stringify(shapes[i])+" but got array with shape "+JSON.stringify(array.shape)+".")}}}function collectMetrics(metrics,outputNames){
if(null==metrics||Array.isArray(metrics)&&0===metrics.length)return outputNames.map(function(name){return[]});if(Array.isArray(metrics))return outputNames.map(function(name){return metrics});if(null!=metrics){for(var nestedMetrics=[],_i=0,outputNames_1=outputNames;_i<outputNames_1.length;_i++){var name_2=outputNames_1[_i],outputMetrics=metrics.hasOwnProperty(name_2)?metrics[name_2]:[];Array.isArray(outputMetrics)||(outputMetrics=[outputMetrics]),nestedMetrics.push(outputMetrics)}return nestedMetrics}throw new TypeError("Type of metrics argument not understood. Expected an Array or Object, found: "+metrics)}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("../backend/state"),K=require("../backend/tfjs_backend"),common_1=require("../common"),errors_1=require("../errors"),losses=require("../losses"),Metrics=require("../metrics"),optimizers=require("../optimizers"),generic_utils_1=require("../utils/generic_utils"),layer_utils_1=require("../utils/layer_utils"),math_utils_1=require("../utils/math_utils"),container_1=require("./container"),executor_1=require("./executor"),training_dataset_1=require("./training_dataset"),training_tensors_1=require("./training_tensors");exports.isDataTensor=isDataTensor,exports.isDataArray=isDataArray,exports.isDataDict=isDataDict,exports.standardizeInputData=standardizeInputData,exports.checkArrayLengths=checkArrayLengths;var Model=function(_super){function Model(config){var _this=_super.call(this,config)||this;return _this.isTraining=!1,_this}return __extends(Model,_super),Model.prototype.summary=function(lineLength,positions,printFn){if(void 0===printFn&&(printFn=console.log),!this.built)throw new errors_1.ValueError("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");layer_utils_1.printSummary(this,lineLength,positions,printFn)},Model.prototype.compile=function(config){var _this=this;if(null==config.loss&&(config.loss=[]),this.loss=config.loss,"string"==typeof config.optimizer)this.optimizer=optimizers.getOptimizer(config.optimizer);else{if(!(config.optimizer instanceof tfjs_core_1.Optimizer))throw new errors_1.ValueError("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer=config.optimizer}var lossFunctions=[];if(Array.isArray(config.loss)||"string"==typeof config.loss||"function"==typeof config.loss)if(Array.isArray(config.loss)){if(config.loss.length!==this.outputs.length)throw new errors_1.ValueError("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+config.loss+".");var theLosses=config.loss;lossFunctions=theLosses.map(function(l){return losses.get(l)})}else{var lossFunction_1=losses.get(config.loss);this.outputs.map(function(layer){lossFunctions.push(lossFunction_1)})}else{config.loss=config.loss;for(var name_3 in config.loss)if(-1===this.outputNames.indexOf(name_3))throw new errors_1.ValueError('Unknown entry in loss dictionary: "'+name_3+'". Only expect the following keys: '+this.outputNames);for(var name_4 in this.outputNames)null==config.loss[name_4]&&console.warn('Output "'+name_4+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+name_4+" during training"),lossFunctions.push(losses.get(config.loss[name_4]))}this.lossFunctions=lossFunctions,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var i=0;i<this.outputs.length;++i){var shape=this.internalOutputShapes[i],name_5=this.outputNames[i];this.feedOutputNames.push(name_5),this.feedOutputShapes.push(shape),this.feedLossFns.push(this.lossFunctions[i])}var skipTargetIndices=[];this.metrics=config.metrics,this.metricsNames=["loss"],this.metricsTensors=[],common_1.nameScope("loss",function(){for(var i=0;i<_this.outputs.length;++i)if(-1===skipTargetIndices.indexOf(i)){var weightedLoss=_this.lossFunctions[i];_this.outputs.length>1&&(_this.metricsTensors.push([weightedLoss,i]),_this.metricsNames.push(_this.outputNames[i]+"_loss"))}});var nestedMetrics=collectMetrics(config.metrics,this.outputNames),appendMetric=function(outputIndex,metricName,metricTensor){_this.outputNames.length>1&&(metricName=_this.outputNames[outputIndex]+"_"+metricName),_this.metricsNames.push(metricName),_this.metricsTensors.push([metricTensor,outputIndex])};common_1.nameScope("metric",function(){for(var i=0;i<_this.outputs.length;++i)!function(i){if(-1!==skipTargetIndices.indexOf(i))return"continue";var outputMetrics=nestedMetrics[i];!function(metrics){for(var metricName,accFn,weightedMetricFn,_i=0,metrics_1=metrics;_i<metrics_1.length;_i++){var metric=metrics_1[_i];!function(metric){if(-1!==["accuracy","acc","crossentropy","ce"].indexOf(metric)){var outputShape=_this.internalOutputShapes[i];1===outputShape[outputShape.length-1]||_this.lossFunctions[i]===losses.binaryCrossentropy?-1!==["accuracy","acc"].indexOf(metric)?accFn=Metrics.binaryAccuracy:-1!==["crossentropy","ce"].indexOf(metric)&&(accFn=Metrics.binaryCrossentropy):_this.lossFunctions[i]===losses.sparseCategoricalCrossentropy?-1!==["accuracy","acc"].indexOf(metric)?accFn=Metrics.sparseCategoricalAccuracy:-1!==["crossentropy","ce"].indexOf(metric)&&(accFn=Metrics.sparseCategoricalCrossentropy):-1!==["accuracy","acc"].indexOf(metric)?accFn=Metrics.categoricalAccuracy:-1!==["crossentropy","ce"].indexOf(metric)&&(accFn=Metrics.categoricalCrossentropy);var suffix=void 0;-1!==["accuracy","acc"].indexOf(metric)?suffix="acc":-1!==["crossentropy","ce"].indexOf(metric)&&(suffix="ce"),weightedMetricFn=accFn,metricName=""+suffix}else{var metricFn=Metrics.get(metric);weightedMetricFn=metricFn,metricName=""+metric}var metricResult;common_1.nameScope(metricName,function(){metricResult=weightedMetricFn}),appendMetric(i,metricName,metricResult)}(metric)}}(outputMetrics)}(i)}),this.collectedTrainableWeights=this.trainableWeights},Model.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},Model.prototype.evaluate=function(x,y,config){void 0===config&&(config={});var batchSize=null==config.batchSize?32:config.batchSize;training_tensors_1.checkBatchSize(batchSize);var standardizedOuts=this.standardizeUserData(x,y,!0,batchSize);try{var ins=standardizedOuts[0].concat(standardizedOuts[1]);this.makeTestFunction();var f=this.testFunction,testOuts=this.testLoop(f,ins,batchSize,config.verbose,config.steps);return generic_utils_1.singletonOrArray(testOuts)}finally{training_tensors_1.disposeNewTensors(standardizedOuts[0],x),training_tensors_1.disposeNewTensors(standardizedOuts[1],y)}},Model.prototype.evaluateDataset=function(dataset,config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return this.makeTestFunction(),[2,training_dataset_1.evaluateDataset(this,dataset,config)]})})},Model.prototype.checkNumSamples=function(ins,batchSize,steps,stepsName){void 0===stepsName&&(stepsName="steps");var numSamples;if(null!=steps){if(numSamples=null,null!=batchSize)throw new errors_1.ValueError("If "+stepsName+" is set, batchSize must be null or undefined.Got batchSize = "+batchSize)}else{if(null==ins)throw new errors_1.ValueError("Either the input data should have a defined shape, or "+stepsName+" shoud be specified.");numSamples=Array.isArray(ins)?ins[0].shape[0]:ins.shape[0]}return numSamples},Model.prototype.execute=function(inputs,outputs){if(Array.isArray(outputs)&&0===outputs.length)throw new errors_1.ValueError("`outputs` is an empty Array, which is not allowed.");var outputsIsArray=Array.isArray(outputs),outputNames=outputsIsArray?outputs:[outputs],outputSymbolicTensors=this.retrieveSymbolicTensors(outputNames),feedDict=new executor_1.FeedDict;if(inputs instanceof tfjs_core_1.Tensor&&(inputs=[inputs]),Array.isArray(inputs)){if(inputs.length!==this.inputs.length)throw new errors_1.ValueError("The number of inputs provided ("+inputs.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var i=0;i<this.inputs.length;++i)feedDict.add(this.inputs[i],inputs[i])}else for(var _i=0,_a=this.inputs;_i<_a.length;_i++){var input=_a[_i],tensorValue=inputs[input.name];if(null==tensorValue)throw new errors_1.ValueError("No value is provided for the model's input "+input.name);feedDict.add(input,tensorValue)}var executeOutputs=executor_1.execute(outputSymbolicTensors,feedDict);return outputsIsArray?executeOutputs:executeOutputs[0]},Model.prototype.retrieveSymbolicTensors=function(symbolicTensorNames){for(var outputSymbolicTensors=generic_utils_1.pyListRepeat(null,symbolicTensorNames.length),outputsRemaining=symbolicTensorNames.length,_i=0,_a=this.layers;_i<_a.length;_i++){for(var layer=_a[_i],layerOutputs=Array.isArray(layer.output)?layer.output:[layer.output],layerOutputNames=layerOutputs.map(function(output){return output.name}),i=0;i<symbolicTensorNames.length;++i){var index=layerOutputNames.indexOf(symbolicTensorNames[i]);if(-1!==index&&(outputSymbolicTensors[i]=layerOutputs[index],outputsRemaining--),0===outputsRemaining)break}if(0===outputsRemaining)break}if(outputsRemaining>0){var remainingNames_1=[];throw outputSymbolicTensors.forEach(function(tensor,i){null==tensor&&remainingNames_1.push(symbolicTensorNames[i])}),new errors_1.ValueError("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(remainingNames_1))}return outputSymbolicTensors},Model.prototype.predictLoop=function(ins,batchSize,verbose){var _this=this;return void 0===batchSize&&(batchSize=32),void 0===verbose&&(verbose=!1),tfc.tidy(function(){var numSamples=_this.checkNumSamples(ins);if(verbose)throw new errors_1.NotImplementedError("Verbose predictLoop() is not implemented yet.");for(var batches=training_tensors_1.makeBatches(numSamples,batchSize),outs=[],batchIndex=0;batchIndex<batches.length;++batchIndex)!function(batchIndex){var batchOuts=tfc.tidy(function(){var batchStart=batches[batchIndex][0],batchEnd=batches[batchIndex][1],insBatch=training_tensors_1.sliceArrays(ins,batchStart,batchEnd),feeds=[];if(Array.isArray(insBatch))for(var i=0;i<insBatch.length;++i)feeds.push({key:_this.inputs[i],value:insBatch[i]});else feeds.push({key:_this.inputs[0],value:insBatch});var feedDict=new executor_1.FeedDict(feeds);return executor_1.execute(_this.outputs,feedDict)});if(0===batchIndex)for(var _i=0,batchOuts_1=batchOuts;_i<batchOuts_1.length;_i++){var batchOut=batchOuts_1[_i];outs.push(batchOut)}else for(var i=0;i<batchOuts.length;++i)outs[i]=K.concatAlongFirstAxis(outs[i],batchOuts[i])}(batchIndex);return generic_utils_1.singletonOrArray(outs)})},Model.prototype.predict=function(x,config){void 0===config&&(config={});var xsRank2OrHigher=training_tensors_1.ensureTensorsRank2OrHigher(x);checkInputData(xsRank2OrHigher,this.inputNames,this.feedInputShapes,!1);try{var batchSize=null==config.batchSize?32:config.batchSize;return training_tensors_1.checkBatchSize(batchSize),this.predictLoop(xsRank2OrHigher,batchSize)}finally{training_tensors_1.disposeNewTensors(xsRank2OrHigher,x)}},Model.prototype.predictOnBatch=function(x){return checkInputData(x,this.inputNames,this.feedInputShapes,!0),this.predictLoop(x,x.shape[0])},Model.prototype.standardizeUserData=function(x,y,checkBatchAxis,batchSize){if(void 0===checkBatchAxis&&(checkBatchAxis=!0),null==this.optimizer)throw new errors_1.RuntimeError("You must compile a model before training/testing. Use Model.compile(modelCompileConfig).");for(var outputShapes=[],i=0;i<this.feedOutputShapes.length;++i){var outputShape=this.feedOutputShapes[i];this.feedLossFns[i]===losses.sparseCategoricalCrossentropy?outputShapes.push(outputShape.slice(0,outputShape.length-1).concat([1])):outputShapes.push(outputShape)}if(x=standardizeInputData(x,this.feedInputNames,this.feedInputShapes,!1,"input"),y=standardizeInputData(y,this.feedOutputNames,outputShapes,!1,"target"),checkArrayLengths(x,y,null),checkLossAndTargetCompatibility(y,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=batchSize&&batchSize>0&&x[0].shape[0]%batchSize!=0)throw new errors_1.ValueError("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+batchSize+". Found: "+x[0].shape[0]+" sample(s).");return[x,y,null]},Model.prototype.testLoop=function(f,ins,batchSize,verbose,steps){var _this=this;return void 0===verbose&&(verbose=0),tfc.tidy(function(){var numSamples=_this.checkNumSamples(ins,batchSize,steps,"steps"),outs=[];if(verbose>0)throw new errors_1.NotImplementedError("Verbose mode is not implemented yet.");if(null!=steps)throw new errors_1.NotImplementedError("steps mode in testLoop() is not implemented yet");for(var batches=training_tensors_1.makeBatches(numSamples,batchSize),indexArray=tfjs_core_1.tensor1d(math_utils_1.range(0,numSamples)),batchIndex=0;batchIndex<batches.length;++batchIndex){var batchStart=batches[batchIndex][0],batchEnd=batches[batchIndex][1],batchIds=K.sliceAlongFirstAxis(indexArray,batchStart,batchEnd-batchStart),insBatch=training_tensors_1.sliceArraysByIndices(ins,batchIds),batchOuts=f(insBatch);if(0===batchIndex)for(var i=0;i<batchOuts.length;++i)outs.push(state_1.getScalar(0));for(var i=0;i<batchOuts.length;++i){var batchOut=batchOuts[i];outs[i]=tfc.add(outs[i],tfc.mul(state_1.getScalar(batchEnd-batchStart),batchOut))}}for(var i=0;i<outs.length;++i)outs[i]=tfc.div(outs[i],state_1.getScalar(numSamples));return outs})},Model.prototype.getDedupedMetricsNames=function(){for(var outLabels=this.metricsNames,dedupedOutLabels=[],i=0;i<outLabels.length;++i){var label=outLabels[i],newLabel=label;if(generic_utils_1.count(outLabels,label)>1){newLabel+="_"+generic_utils_1.count(outLabels.slice(0,i),label)}dedupedOutLabels.push(newLabel)}return dedupedOutLabels},Model.prototype.makeTrainFunction=function(){var _this=this;return function(data){var losses=[],lossValues=[],inputs=data.slice(0,_this.inputs.length),targets=data.slice(_this.inputs.length,_this.inputs.length+_this.outputs.length),metricsValues=[],totalLossFunction=function(){for(var feeds=[],i=0;i<_this.inputs.length;++i)feeds.push({key:_this.inputs[i],value:inputs[i]});for(var totalLoss,feedDict=new executor_1.FeedDict(feeds),outputs=executor_1.execute(_this.outputs,feedDict,{training:!0}),i=0;i<_this.lossFunctions.length;++i){var lossFunction=_this.lossFunctions[i],loss=lossFunction(targets[i],outputs[i]);losses.push(loss);var meanLoss=tfc.mean(loss);lossValues.push(meanLoss),totalLoss=0===i?loss:tfc.add(totalLoss,loss)}for(var i=0;i<_this.metricsTensors.length;++i){var metric=_this.metricsTensors[i][0],outputIndex=_this.metricsTensors[i][1],meanMetric=tfc.mean(metric(targets[outputIndex],outputs[outputIndex]));tfc.keep(meanMetric),metricsValues.push(meanMetric)}return totalLoss=tfc.mean(totalLoss),_this.calculateLosses().forEach(function(regularizerLoss){totalLoss=tfc.add(totalLoss,regularizerLoss)}),totalLoss},variables=_this.collectedTrainableWeights.map(function(param){return param.read()});return[_this.optimizer.minimize(totalLossFunction,!0,variables)].concat(metricsValues)}},Model.prototype.makeTestFunction=function(){var _this=this;this.testFunction=function(data){return tfc.tidy(function(){for(var totalLoss,valOutputs=[],inputs=data.slice(0,_this.inputs.length),targets=data.slice(_this.inputs.length,_this.inputs.length+_this.outputs.length),feeds=[],i=0;i<_this.inputs.length;++i)feeds.push({key:_this.inputs[i],value:inputs[i]});for(var feedDict=new executor_1.FeedDict(feeds),outputs=executor_1.execute(_this.outputs,feedDict),i=0;i<_this.lossFunctions.length;++i){var lossFunction=_this.lossFunctions[i],loss=tfc.mean(lossFunction(targets[i],outputs[i]));totalLoss=0===i?loss:tfc.add(totalLoss,loss),valOutputs.push(totalLoss)}for(var i=0;i<_this.metricsTensors.length;++i){var metric=_this.metricsTensors[i][0],outputIndex=_this.metricsTensors[i][1],meanMetric=tfc.mean(metric(targets[outputIndex],outputs[outputIndex]));valOutputs.push(meanMetric)}return valOutputs})}},Model.prototype.fit=function(x,y,config){return void 0===config&&(config={}),__awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,training_tensors_1.fitTensors(this,x,y,config)]})})},Model.prototype.fitDataset=function(dataset,config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,training_dataset_1.fitDataset(this,dataset,config)]})})},Model.prototype.getNamedWeights=function(config){for(var namedWeights={},trainableOnly=null!=config&&config.trainableOnly,weights=trainableOnly?this.trainableWeights:this.weights,weightValues=this.getWeights(trainableOnly),i=0;i<weights.length;++i)trainableOnly&&!weights[i].trainable||(namedWeights[weights[i].originalName]=weightValues[i]);return namedWeights},Object.defineProperty(Model.prototype,"stopTraining",{set:function(stop){this.stopTraining_=stop},enumerable:!0,configurable:!0}),Model.prototype.save=function(handlerOrURL,config){return __awaiter(this,void 0,void 0,function(){var handlers,weightDataAndSpecs,returnString,unusedArg,modelConfig;return __generator(this,function(_a){switch(_a.label){case 0:if("string"==typeof handlerOrURL){if(handlers=tfjs_core_1.io.getSaveHandlers(handlerOrURL),0===handlers.length)throw new errors_1.ValueError("Cannot find any save handlers for URL '"+handlerOrURL+"'");if(handlers.length>1)throw new errors_1.ValueError("Found more than one ("+handlers.length+") save handlers for URL '"+handlerOrURL+"'");handlerOrURL=handlers[0]}if(null==handlerOrURL.save)throw new errors_1.ValueError("Model.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,tfjs_core_1.io.encodeWeights(this.getNamedWeights(config))];case 1:return weightDataAndSpecs=_a.sent(),returnString=!1,unusedArg=null,modelConfig=this.toJSON(unusedArg,returnString),[2,handlerOrURL.save({modelTopology:modelConfig,weightData:weightDataAndSpecs.data,weightSpecs:weightDataAndSpecs.specs})]}})})},Model.className="Model",Model}(container_1.Container);exports.Model=Model,tfjs_core_1.serialization.registerClass(Model)},{"../backend/state":215,"../backend/tfjs_backend":216,"../common":219,"../errors":228,"../losses":251,"../metrics":252,"../optimizers":254,"../utils/generic_utils":257,"../utils/layer_utils":258,"../utils/math_utils":259,"./container":221,"./executor":222,"./training_dataset":226,"./training_tensors":227,"@tensorflow/tfjs-core":62}],226:[function(require,module,exports){"use strict";function standardizeDataIteratorOutput(model,iteratorOut){if(model.outputs.length>1)throw new errors_1.NotImplementedError("Support for training a model with multiple output tensors with a dataset object is not implemented yet.");tfc.util.assert(Array.isArray(iteratorOut)&&2===iteratorOut.length,"Dataset iterator for fitDataset() is expected to generate an Array of length 2: `[xs, ys]`, but instead generates "+iteratorOut),iteratorOut=iteratorOut;var ys=iteratorOut[1],xs=iteratorOut[0];if(xs instanceof tfc.Tensor)return tfc.util.assert(1===model.inputs.length,"Model has multiple "+model.inputs.length+" inputs, hence it expects the input dataset to generate a dictionary of tensors  (with keys "+JSON.stringify(model.inputNames)+", but received a single tensor."),tfc.util.assert(xs.shape[0]===ys.shape[0],"Mismatch in batch size between x and y tensors ("+xs.shape[0]+" vs. "+ys.shape[0]+")"),[xs,ys];var batchSize=void 0;xs=xs;for(var flattendXs=[],_i=0,_a=model.inputNames;_i<_a.length;_i++){var inputName=_a[_i];if(null==xs[inputName])throw new errors_1.ValueError("The feature data generated by the dataset lacks the required input key '"+inputName+"'.");flattendXs.push(xs[inputName]),null==batchSize?batchSize=xs[inputName].shape[0]:tfc.util.assert(xs[inputName].shape[0]===batchSize,"Mismatch in batch size between x and y tensors ("+xs[inputName].shape[0]+" vs. "+ys.shape[0]+")")}return flattendXs.concat(ys)}function standardizeTensorValidationData(data){if(3===data.length)throw new errors_1.NotImplementedError("Validation with sample weights is not implemented yet.");return{xs:data[0],ys:data[1]}}function fitDataset(model,dataset,config){return __awaiter(this,void 0,void 0,function(){var hasBatchesPerEpoch,doValidation,valXs,valYs,validationData,trainFunction,outLabels,callbackMetrics,callbacks,_a,callbackList,history_1,epoch,epochLogs,dataIterator,stepsDone,batchIndex,iteratorOut,xsAndYs,batchLogs,outs,i,label,out,valOuts,_b,i;return __generator(this,function(_c){switch(_c.label){case 0:if(hasBatchesPerEpoch=null!=config.batchesPerEpoch,tfc.util.assert(null!=model.optimizer,"You must compile a model before training/testing. Use Model.compile(modelCompileConfig)."),tfc.util.assert(null!=config,"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),tfc.util.assert(null!=config.epochs&&config.epochs>0&&Number.isInteger(config.epochs),"For fitDataset(), config.epochs is expected to be a positive integer, but got "+config.epochs),tfc.util.assert(!hasBatchesPerEpoch||config.batchesPerEpoch>0&&Number.isInteger(config.batchesPerEpoch),"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+config.batchesPerEpoch),tfc.util.assert(null==config.validationSplit,"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),model.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");model.isTraining=!0,_c.label=1;case 1:return _c.trys.push([1,,21,22]),doValidation=null!=config.validationData,valXs=void 0,valYs=void 0,doValidation&&(isDatasetObject(config.validationData)?tfc.util.assert(null==config.validationBatches||config.validationBatches>0&&Number.isInteger(config.validationBatches),"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+config.validationBatches):(validationData=standardizeTensorValidationData(config.validationData),valXs=validationData.xs,valYs=validationData.ys)),trainFunction=model.makeTrainFunction(),outLabels=model.getDedupedMetricsNames(),callbackMetrics=void 0,callbackMetrics=doValidation?outLabels.slice().concat(outLabels.map(function(n){return"val_"+n})):outLabels.slice(),callbacks=base_callbacks_1.standardizeCallbacks(config.callbacks),_a=base_callbacks_1.configureCallbacks(callbacks,config.yieldEvery,config.verbose,config.epochs,null,null,config.batchesPerEpoch,null,doValidation,callbackMetrics),callbackList=_a.callbackList,history_1=_a.history,model.history=history_1,[4,callbackList.onTrainBegin()];case 2:return _c.sent(),epoch=null==config.initialEpoch?0:config.initialEpoch,epochLogs={},[4,dataset.iterator()];case 3:dataIterator=_c.sent(),_c.label=4;case 4:return epoch<config.epochs?[4,callbackList.onEpochBegin(epoch)]:[3,18];case 5:return _c.sent(),stepsDone=0,batchIndex=0,hasBatchesPerEpoch?[3,7]:[4,dataset.iterator()];case 6:dataIterator=_c.sent(),_c.label=7;case 7:return!hasBatchesPerEpoch||stepsDone<config.batchesPerEpoch?[4,dataIterator.next()]:[3,16];case 8:if(iteratorOut=_c.sent(),hasBatchesPerEpoch&&iteratorOut.done)return console.warn("You provided `batchesPerEpoch` as "+config.batchesPerEpoch+", but your dataset iterator ran out of data after "+stepsDone+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+config.batchesPerEpoch*config.epochs+" batches). You may need to use the repeat() function when building your dataset."),[3,16];if(null==iteratorOut.value)return[3,10];for(xsAndYs=standardizeDataIteratorOutput(model,iteratorOut.value),batchLogs={},batchLogs.batch=batchIndex,batchLogs.size=xsAndYs[0].shape[0],callbackList.onBatchBegin(batchIndex,batchLogs),outs=trainFunction(xsAndYs),tfc.dispose(xsAndYs),i=0;i<outLabels.length;++i)label=outLabels[i],out=outs[i],batchLogs[label]=out,tfc.keep(out);return[4,callbackList.onBatchEnd(batchIndex,batchLogs)];case 9:_c.sent(),logs_1.disposeTensorsInLogs(batchLogs),batchIndex++,stepsDone++,_c.label=10;case 10:return(hasBatchesPerEpoch?stepsDone>=config.batchesPerEpoch:iteratorOut.done)?doValidation?(valOuts=void 0,isDatasetObject(config.validationData)?(_b=generic_utils_1.toList,[4,model.evaluateDataset(config.validationData,{batches:config.validationBatches})]):[3,12]):[3,14]:[3,15];case 11:return valOuts=_b.apply(void 0,[_c.sent()]),[3,13];case 12:valOuts=generic_utils_1.toList(model.evaluate(valXs,valYs,{batchSize:null==config.validationBatchSize?DEFAULT_VALIDATION_BATCH_SIZE:config.validationBatchSize,verbose:0})),_c.label=13;case 13:for(i=0;i<model.metricsNames.length;++i)epochLogs["val_"+model.metricsNames[i]]=valOuts[i];_c.label=14;case 14:return[3,16];case 15:return model.stopTraining_?[3,16]:[3,7];case 16:return[4,callbackList.onEpochEnd(epoch,epochLogs)];case 17:return _c.sent(),epoch++,model.stopTraining_?[3,18]:[3,4];case 18:return[4,callbackList.onTrainEnd()];case 19:return _c.sent(),[4,model.history.syncData()];case 20:return _c.sent(),[2,model.history];case 21:return model.isTraining=!1,[7];case 22:return[2]}})})}function isDatasetObject(dataset){return"function"==typeof dataset.iterator}function isLazyIteratorObject(iterator){return"function"==typeof iterator.next}function evaluateDataset(model,dataset,config){return __awaiter(this,void 0,void 0,function(){var hasBatches,f,outs,dataIterator,_a,numExamples,batch,_loop_1,state_2,_loop_2,i;return __generator(this,function(_b){switch(_b.label){case 0:if(hasBatches=null!=config.batches,f=model.testFunction,outs=[],config.verbose>0)throw new errors_1.NotImplementedError("Verbose mode is not implemented yet.");return tfc.util.assert(!hasBatches||config.batches>0&&Number.isInteger(config.batches),"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(config.batches)),isLazyIteratorObject(dataset)?(_a=dataset,[3,3]):[3,1];case 1:return[4,dataset.iterator()];case 2:_a=_b.sent(),_b.label=3;case 3:dataIterator=_a,numExamples=0,batch=0,_loop_1=function(){var iteratorOut,xsAndYs_1,batchOuts,i,batchSize_1,_loop_3,i;return __generator(this,function(_a){switch(_a.label){case 0:return[4,dataIterator.next()];case 1:if(iteratorOut=_a.sent(),iteratorOut.value){if(xsAndYs_1=standardizeDataIteratorOutput(model,iteratorOut.value),batchOuts=tfc.tidy(function(){return f(xsAndYs_1)}),tfc.dispose(xsAndYs_1),0===batch)for(i=0;i<batchOuts.length;++i)outs.push(state_1.getScalar(0));for(batchSize_1=xsAndYs_1[0].shape[0],_loop_3=function(i){var batchOut=batchOuts[i],oldScalar=outs[i];outs[i]=tfc.tidy(function(){return tfc.add(outs[i],tfc.mul(state_1.getScalar(batchSize_1),batchOut))}),batch>0&&tfc.dispose(oldScalar)},i=0;i<batchOuts.length;++i)_loop_3(i);tfc.dispose(batchOuts),numExamples+=batchSize_1,++batch}return iteratorOut.done?(hasBatches&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, "+config.batches+" batches). You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},_b.label=4;case 4:return!hasBatches||batch<config.batches?[5,_loop_1()]:[3,6];case 5:return state_2=_b.sent(),"break"===state_2?[3,6]:[3,4];case 6:for(_loop_2=function(i){var oldScalar=outs[i];outs[i]=tfc.tidy(function(){return tfc.div(outs[i],state_1.getScalar(numExamples))}),tfc.dispose(oldScalar)},i=0;i<outs.length;++i)_loop_2(i);return[2,generic_utils_1.singletonOrArray(outs)]}})})}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),state_1=require("../backend/state"),base_callbacks_1=require("../base_callbacks"),errors_1=require("../errors"),logs_1=require("../logs"),generic_utils_1=require("../utils/generic_utils"),DEFAULT_VALIDATION_BATCH_SIZE=32;exports.fitDataset=fitDataset,exports.evaluateDataset=evaluateDataset},{"../backend/state":215,"../base_callbacks":217,"../errors":228,"../logs":250,"../utils/generic_utils":257,"@tensorflow/tfjs-core":62}],
227:[function(require,module,exports){"use strict";function checkBatchSize(batchSize){tfc.util.assert(batchSize>0&&Number.isInteger(batchSize),"batchSize is required to be a positive integer, but got "+batchSize)}function sliceArrays(arrays,start,stop){return null==arrays?[null]:Array.isArray(arrays)?arrays.map(function(array){return tfjs_backend_1.sliceAlongFirstAxis(array,start,stop-start)}):tfjs_backend_1.sliceAlongFirstAxis(arrays,start,stop-start)}function sliceArraysByIndices(arrays,indices){return tfc.tidy(function(){return null==arrays?null:Array.isArray(arrays)?arrays.map(function(array){return sliceArraysByIndices(array,indices)}):tfjs_backend_1.gather(arrays,"int32"===indices.dtype?indices:indices.toInt())})}function makeBatches(size,batchSize){for(var output=[],batchStart=0,batchEnd=null;batchStart<size;)batchEnd=batchStart+batchSize,batchEnd>=size&&(batchEnd=size),output.push([batchStart,batchEnd]),batchStart=batchEnd;return output}function fitLoop(model,f,ins,outLabels,batchSize,epochs,verbose,callbacks,valF,valIns,shuffle,callbackMetrics,initialEpoch,stepsPerEpoch,validationSteps,yieldEvery){return __awaiter(this,void 0,void 0,function(){var doValidation,numTrainSamples,indexArray,_a,callbackList,history,_loop_1,epoch,state_1;return __generator(this,function(_b){switch(_b.label){case 0:if(null==batchSize&&(batchSize=32),null==epochs&&(epochs=1),null==shuffle&&(shuffle=!0),null==initialEpoch&&(initialEpoch=0),doValidation=!1,null!=valF&&null!=valIns&&(doValidation=!0),null!=validationSteps&&(doValidation=!0,null==stepsPerEpoch))throw new errors_1.ValueError("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return numTrainSamples=model.checkNumSamples(ins,batchSize,stepsPerEpoch,"steps_per_epoch"),null!=numTrainSamples&&(indexArray=math_utils_1.range(0,numTrainSamples)),null==verbose&&(verbose=1),_a=base_callbacks_1.configureCallbacks(callbacks,yieldEvery,verbose,epochs,initialEpoch,numTrainSamples,stepsPerEpoch,batchSize,doValidation,callbackMetrics),callbackList=_a.callbackList,history=_a.history,callbackList.setModel(model),model.history=history,[4,callbackList.onTrainBegin()];case 1:_b.sent(),model.stopTraining_=!1,_loop_1=function(epoch){var epochLogs,epochIndexArray1D_1,batches_1,_loop_2,batchIndex,state_2;return __generator(this,function(_a){switch(_a.label){case 0:return[4,callbackList.onEpochBegin(epoch)];case 1:if(_a.sent(),epochLogs={},null==stepsPerEpoch)return[3,2];throw new errors_1.NotImplementedError("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===shuffle)throw new errors_1.NotImplementedError("batch shuffling is not implemneted yet");shuffle&&tfjs_core_1.util.shuffle(indexArray),epochIndexArray1D_1=tfjs_core_1.tensor1d(indexArray),batches_1=makeBatches(numTrainSamples,batchSize),_loop_2=function(batchIndex){var batchLogs;return __generator(this,function(_a){switch(_a.label){case 0:return batchLogs={},[4,callbackList.onBatchBegin(batchIndex,batchLogs)];case 1:return _a.sent(),tfc.tidy(function(){var batchStart=batches_1[batchIndex][0],batchEnd=batches_1[batchIndex][1],batchIds=tfjs_backend_1.sliceAlongFirstAxis(epochIndexArray1D_1,batchStart,batchEnd-batchStart);batchLogs.batch=batchIndex,batchLogs.size=batchEnd-batchStart;for(var insBatch=sliceArraysByIndices(ins,batchIds),outs=f(insBatch),i=0;i<outLabels.length;++i){var label=outLabels[i],out=outs[i];batchLogs[label]=out,tfc.keep(out)}if(batchIndex===batches_1.length-1&&doValidation)for(var valOuts=model.testLoop(valF,valIns,batchSize),i=0;i<outLabels.length;++i){var label=outLabels[i],out=valOuts[i];tfc.keep(out),epochLogs["val_"+label]=out}}),[4,callbackList.onBatchEnd(batchIndex,batchLogs)];case 2:return _a.sent(),logs_1.disposeTensorsInLogs(batchLogs),model.stopTraining_?[2,"break"]:[2]}})},batchIndex=0,_a.label=3;case 3:return batchIndex<batches_1.length?[5,_loop_2(batchIndex)]:[3,6];case 4:if("break"===(state_2=_a.sent()))return[3,6];_a.label=5;case 5:return++batchIndex,[3,3];case 6:epochIndexArray1D_1.dispose(),_a.label=7;case 7:return[4,callbackList.onEpochEnd(epoch,epochLogs)];case 8:return _a.sent(),model.stopTraining_?[2,"break"]:[2]}})},epoch=initialEpoch,_b.label=2;case 2:return epoch<epochs?[5,_loop_1(epoch)]:[3,5];case 3:if("break"===(state_1=_b.sent()))return[3,5];_b.label=4;case 4:return++epoch,[3,2];case 5:return[4,callbackList.onTrainEnd()];case 6:return _b.sent(),[4,model.history.syncData()];case 7:return _b.sent(),[2,model.history]}})})}function fitTensors(model,x,y,config){return void 0===config&&(config={}),__awaiter(this,void 0,void 0,function(){var inputs,targets,inputValX,inputValY,valX,valY,batchSize,standardizedOuts,doValidation,valIns,valStandardized,splitAt,originalBatchSize,ins,trainFunction,outLabels,valFunction,callbackMetrics,callbacks,out;return __generator(this,function(_a){switch(_a.label){case 0:if(model.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");model.isTraining=!0,_a.label=1;case 1:if(_a.trys.push([1,,3,4]),batchSize=null==config.batchSize?32:config.batchSize,checkBatchSize(batchSize),standardizedOuts=model.standardizeUserData(x,y,!1,batchSize),inputs=standardizedOuts[0],targets=standardizedOuts[1],doValidation=!1,valIns=void 0,null!=config.validationData&&config.validationData.length>0){if(doValidation=!0,2!==config.validationData.length)throw 3===config.validationData.length?new errors_1.NotImplementedError("validationData including sample weights is not supported yet."):new errors_1.ValueError("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+config.validationData+" is invalid.");inputValX=config.validationData[0],inputValY=config.validationData[1],valStandardized=model.standardizeUserData(inputValX,inputValY,!0,batchSize),valX=valStandardized[0],valY=valStandardized[1],valIns=valX.concat(valY)}else null!=config.validationSplit&&config.validationSplit>0&&config.validationSplit<1?(doValidation=!0,splitAt=Math.floor(inputs[0].shape[0]*(1-config.validationSplit)),originalBatchSize=inputs[0].shape[0],valX=sliceArrays(inputs,splitAt,originalBatchSize),inputs=sliceArrays(inputs,0,splitAt),valY=sliceArrays(targets,splitAt,originalBatchSize),targets=sliceArrays(targets,0,splitAt),valIns=valX.concat(valY)):null!=config.validationSteps&&(doValidation=!0);return ins=inputs.concat(targets),model.checkTrainableWeightsConsistency(),trainFunction=model.makeTrainFunction(),outLabels=model.getDedupedMetricsNames(),valFunction=void 0,callbackMetrics=void 0,doValidation?(model.makeTestFunction(),valFunction=model.testFunction,callbackMetrics=outLabels.slice().concat(outLabels.map(function(n){return"val_"+n}))):(valFunction=null,valIns=[],callbackMetrics=outLabels.slice()),callbacks=base_callbacks_1.standardizeCallbacks(config.callbacks),[4,fitLoop(model,trainFunction,ins,outLabels,batchSize,config.epochs,config.verbose,callbacks,valFunction,valIns,config.shuffle,callbackMetrics,config.initialEpoch,null,null,config.yieldEvery)];case 2:return out=_a.sent(),model.isTraining=!1,[2,out];case 3:return model.isTraining=!1,disposeNewTensors(inputs,x),disposeNewTensors(targets,y),disposeNewTensors(valX,inputValX),disposeNewTensors(valY,inputValY),[7];case 4:return[2]}})})}function ensureTensorsRank2OrHigher(tensors){var outs=[];tensors instanceof tfjs_core_1.Tensor&&(tensors=[tensors]);for(var i=0;i<tensors.length;++i){var tensor=tensors[i];if(1===tensor.rank)outs.push(tfjs_backend_1.expandDims(tensor,1));else{if(0===tensor.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");outs.push(tensor)}}return outs}function disposeNewTensors(tensors,refTensors){if(null!=tensors){var oldTensorIds=[];if(refTensors instanceof tfjs_core_1.Tensor)oldTensorIds.push(refTensors.id);else if(Array.isArray(refTensors))refTensors.forEach(function(t){return oldTensorIds.push(t.id)});else if(null!=refTensors)for(var name_1 in refTensors){var oldTensor=refTensors[name_1];oldTensorIds.push(oldTensor.id)}var tensorsToDispose=[];if(tensors instanceof tfjs_core_1.Tensor)-1===oldTensorIds.indexOf(tensors.id)&&tensorsToDispose.push(tensors);else if(Array.isArray(tensors))tensors.forEach(function(t){-1===oldTensorIds.indexOf(t.id)&&tensorsToDispose.push(t)});else if(null!=tensors)for(var name_2 in tensors){var tensor=tensors[name_2];-1===oldTensorIds.indexOf(tensor.id)&&tensorsToDispose.push(tensor)}tensorsToDispose.forEach(function(t){t.isDisposed||t.dispose()})}}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),tfjs_backend_1=require("../backend/tfjs_backend"),base_callbacks_1=require("../base_callbacks"),errors_1=require("../errors"),logs_1=require("../logs"),math_utils_1=require("../utils/math_utils");exports.checkBatchSize=checkBatchSize,exports.sliceArrays=sliceArrays,exports.sliceArraysByIndices=sliceArraysByIndices,exports.makeBatches=makeBatches,exports.fitTensors=fitTensors,exports.ensureTensorsRank2OrHigher=ensureTensorsRank2OrHigher,exports.disposeNewTensors=disposeNewTensors},{"../backend/tfjs_backend":216,"../base_callbacks":217,"../errors":228,"../logs":250,"../utils/math_utils":259,"@tensorflow/tfjs-core":62}],228:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var AttributeError=function(_super){function AttributeError(message){var _this=_super.call(this,message)||this;return Object.setPrototypeOf(_this,AttributeError.prototype),_this}return __extends(AttributeError,_super),AttributeError}(Error);exports.AttributeError=AttributeError;var RuntimeError=function(_super){function RuntimeError(message){var _this=_super.call(this,message)||this;return Object.setPrototypeOf(_this,RuntimeError.prototype),_this}return __extends(RuntimeError,_super),RuntimeError}(Error);exports.RuntimeError=RuntimeError;var ValueError=function(_super){function ValueError(message){var _this=_super.call(this,message)||this;return Object.setPrototypeOf(_this,ValueError.prototype),_this}return __extends(ValueError,_super),ValueError}(Error);exports.ValueError=ValueError;var NotImplementedError=function(_super){function NotImplementedError(message){var _this=_super.call(this,message)||this;return Object.setPrototypeOf(_this,NotImplementedError.prototype),_this}return __extends(NotImplementedError,_super),NotImplementedError}(Error);exports.NotImplementedError=NotImplementedError;var AssertionError=function(_super){function AssertionError(message){var _this=_super.call(this,message)||this;return Object.setPrototypeOf(_this,AssertionError.prototype),_this}return __extends(AssertionError,_super),AssertionError}(Error);exports.AssertionError=AssertionError;var IndexError=function(_super){function IndexError(message){var _this=_super.call(this,message)||this;return Object.setPrototypeOf(_this,IndexError.prototype),_this}return __extends(IndexError,_super),IndexError}(Error);exports.IndexError=IndexError},{}],229:[function(require,module,exports){"use strict";function model(config){return new training_1.Model(config)}function sequential(config){return new models_1.Sequential(config)}function loadModel(pathOrIOHandler,strict){return void 0===strict&&(strict=!0),models_1.loadModelInternal(pathOrIOHandler,strict)}function input(config){return input_layer_1.Input(config)}function registerCallbackConstructor(verbosityLevel,callbackConstructor){base_callbacks_1.CallbackConstructorRegistry.registerCallbackConstructor(verbosityLevel,callbackConstructor)}Object.defineProperty(exports,"__esModule",{value:!0});var base_callbacks_1=require("./base_callbacks"),input_layer_1=require("./engine/input_layer"),training_1=require("./engine/training"),models_1=require("./models");exports.model=model,exports.sequential=sequential,exports.loadModel=loadModel,exports.input=input,exports.registerCallbackConstructor=registerCallbackConstructor},{"./base_callbacks":217,"./engine/input_layer":223,"./engine/training":225,"./models":253}],230:[function(require,module,exports){"use strict";function maxNorm(config){return new constraints_1.MaxNorm(config)}function unitNorm(config){return new constraints_1.UnitNorm(config)}function nonNeg(){return new constraints_1.NonNeg}function minMaxNorm(config){return new constraints_1.MinMaxNorm(config)}Object.defineProperty(exports,"__esModule",{value:!0});var constraints_1=require("./constraints");exports.maxNorm=maxNorm,exports.unitNorm=unitNorm,exports.nonNeg=nonNeg,exports.minMaxNorm=minMaxNorm},{"./constraints":220}],231:[function(require,module,exports){"use strict";function zeros(){return new initializers_1.Zeros}function ones(){return new initializers_1.Ones}function constant(config){return new initializers_1.Constant(config)}function randomUniform(config){return new initializers_1.RandomUniform(config)}function randomNormal(config){return new initializers_1.RandomNormal(config)}function truncatedNormal(config){return new initializers_1.TruncatedNormal(config)}function identity(config){return new initializers_1.Identity(config)}function varianceScaling(config){return new initializers_1.VarianceScaling(config)}function glorotUniform(config){return new initializers_1.GlorotUniform(config)}function glorotNormal(config){return new initializers_1.GlorotNormal(config)}function heNormal(config){return new initializers_1.HeNormal(config)}function leCunNormal(config){return new initializers_1.LeCunNormal(config)}function orthogonal(config){return new initializers_1.Orthogonal(config)}Object.defineProperty(exports,"__esModule",{value:!0});var initializers_1=require("./initializers");exports.zeros=zeros,exports.ones=ones,exports.constant=constant,exports.randomUniform=randomUniform,exports.randomNormal=randomNormal,exports.truncatedNormal=truncatedNormal,exports.identity=identity,exports.varianceScaling=varianceScaling,exports.glorotUniform=glorotUniform,exports.glorotNormal=glorotNormal,exports.heNormal=heNormal,exports.leCunNormal=leCunNormal,exports.orthogonal=orthogonal},{"./initializers":237}],232:[function(require,module,exports){"use strict";function inputLayer(config){return new input_layer_1.InputLayer(config)}function elu(config){return new advanced_activations_1.ELU(config)}function reLU(config){return new advanced_activations_1.ReLU(config)}function leakyReLU(config){return new advanced_activations_1.LeakyReLU(config)}function softmax(config){return new advanced_activations_1.Softmax(config)}function thresholdedReLU(config){return new advanced_activations_1.ThresholdedReLU(config)}function conv1d(config){return new convolutional_1.Conv1D(config)}function conv2d(config){return new convolutional_1.Conv2D(config)}function conv2dTranspose(config){return new convolutional_1.Conv2DTranspose(config)}function separableConv2d(config){return new convolutional_1.SeparableConv2D(config)}function cropping2D(config){return new convolutional_1.Cropping2D(config)}function upSampling2d(config){return new convolutional_1.UpSampling2D(config)}function depthwiseConv2d(config){return new convolutional_depthwise_1.DepthwiseConv2D(config)}function activation(config){return new core_1.Activation(config)}function dense(config){return new core_1.Dense(config)}function dropout(config){return new core_1.Dropout(config)}function flatten(config){return new core_1.Flatten(config)}function repeatVector(config){return new core_1.RepeatVector(config)}function reshape(config){return new core_1.Reshape(config)}function permute(config){return new core_1.Permute(config)}function embedding(config){return new embeddings_1.Embedding(config)}function add(config){return new merge_1.Add(config)}function average(config){return new merge_1.Average(config)}function concatenate(config){return new merge_1.Concatenate(config)}function maximum(config){return new merge_1.Maximum(config)}function minimum(config){return new merge_1.Minimum(config)}function multiply(config){return new merge_1.Multiply(config)}function dot(config){return new merge_1.Dot(config)}function batchNormalization(config){return new normalization_1.BatchNormalization(config)}function zeroPadding2d(config){return new padding_1.ZeroPadding2D(config)}function averagePooling1d(config){return new pooling_1.AveragePooling1D(config)}function avgPool1d(config){return averagePooling1d(config)}function avgPooling1d(config){return averagePooling1d(config)}function averagePooling2d(config){return new pooling_1.AveragePooling2D(config)}function avgPool2d(config){return averagePooling2d(config)}function avgPooling2d(config){return averagePooling2d(config)}function globalAveragePooling1d(config){return new pooling_1.GlobalAveragePooling1D(config)}function globalAveragePooling2d(config){return new pooling_1.GlobalAveragePooling2D(config)}function globalMaxPooling1d(config){return new pooling_1.GlobalMaxPooling1D(config)}function globalMaxPooling2d(config){return new pooling_1.GlobalMaxPooling2D(config)}function maxPooling1d(config){return new pooling_1.MaxPooling1D(config)}function maxPooling2d(config){return new pooling_1.MaxPooling2D(config)}function gru(config){return new recurrent_1.GRU(config)}function gruCell(config){return new recurrent_1.GRUCell(config)}function lstm(config){return new recurrent_1.LSTM(config)}function lstmCell(config){return new recurrent_1.LSTMCell(config)}function simpleRNN(config){return new recurrent_1.SimpleRNN(config)}function simpleRNNCell(config){return new recurrent_1.SimpleRNNCell(config)}function rnn(config){return new recurrent_1.RNN(config)}function stackedRNNCells(config){return new recurrent_1.StackedRNNCells(config)}function bidirectional(config){return new wrappers_1.Bidirectional(config)}function timeDistributed(config){return new wrappers_1.TimeDistributed(config)}Object.defineProperty(exports,"__esModule",{value:!0});var input_layer_1=require("./engine/input_layer"),topology_1=require("./engine/topology");exports.Layer=topology_1.Layer;var exports_1=require("./exports");exports.input=exports_1.input;var advanced_activations_1=require("./layers/advanced_activations"),convolutional_1=require("./layers/convolutional"),convolutional_depthwise_1=require("./layers/convolutional_depthwise"),core_1=require("./layers/core"),embeddings_1=require("./layers/embeddings"),merge_1=require("./layers/merge"),normalization_1=require("./layers/normalization"),padding_1=require("./layers/padding"),pooling_1=require("./layers/pooling"),recurrent_1=require("./layers/recurrent");exports.RNN=recurrent_1.RNN,exports.RNNCell=recurrent_1.RNNCell;var wrappers_1=require("./layers/wrappers");exports.inputLayer=inputLayer,exports.elu=elu,exports.reLU=reLU,exports.leakyReLU=leakyReLU,exports.softmax=softmax,exports.thresholdedReLU=thresholdedReLU,exports.conv1d=conv1d,exports.conv2d=conv2d,exports.conv2dTranspose=conv2dTranspose,exports.separableConv2d=separableConv2d,exports.cropping2D=cropping2D,exports.upSampling2d=upSampling2d,exports.depthwiseConv2d=depthwiseConv2d,exports.activation=activation,exports.dense=dense,exports.dropout=dropout,exports.flatten=flatten,exports.repeatVector=repeatVector,exports.reshape=reshape,exports.permute=permute,exports.embedding=embedding,exports.add=add,exports.average=average,exports.concatenate=concatenate,exports.maximum=maximum,exports.minimum=minimum,exports.multiply=multiply,exports.dot=dot,exports.batchNormalization=batchNormalization,exports.zeroPadding2d=zeroPadding2d,exports.averagePooling1d=averagePooling1d,exports.avgPool1d=avgPool1d,exports.avgPooling1d=avgPooling1d,exports.averagePooling2d=averagePooling2d,exports.avgPool2d=avgPool2d,exports.avgPooling2d=avgPooling2d,exports.globalAveragePooling1d=globalAveragePooling1d,exports.globalAveragePooling2d=globalAveragePooling2d,exports.globalMaxPooling1d=globalMaxPooling1d,exports.globalMaxPooling2d=globalMaxPooling2d,exports.maxPooling1d=maxPooling1d,exports.maxPooling2d=maxPooling2d,exports.gru=gru,exports.gruCell=gruCell,exports.lstm=lstm,exports.lstmCell=lstmCell,exports.simpleRNN=simpleRNN,exports.simpleRNNCell=simpleRNNCell,exports.rnn=rnn,exports.stackedRNNCells=stackedRNNCells,exports.bidirectional=bidirectional,exports.timeDistributed=timeDistributed,exports.globalMaxPool1d=globalMaxPooling1d,exports.globalMaxPool2d=globalMaxPooling2d,exports.maxPool1d=maxPooling1d,exports.maxPool2d=maxPooling2d},{"./engine/input_layer":223,"./engine/topology":224,"./exports":229,"./layers/advanced_activations":238,"./layers/convolutional":239,"./layers/convolutional_depthwise":240,"./layers/core":241,"./layers/embeddings":242,"./layers/merge":243,"./layers/normalization":244,"./layers/padding":245,"./layers/pooling":246,"./layers/recurrent":247,"./layers/wrappers":249}],233:[function(require,module,exports){"use strict";function binaryAccuracy(yTrue,yPred){return metrics.binaryAccuracy(yTrue,yPred)}function binaryCrossentropy(yTrue,yPred){return metrics.binaryCrossentropy(yTrue,yPred)}function categoricalAccuracy(yTrue,yPred){return metrics.categoricalAccuracy(yTrue,yPred)}function categoricalCrossentropy(yTrue,yPred){return metrics.categoricalCrossentropy(yTrue,yPred)}function precision(yTrue,yPred){return metrics.precision(yTrue,yPred)}function recall(yTrue,yPred){return metrics.recall(yTrue,yPred)}function cosineProximity(yTrue,yPred){return losses.cosineProximity(yTrue,yPred)}function meanAbsoluteError(yTrue,yPred){return losses.meanAbsoluteError(yTrue,yPred)}function meanAbsolutePercentageError(yTrue,yPred){return losses.meanAbsolutePercentageError(yTrue,yPred)}function MAPE(yTrue,yPred){return losses.meanAbsolutePercentageError(yTrue,yPred)}function mape(yTrue,yPred){return losses.meanAbsolutePercentageError(yTrue,yPred)}function meanSquaredError(yTrue,yPred){return losses.meanSquaredError(yTrue,yPred)}function MSE(yTrue,yPred){return losses.meanSquaredError(yTrue,yPred)}function mse(yTrue,yPred){return losses.meanSquaredError(yTrue,yPred)}Object.defineProperty(exports,"__esModule",{value:!0});var losses=require("./losses"),metrics=require("./metrics");exports.binaryAccuracy=binaryAccuracy,exports.binaryCrossentropy=binaryCrossentropy,exports.categoricalAccuracy=categoricalAccuracy,exports.categoricalCrossentropy=categoricalCrossentropy,exports.precision=precision,exports.recall=recall,exports.cosineProximity=cosineProximity,exports.meanAbsoluteError=meanAbsoluteError,exports.meanAbsolutePercentageError=meanAbsolutePercentageError,exports.MAPE=MAPE,exports.mape=mape,exports.meanSquaredError=meanSquaredError,exports.MSE=MSE,exports.mse=mse},{"./losses":251,"./metrics":252}],234:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var models_1=require("./models");exports.modelFromJSON=models_1.modelFromJSON},{"./models":253}],235:[function(require,module,exports){"use strict";function l1l2(config){return new regularizers_1.L1L2(config)}function l1(config){return regularizers.l1(config)}function l2(config){return regularizers.l2(config)}Object.defineProperty(exports,"__esModule",{value:!0});var regularizers=require("./regularizers"),regularizers_1=require("./regularizers");exports.l1l2=l1l2,exports.l1=l1,exports.l2=l2},{"./regularizers":255}],236:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var constraints=require("./exports_constraints");exports.constraints=constraints;var initializers=require("./exports_initializers");exports.initializers=initializers;var layers=require("./exports_layers");exports.layers=layers;var models=require("./exports_models");exports.models=models;var metrics=require("./exports_metrics");exports.metrics=metrics;var regularizers=require("./exports_regularizers");exports.regularizers=regularizers;var base_callbacks_1=require("./base_callbacks");exports.CallbackList=base_callbacks_1.CallbackList,exports.CustomCallback=base_callbacks_1.CustomCallback,exports.History=base_callbacks_1.History;var callbacks_1=require("./callbacks");exports.Callback=callbacks_1.Callback;var topology_1=require("./engine/topology");exports.InputSpec=topology_1.InputSpec,exports.SymbolicTensor=topology_1.SymbolicTensor;var training_1=require("./engine/training");exports.Model=training_1.Model;var exports_1=require("./exports");exports.input=exports_1.input,exports.loadModel=exports_1.loadModel,exports.model=exports_1.model,exports.registerCallbackConstructor=exports_1.registerCallbackConstructor,exports.sequential=exports_1.sequential;var recurrent_1=require("./layers/recurrent");exports.RNN=recurrent_1.RNN;var models_1=require("./models");exports.Sequential=models_1.Sequential;var variables_1=require("./variables");exports.LayerVariable=variables_1.LayerVariable;var version_1=require("./version");exports.version_layers=version_1.version},{"./base_callbacks":217,"./callbacks":218,"./engine/topology":224,"./engine/training":225,"./exports":229,"./exports_constraints":230,"./exports_initializers":231,"./exports_layers":232,"./exports_metrics":233,"./exports_models":234,"./exports_regularizers":235,"./layers/recurrent":247,"./models":253,"./variables":263,"./version":264}],237:[function(require,module,exports){"use strict";function checkFanMode(value){generic_utils_1.checkStringTypeUnionValue(exports.VALID_FAN_MODE_VALUES,"FanMode",value)}function checkDistribution(value){generic_utils_1.checkStringTypeUnionValue(exports.VALID_DISTRIBUTION_VALUES,"Distribution",value)}function computeFans(shape,dataFormat){void 0===dataFormat&&(dataFormat="channelsLast");var fanIn,fanOut;if(common_1.checkDataFormat(dataFormat),2===shape.length)fanIn=shape[0],fanOut=shape[1];else if(-1!==[3,4,5].indexOf(shape.length)){if("channelsFirst"===dataFormat){var receptiveFieldSize=math_utils_1.arrayProd(shape,2);fanIn=shape[1]*receptiveFieldSize,fanOut=shape[0]*receptiveFieldSize}else if("channelsLast"===dataFormat){var receptiveFieldSize=math_utils_1.arrayProd(shape,0,shape.length-2);fanIn=shape[shape.length-2]*receptiveFieldSize,fanOut=shape[shape.length-1]*receptiveFieldSize}}else{var shapeProd=math_utils_1.arrayProd(shape);fanIn=Math.sqrt(shapeProd),fanOut=Math.sqrt(shapeProd)}return[fanIn,fanOut]}function deserializeInitializer(config,customObjects){return void 0===customObjects&&(customObjects={}),generic_utils_1.deserializeKerasObject(config,tfjs_core_1.serialization.SerializationMap.getMap().classNameMap,customObjects,"initializer")}function serializeInitializer(initializer){return generic_utils_1.serializeKerasObject(initializer)}function getInitializer(identifier){if("string"==typeof identifier){var className=identifier in exports.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?exports.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[identifier]:identifier;if("GlorotUniform"===className)return new GlorotUniform;if("GlorotNormal"===className)return new GlorotNormal;if("HeNormal"===className)return new HeNormal;if("LeCunNormal"===className)return new LeCunNormal;return deserializeInitializer({className:className,config:{}})}return identifier instanceof Initializer?identifier:deserializeInitializer(identifier)}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("./backend/state"),K=require("./backend/tfjs_backend"),common_1=require("./common"),errors_1=require("./errors"),generic_utils_1=require("./utils/generic_utils"),math_utils_1=require("./utils/math_utils");exports.VALID_FAN_MODE_VALUES=["fanIn","fanOut","fanAvg"],exports.checkFanMode=checkFanMode,exports.VALID_DISTRIBUTION_VALUES=["normal","uniform"],exports.checkDistribution=checkDistribution;var Initializer=function(_super){function Initializer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Initializer,_super),Initializer.prototype.fromConfigUsesCustomObjects=function(){return!1},Initializer.prototype.getConfig=function(){return{}},Initializer}(tfjs_core_1.serialization.Serializable);exports.Initializer=Initializer;var Zeros=function(_super){function Zeros(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Zeros,_super),Zeros.prototype.apply=function(shape,dtype){return tfjs_core_1.zeros(shape,dtype)},Zeros.className="Zeros",Zeros}(Initializer);exports.Zeros=Zeros,tfjs_core_1.serialization.registerClass(Zeros);var Ones=function(_super){function Ones(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Ones,_super),Ones.prototype.apply=function(shape,dtype){return tfjs_core_1.ones(shape,dtype)},Ones.className="Ones",Ones}(Initializer);exports.Ones=Ones,tfjs_core_1.serialization.registerClass(Ones);var Constant=function(_super){function Constant(config){var _this=_super.call(this)||this;if("object"!=typeof config)throw new errors_1.ValueError("Expected argument of type ConstantConfig but got "+config);if(void 0===config.value)throw new errors_1.ValueError("config must have value set but got "+config);return _this.value=config.value,_this}return __extends(Constant,_super),Constant.prototype.apply=function(shape,dtype){var _this=this;return tfjs_core_1.tidy(function(){return tfjs_core_1.mul(tfjs_core_1.scalar(_this.value),tfjs_core_1.ones(shape,dtype))})},Constant.prototype.getConfig=function(){return{value:this.value}},Constant.className="Constant",Constant}(Initializer);exports.Constant=Constant,tfjs_core_1.serialization.registerClass(Constant);var RandomUniform=function(_super){function RandomUniform(config){var _this=_super.call(this)||this;return _this.DEFAULT_MINVAL=-.05,_this.DEFAULT_MAXVAL=.05,_this.minval=config.minval||_this.DEFAULT_MINVAL,_this.maxval=config.maxval||_this.DEFAULT_MAXVAL,_this.seed=config.seed,_this}return __extends(RandomUniform,_super),
RandomUniform.prototype.apply=function(shape,dtype){return tfjs_core_1.randomUniform(shape,this.minval,this.maxval,dtype)},RandomUniform.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},RandomUniform.className="RandomUniform",RandomUniform}(Initializer);exports.RandomUniform=RandomUniform,tfjs_core_1.serialization.registerClass(RandomUniform);var RandomNormal=function(_super){function RandomNormal(config){var _this=_super.call(this)||this;return _this.DEFAULT_MEAN=0,_this.DEFAULT_STDDEV=.05,_this.mean=config.mean||_this.DEFAULT_MEAN,_this.stddev=config.stddev||_this.DEFAULT_STDDEV,_this.seed=config.seed,_this}return __extends(RandomNormal,_super),RandomNormal.prototype.apply=function(shape,dtype){if("float32"!==(dtype=dtype||"float32")&&"int32"!==dtype)throw new errors_1.NotImplementedError("randomNormal does not support dType "+dtype+".");return K.randomNormal(shape,this.mean,this.stddev,dtype,this.seed)},RandomNormal.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},RandomNormal.className="RandomNormal",RandomNormal}(Initializer);exports.RandomNormal=RandomNormal,tfjs_core_1.serialization.registerClass(RandomNormal);var TruncatedNormal=function(_super){function TruncatedNormal(config){var _this=_super.call(this)||this;return _this.DEFAULT_MEAN=0,_this.DEFAULT_STDDEV=.05,_this.mean=config.mean||_this.DEFAULT_MEAN,_this.stddev=config.stddev||_this.DEFAULT_STDDEV,_this.seed=config.seed,_this}return __extends(TruncatedNormal,_super),TruncatedNormal.prototype.apply=function(shape,dtype){if("float32"!==(dtype=dtype||"float32")&&"int32"!==dtype)throw new errors_1.NotImplementedError("truncatedNormal does not support dType "+dtype+".");return tfjs_core_1.truncatedNormal(shape,this.mean,this.stddev,dtype,this.seed)},TruncatedNormal.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},TruncatedNormal.className="TruncatedNormal",TruncatedNormal}(Initializer);exports.TruncatedNormal=TruncatedNormal,tfjs_core_1.serialization.registerClass(TruncatedNormal);var Identity=function(_super){function Identity(config){var _this=_super.call(this)||this;return _this.gain=null!=config.gain?tfjs_core_1.scalar(config.gain):state_1.getScalar(1),_this}return __extends(Identity,_super),Identity.prototype.apply=function(shape,dtype){var _this=this;return tfjs_core_1.tidy(function(){if(2!==shape.length||shape[0]!==shape[1])throw new errors_1.ValueError("Identity matrix initializer can only be used for 2D square matrices.");return tfjs_core_1.mul(_this.gain,tfjs_core_1.eye(shape[0]))})},Identity.prototype.getConfig=function(){return{gain:this.gain.get()}},Identity.className="Identity",Identity}(Initializer);exports.Identity=Identity,tfjs_core_1.serialization.registerClass(Identity);var VarianceScaling=function(_super){function VarianceScaling(config){var _this=_super.call(this)||this;if(config.scale<0)throw new errors_1.ValueError("scale must be a positive float. Got: "+config.scale);return _this.scale=null==config.scale?1:config.scale,_this.mode=config.mode,checkFanMode(_this.mode),_this.distribution=config.distribution,checkDistribution(_this.distribution),_this.seed=config.seed,_this}return __extends(VarianceScaling,_super),VarianceScaling.prototype.apply=function(shape,dtype){var fans=computeFans(shape),fanIn=fans[0],fanOut=fans[1],scale=this.scale;if("fanIn"===this.mode?scale/=Math.max(1,fanIn):"fanOut"===this.mode?scale/=Math.max(1,fanOut):scale/=Math.max(1,(fanIn+fanOut)/2),"normal"===this.distribution){var stddev=Math.sqrt(scale);if("float32"!==(dtype=dtype||"float32")&&"int32"!==dtype)throw new errors_1.NotImplementedError(this.getClassName()+" does not support dType "+dtype+".");return tfjs_core_1.truncatedNormal(shape,0,stddev,dtype,this.seed)}var limit=Math.sqrt(3*scale);return tfjs_core_1.randomUniform(shape,-limit,limit,dtype)},VarianceScaling.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},VarianceScaling.className="VarianceScaling",VarianceScaling}(Initializer);exports.VarianceScaling=VarianceScaling,tfjs_core_1.serialization.registerClass(VarianceScaling);var GlorotUniform=function(_super){function GlorotUniform(config){return _super.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==config?null:config.seed})||this}return __extends(GlorotUniform,_super),GlorotUniform.prototype.getClassName=function(){return VarianceScaling.className},GlorotUniform.className="GlorotUniform",GlorotUniform}(VarianceScaling);exports.GlorotUniform=GlorotUniform,tfjs_core_1.serialization.registerClass(GlorotUniform);var GlorotNormal=function(_super){function GlorotNormal(config){return _super.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==config?null:config.seed})||this}return __extends(GlorotNormal,_super),GlorotNormal.prototype.getClassName=function(){return VarianceScaling.className},GlorotNormal.className="GlorotNormal",GlorotNormal}(VarianceScaling);exports.GlorotNormal=GlorotNormal,tfjs_core_1.serialization.registerClass(GlorotNormal);var HeNormal=function(_super){function HeNormal(config){return _super.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==config?null:config.seed})||this}return __extends(HeNormal,_super),HeNormal.prototype.getClassName=function(){return VarianceScaling.className},HeNormal.className="HeNormal",HeNormal}(VarianceScaling);exports.HeNormal=HeNormal,tfjs_core_1.serialization.registerClass(HeNormal);var LeCunNormal=function(_super){function LeCunNormal(config){return _super.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==config?null:config.seed})||this}return __extends(LeCunNormal,_super),LeCunNormal.prototype.getClassName=function(){return VarianceScaling.className},LeCunNormal.className="LeCunNormal",LeCunNormal}(VarianceScaling);exports.LeCunNormal=LeCunNormal,tfjs_core_1.serialization.registerClass(LeCunNormal);var Orthogonal=function(_super){function Orthogonal(config){var _this=_super.call(this)||this;if(_this.DEFAULT_GAIN=1,_this.gain=null==config.gain?_this.DEFAULT_GAIN:config.gain,_this.seed=config.seed,null!=_this.seed)throw new errors_1.NotImplementedError("Random seed is not implemented for Orthogonal Initializer yet.");return _this}return __extends(Orthogonal,_super),Orthogonal.prototype.apply=function(shape,dtype){var _this=this;return tfjs_core_1.tidy(function(){if(2!==shape.length)throw new errors_1.NotImplementedError("The Orthogonal Initializer does not support non-2D shapes yet.");shape[0]*shape[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+shape[0]*shape[1]+") elements: Slowness may result.");var normalizedShape=shape[0]>shape[1]?[shape[1],shape[0]]:shape,a=K.randomNormal(normalizedShape,0,1,"float32"),q=tfjs_core_1.linalg.gramSchmidt(a);return shape[0]>shape[1]&&(q=q.transpose()),tfjs_core_1.mul(state_1.getScalar(_this.gain),q)})},Orthogonal.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},Orthogonal.className="Orthogonal",Orthogonal}(Initializer);exports.Orthogonal=Orthogonal,tfjs_core_1.serialization.registerClass(Orthogonal),exports.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",identity:"Identity",leCunNormal:"LeCunNormal",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"},exports.serializeInitializer=serializeInitializer,exports.getInitializer=getInitializer},{"./backend/state":215,"./backend/tfjs_backend":216,"./common":219,"./errors":228,"./utils/generic_utils":257,"./utils/math_utils":259,"@tensorflow/tfjs-core":62}],238:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),activations_1=require("../activations"),tfjs_backend_1=require("../backend/tfjs_backend"),topology_1=require("../engine/topology"),state_1=require("../backend/state"),errors_1=require("../errors"),types_utils_1=require("../utils/types_utils"),ReLU=function(_super){function ReLU(config){var _this=_super.call(this,null==config?{}:config)||this;return _this.supportsMasking=!0,null!=config&&(_this.maxValue=config.maxValue),_this}return __extends(ReLU,_super),ReLU.prototype.call=function(inputs,kwargs){inputs=types_utils_1.getExactlyOneTensor(inputs);var output=tfjs_core_1.relu(inputs);return null!=this.maxValue&&(output=tfjs_core_1.clipByValue(output,0,this.maxValue)),output},ReLU.prototype.computeOutputShape=function(inputShape){return inputShape},ReLU.prototype.getConfig=function(){var config={maxValue:this.maxValue},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},ReLU.className="ReLU",ReLU}(topology_1.Layer);exports.ReLU=ReLU,tfjs_core_1.serialization.registerClass(ReLU);var LeakyReLU=function(_super){function LeakyReLU(config){var _this=_super.call(this,null==config?{}:config)||this;return _this.DEFAULT_ALPHA=.3,null==config&&(config={}),_this.alpha=null==config.alpha?_this.DEFAULT_ALPHA:config.alpha,_this}return __extends(LeakyReLU,_super),LeakyReLU.prototype.call=function(inputs,kwargs){var x=types_utils_1.getExactlyOneTensor(inputs);return tfjs_core_1.leakyRelu(x,this.alpha)},LeakyReLU.prototype.computeOutputShape=function(inputShape){return inputShape},LeakyReLU.prototype.getConfig=function(){var config={alpha:this.alpha},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},LeakyReLU.className="LeakyReLU",LeakyReLU}(topology_1.Layer);exports.LeakyReLU=LeakyReLU,tfjs_core_1.serialization.registerClass(LeakyReLU);var ELU=function(_super){function ELU(config){var _this=_super.call(this,null==config?{}:config)||this;if(_this.DEFAULT_ALPHA=1,null==config&&(config={}),null!=config.alpha&&config.alpha!==_this.DEFAULT_ALPHA)throw new errors_1.NotImplementedError("Non-default alpha value ("+config.alpha+") is not supported by the ELU layer yet.");return _this.alpha=null==config.alpha?_this.DEFAULT_ALPHA:config.alpha,_this}return __extends(ELU,_super),ELU.prototype.call=function(inputs,kwargs){var x=types_utils_1.getExactlyOneTensor(inputs);return tfjs_core_1.elu(x)},ELU.prototype.computeOutputShape=function(inputShape){return inputShape},ELU.prototype.getConfig=function(){var config={alpha:this.alpha},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},ELU.className="ELU",ELU}(topology_1.Layer);exports.ELU=ELU,tfjs_core_1.serialization.registerClass(ELU);var ThresholdedReLU=function(_super){function ThresholdedReLU(config){var _this=_super.call(this,null==config?{}:config)||this;return _this.DEFAULT_THETA=1,null==config&&(config={}),_this.theta=null==config.theta?_this.DEFAULT_THETA:config.theta,_this.thetaTensor=state_1.getScalar(_this.theta),_this}return __extends(ThresholdedReLU,_super),ThresholdedReLU.prototype.call=function(inputs,kwargs){var x=types_utils_1.getExactlyOneTensor(inputs);return x.mul(tfjs_backend_1.cast(x.greater(this.thetaTensor),"float32"))},ThresholdedReLU.prototype.computeOutputShape=function(inputShape){return inputShape},ThresholdedReLU.prototype.getConfig=function(){var config={theta:this.theta},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},ThresholdedReLU.className="ThresholdedReLU",ThresholdedReLU}(topology_1.Layer);exports.ThresholdedReLU=ThresholdedReLU,tfjs_core_1.serialization.registerClass(ThresholdedReLU);var Softmax=function(_super){function Softmax(config){var _this=_super.call(this,null==config?{}:config)||this;return _this.DEFAULT_AXIS=1,null==config&&(config={}),_this.softmax=(new activations_1.Softmax).apply,_this.axis=null==config.axis?_this.DEFAULT_AXIS:config.axis,_this}return __extends(Softmax,_super),Softmax.prototype.call=function(inputs,kwargs){var x=types_utils_1.getExactlyOneTensor(inputs);return this.softmax(x,this.axis)},Softmax.prototype.computeOutputShape=function(inputShape){return inputShape},Softmax.prototype.getConfig=function(){var config={axis:this.axis},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Softmax.className="Softmax",Softmax}(topology_1.Layer);exports.Softmax=Softmax,tfjs_core_1.serialization.registerClass(Softmax)},{"../activations":213,"../backend/state":215,"../backend/tfjs_backend":216,"../engine/topology":224,"../errors":228,"../utils/types_utils":261,"@tensorflow/tfjs-core":62}],239:[function(require,module,exports){"use strict";function preprocessConv2DInput(x,dataFormat){return tfjs_core_1.tidy(function(){return common_2.checkDataFormat(dataFormat),"channelsFirst"===dataFormat?tfc.transpose(x,[0,2,3,1]):x})}function conv1dWithBias(x,kernel,bias,strides,padding,dataFormat,dilationRate){return void 0===strides&&(strides=1),void 0===padding&&(padding="valid"),void 0===dilationRate&&(dilationRate=1),tfjs_core_1.tidy(function(){if(null==dataFormat&&(dataFormat=common_1.imageDataFormat()),common_2.checkDataFormat(dataFormat),3!==x.shape.length)throw new errors_1.ValueError("The input of a conv1dWithBias operation should be 3, but is "+x.shape.length+" instead.");if(3!==kernel.shape.length)throw new errors_1.ValueError("The kernel for a conv1dWithBias operation should be 3, but is "+kernel.shape.length+" instead");if(null!=bias&&1!==bias.shape.length)throw new errors_1.ValueError("The bias for a conv1dWithBias operation should be 1, but is "+kernel.shape.length+" instead");if("channelsFirst"===dataFormat&&(x=tfc.transpose(x,[0,2,1])),"causal"===padding)throw new errors_1.NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var y=tfc.conv1d(x,kernel,strides,"same"===padding?"same":"valid","NWC",dilationRate);return null!=bias&&(y=K.biasAdd(y,bias)),y})}function conv1d(x,kernel,strides,padding,dataFormat,dilationRate){return void 0===strides&&(strides=1),void 0===padding&&(padding="valid"),void 0===dilationRate&&(dilationRate=1),tfjs_core_1.tidy(function(){return common_2.checkDataFormat(dataFormat),conv1dWithBias(x,kernel,null,strides,padding,dataFormat,dilationRate)})}function conv2d(x,kernel,strides,padding,dataFormat,dilationRate){return void 0===strides&&(strides=[1,1]),void 0===padding&&(padding="valid"),tfjs_core_1.tidy(function(){return common_2.checkDataFormat(dataFormat),conv2dWithBias(x,kernel,null,strides,padding,dataFormat,dilationRate)})}function conv2dWithBias(x,kernel,bias,strides,padding,dataFormat,dilationRate){return void 0===strides&&(strides=[1,1]),void 0===padding&&(padding="valid"),tfjs_core_1.tidy(function(){if(null==dataFormat&&(dataFormat=common_1.imageDataFormat()),common_2.checkDataFormat(dataFormat),3!==x.rank&&4!==x.rank)throw new errors_1.ValueError("conv2dWithBias expects input to be of rank 3 or 4, but received "+x.rank+".");if(3!==kernel.rank&&4!==kernel.rank)throw new errors_1.ValueError("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+x.rank+".");var y=preprocessConv2DInput(x,dataFormat);if("causal"===padding)throw new errors_1.NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return y=tfc.conv2d(y,kernel,strides,"same"===padding?"same":"valid","NHWC",dilationRate),null!=bias&&(y=K.biasAdd(y,bias)),"channelsFirst"===dataFormat&&(y=tfc.transpose(y,[0,3,1,2])),y})}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),activations_1=require("../activations"),common_1=require("../backend/common"),K=require("../backend/tfjs_backend"),common_2=require("../common"),constraints_1=require("../constraints"),topology_1=require("../engine/topology"),errors_1=require("../errors"),initializers_1=require("../initializers"),regularizers_1=require("../regularizers"),conv_utils_1=require("../utils/conv_utils"),generic_utils=require("../utils/generic_utils"),types_utils_1=require("../utils/types_utils");exports.preprocessConv2DInput=preprocessConv2DInput,exports.conv1dWithBias=conv1dWithBias,exports.conv1d=conv1d,exports.conv2d=conv2d,exports.conv2dWithBias=conv2dWithBias;var BaseConv=function(_super){function BaseConv(rank,config){var _this=_super.call(this,config)||this;if(_this.bias=null,_this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",_this.DEFAULT_BIAS_INITIALIZER="zeros",BaseConv.verifyConfig(config),_this.rank=rank,1!==_this.rank&&2!==_this.rank)throw new errors_1.NotImplementedError("Convolution layer for rank other than 1 or 2 ("+_this.rank+") is not implemented yet.");if(_this.kernelSize=conv_utils_1.normalizeArray(config.kernelSize,rank,"kernelSize"),_this.strides=conv_utils_1.normalizeArray(null==config.strides?1:config.strides,rank,"strides"),_this.padding=null==config.padding?"valid":config.padding,common_2.checkPaddingMode(_this.padding),_this.dataFormat=null==config.dataFormat?"channelsLast":config.dataFormat,common_2.checkDataFormat(_this.dataFormat),_this.activation=activations_1.getActivation(config.activation),_this.useBias=null==config.useBias||config.useBias,_this.biasInitializer=initializers_1.getInitializer(config.biasInitializer||_this.DEFAULT_BIAS_INITIALIZER),_this.biasConstraint=constraints_1.getConstraint(config.biasConstraint),_this.biasRegularizer=regularizers_1.getRegularizer(config.biasRegularizer),_this.activityRegularizer=regularizers_1.getRegularizer(config.activityRegularizer),_this.dilationRate=conv_utils_1.normalizeArray(null==config.dilationRate?1:config.dilationRate,rank,"dilationRate"),1===_this.rank&&Array.isArray(_this.dilationRate)&&1!==_this.dilationRate.length)throw new errors_1.ValueError("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(_this.dilationRate));if(2===_this.rank)if("number"==typeof _this.dilationRate)_this.dilationRate=[_this.dilationRate,_this.dilationRate];else if(2!==_this.dilationRate.length)throw new errors_1.ValueError("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(_this.dilationRate));return _this}return __extends(BaseConv,_super),BaseConv.verifyConfig=function(config){if(generic_utils.assert("kernelSize"in config,"required key 'kernelSize' not in config"),"number"!=typeof config.kernelSize&&!generic_utils.checkArrayTypeAndLength(config.kernelSize,"number",1,2))throw new errors_1.ValueError("BaseConv expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(config.kernelSize)+".")},BaseConv.prototype.getConfig=function(){var config={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:activations_1.serializeActivation(this.activation),useBias:this.useBias,biasInitializer:initializers_1.serializeInitializer(this.biasInitializer),biasRegularizer:regularizers_1.serializeRegularizer(this.biasRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),biasConstraint:constraints_1.serializeConstraint(this.biasConstraint)},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},BaseConv}(topology_1.Layer);exports.BaseConv=BaseConv;var Conv=function(_super){function Conv(rank,config){var _this=_super.call(this,rank,config)||this;return _this.kernel=null,Conv.verifyConfig(config),_this.filters=config.filters,_this.kernelInitializer=initializers_1.getInitializer(config.kernelInitializer||_this.DEFAULT_KERNEL_INITIALIZER),_this.kernelConstraint=constraints_1.getConstraint(config.kernelConstraint),_this.kernelRegularizer=regularizers_1.getRegularizer(config.kernelRegularizer),_this}return __extends(Conv,_super),Conv.prototype.build=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var channelAxis="channelsFirst"===this.dataFormat?1:inputShape.length-1;if(null==inputShape[channelAxis])throw new errors_1.ValueError("The channel dimension of the input should be defined. Found "+inputShape[channelAxis]);var inputDim=inputShape[channelAxis],kernelShape=this.kernelSize.concat([inputDim,this.filters]);this.kernel=this.addWeight("kernel",kernelShape,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(_a={},_a[channelAxis]=inputDim,_a)}],this.built=!0;var _a},Conv.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){inputs=types_utils_1.getExactlyOneTensor(inputs);var outputs,biasValue=null==_this.bias?null:_this.bias.read();if(1===_this.rank)outputs=conv1dWithBias(inputs,_this.kernel.read(),biasValue,_this.strides[0],_this.padding,_this.dataFormat,_this.dilationRate[0]);else if(2===_this.rank)outputs=conv2dWithBias(inputs,_this.kernel.read(),biasValue,_this.strides,_this.padding,_this.dataFormat,_this.dilationRate);else if(3===_this.rank)throw new errors_1.NotImplementedError("3D convolution is not implemented yet.");return null!=_this.activation&&(outputs=_this.activation.apply(outputs)),outputs})},Conv.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);for(var newSpace=[],space="channelsLast"===this.dataFormat?inputShape.slice(1,inputShape.length-1):inputShape.slice(2),i=0;i<space.length;++i){var newDim=conv_utils_1.convOutputLength(space[i],this.kernelSize[i],this.padding,this.strides[i],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);newSpace.push(newDim)}var outputShape=[inputShape[0]];return"channelsLast"===this.dataFormat?(outputShape=outputShape.concat(newSpace),outputShape.push(this.filters)):(outputShape.push(this.filters),outputShape=outputShape.concat(newSpace)),outputShape},Conv.prototype.getConfig=function(){var config={filters:this.filters,kernelInitializer:initializers_1.serializeInitializer(this.kernelInitializer),kernelRegularizer:regularizers_1.serializeRegularizer(this.kernelRegularizer),kernelConstraint:constraints_1.serializeConstraint(this.kernelConstraint)},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Conv.verifyConfig=function(config){if(!("filters"in config)||"number"!=typeof config.filters||config.filters<1)throw new errors_1.ValueError("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(config.filters))},Conv}(BaseConv);exports.Conv=Conv;var Conv2D=function(_super){function Conv2D(config){var _this=_super.call(this,2,config)||this;return Conv2D.verifyConfig(config),_this}return __extends(Conv2D,_super),Conv2D.prototype.getConfig=function(){var config=_super.prototype.getConfig.call(this);return delete config.rank,config},Conv2D.verifyConfig=function(config){if("number"!=typeof config.kernelSize&&!generic_utils.checkArrayTypeAndLength(config.kernelSize,"number",1,2))throw new errors_1.ValueError("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(config.kernelSize)+".")},Conv2D.className="Conv2D",Conv2D}(Conv);exports.Conv2D=Conv2D,tfjs_core_1.serialization.registerClass(Conv2D);var Conv2DTranspose=function(_super){function Conv2DTranspose(config){var _this=_super.call(this,config)||this;if(_this.inputSpec=[new topology_1.InputSpec({ndim:4})],"same"!==_this.padding&&"valid"!==_this.padding)throw new errors_1.ValueError("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+_this.padding);return _this}return __extends(Conv2DTranspose,_super),Conv2DTranspose.prototype.build=function(inputShape){if(inputShape=types_utils_1.getExactlyOneShape(inputShape),4!==inputShape.length)throw new errors_1.ValueError("Input should have rank 4; Received input shape: "+JSON.stringify(inputShape));var channelAxis="channelsFirst"===this.dataFormat?1:inputShape.length-1;if(null==inputShape[channelAxis])throw new errors_1.ValueError("The channel dimension of the inputs should be defined. Found `None`.");var inputDim=inputShape[channelAxis],kernelShape=this.kernelSize.concat([this.filters,inputDim]);this.kernel=this.addWeight("kernel",kernelShape,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new topology_1.InputSpec({ndim:4,axes:(_a={},_a[channelAxis]=inputDim,_a)})],this.built=!0;var _a},Conv2DTranspose.prototype.call=function(inputs,kwargs){var _this=this;return tfc.tidy(function(){var input=types_utils_1.getExactlyOneTensor(inputs);if(4!==input.shape.length)throw new errors_1.ValueError("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+input.shape.length);var hAxis,wAxis,inputShape=input.shape,batchSize=inputShape[0];"channelsFirst"===_this.dataFormat?(hAxis=2,wAxis=3):(hAxis=1,wAxis=2);var height=inputShape[hAxis],width=inputShape[wAxis],kernelH=_this.kernelSize[0],kernelW=_this.kernelSize[1],strideH=_this.strides[0],strideW=_this.strides[1],outHeight=conv_utils_1.deconvLength(height,strideH,kernelH,_this.padding),outWidth=conv_utils_1.deconvLength(width,strideW,kernelW,_this.padding),outputShape=[batchSize,outHeight,outWidth,_this.filters];"channelsLast"!==_this.dataFormat&&(input=tfc.transpose(input,[0,2,3,1]));var outputs=tfc.conv2dTranspose(input,_this.kernel.read(),outputShape,_this.strides,_this.padding);return"channelsLast"!==_this.dataFormat&&(outputs=tfc.transpose(outputs,[0,3,1,2])),null!=_this.bias&&(outputs=K.biasAdd(outputs,_this.bias.read(),_this.dataFormat)),null!=_this.activation&&(outputs=_this.activation.apply(outputs)),outputs})},Conv2DTranspose.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var channelAxis,heightAxis,widthAxis,outputShape=inputShape.slice();"channelsFirst"===this.dataFormat?(channelAxis=1,heightAxis=2,widthAxis=3):(channelAxis=3,heightAxis=1,widthAxis=2);var kernelH=this.kernelSize[0],kernelW=this.kernelSize[1],strideH=this.strides[0],strideW=this.strides[1];return outputShape[channelAxis]=this.filters,outputShape[heightAxis]=conv_utils_1.deconvLength(outputShape[heightAxis],strideH,kernelH,this.padding),outputShape[widthAxis]=conv_utils_1.deconvLength(outputShape[widthAxis],strideW,kernelW,this.padding),outputShape},Conv2DTranspose.prototype.getConfig=function(){var config=_super.prototype.getConfig.call(this);return delete config.dilationRate,config},Conv2DTranspose.className="Conv2DTranspose",Conv2DTranspose}(Conv2D);exports.Conv2DTranspose=Conv2DTranspose,tfjs_core_1.serialization.registerClass(Conv2DTranspose);var SeparableConv=function(_super){function SeparableConv(rank,config){var _this=_super.call(this,rank,config)||this;if(_this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",_this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",_this.depthwiseKernel=null,_this.pointwiseKernel=null,null==config.filters)throw new errors_1.ValueError("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=config.kernelInitializer||null!=config.kernelRegularizer||null!=config.kernelConstraint)throw new errors_1.ValueError("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=config.padding&&"same"!==config.padding&&"valid"!==config.padding)throw new errors_1.ValueError("SeparableConv"+_this.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(config.padding));return _this.depthMultiplier=null==config.depthMultiplier?1:config.depthMultiplier,_this.depthwiseInitializer=initializers_1.getInitializer(config.depthwiseInitializer||_this.DEFAULT_DEPTHWISE_INITIALIZER),_this.depthwiseRegularizer=regularizers_1.getRegularizer(config.depthwiseRegularizer),_this.depthwiseConstraint=constraints_1.getConstraint(config.depthwiseConstraint),_this.pointwiseInitializer=initializers_1.getInitializer(config.depthwiseInitializer||_this.DEFAULT_POINTWISE_INITIALIZER),_this.pointwiseRegularizer=regularizers_1.getRegularizer(config.pointwiseRegularizer),_this.pointwiseConstraint=constraints_1.getConstraint(config.pointwiseConstraint),_this}return __extends(SeparableConv,_super),SeparableConv.prototype.build=function(inputShape){if(inputShape=types_utils_1.getExactlyOneShape(inputShape),inputShape.length<this.rank+2)throw new errors_1.ValueError("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(inputShape));var channelAxis="channelsFirst"===this.dataFormat?1:inputShape.length-1;if(null==inputShape[channelAxis]||inputShape[channelAxis]<0)throw new errors_1.ValueError("The channel dimension of the inputs should be defined, but found "+JSON.stringify(inputShape[channelAxis]));for(var inputDim=inputShape[channelAxis],depthwiseKernelShape=this.kernelSize.concat([inputDim,this.depthMultiplier]),pointwiseKernelShape=[],i=0;i<this.rank;++i)pointwiseKernelShape.push(1);pointwiseKernelShape.push(inputDim*this.depthMultiplier,this.filters);this.depthwiseKernel=this.addWeight("depthwise_kernel",depthwiseKernelShape,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",pointwiseKernelShape,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new topology_1.InputSpec({ndim:this.rank+2,axes:(_a={},_a[channelAxis]=inputDim,_a)})],this.built=!0;var _a},SeparableConv.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){inputs=types_utils_1.getExactlyOneTensor(inputs);var output;if(1===_this.rank)throw new errors_1.NotImplementedError("1D separable convolution is not implemented yet.");return 2===_this.rank&&("channelsFirst"===_this.dataFormat&&(inputs=tfc.transpose(inputs,[0,2,3,1])),output=tfc.separableConv2d(inputs,_this.depthwiseKernel.read(),_this.pointwiseKernel.read(),_this.strides,_this.padding,_this.dilationRate,"NHWC")),_this.useBias&&(output=K.biasAdd(output,_this.bias.read(),_this.dataFormat)),null!=_this.activation&&(output=_this.activation.apply(output)),"channelsFirst"===_this.dataFormat&&(output=tfc.transpose(output,[0,3,1,2])),output})},SeparableConv.prototype.getConfig=function(){var config=_super.prototype.getConfig.call(this);return delete config.rank,delete config.kernelInitializer,delete config.kernelRegularizer,delete config.kernelConstraint,config.depthwiseInitializer=initializers_1.serializeInitializer(this.depthwiseInitializer),
config.pointwiseInitializer=initializers_1.serializeInitializer(this.pointwiseInitializer),config.depthwiseRegularizer=regularizers_1.serializeRegularizer(this.depthwiseRegularizer),config.pointwiseRegularizer=regularizers_1.serializeRegularizer(this.pointwiseRegularizer),config.depthwiseConstraint=constraints_1.serializeConstraint(this.depthwiseConstraint),config.pointwiseConstraint=constraints_1.serializeConstraint(this.pointwiseConstraint),config},SeparableConv.className="SeparableConv",SeparableConv}(Conv);exports.SeparableConv=SeparableConv;var SeparableConv2D=function(_super){function SeparableConv2D(config){return _super.call(this,2,config)||this}return __extends(SeparableConv2D,_super),SeparableConv2D.className="SeparableConv2D",SeparableConv2D}(SeparableConv);exports.SeparableConv2D=SeparableConv2D,tfjs_core_1.serialization.registerClass(SeparableConv2D);var Conv1D=function(_super){function Conv1D(config){var _this=_super.call(this,1,config)||this;return Conv1D.verifyConfig(config),_this.inputSpec=[{ndim:3}],_this}return __extends(Conv1D,_super),Conv1D.prototype.getConfig=function(){var config=_super.prototype.getConfig.call(this);return delete config.rank,delete config.dataFormat,config},Conv1D.verifyConfig=function(config){if("number"!=typeof config.kernelSize&&!generic_utils.checkArrayTypeAndLength(config.kernelSize,"number",1,1))throw new errors_1.ValueError("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(config.kernelSize)+".")},Conv1D.className="Conv1D",Conv1D}(Conv);exports.Conv1D=Conv1D,tfjs_core_1.serialization.registerClass(Conv1D);var Cropping2D=function(_super){function Cropping2D(config){var _this=_super.call(this,config)||this;return"number"==typeof config.cropping?_this.cropping=[[config.cropping,config.cropping],[config.cropping,config.cropping]]:"number"==typeof config.cropping[0]?_this.cropping=[[config.cropping[0],config.cropping[0]],[config.cropping[1],config.cropping[1]]]:_this.cropping=config.cropping,_this.dataFormat=void 0===config.dataFormat?"channelsLast":config.dataFormat,_this.inputSpec=[{ndim:4}],_this}return __extends(Cropping2D,_super),Cropping2D.prototype.computeOutputShape=function(inputShape){return"channelsFirst"===this.dataFormat?[inputShape[0],inputShape[1],inputShape[2]-this.cropping[0][0]-this.cropping[0][1],inputShape[3]-this.cropping[1][0]-this.cropping[1][1]]:[inputShape[0],inputShape[1]-this.cropping[0][0]-this.cropping[0][1],inputShape[2]-this.cropping[1][0]-this.cropping[1][1],inputShape[3]]},Cropping2D.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){if(inputs=types_utils_1.getExactlyOneTensor(inputs),"channelsLast"===_this.dataFormat){var hSliced=K.sliceAlongAxis(inputs,_this.cropping[0][0],inputs.shape[1]-_this.cropping[0][0]-_this.cropping[0][1],2);return K.sliceAlongAxis(hSliced,_this.cropping[1][0],inputs.shape[2]-_this.cropping[1][1]-_this.cropping[1][0],3)}var hSliced=K.sliceAlongAxis(inputs,_this.cropping[0][0],inputs.shape[2]-_this.cropping[0][0]-_this.cropping[0][1],3);return K.sliceAlongAxis(hSliced,_this.cropping[1][0],inputs.shape[3]-_this.cropping[1][1]-_this.cropping[1][0],4)})},Cropping2D.prototype.getConfig=function(){var config={cropping:this.cropping,dataFormat:this.dataFormat},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Cropping2D.className="Cropping2D",Cropping2D}(topology_1.Layer);exports.Cropping2D=Cropping2D,tfjs_core_1.serialization.registerClass(Cropping2D);var UpSampling2D=function(_super){function UpSampling2D(config){var _this=_super.call(this,config)||this;return _this.DEFAULT_SIZE=[2,2],_this.inputSpec=[{ndim:4}],_this.size=null==config.size?_this.DEFAULT_SIZE:config.size,_this.dataFormat=null==config.dataFormat?"channelsLast":config.dataFormat,_this}return __extends(UpSampling2D,_super),UpSampling2D.prototype.computeOutputShape=function(inputShape){if("channelsFirst"===this.dataFormat){var height=null==inputShape[2]?null:this.size[0]*inputShape[2],width=null==inputShape[3]?null:this.size[1]*inputShape[3];return[inputShape[0],inputShape[1],height,width]}var height=null==inputShape[1]?null:this.size[0]*inputShape[1],width=null==inputShape[2]?null:this.size[1]*inputShape[2];return[inputShape[0],height,width,inputShape[3]]},UpSampling2D.prototype.call=function(inputs,kwargs){var _this=this;return tfc.tidy(function(){var input=types_utils_1.getExactlyOneTensor(inputs),inputShape=input.shape;if("channelsFirst"===_this.dataFormat){input=tfc.transpose(input,[0,2,3,1]);var height=_this.size[0]*inputShape[2],width=_this.size[1]*inputShape[3],resized=input.resizeNearestNeighbor([height,width]);return tfc.transpose(resized,[0,3,1,2])}var height=_this.size[0]*inputShape[1],width=_this.size[1]*inputShape[2];return input.resizeNearestNeighbor([height,width])})},UpSampling2D.prototype.getConfig=function(){var config={size:this.size,dataFormat:this.dataFormat},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},UpSampling2D.className="UpSampling2D",UpSampling2D}(topology_1.Layer);exports.UpSampling2D=UpSampling2D,tfjs_core_1.serialization.registerClass(UpSampling2D)},{"../activations":213,"../backend/common":214,"../backend/tfjs_backend":216,"../common":219,"../constraints":220,"../engine/topology":224,"../errors":228,"../initializers":237,"../regularizers":255,"../utils/conv_utils":256,"../utils/generic_utils":257,"../utils/types_utils":261,"@tensorflow/tfjs-core":62}],240:[function(require,module,exports){"use strict";function depthwiseConv2d(x,depthwiseKernel,strides,padding,dataFormat,dilationRate){return void 0===strides&&(strides=[1,1]),void 0===padding&&(padding="valid"),tfjs_core_1.tidy(function(){null==dataFormat&&(dataFormat=common_1.imageDataFormat()),common_2.checkDataFormat(dataFormat);var y=convolutional_1.preprocessConv2DInput(x,dataFormat);if(4!==x.rank)throw new errors_1.ValueError("Input for depthwiseConv2d is required to be 4-D, but is instead "+x.rank+"-D");if(4!==depthwiseKernel.rank)throw new errors_1.ValueError("depthwiseKernel is required to be 4-D, but is instead "+depthwiseKernel.rank+"-D");return y=tfc.depthwiseConv2d(y,depthwiseKernel,strides,"same"===padding?"same":"valid","NHWC",dilationRate),"channelsFirst"===dataFormat&&(y=tfc.transpose(y,[0,3,1,2])),y})}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),common_1=require("../backend/common"),K=require("../backend/tfjs_backend"),common_2=require("../common"),constraints_1=require("../constraints"),errors_1=require("../errors"),initializers_1=require("../initializers"),regularizers_1=require("../regularizers"),conv_utils_1=require("../utils/conv_utils"),types_utils_1=require("../utils/types_utils"),convolutional_1=require("./convolutional");exports.depthwiseConv2d=depthwiseConv2d;var DepthwiseConv2D=function(_super){function DepthwiseConv2D(config){var _this=_super.call(this,2,config)||this;return _this.depthwiseKernel=null,_this.depthMultiplier=null==config.depthMultiplier?1:config.depthMultiplier,_this.depthwiseInitializer=initializers_1.getInitializer(config.depthwiseInitializer||_this.DEFAULT_KERNEL_INITIALIZER),_this.depthwiseConstraint=constraints_1.getConstraint(config.depthwiseConstraint),_this.depthwiseRegularizer=regularizers_1.getRegularizer(config.depthwiseRegularizer),_this}return __extends(DepthwiseConv2D,_super),DepthwiseConv2D.prototype.build=function(inputShape){if(inputShape=types_utils_1.getExactlyOneShape(inputShape),inputShape.length<4)throw new errors_1.ValueError("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(inputShape)+".");var channelAxis="channelsFirst"===this.dataFormat?1:3;if(null==inputShape[channelAxis]||inputShape[channelAxis]<0)throw new errors_1.ValueError("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+inputShape[channelAxis]+").");var inputDim=inputShape[channelAxis],depthwiseKernelShape=[this.kernelSize[0],this.kernelSize[1],inputDim,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",depthwiseKernelShape,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[inputDim*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},DepthwiseConv2D.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){inputs=types_utils_1.getExactlyOneTensor(inputs);var outputs=depthwiseConv2d(inputs,_this.depthwiseKernel.read(),_this.strides,_this.padding,_this.dataFormat,null);return _this.useBias&&(outputs=K.biasAdd(outputs,_this.bias.read(),_this.dataFormat)),null!=_this.activation&&(outputs=_this.activation.apply(outputs)),outputs})},DepthwiseConv2D.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var rows="channelsFirst"===this.dataFormat?inputShape[2]:inputShape[1],cols="channelsFirst"===this.dataFormat?inputShape[3]:inputShape[2],outFilters="channelsFirst"===this.dataFormat?inputShape[1]*this.depthMultiplier:inputShape[3]*this.depthMultiplier,outRows=conv_utils_1.convOutputLength(rows,this.kernelSize[0],this.padding,this.strides[0]),outCols=conv_utils_1.convOutputLength(cols,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[inputShape[0],outFilters,outRows,outCols]:[inputShape[0],outRows,outCols,outFilters]},DepthwiseConv2D.prototype.getConfig=function(){var config=_super.prototype.getConfig.call(this);return config.depthMultiplier=this.depthMultiplier,config.depthwiseInitializer=initializers_1.serializeInitializer(this.depthwiseInitializer),config.depthwiseRegularizer=regularizers_1.serializeRegularizer(this.depthwiseRegularizer),config.depthwiseConstraint=constraints_1.serializeConstraint(this.depthwiseRegularizer),config},DepthwiseConv2D.className="DepthwiseConv2D",DepthwiseConv2D}(convolutional_1.BaseConv);exports.DepthwiseConv2D=DepthwiseConv2D,tfjs_core_1.serialization.registerClass(DepthwiseConv2D)},{"../backend/common":214,"../backend/tfjs_backend":216,"../common":219,"../constraints":220,"../errors":228,"../initializers":237,"../regularizers":255,"../utils/conv_utils":256,"../utils/types_utils":261,"./convolutional":239,"@tensorflow/tfjs-core":62}],241:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),activations_1=require("../activations"),state_1=require("../backend/state"),K=require("../backend/tfjs_backend"),constraints_1=require("../constraints"),topology_1=require("../engine/topology"),errors_1=require("../errors"),initializers_1=require("../initializers"),regularizers_1=require("../regularizers"),math_utils_1=require("../utils/math_utils"),types_utils_1=require("../utils/types_utils"),Dropout=function(_super){function Dropout(config){var _this=_super.call(this,config)||this;if(_this.rate=Math.max(Math.min(config.rate,1),0),_this.rateScalar=state_1.getScalar(_this.rate),_this.noiseShape=config.noiseShape,_this.seed=config.seed,null!=_this.seed)throw new errors_1.NotImplementedError("Non-default seed is not implemented in Dropout layer yet: "+_this.seed);return _this.supportsMasking=!0,_this}return __extends(Dropout,_super),Dropout.prototype.getNoiseShape=function(input){if(null==this.noiseShape)return this.noiseShape;for(var inputShape=input.shape,noiseShape=[],i=0;i<this.noiseShape.length;++i)noiseShape.push(null==this.noiseShape[i]?inputShape[i]:this.noiseShape[i]);return noiseShape},Dropout.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){_this.invokeCallHook(inputs,kwargs);var input=types_utils_1.getExactlyOneTensor(inputs);if(null!=_this.noiseShape&&!tfjs_core_1.util.arraysEqual(input.shape,_this.noiseShape))throw new errors_1.NotImplementedError("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(_this.noiseShape));if(0<_this.rate&&_this.rate<1){var training=null!=kwargs.training&&kwargs.training,noiseShape_1=_this.getNoiseShape(input);return K.inTrainPhase(function(){return K.dropout(input,_this.rateScalar,noiseShape_1,_this.seed)},function(){return input},training)}return inputs})},Dropout.prototype.getConfig=function(){var config={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Dropout.className="Dropout",Dropout}(topology_1.Layer);exports.Dropout=Dropout,tfjs_core_1.serialization.registerClass(Dropout);var Dense=function(_super){function Dense(config){var _this=_super.call(this,config)||this;if(_this.activation=null,_this.useBias=!0,_this.kernel=null,_this.bias=null,_this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",_this.DEFAULT_BIAS_INITIALIZER="zeros",null==config.batchInputShape&&null==config.inputShape&&null!=config.inputDim){var batchSize=null;null!=config.batchSize&&(batchSize=config.batchSize),_this.batchInputShape=[batchSize,config.inputDim]}return _this.units=config.units,_this.activation=activations_1.getActivation(config.activation),null!=config.useBias&&(_this.useBias=config.useBias),_this.kernelInitializer=initializers_1.getInitializer(config.kernelInitializer||_this.DEFAULT_KERNEL_INITIALIZER),_this.biasInitializer=initializers_1.getInitializer(config.biasInitializer||_this.DEFAULT_BIAS_INITIALIZER),_this.kernelConstraint=constraints_1.getConstraint(config.kernelConstraint),_this.biasConstraint=constraints_1.getConstraint(config.biasConstraint),_this.kernelRegularizer=regularizers_1.getRegularizer(config.kernelRegularizer),_this.biasRegularizer=regularizers_1.getRegularizer(config.biasRegularizer),_this.activityRegularizer=regularizers_1.getRegularizer(config.activityRegularizer),_this.inputSpec=[{minNDim:2}],_this}return __extends(Dense,_super),Dense.prototype.build=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var inputLastDim=inputShape[inputShape.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[inputLastDim,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(_a={},_a[-1]=inputLastDim,_a)}],this.built=!0;var _a},Dense.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var outputShape=inputShape.slice();return outputShape[outputShape.length-1]=this.units,outputShape},Dense.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){_this.invokeCallHook(inputs,kwargs);var input=types_utils_1.getExactlyOneTensor(inputs),output=K.dot(input,_this.kernel.read());return null!=_this.bias&&(output=K.biasAdd(output,_this.bias.read())),null!=_this.activation&&(output=_this.activation.apply(output)),output})},Dense.prototype.getConfig=function(){var config={units:this.units,activation:activations_1.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:initializers_1.serializeInitializer(this.kernelInitializer),biasInitializer:initializers_1.serializeInitializer(this.biasInitializer),kernelRegularizer:regularizers_1.serializeRegularizer(this.kernelRegularizer),biasRegularizer:regularizers_1.serializeRegularizer(this.biasRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),kernelConstraint:constraints_1.serializeConstraint(this.kernelConstraint),biasConstraint:constraints_1.serializeConstraint(this.biasConstraint)},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Dense.className="Dense",Dense}(topology_1.Layer);exports.Dense=Dense,tfjs_core_1.serialization.registerClass(Dense);var Flatten=function(_super){function Flatten(config){var _this=_super.call(this,config||{})||this;return _this.inputSpec=[{minNDim:3}],_this}return __extends(Flatten,_super),Flatten.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);for(var _i=0,_a=inputShape.slice(1);_i<_a.length;_i++){if(null==_a[_i])throw new errors_1.ValueError('The shape of the input to "Flatten" is not fully defined (got '+inputShape.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.')}return[inputShape[0],math_utils_1.arrayProd(inputShape,1)]},Flatten.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){return _this.invokeCallHook(inputs,kwargs),K.batchFlatten(types_utils_1.getExactlyOneTensor(inputs))})},Flatten.className="Flatten",Flatten}(topology_1.Layer);exports.Flatten=Flatten,tfjs_core_1.serialization.registerClass(Flatten);var Activation=function(_super){function Activation(config){var _this=_super.call(this,config)||this;return _this.supportsMasking=!0,_this.activation=activations_1.getActivation(config.activation),_this}return __extends(Activation,_super),Activation.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){_this.invokeCallHook(inputs,kwargs);var input=types_utils_1.getExactlyOneTensor(inputs);return _this.activation.apply(input)})},Activation.prototype.getConfig=function(){var config={activation:activations_1.serializeActivation(this.activation)},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Activation.className="Activation",Activation}(topology_1.Layer);exports.Activation=Activation,tfjs_core_1.serialization.registerClass(Activation);var RepeatVector=function(_super){function RepeatVector(config){var _this=_super.call(this,config)||this;return _this.n=config.n,_this.inputSpec=[{ndim:2}],_this}return __extends(RepeatVector,_super),RepeatVector.prototype.computeOutputShape=function(inputShape){return[inputShape[0],this.n,inputShape[1]]},RepeatVector.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){return inputs=types_utils_1.getExactlyOneTensor(inputs),K.repeat(inputs,_this.n)})},RepeatVector.prototype.getConfig=function(){var config={n:this.n},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},RepeatVector.className="RepeatVector",RepeatVector}(topology_1.Layer);exports.RepeatVector=RepeatVector,tfjs_core_1.serialization.registerClass(RepeatVector);var Reshape=function(_super){function Reshape(config){var _this=_super.call(this,config)||this;_this.targetShape=config.targetShape;for(var i=0;i<_this.targetShape.length;++i)_this.isUnknown(_this.targetShape[i])&&(_this.targetShape[i]=null);return _this}return __extends(Reshape,_super),Reshape.prototype.isUnknown=function(dim){return dim<0||null==dim},Reshape.prototype.fixUnknownDimension=function(inputShape,outputShape){for(var errorMsg="Total size of new array must be unchanged.",finalShape=outputShape.slice(),known=1,unknown=null,i=0;i<finalShape.length;++i){var dim=finalShape[i];if(this.isUnknown(dim)){if(null!==unknown)throw new errors_1.ValueError("Can only specifiy one unknown dimension.");unknown=i}else known*=dim}var originalSize=math_utils_1.arrayProd(inputShape);if(null!==unknown){if(0===known||originalSize%known!=0)throw new errors_1.ValueError(errorMsg);finalShape[unknown]=originalSize/known}else if(originalSize!==known)throw new errors_1.ValueError(errorMsg);return finalShape},Reshape.prototype.computeOutputShape=function(inputShape){for(var anyUnknownDims=!1,i=0;i<inputShape.length;++i)if(this.isUnknown(inputShape[i])){anyUnknownDims=!0;break}return anyUnknownDims?inputShape.slice(0,1).concat(this.targetShape):inputShape.slice(0,1).concat(this.fixUnknownDimension(inputShape.slice(1),this.targetShape))},Reshape.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){_this.invokeCallHook(inputs,kwargs);var input=types_utils_1.getExactlyOneTensor(inputs),inputShape=input.shape,outputShape=inputShape.slice(0,1).concat(_this.fixUnknownDimension(inputShape.slice(1),_this.targetShape));return input.reshape(outputShape)})},Reshape.prototype.getConfig=function(){var config={targetShape:this.targetShape},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Reshape.className="Reshape",Reshape}(topology_1.Layer);exports.Reshape=Reshape,tfjs_core_1.serialization.registerClass(Reshape);var Permute=function(_super){function Permute(config){var _this=_super.call(this,config)||this;if(null==config.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(config.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+config.dims+" instead.");var expectedSortedIndices=math_utils_1.range(1,config.dims.length+1);if(!tfjs_core_1.util.arraysEqual(config.dims.slice().sort(),expectedSortedIndices))throw new Error("Invalid permutation `dims`: "+JSON.stringify(config.dims)+" `dims` must contain consecutive integers starting from 1.");return _this.dims=config.dims,_this.dimsIncludingBatch=[0].concat(_this.dims),_this.inputSpec=[new topology_1.InputSpec({ndim:_this.dims.length+1})],_this}return __extends(Permute,_super),Permute.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var outputShape=inputShape.slice();return this.dims.forEach(function(dim,i){outputShape[i+1]=inputShape[dim]}),outputShape},Permute.prototype.call=function(inputs,kwargs){return tfjs_core_1.transpose(types_utils_1.getExactlyOneTensor(inputs),this.dimsIncludingBatch)},Permute.prototype.getConfig=function(){var config={dims:this.dims},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Permute.className="Permute",Permute}(topology_1.Layer);exports.Permute=Permute,tfjs_core_1.serialization.registerClass(Permute)},{"../activations":213,"../backend/state":215,"../backend/tfjs_backend":216,"../constraints":220,"../engine/topology":224,"../errors":228,"../initializers":237,"../regularizers":255,"../utils/math_utils":259,"../utils/types_utils":261,"@tensorflow/tfjs-core":62}],242:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),K=require("../backend/tfjs_backend"),constraints_1=require("../constraints"),topology_1=require("../engine/topology"),errors_1=require("../errors"),initializers_1=require("../initializers"),regularizers_1=require("../regularizers"),generic_utils=require("../utils/generic_utils"),types_utils_1=require("../utils/types_utils"),Embedding=function(_super){function Embedding(config){var _this=_super.call(this,config)||this;if(_this.embeddings=null,_this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==config.batchInputShape&&null==config.inputShape){var batchSize=null;null!=config.batchSize&&(batchSize=config.batchSize),null==config.inputLength?_this.batchInputShape=[batchSize,null]:_this.batchInputShape=[batchSize].concat(generic_utils.toList(config.inputLength))}return _this.inputDim=config.inputDim,_this.outputDim=config.outputDim,_this.embeddingsInitializer=initializers_1.getInitializer(config.embeddingsInitializer||_this.DEFAULT_EMBEDDINGS_INITIALIZER),_this.embeddingsRegularizer=regularizers_1.getRegularizer(config.embeddingsRegularizer),_this.activityRegularizer=regularizers_1.getRegularizer(config.activityRegularizer),_this.embeddingsConstraint=constraints_1.getConstraint(config.embeddingsConstraint),_this.maskZero=config.maskZero,_this.inputLength=config.inputLength,_this}return __extends(Embedding,_super),Embedding.prototype.build=function(inputShape){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},Embedding.prototype.warnOnIncompatibleInputShape=function(inputShape){},Embedding.prototype.computeMask=function(inputs,mask){throw new errors_1.NotImplementedError("computeMask has not been implemented for Embedding yet")},Embedding.prototype.computeOutputShape=function(inputShape){if(inputShape=types_utils_1.getExactlyOneShape(inputShape),null==this.inputLength)return inputShape.concat([this.outputDim]);var inLens=generic_utils.toList(this.inputLength);if(inLens.length!==inputShape.length-1)throw new errors_1.ValueError('"inputLength" is '+this.inputLength+", but received input shape has shape "+inputShape);for(var i=0,k=0;k<inLens.length;++k){var s1=inLens[k],s2=inputShape[k+1];if(null!=s1&&null!=s2&&s1!==s2)throw new errors_1.ValueError('"inputLength" is '+this.inputLength+", but received input shape has shape "+inputShape);null==s1&&(inLens[i]=s2),i++}return[inputShape[0]].concat(inLens,[this.outputDim])},Embedding.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){_this.invokeCallHook(inputs,kwargs);var input=types_utils_1.getExactlyOneTensor(inputs);return"int32"!==input.dtype&&(input=K.cast(input,"int32")),K.gather(_this.embeddings.read(),input.as1D()).reshape(types_utils_1.getExactlyOneShape(_this.computeOutputShape(input.shape)))})},Embedding.prototype.getConfig=function(){var config={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:initializers_1.serializeInitializer(this.embeddingsInitializer),embeddingsRegularizer:regularizers_1.serializeRegularizer(this.embeddingsRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),embeddingsConstraint:constraints_1.serializeConstraint(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Embedding.className="Embedding",Embedding}(topology_1.Layer);exports.Embedding=Embedding,tfjs_core_1.serialization.registerClass(Embedding)},{"../backend/tfjs_backend":216,"../constraints":220,"../engine/topology":224,"../errors":228,"../initializers":237,"../regularizers":255,"../utils/generic_utils":257,"../utils/types_utils":261,"@tensorflow/tfjs-core":62}],243:[function(require,module,exports){"use strict";function add(config){if(Array.isArray(config)){return new Add({}).apply(config)}return new Add(config)}function multiply(config){if(Array.isArray(config)){return new Multiply({}).apply(config)}return new Multiply(config)}function average(config){if(Array.isArray(config)){return new Average({}).apply(config)}return new Average(config)}function maximum(config){if(Array.isArray(config)){return new Maximum({}).apply(config)}return new Maximum(config)}function minimum(config){if(Array.isArray(config)){return new Minimum({}).apply(config)}return new Minimum(config)}function concatenate(config){if(Array.isArray(config)){return new Concatenate({}).apply(config)}return new Concatenate(config)}function interpretAxis(axis,dim){for(;axis<0;)axis+=dim;return axis}function batchDot(x,y,axes){if(x.shape.length>3||y.shape.length>3)throw new errors_1.NotImplementedError("batchDot is not implemented for tensors of 4D or higher rank yet");if(tfc.util.assert(x.shape.length>=2,"batchDot requires the rank of x to be >= 2, but got "+x.shape.length),tfc.util.assert(x.shape.length>=2,"batchDot requires the rank of y to be >= 2, but got "+y.shape.length),"number"==typeof axes&&(axes=[axes,axes]),"complex64"===x.dtype||"complex64"===y.dtype)throw new errors_1.NotImplementedError("batchDot is not implemented for complex64-type Tensors yet.");var xNDim=x.shape.length,yNDim=y.shape.length;null==axes&&(axes=[xNDim-1,yNDim-2]);var axesArray=axes;return tfc.tidy(function(){var diff;if(xNDim>yNDim){diff=xNDim-yNDim;for(var diffShape=[],i=0;i<diff;++i)diffShape.push(1);y=y.reshape(y.shape.concat(diffShape))}else if(yNDim>xNDim){diff=yNDim-xNDim;for(var diffShape=[],i=0;i<diff;++i)diffShape.push(1);x=x.reshape(x.shape.concat(diffShape))}else diff=0;var out;if(2===x.shape.length&&2===y.shape.length)out=axesArray[0]===axesArray[1]?x.mulStrict(y).sum(axesArray[0]):x.transpose([1,0]).mulStrict(y).sum(axesArray[1]);else{var adjX=axesArray[0]!==x.shape.length-1||null,adjY=axesArray[1]===y.shape.length-1||null;out=x.matMul(y,adjX,adjY)}if(diff>0){var idx=void 0;idx=xNDim>yNDim?xNDim+yNDim-3:xNDim-1;for(var squeezeAxes=[],i=idx;i<idx+diff;++i)squeezeAxes.push(i);out=out.squeeze(squeezeAxes)}return 1===out.shape.length&&(out=out.expandDims(1)),out})}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("../backend/state"),K=require("../backend/tfjs_backend"),topology_1=require("../engine/topology"),errors_1=require("../errors"),losses_1=require("../losses"),generic_utils=require("../utils/generic_utils"),mathUtils=require("../utils/math_utils"),types_utils_1=require("../utils/types_utils"),Merge=function(_super){function Merge(config){var _this=_super.call(this,config||{})||this;return _this.supportsMasking=!0,_this}return __extends(Merge,_super),Merge.prototype.mergeFunction=function(inputs){throw new errors_1.NotImplementedError},Merge.prototype.computeElementwiseOpOutputShape=function(shape1,shape2){if(null==shape1||null==shape2)return null;if(shape1.length<shape2.length)return this.computeElementwiseOpOutputShape(shape2,shape1);if(0===shape2.length)return shape1;for(var outputShape=shape1.slice(0,shape1.length-shape2.length),k=0;k<shape2.length;++k){var i=shape1[shape1.length-shape2.length+k],j=shape2[k];if(null==i||null==j||i<0||j<0)outputShape.push(null);else if(1===i)outputShape.push(j);else if(1===j)outputShape.push(i);else{if(i!==j)throw new errors_1.ValueError("Operands could not be broadcast together with shapes "+JSON.stringify(shape1)+" "+JSON.stringify(shape2));outputShape.push(i)}}return outputShape},Merge.prototype.build=function(inputShape){if(Array.isArray(inputShape)&&!Array.isArray(inputShape[0])&&(inputShape=[types_utils_1.getExactlyOneShape(inputShape)]),inputShape=inputShape,inputShape.length<2)throw new errors_1.ValueError("A merge layer should be called on an Array of at least 2 inputs. Got "+inputShape.length+" input(s).");for(var batchSizes=[],_i=0,inputShape_1=inputShape;_i<inputShape_1.length;_i++){var shape=inputShape_1[_i]
;null!=shape&&null!==shape[0]&&batchSizes.push(shape[0])}if(batchSizes=generic_utils.unique(batchSizes),batchSizes.length>1)throw new errors_1.ValueError("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(inputShape)+".");for(var outputShape=null==inputShape[0]?null:inputShape[0].slice(1),i=1;i<inputShape.length;++i){var shape=null==inputShape[i]?null:inputShape[i].slice(1);outputShape=this.computeElementwiseOpOutputShape(outputShape,shape)}var allRanks=inputShape.map(function(shape){return shape.length});-1===inputShape.indexOf(null)&&1===generic_utils.unique(allRanks).length?this.reshapeRequired=!1:this.reshapeRequired=!0},Merge.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){if(inputs=inputs,_this.reshapeRequired){var reshapedInputs=[],inputDims=inputs.map(function(input){return input.rank});if(-1===inputDims.indexOf(null)){for(var maxNDim=mathUtils.max(inputDims),_i=0,inputs_1=inputs;_i<inputs_1.length;_i++){for(var x=inputs_1[_i],xNDim=x.rank,k=0;k<maxNDim-xNDim;++k)x=K.expandDims(x,1);reshapedInputs.push(x)}return _this.mergeFunction(reshapedInputs)}for(var transposed=!1,_a=0,inputs_2=inputs;_a<inputs_2.length;_a++){var x=inputs_2[_a],xNDim=x.rank;if(null==xNDim){var xShape=x.shape,batchSize=xShape[0],newShape=xShape.slice(1).concat([batchSize]),xTransposed=x.reshape([batchSize].concat(mathUtils.arrayProd(xShape.slice(1))));xTransposed=tfc.transpose(xTransposed,[1,0]),xTransposed=xTransposed.reshape(newShape),reshapedInputs.push(xTransposed),transposed=!0}else if(xNDim>1){var dims=mathUtils.range(1,xNDim).concat([0]);reshapedInputs.push(tfc.transpose(x,dims)),transposed=!0}else reshapedInputs.push(x)}var y=_this.mergeFunction(reshapedInputs),yNDim=y.rank;if(transposed)if(null==yNDim){var yShape=y.shape,yNDim_1=yShape.length,batchSize=yShape[yNDim_1-1],newShape=[batchSize].concat(yShape.slice(0,yShape.length-1));y=tfc.transpose(y.reshape([-1,batchSize]),[1,0]).reshape(newShape)}else if(yNDim>1){var dims=[yNDim-1].concat(mathUtils.range(0,yNDim-1));y=tfc.transpose(y,dims)}return y}return _this.mergeFunction(inputs)})},Merge.prototype.computeOutputShape=function(inputShape){inputShape=inputShape;var outputShape;outputShape=null==inputShape[0]?null:inputShape[0].slice(1);for(var i=1;i<inputShape.length;++i){var shape=null==inputShape[i]?null:inputShape[i].slice(1);outputShape=this.computeElementwiseOpOutputShape(outputShape,shape)}for(var batchSizes=[],_i=0,inputShape_2=inputShape;_i<inputShape_2.length;_i++){var shape=inputShape_2[_i];null!=shape&&null!==shape[0]&&batchSizes.push(shape[0])}return batchSizes=generic_utils.unique(batchSizes),outputShape=1===batchSizes.length?batchSizes.concat(outputShape):[null].concat(outputShape)},Merge.prototype.computeMask=function(inputs,mask){throw new errors_1.NotImplementedError("computeMask has not been implemented for Merge yet")},Merge}(topology_1.Layer);exports.Merge=Merge;var Add=function(_super){function Add(config){return _super.call(this,config)||this}return __extends(Add,_super),Add.prototype.mergeFunction=function(inputs){return tfjs_core_1.tidy(function(){for(var output=inputs[0].clone(),i=1;i<inputs.length;++i)output=tfc.add(output,inputs[i]);return output})},Add.className="Add",Add}(Merge);exports.Add=Add,tfjs_core_1.serialization.registerClass(Add),exports.add=add;var Multiply=function(_super){function Multiply(config){return _super.call(this,config)||this}return __extends(Multiply,_super),Multiply.prototype.mergeFunction=function(inputs){return tfjs_core_1.tidy(function(){for(var output=inputs[0].clone(),i=1;i<inputs.length;++i)output=tfc.mul(output,inputs[i]);return output})},Multiply.className="Multiply",Multiply}(Merge);exports.Multiply=Multiply,tfjs_core_1.serialization.registerClass(Multiply),exports.multiply=multiply;var Average=function(_super){function Average(config){return _super.call(this,config)||this}return __extends(Average,_super),Average.prototype.mergeFunction=function(inputs){return tfjs_core_1.tidy(function(){for(var output=inputs[0].clone(),i=1;i<inputs.length;++i)output=tfc.add(output,inputs[i]);return tfc.mul(state_1.getScalar(1/inputs.length),output)})},Average.className="Average",Average}(Merge);exports.Average=Average,tfjs_core_1.serialization.registerClass(Average),exports.average=average;var Maximum=function(_super){function Maximum(config){return _super.call(this,config)||this}return __extends(Maximum,_super),Maximum.prototype.mergeFunction=function(inputs){return tfjs_core_1.tidy(function(){for(var output=inputs[0],i=1;i<inputs.length;++i)output=tfc.maximum(output,inputs[i]);return output})},Maximum.className="Maximum",Maximum}(Merge);exports.Maximum=Maximum,tfjs_core_1.serialization.registerClass(Maximum),exports.maximum=maximum;var Minimum=function(_super){function Minimum(config){return _super.call(this,config)||this}return __extends(Minimum,_super),Minimum.prototype.mergeFunction=function(inputs){return tfjs_core_1.tidy(function(){for(var output=inputs[0],i=1;i<inputs.length;++i)output=tfc.minimum(output,inputs[i]);return output})},Minimum.className="Minimum",Minimum}(Merge);exports.Minimum=Minimum,tfjs_core_1.serialization.registerClass(Minimum),exports.minimum=minimum;var Concatenate=function(_super){function Concatenate(config){var _this=_super.call(this,config)||this;return _this.DEFAULT_AXIS=-1,null==config&&(config={}),_this.axis=null==config.axis?_this.DEFAULT_AXIS:config.axis,_this.supportsMasking=!0,_this.reshapeRequired=!1,_this}return __extends(Concatenate,_super),Concatenate.prototype.build=function(inputShape){if(!Array.isArray(inputShape)||!Array.isArray(inputShape[0])||1===inputShape.length)throw new errors_1.ValueError("A `Concatenate` layer should be called on a list of at least 2 inputs");inputShape=inputShape;for(var allNoneShape=!0,_i=0,inputShape_3=inputShape;_i<inputShape_3.length;_i++){var shape=inputShape_3[_i];if(null!=shape){allNoneShape=!1;break}}if(!allNoneShape){for(var shapeSet=[],i=0;i<inputShape.length;++i){var shapeWithoutConcatAxis=inputShape[i].slice();shapeWithoutConcatAxis.splice(this.axis,1);for(var exists=!1,_a=0,shapeSet_1=shapeSet;_a<shapeSet_1.length;_a++){var shape=shapeSet_1[_a];if(tfjs_core_1.util.arraysEqual(shape,shapeWithoutConcatAxis)){exists=!0;break}}exists||shapeSet.push(shapeWithoutConcatAxis)}if(shapeSet.length>1)throw new errors_1.ValueError("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(inputShape))}},Concatenate.prototype.mergeFunction=function(inputs){var _this=this;return tfjs_core_1.tidy(function(){return K.concatenate(inputs,_this.axis)})},Concatenate.prototype.computeOutputShape=function(inputShape){if(!Array.isArray(inputShape)||!Array.isArray(inputShape[0]))throw new errors_1.ValueError("A `Concatenate` layer should be called on a list of inputs.");for(var inputShapes=inputShape,outputShape=inputShapes[0].slice(),axis=this.axis<0?outputShape.length+this.axis:this.axis,_i=0,_a=inputShapes.slice(1);_i<_a.length;_i++){var shape=_a[_i];if(null==outputShape[axis]||null==shape[axis]){outputShape[axis]=null;break}outputShape[axis]+=shape[axis]}return outputShape},Concatenate.prototype.computeMask=function(inputs,mask){throw new errors_1.NotImplementedError("computeMask has not been implemented for Concatenate yet")},Concatenate.prototype.getConfig=function(){var config={axis:this.axis},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Concatenate.className="Concatenate",Concatenate}(Merge);exports.Concatenate=Concatenate,tfjs_core_1.serialization.registerClass(Concatenate),exports.concatenate=concatenate;var Dot=function(_super){function Dot(config){var _this=_super.call(this,config)||this;return _this.axes=config.axes,_this.normalize=null!=config.normalize&&config.normalize,_this.supportsMasking=!0,_this.reshapeRequired=!1,_this}return __extends(Dot,_super),Dot.prototype.build=function(inputShape){tfc.util.assert(Array.isArray(inputShape)&&2===inputShape.length&&Array.isArray(inputShape[0])&&Array.isArray(inputShape[1]),"A `Dot` layer should be called on a list of exactly 2 inputs.");var shape1=inputShape[0],shape2=inputShape[1];if(shape1.length>3||shape2.length>3)throw new errors_1.NotImplementedError("Dot layer does not support tensors of 4D or higher rank yet.");var axes=this.interpretAxes(shape1,shape2);if(shape1[axes[0]]!==shape2[axes[1]])throw new errors_1.ValueError("Dimension incompatibility: "+shape1[axes[0]]+" !== "+shape2[axes[1]])},Dot.prototype.mergeFunction=function(inputs){if(2!==inputs.length)throw new errors_1.ValueError("A `Dot` layer must be called on exactly 2 inputs, but received "+inputs.length+" input(s).");var axes,x1=inputs[0],x2=inputs[1];return axes=Array.isArray(this.axes)?this.axes.map(function(axis,i){return interpretAxis(axis,inputs[i].shape.length)}):[interpretAxis(this.axes,x1.shape.length),interpretAxis(this.axes,x2.shape.length)],this.normalize&&(x1=losses_1.l2Normalize(x1,axes[0]),x2=losses_1.l2Normalize(x2,axes[1])),batchDot(x1,x2,axes)},Dot.prototype.interpretAxes=function(shape1,shape2){return Array.isArray(this.axes)?this.axes:[interpretAxis(this.axes,shape1.length),interpretAxis(this.axes,shape2.length)]},Dot.prototype.computeOutputShape=function(inputShape){tfc.util.assert(Array.isArray(inputShape)&&2===inputShape.length&&Array.isArray(inputShape[0])&&Array.isArray(inputShape[1]),"A `Dot` layer should be called on a list of exactly 2 inputs.");var shape1=inputShape[0].slice(),shape2=inputShape[1].slice();if(shape1.length>3||shape2.length>3)throw new errors_1.NotImplementedError("Dot layer does not support tensors of 4D or higher rank yet.");var axes=this.interpretAxes(shape1,shape2);shape1.splice(axes[0],1),shape2.splice(axes[1],1),shape2.splice(0,1);var outputShape=shape1.concat(shape2);return 1===outputShape.length&&outputShape.push(1),outputShape},Dot.prototype.computeMask=function(inputs,mask){throw new errors_1.NotImplementedError("computeMask has not been implemented for Dot yet")},Dot.prototype.getConfig=function(){var config={axes:this.axes,normalize:this.normalize},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Dot.className="Dot",Dot}(Merge);exports.Dot=Dot,tfjs_core_1.serialization.registerClass(Dot)},{"../backend/state":215,"../backend/tfjs_backend":216,"../engine/topology":224,"../errors":228,"../losses":251,"../utils/generic_utils":257,"../utils/math_utils":259,"../utils/types_utils":261,"@tensorflow/tfjs-core":62}],244:[function(require,module,exports){"use strict";function batchNormalization(x,mean,variance,beta,gamma,epsilon){void 0===epsilon&&(epsilon=.001);var out;if(2===x.rank)out=tfc.batchNormalization2d(x,mean,variance,epsilon,gamma,beta);else if(3===x.rank)out=tfc.batchNormalization3d(x,mean,variance,epsilon,gamma,beta);else{if(4!==x.rank)throw new errors_1.NotImplementedError("batchNormalization is not implemented for array of rank "+x.rank+" yet");out=tfc.batchNormalization4d(x,mean,variance,epsilon,gamma,beta)}return out}function regularNormalizeBatchInTraining(x,gamma,beta,reductionAxes,epsilon){return void 0===epsilon&&(epsilon=.001),tfjs_core_1.tidy(function(){var meanAndVariance=tfc.moments(x,reductionAxes),mean=meanAndVariance.mean,variance=meanAndVariance.variance;return[batchNormalization(x,mean,variance,beta,gamma,epsilon),mean,variance]})}function broadcastNormalizeBatchInTraining(x,gamma,beta,reductionAxes,epsilon){return void 0===epsilon&&(epsilon=.001),tfjs_core_1.tidy(function(){for(var meanAndVariance=tfc.moments(x,reductionAxes),mean=meanAndVariance.mean,variance=meanAndVariance.variance,targetShape=[],_i=0,_a=math_utils.range(0,x.rank);_i<_a.length;_i++){var axis=_a[_i];-1!==reductionAxes.indexOf(axis)?targetShape.push(1):targetShape.push(x.shape[axis])}var broadcastMean=mean.reshape(targetShape),broadcastVariance=variance.reshape(targetShape),broadcastGamma=null==gamma?null:gamma.reshape(targetShape),broadcastBeta=null==beta?null:beta.reshape(targetShape);return[batchNormalization(x,broadcastMean,broadcastVariance,broadcastBeta,broadcastGamma,epsilon),mean,variance]})}function normalizeBatchInTraining(x,gamma,beta,reductionAxes,epsilon){return void 0===epsilon&&(epsilon=.001),tfjs_core_1.util.arraysEqual(reductionAxes.slice().sort(),math_utils.range(0,x.rank-1))?regularNormalizeBatchInTraining(x,gamma,beta,reductionAxes,epsilon):broadcastNormalizeBatchInTraining(x,gamma,beta,reductionAxes,epsilon)}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),constraints_1=require("../constraints"),topology_1=require("../engine/topology"),state_1=require("../backend/state"),errors_1=require("../errors"),initializers_1=require("../initializers"),regularizers_1=require("../regularizers"),generic_utils=require("../utils/generic_utils"),math_utils=require("../utils/math_utils"),types_utils_1=require("../utils/types_utils");exports.batchNormalization=batchNormalization,exports.normalizeBatchInTraining=normalizeBatchInTraining;var BatchNormalization=function(_super){function BatchNormalization(config){var _this=this;return null==config&&(config={}),_this=_super.call(this,config)||this,_this.supportsMasking=!0,_this.axis=null==config.axis?-1:config.axis,_this.momentum=null==config.momentum?.99:config.momentum,_this.epsilon=null==config.epsilon?.001:config.epsilon,_this.center=null==config.center||config.center,_this.scale=null==config.scale||config.scale,_this.betaInitializer=initializers_1.getInitializer(config.betaInitializer||"zeros"),_this.gammaInitializer=initializers_1.getInitializer(config.gammaInitializer||"ones"),_this.movingMeanInitializer=initializers_1.getInitializer(config.movingMeanInitializer||"zeros"),_this.movingVarianceInitializer=initializers_1.getInitializer(config.movingVarianceInitializer||"ones"),_this.betaConstraint=constraints_1.getConstraint(config.betaConstraint),_this.gammaConstraint=constraints_1.getConstraint(config.gammaConstraint),_this.betaRegularizer=regularizers_1.getRegularizer(config.betaRegularizer),_this.gammaRegularizer=regularizers_1.getRegularizer(config.gammaRegularizer),_this.stepCount=0,_this}return __extends(BatchNormalization,_super),BatchNormalization.prototype.build=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var axis=this.axis>=0?this.axis:this.axis+inputShape.length,dim=inputShape[axis];if(null==dim)throw new errors_1.ValueError("Axis "+axis+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(inputShape)+".");this.inputSpec=[new topology_1.InputSpec({ndim:inputShape.length,axes:(_a={},_a[axis]=dim,_a)})];var shape=[dim];this.scale&&(this.gamma=this.addWeight("gamma",shape,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",shape,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",shape,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",shape,null,this.movingVarianceInitializer,null,!1),this.built=!0;var _a},BatchNormalization.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){var training=null!=kwargs.training&&kwargs.training,input=types_utils_1.getExactlyOneTensor(inputs),inputShape=input.shape,ndim=inputShape.length,reductionAxes=math_utils.range(0,ndim),axis=_this.axis>=0?_this.axis:_this.axis+ndim;reductionAxes.splice(axis,1);var broadcastShape=generic_utils.pyListRepeat(1,ndim);broadcastShape[axis]=inputShape[axis];var sortedReductionAxes=reductionAxes.slice();sortedReductionAxes.sort();var needsBroadcasting=!tfjs_core_1.util.arraysEqual(sortedReductionAxes,math_utils.range(0,ndim).slice(0,ndim-1));if(!training)return function(){if(needsBroadcasting){var broadcastMovingMean=_this.movingMean.read().reshape(broadcastShape),broadcastMovingVariance=_this.movingVariance.read().reshape(broadcastShape),broadcastBeta=_this.center?_this.beta.read().reshape(broadcastShape):null,broadcastGamma=_this.scale?_this.gamma.read().reshape(broadcastShape):null;return batchNormalization(input,broadcastMovingMean,broadcastMovingVariance,broadcastBeta,broadcastGamma,_this.epsilon)}return batchNormalization(input,_this.movingMean.read(),_this.movingVariance.read(),null==_this.beta?null:_this.beta.read(),null==_this.gamma?null:_this.gamma.read(),_this.epsilon)}();var _a=normalizeBatchInTraining(input,_this.gamma.read(),_this.beta.read(),reductionAxes,_this.epsilon),normedTraining=_a[0],mean=_a[1],variance=_a[2],sampleSize=math_utils.arrayProd(reductionAxes.map(function(axis){return input.shape[axis]})),varianceDebiased=variance.mul(state_1.getScalar(sampleSize/(sampleSize-(1+_this.epsilon))));return function(){_this.stepCount++;var newMovingMean=tfc.movingAverage(_this.movingMean.read(),mean,_this.momentum,_this.stepCount);_this.movingMean.write(newMovingMean);var newMovingVariance=tfc.movingAverage(_this.movingVariance.read(),varianceDebiased,_this.momentum,_this.stepCount);_this.movingVariance.write(newMovingVariance)}(),normedTraining})},BatchNormalization.prototype.getConfig=function(){var config={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:initializers_1.serializeInitializer(this.betaInitializer),gammaInitializer:initializers_1.serializeInitializer(this.gammaInitializer),movingMeanInitializer:initializers_1.serializeInitializer(this.movingMeanInitializer),movingVarianceInitializer:initializers_1.serializeInitializer(this.movingVarianceInitializer),betaRegularizer:regularizers_1.serializeRegularizer(this.betaRegularizer),gammaRegularizer:regularizers_1.serializeRegularizer(this.gammaRegularizer),betaConstraint:constraints_1.serializeConstraint(this.betaConstraint),gammaConstraint:constraints_1.serializeConstraint(this.gammaConstraint)},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},BatchNormalization.className="BatchNormalization",BatchNormalization}(topology_1.Layer);exports.BatchNormalization=BatchNormalization,tfjs_core_1.serialization.registerClass(BatchNormalization)},{"../backend/state":215,"../constraints":220,"../engine/topology":224,"../errors":228,"../initializers":237,"../regularizers":255,"../utils/generic_utils":257,"../utils/math_utils":259,"../utils/types_utils":261,"@tensorflow/tfjs-core":62}],245:[function(require,module,exports){"use strict";function temporalPadding(x,padding){return tfjs_core_1.tidy(function(){if(3!==x.rank)throw new errors_1.ValueError("temporalPadding expects input tensor to be 3-D, but received a "+x.rank+"-D tensor.");if(null==padding&&(padding=[1,1]),2!==padding.length)throw new errors_1.ValueError("temporalPadding expects input padding pattern to be a length-2 array, but received a length-"+padding.length+" array.");var pattern=[[0,0],padding,[0,0]];return tfc.pad(x,pattern)})}function spatial2dPadding(x,padding,dataFormat){return tfjs_core_1.tidy(function(){if(4!==x.rank)throw new errors_1.ValueError("temporalPadding expects input tensor to be 4-D, but received a "+x.rank+"-D tensor.");if(null==padding&&(padding=[[1,1],[1,1]]),2!==padding.length||2!==padding[0].length||2!==padding[1].length)throw new errors_1.ValueError("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==dataFormat&&(dataFormat=common_1.imageDataFormat()),"channelsLast"!==dataFormat&&"channelsFirst"!==dataFormat)throw new errors_1.ValueError("Unknown data format: "+dataFormat+". Supported data formats are 'channelsLast' and 'channelsFirst.");var pattern;return pattern="channelsFirst"===dataFormat?[[0,0],[0,0],padding[0],padding[1]]:[[0,0],padding[0],padding[1],[0,0]],tfc.pad(x,pattern)})}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),common_1=require("../backend/common"),topology_1=require("../engine/topology"),errors_1=require("../errors"),types_utils_1=require("../utils/types_utils");exports.temporalPadding=temporalPadding,exports.spatial2dPadding=spatial2dPadding;var ZeroPadding2D=function(_super){function ZeroPadding2D(config){var _this=this;if(null==config&&(config={}),_this=_super.call(this,config)||this,_this.dataFormat=null==config.dataFormat?common_1.imageDataFormat():config.dataFormat,null==config.padding)_this.padding=[[1,1],[1,1]];else if("number"==typeof config.padding)_this.padding=[[config.padding,config.padding],[config.padding,config.padding]];else{if(config.padding=config.padding,2!==config.padding.length)throw new errors_1.ValueError("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+config.padding.length+" array.");var heightPadding=void 0,widthPadding=void 0;if("number"==typeof config.padding[0])heightPadding=[config.padding[0],config.padding[0]],widthPadding=[config.padding[1],config.padding[1]];else{if(config.padding=config.padding,2!==config.padding[0].length)throw new errors_1.ValueError("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+config.padding[0].length+" array.");if(heightPadding=config.padding[0],2!==config.padding[1].length)throw new errors_1.ValueError("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+config.padding[1].length+" array.");widthPadding=config.padding[1]}_this.padding=[heightPadding,widthPadding]}return _this.inputSpec=[new topology_1.InputSpec({ndim:4})],_this}return __extends(ZeroPadding2D,_super),ZeroPadding2D.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var rows,cols;return"channelsFirst"===this.dataFormat?(rows=null!=inputShape[2]&&inputShape[2]>=0?inputShape[2]+this.padding[0][0]+this.padding[0][1]:null,cols=null!=inputShape[3]&&inputShape[3]>=0?inputShape[3]+this.padding[1][0]+this.padding[1][1]:null,[inputShape[0],inputShape[1],rows,cols]):(rows=null!=inputShape[1]&&inputShape[1]>=0?inputShape[1]+this.padding[0][0]+this.padding[0][1]:null,cols=null!=inputShape[2]&&inputShape[2]>=0?inputShape[2]+this.padding[1][0]+this.padding[1][1]:null,[inputShape[0],rows,cols,inputShape[3]])},ZeroPadding2D.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){return spatial2dPadding(types_utils_1.getExactlyOneTensor(inputs),_this.padding,_this.dataFormat)})},ZeroPadding2D.prototype.getConfig=function(){var config={padding:this.padding,dataFormat:this.dataFormat},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},ZeroPadding2D.className="ZeroPadding2D",ZeroPadding2D}(topology_1.Layer);exports.ZeroPadding2D=ZeroPadding2D,tfjs_core_1.serialization.registerClass(ZeroPadding2D)},{"../backend/common":214,"../engine/topology":224,"../errors":228,"../utils/types_utils":261,"@tensorflow/tfjs-core":62}],246:[function(require,module,exports){"use strict";function pool2d(x,poolSize,strides,padding,dataFormat,poolMode){return tfjs_core_1.tidy(function(){common_2.checkDataFormat(dataFormat),common_2.checkPoolMode(poolMode),common_2.checkPaddingMode(padding),null==strides&&(strides=[1,1]),null==padding&&(padding="valid"),null==dataFormat&&(dataFormat=common_1.imageDataFormat()),null==poolMode&&(poolMode="max"),x=convolutional_1.preprocessConv2DInput(x,dataFormat);var y,paddingString="same"===padding?"same":"valid";return y="max"===poolMode?tfc.maxPool(x,poolSize,strides,paddingString):tfc.avgPool(x,poolSize,strides,paddingString),"channelsFirst"===dataFormat&&(y=tfc.transpose(y,[0,3,1,2])),y})}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),common_1=require("../backend/common"),K=require("../backend/tfjs_backend"),common_2=require("../common"),topology_1=require("../engine/topology"),topology_2=require("../engine/topology"),errors_1=require("../errors"),conv_utils_1=require("../utils/conv_utils"),types_utils_1=require("../utils/types_utils"),convolutional_1=require("./convolutional");exports.pool2d=pool2d;var Pooling1D=function(_super){function Pooling1D(config){var _this=this;if(null==config.poolSize&&(config.poolSize=2),_this=_super.call(this,config)||this,"number"==typeof config.poolSize)_this.poolSize=[config.poolSize];else{if(!Array.isArray(config.poolSize)||1!==config.poolSize.length||"number"!=typeof config.poolSize[0])throw new errors_1.ValueError("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(config.poolSize));_this.poolSize=config.poolSize}if(null==config.strides)_this.strides=_this.poolSize;else if("number"==typeof config.strides)_this.strides=[config.strides];else{if(!Array.isArray(config.strides)||1!==config.strides.length||"number"!=typeof config.strides[0])throw new errors_1.ValueError("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(config.strides));_this.strides=config.strides}return _this.padding=null==config.padding?"valid":config.padding,common_2.checkPaddingMode(_this.padding),_this.inputSpec=[new topology_1.InputSpec({ndim:3})],_this}return __extends(Pooling1D,_super),Pooling1D.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var length=conv_utils_1.convOutputLength(inputShape[1],this.poolSize[0],this.padding,this.strides[0]);return[inputShape[0],length,inputShape[2]]},Pooling1D.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){_this.invokeCallHook(inputs,kwargs),inputs=K.expandDims(types_utils_1.getExactlyOneTensor(inputs),2);var output=_this.poolingFunction(types_utils_1.getExactlyOneTensor(inputs),[_this.poolSize[0],1],[_this.strides[0],1],_this.padding,"channelsLast");return tfc.squeeze(output,[2])})},Pooling1D.prototype.getConfig=function(){var config={poolSize:this.poolSize,padding:this.padding,strides:this.strides},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Pooling1D}(topology_2.Layer);exports.Pooling1D=Pooling1D;var MaxPooling1D=function(_super){function MaxPooling1D(config){return _super.call(this,config)||this}return __extends(MaxPooling1D,_super),MaxPooling1D.prototype.poolingFunction=function(inputs,poolSize,strides,padding,dataFormat){return common_2.checkDataFormat(dataFormat),common_2.checkPaddingMode(padding),pool2d(inputs,poolSize,strides,padding,dataFormat,"max")},MaxPooling1D.className="MaxPooling1D",MaxPooling1D}(Pooling1D);exports.MaxPooling1D=MaxPooling1D,tfjs_core_1.serialization.registerClass(MaxPooling1D);var AveragePooling1D=function(_super){function AveragePooling1D(config){return _super.call(this,config)||this}return __extends(AveragePooling1D,_super),AveragePooling1D.prototype.poolingFunction=function(inputs,poolSize,strides,padding,dataFormat){return common_2.checkDataFormat(dataFormat),common_2.checkPaddingMode(padding),pool2d(inputs,poolSize,strides,padding,dataFormat,"avg")},AveragePooling1D.className="AveragePooling1D",AveragePooling1D}(Pooling1D);exports.AveragePooling1D=AveragePooling1D,tfjs_core_1.serialization.registerClass(AveragePooling1D);var Pooling2D=function(_super){function Pooling2D(config){var _this=this;if(null==config.poolSize&&(config.poolSize=[2,2]),_this=_super.call(this,config)||this,_this.poolSize=Array.isArray(config.poolSize)?config.poolSize:[config.poolSize,config.poolSize],null==config.strides)_this.strides=_this.poolSize;else if(Array.isArray(config.strides)){if(2!==config.strides.length)throw new errors_1.ValueError("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+config.strides.length+".");_this.strides=config.strides}else _this.strides=[config.strides,config.strides];return _this.padding=null==config.padding?"valid":config.padding,_this.dataFormat=null==config.dataFormat?"channelsLast":config.dataFormat,common_2.checkDataFormat(_this.dataFormat),common_2.checkPaddingMode(_this.padding),_this.inputSpec=[new topology_1.InputSpec({ndim:4})],_this}return __extends(Pooling2D,_super),Pooling2D.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var rows="channelsFirst"===this.dataFormat?inputShape[2]:inputShape[1],cols="channelsFirst"===this.dataFormat?inputShape[3]:inputShape[2];return rows=conv_utils_1.convOutputLength(rows,this.poolSize[0],this.padding,this.strides[0]),cols=conv_utils_1.convOutputLength(cols,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[inputShape[0],inputShape[1],rows,cols]:[inputShape[0],rows,cols,inputShape[3]]},Pooling2D.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){return _this.invokeCallHook(inputs,kwargs),_this.poolingFunction(types_utils_1.getExactlyOneTensor(inputs),_this.poolSize,_this.strides,_this.padding,_this.dataFormat)})},Pooling2D.prototype.getConfig=function(){var config={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Pooling2D}(topology_2.Layer);exports.Pooling2D=Pooling2D;var MaxPooling2D=function(_super){function MaxPooling2D(config){return _super.call(this,config)||this}return __extends(MaxPooling2D,_super),MaxPooling2D.prototype.poolingFunction=function(inputs,poolSize,strides,padding,dataFormat){return common_2.checkDataFormat(dataFormat),common_2.checkPaddingMode(padding),pool2d(inputs,poolSize,strides,padding,dataFormat,"max")},MaxPooling2D.className="MaxPooling2D",MaxPooling2D}(Pooling2D);exports.MaxPooling2D=MaxPooling2D,tfjs_core_1.serialization.registerClass(MaxPooling2D);var AveragePooling2D=function(_super){function AveragePooling2D(config){return _super.call(this,config)||this}return __extends(AveragePooling2D,_super),AveragePooling2D.prototype.poolingFunction=function(inputs,poolSize,strides,padding,dataFormat){return common_2.checkDataFormat(dataFormat),common_2.checkPaddingMode(padding),pool2d(inputs,poolSize,strides,padding,dataFormat,"avg")},AveragePooling2D.className="AveragePooling2D",AveragePooling2D}(Pooling2D);exports.AveragePooling2D=AveragePooling2D,tfjs_core_1.serialization.registerClass(AveragePooling2D);var GlobalPooling1D=function(_super){function GlobalPooling1D(config){var _this=_super.call(this,config)||this;return _this.inputSpec=[new topology_1.InputSpec({ndim:3})],_this}return __extends(GlobalPooling1D,_super),GlobalPooling1D.prototype.computeOutputShape=function(inputShape){return[inputShape[0],inputShape[2]]},
GlobalPooling1D.prototype.call=function(inputs,kwargs){throw new errors_1.NotImplementedError},GlobalPooling1D}(topology_2.Layer);exports.GlobalPooling1D=GlobalPooling1D;var GlobalAveragePooling1D=function(_super){function GlobalAveragePooling1D(config){return _super.call(this,config)||this}return __extends(GlobalAveragePooling1D,_super),GlobalAveragePooling1D.prototype.call=function(inputs,kwargs){return tfjs_core_1.tidy(function(){var input=types_utils_1.getExactlyOneTensor(inputs);return tfc.mean(input,1)})},GlobalAveragePooling1D.className="GlobalAveragePooling1D",GlobalAveragePooling1D}(GlobalPooling1D);exports.GlobalAveragePooling1D=GlobalAveragePooling1D,tfjs_core_1.serialization.registerClass(GlobalAveragePooling1D);var GlobalMaxPooling1D=function(_super){function GlobalMaxPooling1D(config){return _super.call(this,config)||this}return __extends(GlobalMaxPooling1D,_super),GlobalMaxPooling1D.prototype.call=function(inputs,kwargs){return tfjs_core_1.tidy(function(){var input=types_utils_1.getExactlyOneTensor(inputs);return tfc.max(input,1)})},GlobalMaxPooling1D.className="GlobalMaxPooling1D",GlobalMaxPooling1D}(GlobalPooling1D);exports.GlobalMaxPooling1D=GlobalMaxPooling1D,tfjs_core_1.serialization.registerClass(GlobalMaxPooling1D);var GlobalPooling2D=function(_super){function GlobalPooling2D(config){var _this=_super.call(this,config)||this;return _this.dataFormat=null==config.dataFormat?"channelsLast":config.dataFormat,common_2.checkDataFormat(_this.dataFormat),_this.inputSpec=[new topology_1.InputSpec({ndim:4})],_this}return __extends(GlobalPooling2D,_super),GlobalPooling2D.prototype.computeOutputShape=function(inputShape){return inputShape=inputShape,"channelsLast"===this.dataFormat?[inputShape[0],inputShape[3]]:[inputShape[0],inputShape[1]]},GlobalPooling2D.prototype.call=function(inputs,kwargs){throw new errors_1.NotImplementedError},GlobalPooling2D.prototype.getConfig=function(){var config={dataFormat:this.dataFormat},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},GlobalPooling2D}(topology_2.Layer);exports.GlobalPooling2D=GlobalPooling2D;var GlobalAveragePooling2D=function(_super){function GlobalAveragePooling2D(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(GlobalAveragePooling2D,_super),GlobalAveragePooling2D.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){var input=types_utils_1.getExactlyOneTensor(inputs);return"channelsLast"===_this.dataFormat?tfc.mean(input,[1,2]):tfc.mean(input,[2,3])})},GlobalAveragePooling2D.className="GlobalAveragePooling2D",GlobalAveragePooling2D}(GlobalPooling2D);exports.GlobalAveragePooling2D=GlobalAveragePooling2D,tfjs_core_1.serialization.registerClass(GlobalAveragePooling2D);var GlobalMaxPooling2D=function(_super){function GlobalMaxPooling2D(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(GlobalMaxPooling2D,_super),GlobalMaxPooling2D.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){var input=types_utils_1.getExactlyOneTensor(inputs);return"channelsLast"===_this.dataFormat?tfc.max(input,[1,2]):tfc.max(input,[2,3])})},GlobalMaxPooling2D.className="GlobalMaxPooling2D",GlobalMaxPooling2D}(GlobalPooling2D);exports.GlobalMaxPooling2D=GlobalMaxPooling2D,tfjs_core_1.serialization.registerClass(GlobalMaxPooling2D)},{"../backend/common":214,"../backend/tfjs_backend":216,"../common":219,"../engine/topology":224,"../errors":228,"../utils/conv_utils":256,"../utils/types_utils":261,"./convolutional":239,"@tensorflow/tfjs-core":62}],247:[function(require,module,exports){"use strict";function standardizeArgs(inputs,initialState,constants,numConstants){function toListOrNull(x){return null==x||Array.isArray(x)?x:[x]}if(Array.isArray(inputs)){if(null!=initialState||null!=constants)throw new errors_1.ValueError("When inputs is an array, neither initialState or constants should be provided");null!=numConstants&&(constants=inputs.slice(inputs.length-numConstants,inputs.length),inputs=inputs.slice(0,inputs.length-numConstants)),inputs.length>1&&(initialState=inputs.slice(1,inputs.length)),inputs=inputs[0]}return initialState=toListOrNull(initialState),constants=toListOrNull(constants),{inputs:inputs,initialState:initialState,constants:constants}}function rnn(stepFunction,inputs,initialStates,goBackwards,mask,constants,unroll,needPerStepOutputs){void 0===goBackwards&&(goBackwards=!1),void 0===unroll&&(unroll=!1),void 0===needPerStepOutputs&&(needPerStepOutputs=!1);var ndim=inputs.shape.length;if(ndim<3)throw new errors_1.ValueError("Input should be at least 3D, but is "+ndim+"D.");var axes=[1,0].concat(math_utils.range(2,ndim));if(inputs=tfc.transpose(inputs,axes),null!=mask)throw new errors_1.NotImplementedError("The rnn() function of the deeplearn.js backend does not support masking yet.");if(null!=constants)throw new errors_1.NotImplementedError("The rnn() functoin of the deeplearn.js backend does not support constants yet.");unroll&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),goBackwards&&(inputs=tfc.reverse(inputs,0));for(var outputs,lastOutput,states=initialStates,timeSteps=inputs.shape[0],t=0;t<timeSteps;++t)!function(t){var currentInput=K.sliceAlongFirstAxis(inputs,t,1);currentInput=currentInput.reshape(currentInput.shape.slice(1));var stepOutputs=tfc.tidy(function(){return stepFunction(currentInput,states)});if(lastOutput=stepOutputs[0],needPerStepOutputs)if(0===t)outputs=lastOutput.expandDims(1);else{var newOutputs=tfc.concat([outputs,lastOutput.expandDims(1)],1);outputs.dispose(),outputs=newOutputs}states=stepOutputs[1]}(t);return[lastOutput,outputs,states]}function generateDropoutMask(ones,rate,training,count){function droppedInputs(){return K.dropout(ones(),state_1.getScalar(rate))}if(void 0===training&&(training=null),void 0===count&&(count=1),count>1){for(var mask=[],i=0;i<count;i++)mask.push(K.inTrainPhase(droppedInputs,ones,training));return mask.forEach(function(m){return tfc.keep(m)}),mask}return tfc.keep(K.inTrainPhase(droppedInputs,ones,training))}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),activations_1=require("../activations"),state_1=require("../backend/state"),K=require("../backend/tfjs_backend"),constraints_1=require("../constraints"),topology_1=require("../engine/topology"),topology_2=require("../engine/topology"),errors_1=require("../errors"),initializers_1=require("../initializers"),regularizers_1=require("../regularizers"),math_utils=require("../utils/math_utils"),types_utils_1=require("../utils/types_utils"),variables_1=require("../variables"),serialization_1=require("./serialization");exports.standardizeArgs=standardizeArgs,exports.rnn=rnn;var RNN=function(_super){function RNN(config){var cell,_this=_super.call(this,config)||this;if(null==config.cell)throw new errors_1.ValueError("cell property is missing for the constructor of RNN.");if(cell=Array.isArray(config.cell)?new StackedRNNCells({cells:config.cell}):config.cell,null==cell.stateSize)throw new errors_1.ValueError("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return _this.cell=cell,_this.returnSequences=null!=config.returnSequences&&config.returnSequences,_this.returnState=null!=config.returnState&&config.returnState,_this.goBackwards=null!=config.goBackwards&&config.goBackwards,_this._stateful=null!=config.stateful&&config.stateful,_this.unroll=null!=config.unroll&&config.unroll,_this.supportsMasking=!0,_this.inputSpec=[new topology_1.InputSpec({ndim:3})],_this.stateSpec=null,_this.states=null,_this.numConstants=null,_this.keptStates=[],_this}return __extends(RNN,_super),RNN.prototype.getStates=function(){if(null==this.states){var numStates=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return math_utils.range(0,numStates).map(function(x){return null})}return this.states},RNN.prototype.setStates=function(states){this.states=states},RNN.prototype.computeOutputShape=function(inputShape){types_utils_1.isArrayOfShapes(inputShape)&&(inputShape=inputShape[0]),inputShape=inputShape;var stateSize=this.cell.stateSize;Array.isArray(stateSize)||(stateSize=[stateSize]);var outputShape,outputDim=stateSize[0];if(outputShape=this.returnSequences?[inputShape[0],inputShape[1],outputDim]:[inputShape[0],outputDim],this.returnState){for(var stateShape=[],_i=0,stateSize_1=stateSize;_i<stateSize_1.length;_i++){var dim=stateSize_1[_i];stateShape.push([inputShape[0],dim])}return[outputShape].concat(stateShape)}return outputShape},RNN.prototype.computeMask=function(inputs,mask){throw new errors_1.NotImplementedError("computeMask has not been implemented for RNN yet")},RNN.prototype.build=function(inputShape){if(null!=this.numConstants)throw new errors_1.NotImplementedError("Constants support is not implemented in RNN yet.");types_utils_1.isArrayOfShapes(inputShape)&&(inputShape=inputShape[0]),inputShape=inputShape;var batchSize=this.stateful?inputShape[0]:null,inputDim=inputShape[inputShape.length-1];this.inputSpec[0]=new topology_1.InputSpec({shape:[batchSize,null,inputDim]});var stepInputShape=[inputShape[0]].concat(inputShape.slice(2));this.cell.build(stepInputShape);var stateSize;if(stateSize=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!tfjs_core_1.util.arraysEqual(this.stateSpec.map(function(spec){return spec.shape[spec.shape.length-1]}),stateSize))throw new errors_1.ValueError("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=stateSize.map(function(dim){return new topology_1.InputSpec({shape:[null,dim]})});this.stateful&&this.resetStates()},RNN.prototype.resetStates=function(states,training){var _this=this;void 0===training&&(training=!1),tfjs_core_1.tidy(function(){if(!_this.stateful)throw new errors_1.AttributeError("Cannot call resetStates() on an RNN Layer that is not stateful.");var batchSize=_this.inputSpec[0].shape[0];if(null==batchSize)throw new errors_1.ValueError("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==_this.states)Array.isArray(_this.cell.stateSize)?_this.states=_this.cell.stateSize.map(function(dim){return tfc.zeros([batchSize,dim])}):_this.states=[tfc.zeros([batchSize,_this.cell.stateSize])];else if(null==states)tfc.dispose(_this.states),null!=_this.keptStates&&(tfc.dispose(_this.keptStates),_this.keptStates=[]),Array.isArray(_this.cell.stateSize)?_this.states=_this.cell.stateSize.map(function(dim){return tfc.zeros([batchSize,dim])}):_this.states[0]=tfc.zeros([batchSize,_this.cell.stateSize]);else{if(Array.isArray(states)||(states=[states]),states.length!==_this.states.length)throw new errors_1.ValueError("Layer "+_this.name+" expects "+_this.states.length+" state(s), but it received "+states.length+" state value(s). Input received: "+states);!0===training?_this.keptStates.push(_this.states.slice()):tfc.dispose(_this.states);for(var index=0;index<_this.states.length;++index){var value=states[index],dim=Array.isArray(_this.cell.stateSize)?_this.cell.stateSize[index]:_this.cell.stateSize,expectedShape=[batchSize,dim];if(!tfjs_core_1.util.arraysEqual(value.shape,expectedShape))throw new errors_1.ValueError("State "+index+" is incompatible with layer "+_this.name+": expected shape="+expectedShape+", received shape="+value.shape);_this.states[index]=value}}_this.states.forEach(function(state){return tfc.keep(state)})})},RNN.prototype.apply=function(inputs,kwargs){var initialState=null==kwargs?null:kwargs.initialState,constants=null==kwargs?null:kwargs.constants;null==kwargs&&(kwargs={});var standardized=standardizeArgs(inputs,initialState,constants,this.numConstants);inputs=standardized.inputs,initialState=standardized.initialState,constants=standardized.constants;var additionalInputs=[],additionalSpecs=[];if(null!=initialState){kwargs.initialState=initialState,additionalInputs=additionalInputs.concat(initialState),this.stateSpec=[];for(var _i=0,initialState_1=initialState;_i<initialState_1.length;_i++){var state=initialState_1[_i];this.stateSpec.push(new topology_1.InputSpec({shape:state.shape}))}additionalSpecs=additionalSpecs.concat(this.stateSpec)}if(null!=constants&&(kwargs.constants=constants,additionalInputs=additionalInputs.concat(constants),this.numConstants=constants.length),additionalInputs[0]instanceof topology_1.SymbolicTensor){var fullInput=[inputs].concat(additionalInputs),fullInputSpec=this.inputSpec.concat(additionalSpecs),originalInputSpec=this.inputSpec;this.inputSpec=fullInputSpec;var output=_super.prototype.apply.call(this,fullInput,kwargs);return this.inputSpec=originalInputSpec,output}return _super.prototype.apply.call(this,inputs,kwargs)},RNN.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){var mask=null==kwargs?null:kwargs.mask,training=null==kwargs?null:kwargs.training,initialState=null==kwargs?null:kwargs.initialState;if(inputs=types_utils_1.getExactlyOneTensor(inputs),null==initialState&&(initialState=_this.stateful?_this.states:_this.getInitialState(inputs)),null!=mask)throw new errors_1.NotImplementedError("Masking is not implemented for RNN yet");var numStates=Array.isArray(_this.cell.stateSize)?_this.cell.stateSize.length:1;if(initialState.length!==numStates)throw new errors_1.ValueError("RNN Layer has "+numStates+" state(s) but was passed "+initialState.length+" initial state(s).");_this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var cellCallKwargs={training:training},step=function(inputs,states){var outputs=_this.cell.call([inputs].concat(states),cellCallKwargs);return[outputs[0],outputs.slice(1)]},rnnOutputs=rnn(step,inputs,initialState,_this.goBackwards,null,null,_this.unroll,_this.returnSequences),lastOutput=rnnOutputs[0],outputs=rnnOutputs[1],states=rnnOutputs[2];_this.stateful&&_this.resetStates(states,training);var output=_this.returnSequences?outputs:lastOutput;return _this.returnState?[output].concat(states):output})},RNN.prototype.getInitialState=function(inputs){var _this=this;return tfjs_core_1.tidy(function(){var initialState=tfc.zeros(inputs.shape);return initialState=tfc.sum(initialState,[1,2]),initialState=K.expandDims(initialState),Array.isArray(_this.cell.stateSize)?_this.cell.stateSize.map(function(dim){return dim>1?K.tile(initialState,[1,dim]):initialState}):_this.cell.stateSize>1?[K.tile(initialState,[1,_this.cell.stateSize])]:[initialState]})},Object.defineProperty(RNN.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(RNN.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),RNN.prototype.getConfig=function(){var config={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(config.numConstants=this.numConstants);var cellConfig=this.cell.getConfig();config.cell={className:this.cell.getClassName(),config:cellConfig};var baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},RNN.className="RNN",RNN}(topology_2.Layer);exports.RNN=RNN,tfjs_core_1.serialization.registerClass(RNN);var RNNCell=function(_super){function RNNCell(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(RNNCell,_super),RNNCell}(topology_2.Layer);exports.RNNCell=RNNCell;var SimpleRNNCell=function(_super){function SimpleRNNCell(config){var _this=_super.call(this,config)||this;return _this.DEFAULT_ACTIVATION="tanh",_this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",_this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",_this.DEFAULT_BIAS_INITIALIZER="zeros",_this.units=config.units,_this.activation=activations_1.getActivation(null==config.activation?_this.DEFAULT_ACTIVATION:config.activation),_this.useBias=null==config.useBias||config.useBias,_this.kernelInitializer=initializers_1.getInitializer(config.kernelInitializer||_this.DEFAULT_KERNEL_INITIALIZER),_this.recurrentInitializer=initializers_1.getInitializer(config.recurrentInitializer||_this.DEFAULT_RECURRENT_INITIALIZER),_this.biasInitializer=initializers_1.getInitializer(config.biasInitializer||_this.DEFAULT_BIAS_INITIALIZER),_this.kernelRegularizer=regularizers_1.getRegularizer(config.kernelRegularizer),_this.recurrentRegularizer=regularizers_1.getRegularizer(config.recurrentRegularizer),_this.biasRegularizer=regularizers_1.getRegularizer(config.biasRegularizer),_this.kernelConstraint=constraints_1.getConstraint(config.kernelConstraint),_this.recurrentConstraint=constraints_1.getConstraint(config.recurrentConstraint),_this.biasConstraint=constraints_1.getConstraint(config.biasConstraint),_this.dropout=math_utils.min([1,math_utils.max([0,null==config.dropout?0:config.dropout])]),_this.recurrentDropout=math_utils.min([1,math_utils.max([0,null==config.recurrentDropout?0:config.recurrentDropout])]),_this.stateSize=_this.units,_this.dropoutMask=null,_this.recurrentDropoutMask=null,_this}return __extends(SimpleRNNCell,_super),SimpleRNNCell.prototype.build=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape),this.kernel=this.addWeight("kernel",[inputShape[inputShape.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},SimpleRNNCell.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){if(inputs=inputs,2!==inputs.length)throw new errors_1.ValueError("SimpleRNNCell expects 2 input Tensors, got "+inputs.length+".");var prevOutput=inputs[1];inputs=inputs[0];var training=null!=kwargs.training&&kwargs.training;0<_this.dropout&&_this.dropout<1&&null==_this.dropoutMask&&(_this.dropoutMask=generateDropoutMask(function(){return tfc.onesLike(inputs)},_this.dropout,training)),0<_this.recurrentDropout&&_this.recurrentDropout<1&&null==_this.recurrentDropoutMask&&(_this.recurrentDropoutMask=generateDropoutMask(function(){return tfc.onesLike(prevOutput)},_this.recurrentDropout,training));var h,dpMask=_this.dropoutMask,recDpMask=_this.recurrentDropoutMask;h=null!=dpMask?K.dot(tfc.mul(inputs,dpMask),_this.kernel.read()):K.dot(inputs,_this.kernel.read()),null!=_this.bias&&(h=K.biasAdd(h,_this.bias.read())),null!=recDpMask&&(prevOutput=tfc.mul(prevOutput,recDpMask));var output=tfc.add(h,K.dot(prevOutput,_this.recurrentKernel.read()));return null!=_this.activation&&(output=_this.activation.apply(output)),[output,output]})},SimpleRNNCell.prototype.getConfig=function(){var config={units:this.units,activation:activations_1.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:initializers_1.serializeInitializer(this.kernelInitializer),recurrentInitializer:initializers_1.serializeInitializer(this.recurrentInitializer),biasInitializer:initializers_1.serializeInitializer(this.biasInitializer),kernelRegularizer:regularizers_1.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:regularizers_1.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:regularizers_1.serializeRegularizer(this.biasRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),kernelConstraint:constraints_1.serializeConstraint(this.kernelConstraint),recurrentConstraint:constraints_1.serializeConstraint(this.recurrentConstraint),biasConstraint:constraints_1.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},SimpleRNNCell.className="SimpleRNNCell",SimpleRNNCell}(RNNCell);exports.SimpleRNNCell=SimpleRNNCell,tfjs_core_1.serialization.registerClass(SimpleRNNCell);var SimpleRNN=function(_super){function SimpleRNN(config){return config.cell=new SimpleRNNCell(config),_super.call(this,config)||this}return __extends(SimpleRNN,_super),SimpleRNN.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){null!=_this.cell.dropoutMask&&(tfc.dispose(_this.cell.dropoutMask),_this.cell.dropoutMask=null),null!=_this.cell.recurrentDropoutMask&&(tfc.dispose(_this.cell.recurrentDropoutMask),_this.cell.recurrentDropoutMask=null);var mask=null==kwargs?null:kwargs.mask,training=null==kwargs?null:kwargs.training,initialState=null==kwargs?null:kwargs.initialState;return _super.prototype.call.call(_this,inputs,{mask:mask,training:training,initialState:initialState})})},Object.defineProperty(SimpleRNN.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(SimpleRNN.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),SimpleRNN.prototype.getConfig=function(){var config={units:this.units,activation:activations_1.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:initializers_1.serializeInitializer(this.kernelInitializer),recurrentInitializer:initializers_1.serializeInitializer(this.recurrentInitializer),biasInitializer:initializers_1.serializeInitializer(this.biasInitializer),kernelRegularizer:regularizers_1.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:regularizers_1.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:regularizers_1.serializeRegularizer(this.biasRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),kernelConstraint:constraints_1.serializeConstraint(this.kernelConstraint),recurrentConstraint:constraints_1.serializeConstraint(this.recurrentConstraint),biasConstraint:constraints_1.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},baseConfig=_super.prototype.getConfig.call(this);return delete baseConfig.cell,Object.assign(config,baseConfig),config},SimpleRNN.className="SimpleRNN",SimpleRNN}(RNN);exports.SimpleRNN=SimpleRNN,tfjs_core_1.serialization.registerClass(SimpleRNN);var GRUCell=function(_super){function GRUCell(config){var _this=_super.call(this,config)||this;return _this.DEFAULT_ACTIVATION="tanh",_this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",_this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",_this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",_this.DEFAULT_BIAS_INITIALIZER="zeros",_this.units=config.units,_this.activation=activations_1.getActivation(void 0===config.activation?_this.DEFAULT_ACTIVATION:config.activation),_this.recurrentActivation=activations_1.getActivation(void 0===config.recurrentActivation?_this.DEFAULT_RECURRENT_ACTIVATION:config.recurrentActivation),_this.useBias=null==config.useBias||config.useBias,_this.kernelInitializer=initializers_1.getInitializer(config.kernelInitializer||_this.DEFAULT_KERNEL_INITIALIZER),_this.recurrentInitializer=initializers_1.getInitializer(config.recurrentInitializer||_this.DEFAULT_RECURRENT_INITIALIZER),_this.biasInitializer=initializers_1.getInitializer(config.biasInitializer||_this.DEFAULT_BIAS_INITIALIZER),_this.kernelRegularizer=regularizers_1.getRegularizer(config.kernelRegularizer),_this.recurrentRegularizer=regularizers_1.getRegularizer(config.recurrentRegularizer),_this.biasRegularizer=regularizers_1.getRegularizer(config.biasRegularizer),_this.kernelConstraint=constraints_1.getConstraint(config.kernelConstraint),_this.recurrentConstraint=constraints_1.getConstraint(config.recurrentConstraint),_this.biasConstraint=constraints_1.getConstraint(config.biasConstraint),_this.dropout=math_utils.min([1,math_utils.max([0,null==config.dropout?0:config.dropout])]),_this.recurrentDropout=math_utils.min([1,math_utils.max([0,null==config.recurrentDropout?0:config.recurrentDropout])]),_this.implementation=config.implementation,_this.stateSize=_this.units,_this.dropoutMask=null,_this.recurrentDropoutMask=null,_this}return __extends(GRUCell,_super),GRUCell.prototype.build=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var inputDim=inputShape[inputShape.length-1];this.kernel=this.addWeight("kernel",[inputDim,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},GRUCell.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){if(inputs=inputs,2!==inputs.length)throw new errors_1.ValueError("GRUCell expects 2 input Tensors (inputs, h, c), got "+inputs.length+".");var training=null!=kwargs.training&&kwargs.training,hTMinus1=inputs[1];inputs=inputs[0],0<_this.dropout&&_this.dropout<1&&null==_this.dropoutMask&&(_this.dropoutMask=generateDropoutMask(function(){return tfc.onesLike(inputs)},_this.dropout,training,3)),0<_this.recurrentDropout&&_this.recurrentDropout<1&&null==_this.recurrentDropoutMask&&(_this.recurrentDropoutMask=generateDropoutMask(function(){return tfc.onesLike(hTMinus1)},_this.recurrentDropout,training,3));var z,r,hh,dpMask=_this.dropoutMask,recDpMask=_this.recurrentDropoutMask;0<_this.dropout&&_this.dropout<1&&(inputs=tfc.mul(inputs,dpMask[0]));var matrixX=K.dot(inputs,_this.kernel.read());_this.useBias&&(matrixX=K.biasAdd(matrixX,_this.bias.read())),0<_this.recurrentDropout&&_this.recurrentDropout<1&&(hTMinus1=tfc.mul(hTMinus1,recDpMask[0]));var recurrentKernelValue=_this.recurrentKernel.read(),_a=tfc.split(recurrentKernelValue,[2*_this.units,_this.units],recurrentKernelValue.rank-1),rk1=_a[0],rk2=_a[1],matrixInner=K.dot(hTMinus1,rk1),_b=tfc.split(matrixX,3,matrixX.rank-1),xZ=_b[0],xR=_b[1],xH=_b[2],_c=tfc.split(matrixInner,2,matrixInner.rank-1),recurrentZ=_c[0],recurrentR=_c[1];z=_this.recurrentActivation.apply(tfc.add(xZ,recurrentZ)),r=_this.recurrentActivation.apply(tfc.add(xR,recurrentR));var recurrentH=K.dot(tfc.mul(r,hTMinus1),rk2);hh=_this.activation.apply(tfc.add(xH,recurrentH));var h=tfc.add(tfc.mul(z,hTMinus1),tfc.mul(tfc.add(state_1.getScalar(1),tfc.neg(z)),hh));return[h,h]})},GRUCell.prototype.getConfig=function(){var config={units:this.units,activation:activations_1.serializeActivation(this.activation),recurrentActivation:activations_1.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:initializers_1.serializeInitializer(this.kernelInitializer),recurrentInitializer:initializers_1.serializeInitializer(this.recurrentInitializer),biasInitializer:initializers_1.serializeInitializer(this.biasInitializer),kernelRegularizer:regularizers_1.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:regularizers_1.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:regularizers_1.serializeRegularizer(this.biasRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),kernelConstraint:constraints_1.serializeConstraint(this.kernelConstraint),recurrentConstraint:constraints_1.serializeConstraint(this.recurrentConstraint),biasConstraint:constraints_1.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},GRUCell.className="GRUCell",GRUCell}(RNNCell);exports.GRUCell=GRUCell,tfjs_core_1.serialization.registerClass(GRUCell);var GRU=function(_super){function GRU(config){return 0===config.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),config.cell=new GRUCell(config),_super.call(this,config)||this}return __extends(GRU,_super),GRU.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){null!=_this.cell.dropoutMask&&(tfc.dispose(_this.cell.dropoutMask),_this.cell.dropoutMask=null),null!=_this.cell.recurrentDropoutMask&&(tfc.dispose(_this.cell.recurrentDropoutMask),_this.cell.recurrentDropoutMask=null);var mask=null==kwargs?null:kwargs.mask,training=null==kwargs?null:kwargs.training,initialState=null==kwargs?null:kwargs.initialState;return _super.prototype.call.call(_this,inputs,{mask:mask,training:training,initialState:initialState})})},Object.defineProperty(GRU.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"recurrentInitializer",{
get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(GRU.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),GRU.prototype.getConfig=function(){var config={units:this.units,activation:activations_1.serializeActivation(this.activation),recurrentActivation:activations_1.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:initializers_1.serializeInitializer(this.kernelInitializer),recurrentInitializer:initializers_1.serializeInitializer(this.recurrentInitializer),biasInitializer:initializers_1.serializeInitializer(this.biasInitializer),kernelRegularizer:regularizers_1.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:regularizers_1.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:regularizers_1.serializeRegularizer(this.biasRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),kernelConstraint:constraints_1.serializeConstraint(this.kernelConstraint),recurrentConstraint:constraints_1.serializeConstraint(this.recurrentConstraint),biasConstraint:constraints_1.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},baseConfig=_super.prototype.getConfig.call(this);return delete baseConfig.cell,Object.assign(config,baseConfig),config},GRU.fromConfig=function(cls,config){return 0===config.implmentation&&(config.implementation=1),new cls(config)},GRU.className="GRU",GRU}(RNN);exports.GRU=GRU,tfjs_core_1.serialization.registerClass(GRU);var LSTMCell=function(_super){function LSTMCell(config){var _this=_super.call(this,config)||this;return _this.DEFAULT_ACTIVATION="tanh",_this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",_this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",_this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",_this.DEFAULT_BIAS_INITIALIZER="zeros",_this.units=config.units,_this.activation=activations_1.getActivation(void 0===config.activation?_this.DEFAULT_ACTIVATION:config.activation),_this.recurrentActivation=activations_1.getActivation(void 0===config.recurrentActivation?_this.DEFAULT_RECURRENT_ACTIVATION:config.recurrentActivation),_this.useBias=null==config.useBias||config.useBias,_this.kernelInitializer=initializers_1.getInitializer(config.kernelInitializer||_this.DEFAULT_KERNEL_INITIALIZER),_this.recurrentInitializer=initializers_1.getInitializer(config.recurrentInitializer||_this.DEFAULT_RECURRENT_INITIALIZER),_this.biasInitializer=initializers_1.getInitializer(config.biasInitializer||_this.DEFAULT_BIAS_INITIALIZER),_this.unitForgetBias=config.unitForgetBias,_this.kernelRegularizer=regularizers_1.getRegularizer(config.kernelRegularizer),_this.recurrentRegularizer=regularizers_1.getRegularizer(config.recurrentRegularizer),_this.biasRegularizer=regularizers_1.getRegularizer(config.biasRegularizer),_this.kernelConstraint=constraints_1.getConstraint(config.kernelConstraint),_this.recurrentConstraint=constraints_1.getConstraint(config.recurrentConstraint),_this.biasConstraint=constraints_1.getConstraint(config.biasConstraint),_this.dropout=math_utils.min([1,math_utils.max([0,null==config.dropout?0:config.dropout])]),_this.recurrentDropout=math_utils.min([1,math_utils.max([0,null==config.recurrentDropout?0:config.recurrentDropout])]),_this.implementation=config.implementation,_this.stateSize=[_this.units,_this.units],_this.dropoutMask=null,_this.recurrentDropoutMask=null,_this}return __extends(LSTMCell,_super),LSTMCell.prototype.build=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var inputDim=inputShape[inputShape.length-1];this.kernel=this.addWeight("kernel",[inputDim,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var biasInitializer;if(this.useBias){if(this.unitForgetBias){var capturedBiasInit_1=this.biasInitializer,capturedUnits_1=this.units;biasInitializer=new(_a=function(_super){function CustomInit(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(CustomInit,_super),CustomInit.prototype.apply=function(shape,dtype){var bI=capturedBiasInit_1.apply([capturedUnits_1]),bF=(new initializers_1.Ones).apply([capturedUnits_1]),bCAndH=capturedBiasInit_1.apply([2*capturedUnits_1]);return K.concatAlongFirstAxis(K.concatAlongFirstAxis(bI,bF),bCAndH)},CustomInit}(initializers_1.Initializer),_a.className="CustomInit",_a)}else biasInitializer=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,biasInitializer,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0;var _a},LSTMCell.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){var training=null!=kwargs.training&&kwargs.training;if(inputs=inputs,3!==inputs.length)throw new errors_1.ValueError("LSTMCell expects 3 input Tensors (inputs, h, c), got "+inputs.length+".");var hTMinus1=inputs[1],cTMinus1=inputs[2];inputs=inputs[0],0<_this.dropout&&_this.dropout<1&&null==_this.dropoutMask&&(_this.dropoutMask=generateDropoutMask(function(){return tfc.onesLike(inputs)},_this.dropout,training,4)),0<_this.recurrentDropout&&_this.recurrentDropout<1&&null==_this.recurrentDropoutMask&&(_this.recurrentDropoutMask=generateDropoutMask(function(){return tfc.onesLike(hTMinus1)},_this.recurrentDropout,training,4));var i,f,c,o,dpMask=_this.dropoutMask,recDpMask=_this.recurrentDropoutMask;0<_this.dropout&&_this.dropout<1&&(inputs=tfc.mul(inputs,dpMask[0]));var z=K.dot(inputs,_this.kernel.read());0<_this.recurrentDropout&&_this.recurrentDropout<1&&(hTMinus1=tfc.mul(hTMinus1,recDpMask[0])),z=tfc.add(z,K.dot(hTMinus1,_this.recurrentKernel.read())),_this.useBias&&(z=K.biasAdd(z,_this.bias.read()));var _a=tfc.split(z,4,z.rank-1),z0=_a[0],z1=_a[1],z2=_a[2],z3=_a[3];i=_this.recurrentActivation.apply(z0),f=_this.recurrentActivation.apply(z1),c=tfc.add(tfc.mul(f,cTMinus1),tfc.mul(i,_this.activation.apply(z2))),o=_this.recurrentActivation.apply(z3);var h=tfc.mul(o,_this.activation.apply(c));return[h,h,c]})},LSTMCell.prototype.getConfig=function(){var config={units:this.units,activation:activations_1.serializeActivation(this.activation),recurrentActivation:activations_1.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:initializers_1.serializeInitializer(this.kernelInitializer),recurrentInitializer:initializers_1.serializeInitializer(this.recurrentInitializer),biasInitializer:initializers_1.serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:regularizers_1.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:regularizers_1.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:regularizers_1.serializeRegularizer(this.biasRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),kernelConstraint:constraints_1.serializeConstraint(this.kernelConstraint),recurrentConstraint:constraints_1.serializeConstraint(this.recurrentConstraint),biasConstraint:constraints_1.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},LSTMCell.className="LSTMCell",LSTMCell}(RNNCell);exports.LSTMCell=LSTMCell,tfjs_core_1.serialization.registerClass(LSTMCell);var LSTM=function(_super){function LSTM(config){return 0===config.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),config.cell=new LSTMCell(config),_super.call(this,config)||this}return __extends(LSTM,_super),LSTM.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){null!=_this.cell.dropoutMask&&(tfc.dispose(_this.cell.dropoutMask),_this.cell.dropoutMask=null),null!=_this.cell.recurrentDropoutMask&&(tfc.dispose(_this.cell.recurrentDropoutMask),_this.cell.recurrentDropoutMask=null);var mask=null==kwargs?null:kwargs.mask,training=null==kwargs?null:kwargs.training,initialState=null==kwargs?null:kwargs.initialState;return _super.prototype.call.call(_this,inputs,{mask:mask,training:training,initialState:initialState})})},Object.defineProperty(LSTM.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(LSTM.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),LSTM.prototype.getConfig=function(){var config={units:this.units,activation:activations_1.serializeActivation(this.activation),recurrentActivation:activations_1.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:initializers_1.serializeInitializer(this.kernelInitializer),recurrentInitializer:initializers_1.serializeInitializer(this.recurrentInitializer),biasInitializer:initializers_1.serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:regularizers_1.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:regularizers_1.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:regularizers_1.serializeRegularizer(this.biasRegularizer),activityRegularizer:regularizers_1.serializeRegularizer(this.activityRegularizer),kernelConstraint:constraints_1.serializeConstraint(this.kernelConstraint),recurrentConstraint:constraints_1.serializeConstraint(this.recurrentConstraint),biasConstraint:constraints_1.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},baseConfig=_super.prototype.getConfig.call(this);return delete baseConfig.cell,Object.assign(config,baseConfig),config},LSTM.fromConfig=function(cls,config){return 0===config.implmentation&&(config.implementation=1),new cls(config)},LSTM.className="LSTM",LSTM}(RNN);exports.LSTM=LSTM,tfjs_core_1.serialization.registerClass(LSTM);var StackedRNNCells=function(_super){function StackedRNNCells(config){var _this=_super.call(this,config)||this;return _this.cells=config.cells,_this}return __extends(StackedRNNCells,_super),Object.defineProperty(StackedRNNCells.prototype,"stateSize",{get:function(){for(var stateSize=[],_i=0,_a=this.cells.slice().reverse();_i<_a.length;_i++){var cell=_a[_i];Array.isArray(cell.stateSize)?stateSize.push.apply(stateSize,cell.stateSize):stateSize.push(cell.stateSize)}return stateSize},enumerable:!0,configurable:!0}),StackedRNNCells.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){inputs=inputs;for(var states=inputs.slice(1),nestedStates=[],_i=0,_a=_this.cells.slice().reverse();_i<_a.length;_i++){var cell=_a[_i];Array.isArray(cell.stateSize)?nestedStates.push(states.splice(0,cell.stateSize.length)):nestedStates.push(states.splice(0,1))}nestedStates.reverse();for(var callInputs,newNestedStates=[],i=0;i<_this.cells.length;++i){var cell=_this.cells[i];states=nestedStates[i],callInputs=0===i?[inputs[0]].concat(states):[callInputs[0]].concat(states),callInputs=cell.call(callInputs,kwargs),newNestedStates.push(callInputs.slice(1))}states=[];for(var _b=0,_c=newNestedStates.slice().reverse();_b<_c.length;_b++){var cellStates=_c[_b];states.push.apply(states,cellStates)}return[callInputs[0]].concat(states)})},StackedRNNCells.prototype.build=function(inputShape){types_utils_1.isArrayOfShapes(inputShape)&&(inputShape=inputShape[0]),inputShape=inputShape;for(var outputDim,_i=0,_a=this.cells;_i<_a.length;_i++){var cell=_a[_i];cell.build(inputShape),outputDim=Array.isArray(cell.stateSize)?cell.stateSize[0]:cell.stateSize,inputShape=[inputShape[0],outputDim]}this.built=!0},StackedRNNCells.prototype.getConfig=function(){for(var cellConfigs=[],_i=0,_a=this.cells;_i<_a.length;_i++){var cell=_a[_i];cellConfigs.push({className:this.getClassName(),config:cell.getConfig()})}var config={cells:cellConfigs},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},StackedRNNCells.fromConfig=function(cls,config,customObjects){void 0===customObjects&&(customObjects={});for(var cells=[],_i=0,_a=config.cells;_i<_a.length;_i++){var cellConfig=_a[_i];cells.push(serialization_1.deserialize(cellConfig,customObjects))}return new cls({cells:cells})},Object.defineProperty(StackedRNNCells.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var weights=[],_i=0,_a=this.cells;_i<_a.length;_i++){var cell=_a[_i];weights.push.apply(weights,cell.trainableWeights)}return weights},enumerable:!0,configurable:!0}),Object.defineProperty(StackedRNNCells.prototype,"nonTrainableWeights",{get:function(){for(var weights=[],_i=0,_a=this.cells;_i<_a.length;_i++){var cell=_a[_i];weights.push.apply(weights,cell.nonTrainableWeights)}if(!this.trainable){for(var trainableWeights=[],_b=0,_c=this.cells;_b<_c.length;_b++){var cell=_c[_b];trainableWeights.push.apply(trainableWeights,cell.trainableWeights)}return trainableWeights.concat(weights)}return weights},enumerable:!0,configurable:!0}),StackedRNNCells.prototype.getWeights=function(){for(var weights=[],_i=0,_a=this.cells;_i<_a.length;_i++){var cell=_a[_i];weights.push.apply(weights,cell.weights)}return variables_1.batchGetValue(weights)},StackedRNNCells.prototype.setWeights=function(weights){for(var tuples=[],_i=0,_a=this.cells;_i<_a.length;_i++)for(var cell=_a[_i],numParams=cell.weights.length,inputWeights=weights.splice(numParams),i=0;i<cell.weights.length;++i)tuples.push([cell.weights[i],inputWeights[i]]);variables_1.batchSetValue(tuples)},StackedRNNCells.className="StackedRNNCells",StackedRNNCells}(RNNCell);exports.StackedRNNCells=StackedRNNCells,tfjs_core_1.serialization.registerClass(StackedRNNCells)},{"../activations":213,"../backend/state":215,"../backend/tfjs_backend":216,"../constraints":220,"../engine/topology":224,"../errors":228,"../initializers":237,"../regularizers":255,"../utils/math_utils":259,"../utils/types_utils":261,"../variables":263,"./serialization":248,"@tensorflow/tfjs-core":62}],248:[function(require,module,exports){"use strict";function deserialize(config,customObjects){return void 0===customObjects&&(customObjects={}),generic_utils_1.deserializeKerasObject(config,tfjs_core_1.serialization.SerializationMap.getMap().classNameMap,customObjects,"layer")}Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),generic_utils_1=require("../utils/generic_utils");exports.deserialize=deserialize},{"../utils/generic_utils":257,"@tensorflow/tfjs-core":62}],249:[function(require,module,exports){"use strict";function checkBidirectionalMergeMode(value){generic_utils.checkStringTypeUnionValue(exports.VALID_BIDIRECTIONAL_MERGE_MODES,"BidirectionalMergeMode",value)}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("../backend/state"),K=require("../backend/tfjs_backend"),common_1=require("../common"),topology_1=require("../engine/topology"),errors_1=require("../errors"),generic_utils=require("../utils/generic_utils"),types_utils_1=require("../utils/types_utils"),recurrent_1=require("./recurrent"),serialization_1=require("./serialization"),Wrapper=function(_super){function Wrapper(config){var _this=_super.call(this,config)||this;return _this.layer=config.layer,_this}return __extends(Wrapper,_super),Wrapper.prototype.build=function(inputShape){this.built=!0},Object.defineProperty(Wrapper.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(value){null!=this.layer&&(this.layer.trainable=value)},enumerable:!0,configurable:!0}),Object.defineProperty(Wrapper.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(Wrapper.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(Wrapper.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(Wrapper.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),Wrapper.prototype.getWeights=function(){return this.layer.getWeights()},Wrapper.prototype.setWeights=function(weights){this.layer.setWeights(weights)},Wrapper.prototype.getConfig=function(){var config={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Wrapper.fromConfig=function(cls,config,customObjects){void 0===customObjects&&(customObjects={});var layerConfig=config.layer,layer=serialization_1.deserialize(layerConfig,customObjects);delete config.layer;var newConfig={layer:layer};return Object.assign(newConfig,config),new cls(newConfig)},Wrapper}(topology_1.Layer);exports.Wrapper=Wrapper;var TimeDistributed=function(_super){function TimeDistributed(config){var _this=_super.call(this,config)||this;return _this.supportsMasking=!0,_this}return __extends(TimeDistributed,_super),TimeDistributed.prototype.build=function(inputShape){if(inputShape=types_utils_1.getExactlyOneShape(inputShape),inputShape.length<3)throw new errors_1.ValueError("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(inputShape));this.inputSpec=[{shape:inputShape}];var childInputShape=[inputShape[0]].concat(inputShape.slice(2));this.layer.built||(this.layer.build(childInputShape),this.layer.built=!0),_super.prototype.build.call(this,inputShape)},TimeDistributed.prototype.computeOutputShape=function(inputShape){inputShape=types_utils_1.getExactlyOneShape(inputShape);var childInputShape=[inputShape[0]].concat(inputShape.slice(2)),childOutputShape=this.layer.computeOutputShape(childInputShape),timesteps=inputShape[1];return[childOutputShape[0],timesteps].concat(childOutputShape.slice(1))},TimeDistributed.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){inputs=types_utils_1.getExactlyOneTensor(inputs);var step=function(inputs,states){return[types_utils_1.getExactlyOneTensor(_this.layer.call(inputs,kwargs)),[]]};return recurrent_1.rnn(step,inputs,[],!1,null,null,!1,!0)[1]})},TimeDistributed.className="TimeDistributed",TimeDistributed}(Wrapper);exports.TimeDistributed=TimeDistributed,tfjs_core_1.serialization.registerClass(TimeDistributed),exports.VALID_BIDIRECTIONAL_MERGE_MODES=["sum","mul","concat","ave"],exports.checkBidirectionalMergeMode=checkBidirectionalMergeMode;var Bidirectional=function(_super){function Bidirectional(config){var _this=_super.call(this,config)||this,layerConfig=config.layer.getConfig();if(_this.forwardLayer=serialization_1.deserialize({className:config.layer.getClassName(),config:layerConfig}),layerConfig.goBackwards=!0!==layerConfig.goBackwards,_this.backwardLayer=serialization_1.deserialize({className:config.layer.getClassName(),config:layerConfig}),_this.forwardLayer.name="forward_"+_this.forwardLayer.name,_this.backwardLayer.name="backward_"+_this.backwardLayer.name,checkBidirectionalMergeMode(config.mergeMode),_this.mergeMode=config.mergeMode,config.weights)throw new errors_1.NotImplementedError("weights support is not implemented for Bidirectional layer yet.");return _this._stateful=config.layer.stateful,_this.returnSequences=config.layer.returnSequences,_this.returnState=config.layer.returnState,_this.supportsMasking=!0,_this._trainable=!0,_this.inputSpec=config.layer.inputSpec,_this.numConstants=null,_this}return __extends(Bidirectional,_super),Object.defineProperty(Bidirectional.prototype,"trainable",{get:function(){return this._trainable},set:function(value){this._trainable=value,null!=this.forwardLayer&&(this.forwardLayer.trainable=value),null!=this.backwardLayer&&(this.backwardLayer.trainable=value)},enumerable:!0,configurable:!0}),Bidirectional.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},Bidirectional.prototype.setWeights=function(weights){var numWeights=weights.length,numeightsOver2=Math.floor(numWeights/2);this.forwardLayer.setWeights(weights.slice(0,numeightsOver2)),this.backwardLayer.setWeights(weights.slice(numeightsOver2))},Bidirectional.prototype.computeOutputShape=function(inputShape){var layerShapes=this.forwardLayer.computeOutputShape(inputShape);Array.isArray(layerShapes)&&Array.isArray(layerShapes[0])||(layerShapes=[layerShapes]),layerShapes=layerShapes;var outputShape,outputShapes,stateShape;return this.returnState?(stateShape=layerShapes.slice(1),outputShape=layerShapes[0]):outputShape=layerShapes[0],outputShape=outputShape,"concat"===this.mergeMode?(outputShape[outputShape.length-1]*=2,outputShapes=[outputShape]):outputShapes=null==this.mergeMode?[outputShape,outputShape.slice()]:[outputShape],this.returnState?null==this.mergeMode?outputShapes.concat(stateShape).concat(stateShape.slice()):[outputShape].concat(stateShape).concat(stateShape.slice()):generic_utils.singletonOrArray(outputShapes)},Bidirectional.prototype.apply=function(inputs,kwargs){var initialState=null==kwargs?null:kwargs.initialState,constants=null==kwargs?null:kwargs.constants;null==kwargs&&(kwargs={});var standardized=recurrent_1.standardizeArgs(inputs,initialState,constants,this.numConstants);if(inputs=standardized.inputs,initialState=standardized.initialState,constants=standardized.constants,Array.isArray(inputs)&&(initialState=inputs.slice(1),inputs=inputs[0]),(null==initialState||0===initialState.length)&&null==constants)return _super.prototype.apply.call(this,inputs,kwargs);var additionalInputs=[],additionalSpecs=[];if(null!=initialState){var numStates=initialState.length;if(numStates%2>0)throw new errors_1.ValueError("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");kwargs.initialState=initialState,additionalInputs.push.apply(additionalInputs,initialState);var stateSpecs=initialState.map(function(state){return new topology_1.InputSpec({shape:state.shape})});this.forwardLayer.stateSpec=stateSpecs.slice(0,numStates/2),this.backwardLayer.stateSpec=stateSpecs.slice(numStates/2),additionalSpecs.push.apply(additionalSpecs,stateSpecs)}if(null!=constants)throw new errors_1.NotImplementedError("Support for constants in Bidirectional layers is not implemented yet.");for(var isSymbolicTensor=additionalInputs[0]instanceof topology_1.SymbolicTensor,_i=0,additionalInputs_1=additionalInputs;_i<additionalInputs_1.length;_i++){if(additionalInputs_1[_i]instanceof topology_1.SymbolicTensor!==isSymbolicTensor)throw new errors_1.ValueError("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(isSymbolicTensor){var fullInput=[inputs].concat(additionalInputs),fullInputSpec=this.inputSpec.concat(additionalSpecs),originalInputSpec=this.inputSpec;this.inputSpec=fullInputSpec;var output=_super.prototype.apply.call(this,fullInput,kwargs);return this.inputSpec=originalInputSpec,output}return _super.prototype.apply.call(this,inputs,kwargs)},Bidirectional.prototype.call=function(inputs,kwargs){var _this=this;return tfjs_core_1.tidy(function(){if(null!=kwargs.mask)throw new errors_1.NotImplementedError("The support for masking is not implemented for Bidirectional layers yet.");var y,yRev,initialState=kwargs.initialState;if(null==initialState)y=_this.forwardLayer.call(inputs,kwargs),yRev=_this.backwardLayer.call(inputs,kwargs);else{var forwardState=initialState.slice(0,initialState.length/2),backwardState=initialState.slice(initialState.length/2);y=_this.forwardLayer.call(inputs,Object.assign(kwargs,{initialState:forwardState})),yRev=_this.backwardLayer.call(inputs,Object.assign(kwargs,{initialState:backwardState}))}var states;_this.returnState&&(Array.isArray(y)&&(states=y.slice(1).concat(yRev.slice(1))),y=y[0],yRev=yRev[0]),_this.returnSequences&&(yRev=tfc.reverse(yRev,1));var output;return"concat"===_this.mergeMode?output=K.concatenate([y,yRev]):"sum"===_this.mergeMode?output=tfc.add(y,yRev):"ave"===_this.mergeMode?output=tfc.mul(state_1.getScalar(.5),tfc.add(y,yRev)):"mul"===_this.mergeMode?output=tfc.mul(y,yRev):null==_this.mergeMode&&(output=[y,yRev]),_this.returnState?null==_this.mergeMode?output.concat(states):[output].concat(states):output})},Bidirectional.prototype.resetStates=function(states){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},Bidirectional.prototype.build=function(inputShape){var _this=this;common_1.nameScope(this.forwardLayer.name,function(){_this.forwardLayer.build(inputShape)}),common_1.nameScope(this.backwardLayer.name,function(){_this.backwardLayer.build(inputShape)}),this.built=!0},Object.defineProperty(Bidirectional.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(Bidirectional.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),Bidirectional.prototype.getConfig=function(){var config={mergeMode:this.mergeMode},baseConfig=_super.prototype.getConfig.call(this);return Object.assign(config,baseConfig),config},Bidirectional.fromConfig=function(cls,config){var rnnLayer=serialization_1.deserialize(config.layer);if(delete config.layer,null!=config.numConstants)throw new errors_1.NotImplementedError("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var newConfig=config;return newConfig.layer=rnnLayer,new cls(newConfig)},Bidirectional.className="Bidirectional",Bidirectional}(Wrapper);exports.Bidirectional=Bidirectional,tfjs_core_1.serialization.registerClass(Bidirectional)},{"../backend/state":215,"../backend/tfjs_backend":216,"../common":219,"../engine/topology":224,"../errors":228,"../utils/generic_utils":257,"../utils/types_utils":261,"./recurrent":247,"./serialization":248,"@tensorflow/tfjs-core":62}],250:[function(require,module,exports){"use strict";function resolveScalarsInLogs(logs){return __awaiter(this,void 0,void 0,function(){var promises,keys,scalarsToDispose,key,value,valueScalar,values,i;return __generator(this,function(_a){switch(_a.label){case 0:if(null==logs)return[2];promises=[],keys=[],scalarsToDispose=[];for(key in logs)"number"!=typeof(value=logs[key])&&(valueScalar=value,promises.push(valueScalar.data()),keys.push(key),scalarsToDispose.push(valueScalar));return[4,Promise.all(promises)];case 1:for(values=_a.sent(),i=0;i<values.length;++i)logs[keys[i]]=values[i][0];return tfjs_core_1.dispose(scalarsToDispose),[2]}})})}function disposeTensorsInLogs(logs){if(null!=logs)for(var key in logs){var value=logs[key];"number"!=typeof value&&value.dispose()}}var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],
_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core");exports.resolveScalarsInLogs=resolveScalarsInLogs,exports.disposeTensorsInLogs=disposeTensorsInLogs},{"@tensorflow/tfjs-core":62}],251:[function(require,module,exports){"use strict";function l2Normalize(x,axis){return tfjs_core_1.tidy(function(){var squareSum=tfc.sum(K.square(x),axis,!0),epsilonTensor=tfc.mul(tfjs_core_1.scalar(common_1.epsilon()),tfc.onesLike(x)),norm=tfc.sqrt(tfc.maximum(squareSum,epsilonTensor));return tfc.div(x,norm)})}function meanSquaredError(yTrue,yPred){return tfjs_core_1.tidy(function(){return tfc.mean(K.square(tfc.sub(yPred,yTrue)),-1)})}function meanAbsoluteError(yTrue,yPred){return tfjs_core_1.tidy(function(){return tfc.mean(tfc.abs(tfc.sub(yPred,yTrue)),-1)})}function meanAbsolutePercentageError(yTrue,yPred){return tfjs_core_1.tidy(function(){var diff=tfc.sub(yTrue,yPred),clippedTrue=tfc.clipByValue(tfc.abs(yTrue),common_1.epsilon(),Number.MAX_VALUE),absResult=tfc.abs(tfc.div(diff,clippedTrue));return tfc.mul(state_1.getScalar(100),tfc.mean(absResult,-1))})}function meanSquaredLogarithmicError(yTrue,yPred){return tfjs_core_1.tidy(function(){var one=state_1.getScalar(1),clippedPred=tfc.clipByValue(yPred,common_1.epsilon(),Number.MAX_VALUE),firstLog=tfc.log(tfc.add(one,clippedPred)),clippedTrue=tfc.clipByValue(yTrue,common_1.epsilon(),Number.MAX_VALUE),secondLog=tfc.log(tfc.add(one,clippedTrue));return tfc.mean(K.square(tfc.sub(firstLog,secondLog)),-1)})}function squaredHinge(yTrue,yPred){return tfjs_core_1.tidy(function(){var zeroTensor=state_1.getScalar(0),one=state_1.getScalar(1),maxResult=tfc.maximum(zeroTensor,tfc.sub(one,tfc.mul(yTrue,yPred)));return tfc.mean(K.square(maxResult),-1)})}function hinge(yTrue,yPred){return tfjs_core_1.tidy(function(){var zeroTensor=state_1.getScalar(0),one=state_1.getScalar(1),maxResult=tfc.maximum(zeroTensor,tfc.sub(one,tfc.mul(yTrue,yPred)));return tfc.mean(maxResult,-1)})}function categoricalHinge(yTrue,yPred){return tfjs_core_1.tidy(function(){var zeroTensor=state_1.getScalar(0),one=state_1.getScalar(1),pos=tfc.sum(tfc.mul(yTrue,yPred),-1),neg=tfc.max(tfc.mul(tfc.sub(one,yTrue),yPred),-1);return tfc.maximum(zeroTensor,tfc.add(one,tfc.sub(neg,pos)))})}function logcosh(yTrue,yPred){return tfjs_core_1.tidy(function(){var log2=state_1.getScalar(Math.log(2)),predictionDiff=tfc.sub(yPred,yTrue),logcoshResult=tfc.sub(tfc.add(predictionDiff,tfc.softplus(tfc.mul(state_1.getScalar(-2),predictionDiff))),log2);return tfc.mean(logcoshResult,-1)})}function categoricalCrossentropy(target,output,fromLogits){return void 0===fromLogits&&(fromLogits=!1),tfjs_core_1.tidy(function(){if(fromLogits)output=tfc.softmax(output);else{var outputSum=tfc.sum(output,output.shape.length-1,!0);output=tfc.div(output,outputSum)}return output=tfc.clipByValue(output,common_1.epsilon(),1-common_1.epsilon()),tfc.neg(tfc.sum(tfc.mul(target.toFloat(),tfc.log(output)),output.shape.length-1))})}function sparseCategoricalCrossentropy(target,output,fromLogits){return void 0===fromLogits&&(fromLogits=!1),tfjs_core_1.tidy(function(){var flatTarget=tfc.floor(K.flatten(target)).toInt(),outputShape=output.shape;return categoricalCrossentropy(tfc.oneHot(flatTarget,outputShape[outputShape.length-1]).reshape(outputShape),output,fromLogits)})}function sigmoidCrossEntropyWithLogits(target,output){return tfjs_core_1.tidy(function(){var maxOutput=tfc.maximum(output,tfc.zerosLike(output)),outputXTarget=tfc.mul(output,target),sigmoidOutput=tfc.log(tfc.add(state_1.getScalar(1),tfc.exp(tfc.neg(tfc.abs(output)))));return tfc.add(tfc.sub(maxOutput,outputXTarget),sigmoidOutput)})}function binaryCrossentropy(yTrue,yPred){return tfjs_core_1.tidy(function(){var y;return y=tfc.clipByValue(yPred,common_1.epsilon(),1-common_1.epsilon()),y=tfc.log(tfc.div(y,tfc.sub(tfc.onesLike(y),y))),tfc.mean(sigmoidCrossEntropyWithLogits(yTrue,y),-1)})}function kullbackLeiblerDivergence(yTrue,yPred){return tfjs_core_1.tidy(function(){var clippedTrue=tfc.clipByValue(yTrue,common_1.epsilon(),1),clippedPred=tfc.clipByValue(yPred,common_1.epsilon(),1);return tfc.sum(tfc.mul(yTrue,tfc.log(tfc.div(clippedTrue,clippedPred))),-1)})}function poisson(yTrue,yPred){return tfjs_core_1.tidy(function(){var logPred=tfc.log(tfc.add(state_1.getScalar(common_1.epsilon()),yPred));return tfc.mean(tfc.sub(yPred,tfc.mul(yTrue,logPred)),-1)})}function cosineProximity(yTrue,yPred){return tfjs_core_1.tidy(function(){var trueNormalized=l2Normalize(yTrue,-1),predNormalized=l2Normalize(yPred,-1),trueXPred=tfc.mul(trueNormalized,predNormalized);return tfc.neg(tfc.sum(trueXPred,-1))})}function get(identifierOrFn){var lossesMap={meanSquaredError:meanSquaredError,meanAbsoluteError:meanAbsoluteError,meanAbsolutePercentageError:meanAbsolutePercentageError,meanSquaredLogarithmicError:meanSquaredLogarithmicError,squaredHinge:squaredHinge,hinge:hinge,categoricalHinge:categoricalHinge,logcosh:logcosh,categoricalCrossentropy:categoricalCrossentropy,sparseCategoricalCrossentropy:sparseCategoricalCrossentropy,binaryCrossentropy:binaryCrossentropy,kullbackLeiblerDivergence:kullbackLeiblerDivergence,poisson:poisson,cosineProximity:cosineProximity};if("string"==typeof identifierOrFn){if(identifierOrFn in lossesMap)return lossesMap[identifierOrFn];var errMsg="Unknown loss "+identifierOrFn;throw identifierOrFn.toLowerCase().includes("softmaxcrossentropy")&&(errMsg="Unknown loss "+identifierOrFn+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new errors_1.ValueError(errMsg)}return identifierOrFn}Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),common_1=require("./backend/common"),state_1=require("./backend/state"),K=require("./backend/tfjs_backend"),errors_1=require("./errors");exports.l2Normalize=l2Normalize,exports.meanSquaredError=meanSquaredError,exports.meanAbsoluteError=meanAbsoluteError,exports.meanAbsolutePercentageError=meanAbsolutePercentageError,exports.meanSquaredLogarithmicError=meanSquaredLogarithmicError,exports.squaredHinge=squaredHinge,exports.hinge=hinge,exports.categoricalHinge=categoricalHinge,exports.logcosh=logcosh,exports.categoricalCrossentropy=categoricalCrossentropy,exports.sparseCategoricalCrossentropy=sparseCategoricalCrossentropy,exports.sigmoidCrossEntropyWithLogits=sigmoidCrossEntropyWithLogits,exports.binaryCrossentropy=binaryCrossentropy,exports.kullbackLeiblerDivergence=kullbackLeiblerDivergence,exports.poisson=poisson,exports.cosineProximity=cosineProximity,exports.mse=meanSquaredError,exports.MSE=meanSquaredError,exports.mae=meanAbsoluteError,exports.MAE=meanAbsoluteError,exports.mape=meanAbsolutePercentageError,exports.MAPE=meanAbsolutePercentageError,exports.msle=meanSquaredLogarithmicError,exports.MSLE=meanSquaredLogarithmicError,exports.kld=kullbackLeiblerDivergence,exports.KLD=kullbackLeiblerDivergence,exports.cosine=cosineProximity,exports.get=get},{"./backend/common":214,"./backend/state":215,"./backend/tfjs_backend":216,"./errors":228,"@tensorflow/tfjs-core":62}],252:[function(require,module,exports){"use strict";function binaryAccuracy(yTrue,yPred){return tfjs_core_1.tidy(function(){var threshold=tfc.mul(state_1.getScalar(.5),tfc.onesLike(yPred)),yPredThresholded=K.cast(tfc.greater(yPred,threshold),yTrue.dtype);return tfc.mean(tfc.equal(yTrue,yPredThresholded),-1)})}function categoricalAccuracy(yTrue,yPred){return tfjs_core_1.tidy(function(){return K.cast(tfc.equal(tfc.argMax(yTrue,-1),tfc.argMax(yPred,-1)),"float32")})}function truePositives(yTrue,yPred){return tfjs_core_1.tidy(function(){var one=state_1.getScalar(1);return tfc.logicalAnd(yTrue.equal(one),yPred.equal(one)).sum().cast("float32")})}function falseNegatives(yTrue,yPred){return tfjs_core_1.tidy(function(){var one=state_1.getScalar(1),zero=state_1.getScalar(0);return tfc.logicalAnd(yTrue.equal(one),yPred.equal(zero)).sum().cast("float32")})}function falsePositives(yTrue,yPred){return tfjs_core_1.tidy(function(){var one=state_1.getScalar(1),zero=state_1.getScalar(0);return tfc.logicalAnd(yTrue.equal(zero),yPred.equal(one)).sum().cast("float32")})}function precision(yTrue,yPred){return tfjs_core_1.tidy(function(){var zero=state_1.getScalar(0),tp=truePositives(yTrue,yPred),fp=falsePositives(yTrue,yPred),denominator=tp.add(fp);return tfc.where(tfc.greater(denominator,zero),tp.div(denominator),zero).cast("float32")})}function recall(yTrue,yPred){return tfjs_core_1.tidy(function(){var zero=state_1.getScalar(0),tp=truePositives(yTrue,yPred),fn=falseNegatives(yTrue,yPred),denominator=tp.add(fn);return tfc.where(tfc.greater(denominator,zero),tp.div(denominator),zero).cast("float32")})}function binaryCrossentropy(yTrue,yPred){return losses_2.binaryCrossentropy(yTrue,yPred)}function sparseCategoricalAccuracy(yTrue,yPred){throw new errors_1.NotImplementedError}function topKCategoricalAccuracy(yTrue,yPred){throw new errors_1.NotImplementedError}function sparseTopKCategoricalAccuracy(yTrue,yPred){throw new errors_1.NotImplementedError}function get(identifier){var metricsMap={binaryAccuracy:binaryAccuracy,categoricalAccuracy:categoricalAccuracy,precision:precision,categoricalCrossentropy:exports.categoricalCrossentropy,sparseCategoricalCrossentropy:exports.sparseCategoricalCrossentropy,mse:exports.mse,MSE:exports.MSE,mae:exports.mae,MAE:exports.MAE,mape:exports.mape,MAPE:exports.MAPE,cosine:exports.cosine};if("string"==typeof identifier&&identifier in metricsMap)return metricsMap[identifier];if("string"!=typeof identifier&&null!=identifier)return identifier;throw new errors_1.ValueError("Unknown metric "+identifier)}Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("./backend/state"),K=require("./backend/tfjs_backend"),errors_1=require("./errors"),losses_1=require("./losses"),losses_2=require("./losses");exports.binaryAccuracy=binaryAccuracy,exports.categoricalAccuracy=categoricalAccuracy,exports.precision=precision,exports.recall=recall,exports.binaryCrossentropy=binaryCrossentropy,exports.sparseCategoricalAccuracy=sparseCategoricalAccuracy,exports.topKCategoricalAccuracy=topKCategoricalAccuracy,exports.sparseTopKCategoricalAccuracy=sparseTopKCategoricalAccuracy,exports.mse=losses_1.meanSquaredError,exports.MSE=losses_1.meanSquaredError,exports.mae=losses_1.meanAbsoluteError,exports.MAE=losses_1.meanAbsoluteError,exports.mape=losses_1.meanAbsolutePercentageError,exports.MAPE=losses_1.meanAbsolutePercentageError,exports.categoricalCrossentropy=losses_1.categoricalCrossentropy,exports.cosine=losses_1.cosineProximity,exports.sparseCategoricalCrossentropy=losses_1.sparseCategoricalCrossentropy,exports.get=get},{"./backend/state":215,"./backend/tfjs_backend":216,"./errors":228,"./losses":251,"@tensorflow/tfjs-core":62}],253:[function(require,module,exports){"use strict";function modelFromJSON(modelAndWeightsConfig,customObjects){return __awaiter(this,void 0,void 0,function(){var modelTopology,tsConfig,model,weightValues,uniqueWeightValues,_i,_a,weight,skipMismatches,isNamedTensorMap;return __generator(this,function(_b){switch(_b.label){case 0:return"modelTopology"in modelAndWeightsConfig||(modelAndWeightsConfig={modelTopology:modelAndWeightsConfig}),modelAndWeightsConfig=modelAndWeightsConfig,modelTopology=modelAndWeightsConfig.modelTopology,null!=modelTopology.model_config&&(modelTopology=modelTopology.model_config),tsConfig=serialization_utils_1.convertPythonicToTs(modelTopology),model=serialization_1.deserialize(tsConfig,customObjects),null==modelAndWeightsConfig.weightsManifest?[3,2]:[4,tfjs_core_1.io.loadWeights(modelAndWeightsConfig.weightsManifest,modelAndWeightsConfig.pathPrefix,model.weights.map(function(weight){return weight.originalName}))];case 1:for(weightValues=_b.sent(),uniqueWeightValues={},_i=0,_a=model.weights;_i<_a.length;_i++)weight=_a[_i],uniqueWeightValues[weight.originalName]=weightValues[weight.originalName];skipMismatches=null,isNamedTensorMap=!0,model.loadWeights(uniqueWeightValues,skipMismatches,isNamedTensorMap),_b.label=2;case 2:return[2,model]}})})}function loadModelInternal(pathOrIOHandler,strict){return void 0===strict&&(strict=!0),__awaiter(this,void 0,void 0,function(){var handlers;return __generator(this,function(_a){if("string"==typeof pathOrIOHandler){if(handlers=tfjs_core_1.io.getLoadHandlers(pathOrIOHandler),0===handlers.length)handlers.push(tfjs_core_1.io.browserHTTPRequest(pathOrIOHandler));else if(handlers.length>1)throw new errors_1.ValueError("Found more than one ("+handlers.length+") load handlers for URL '"+pathOrIOHandler+"'");pathOrIOHandler=handlers[0]}return[2,loadModelFromIOHandler(pathOrIOHandler,void 0,strict)]})})}function loadModelFromIOHandler(handler,customObjects,strict){return void 0===strict&&(strict=!0),__awaiter(this,void 0,void 0,function(){var artifacts,modelTopology,model,skipMismatch,isNamedTensorMap;return __generator(this,function(_a){switch(_a.label){case 0:if(null==handler.load)throw new errors_1.ValueError("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,handler.load()];case 1:if(artifacts=_a.sent(),modelTopology=artifacts.modelTopology,null!=modelTopology.model_config&&(modelTopology=modelTopology.model_config),model=serialization_1.deserialize(serialization_utils_1.convertPythonicToTs(modelTopology),customObjects),null!=artifacts.weightData){if(null==artifacts.weightSpecs)throw new errors_1.ValueError("Model artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");skipMismatch=!1,isNamedTensorMap=!0,model.loadWeights(tfjs_core_1.io.decodeWeights(artifacts.weightData,artifacts.weightSpecs),skipMismatch,isNamedTensorMap,strict)}return[2,model]}})})}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=y[2&op[0]?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("./backend/state"),input_layer_1=require("./engine/input_layer"),topology_1=require("./engine/topology"),training_1=require("./engine/training"),errors_1=require("./errors"),serialization_1=require("./layers/serialization"),generic_utils=require("./utils/generic_utils"),serialization_utils_1=require("./utils/serialization_utils"),types_utils_1=require("./utils/types_utils");exports.modelFromJSON=modelFromJSON,exports.loadModelInternal=loadModelInternal,exports.loadModelFromIOHandler=loadModelFromIOHandler;var Sequential=function(_super){function Sequential(config){var _this=_super.call(this,{inputs:[],outputs:[]})||this;if(config=config||{},_this.trainable=!0,_this._updatable=!0,_this.built=!1,_this.name=null!=config.name?config.name:state_1.getUid("sequential_"),null!=config.layers)for(var _i=0,_a=config.layers;_i<_a.length;_i++){var layer=_a[_i];_this.add(layer)}return _this}return __extends(Sequential,_super),Sequential.prototype.checkShape=function(layer){if(layer.inboundNodes[0].outputTensors[0].shape.some(function(x){return x<0}))throw new errors_1.ValueError("Negative dimension size caused by adding layer "+layer.name+" with input shape ["+layer.inboundNodes[0].inputTensors[0].shape+"]")},Sequential.prototype.add=function(layer){var modelLayer,isLayerModelInstance=layer instanceof Sequential||layer instanceof training_1.Model;if(isLayerModelInstance){if(modelLayer=layer,1!==modelLayer.outputs.length)throw new errors_1.ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==modelLayer.inputs.length)throw new errors_1.ValueError("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===layer.inboundNodes.length){if(null==layer.batchInputShape)throw new errors_1.ValueError("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var x=input_layer_1.Input({batchShape:layer.batchInputShape,dtype:layer.dtype,name:layer.name+"_input"});layer.apply(x)}if(isLayerModelInstance)this.outputs=modelLayer.outputs,this.inputs=modelLayer.inputs;else{if(1!==layer.inboundNodes.length)throw new errors_1.ValueError("A layer added to a Sequential model must not already be connected somewhere else. Model received layer "+layer.name+" which has "+layer.inboundNodes.length+" pre-existing inbound connections.");if(1!==layer.inboundNodes[0].outputTensors.length)throw new errors_1.ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(layer),this.outputs=[layer.inboundNodes[0].outputTensors[0]],this.inputs=topology_1.getSourceInputs(this.outputs[0])}this.inboundNodes=[],new topology_1.Node({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:generic_utils.pyListRepeat(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(x){return x.shape}),outputShapes:this.outputs[0].shape})}else{var outputTensor=layer.apply(this.outputs[0]);if(Array.isArray(outputTensor))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(layer),this.outputs=[outputTensor],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(layer),this.built=!1},Sequential.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var lastLayerIndex=this.layers.length-1;this.layers[lastLayerIndex].outboundNodes=[],this.outputs=[this.layers[lastLayerIndex].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},Sequential.prototype.call=function(inputs,kwargs){return null==this.model&&this.build(),this.model.call(inputs,kwargs)},Sequential.prototype.build=function(inputShape){if(types_utils_1.getExactlyOneShape(inputShape),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new training_1.Model({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.model.updatable=this.updatable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},Sequential.prototype.countParams=function(){return this.built||this.build(),_super.prototype.countParams.call(this)},Sequential.prototype.summary=function(lineLength,positions,printFn){void 0===printFn&&(printFn=console.log),this.built||this.build(),_super.prototype.summary.call(this,lineLength,positions,printFn)},Sequential.prototype.setWeights=function(weights){null==this.model&&this.build(),this.model.setWeights(weights)},Object.defineProperty(Sequential.prototype,"updatable",{get:function(){return this._updatable},set:function(value){this.built&&(this.model.updatable=value),this._updatable=value},enumerable:!0,configurable:!0}),Sequential.prototype.evaluate=function(x,y,config){if(void 0===config&&(config={}),!this.built)throw new errors_1.RuntimeError("The model needs to be compiled before being used.");return this.model.evaluate(x,y,config)},Sequential.prototype.evaluateDataset=function(dataset,config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(!this.built)throw new errors_1.RuntimeError("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(dataset,config)]})})},Sequential.prototype.predict=function(x,config){return void 0===config&&(config={}),null==this.model&&this.build(),this.model.predict(x,config)},Sequential.prototype.predictOnBatch=function(x){return null==this.model&&this.build(),this.model.predictOnBatch(x)},Sequential.prototype.compile=function(config){this.build(),this.model.compile(config),this.optimizer=this.model.optimizer,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Sequential.prototype.fit=function(x,y,config){return void 0===config&&(config={}),__awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(!this.built)throw new errors_1.RuntimeError("The model needs to be compiled before being used.");return[2,this.model.fit(x,y,config)]})})},Sequential.prototype.fitDataset=function(dataset,config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(!this.built)throw new errors_1.RuntimeError("The model needs to be compiled before being used.");return[2,this.model.fitDataset(dataset,config)]})})},Sequential.fromConfig=function(cls,config){var configArray,extraModelConfig={};if(config instanceof Array){if(null==config[0].className||"Merge"===config[0].className)throw new errors_1.ValueError("Legacy serialization format not supported yet.");configArray=config}else tfjs_core_1.util.assert(null!=config.layers,"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),configArray=config.layers,delete config.layers,extraModelConfig=config;var model=new cls(extraModelConfig);if(!(model instanceof Sequential))throw new errors_1.NotImplementedError("Sequential.fromConfig called on non-Sequential input: "+model);for(var _i=0,configArray_1=configArray;_i<configArray_1.length;_i++){var conf=configArray_1[_i],layer=serialization_1.deserialize(conf);model.add(layer)}return model},Object.defineProperty(Sequential.prototype,"stopTraining",{set:function(stop){this.model.stopTraining=stop},enumerable:!0,configurable:!0}),Sequential.prototype.getConfig=function(){for(var config=[],_i=0,_a=this.layers;_i<_a.length;_i++){var layer=_a[_i];config.push({className:layer.getClassName(),config:layer.getConfig()})}return config},Sequential.className="Sequential",Sequential}(training_1.Model);exports.Sequential=Sequential,tfjs_core_1.serialization.registerClass(Sequential)},{"./backend/state":215,"./engine/input_layer":223,"./engine/topology":224,"./engine/training":225,"./errors":228,"./layers/serialization":248,"./utils/generic_utils":257,"./utils/serialization_utils":260,"./utils/types_utils":261,"@tensorflow/tfjs-core":62}],254:[function(require,module,exports){"use strict";function getOptimizer(identifier){var optimizerMap={Adagrad:function(){return tfjs_core_1.train.adagrad(.01)},Adadelta:function(){return tfjs_core_1.train.adadelta(1,.95,common_1.epsilon())},Adam:function(){return tfjs_core_1.train.adam(.001,.9,.999,common_1.epsilon())},Adamax:function(){return tfjs_core_1.train.adamax(.002,.9,.999,common_1.epsilon(),0)},RMSProp:function(){return tfjs_core_1.train.rmsprop(.001,.9,0,common_1.epsilon())},SGD:function(){return tfjs_core_1.train.sgd(.01)}};if(optimizerMap.adagrad=optimizerMap.Adagrad,optimizerMap.adadelta=optimizerMap.Adadelta,optimizerMap.adam=optimizerMap.Adam,optimizerMap.adamax=optimizerMap.Adamax,optimizerMap.rmsprop=optimizerMap.RMSProp,optimizerMap.sgd=optimizerMap.SGD,identifier in optimizerMap)return optimizerMap[identifier]();throw new errors_1.ValueError("Unknown Optimizer "+identifier)}Object.defineProperty(exports,"__esModule",{value:!0});var tfjs_core_1=require("@tensorflow/tfjs-core"),common_1=require("./backend/common"),errors_1=require("./errors");exports.getOptimizer=getOptimizer},{"./backend/common":214,"./errors":228,"@tensorflow/tfjs-core":62}],255:[function(require,module,exports){"use strict";function l1(config){return new L1L2({l1:null!=config?config.l1:null,l2:0})}function l2(config){return new L1L2({l2:null!=config?config.l2:null,l1:0})}function serializeRegularizer(constraint){return generic_utils_1.serializeKerasObject(constraint)}function deserializeRegularizer(config,customObjects){return void 0===customObjects&&(customObjects={}),generic_utils_1.deserializeKerasObject(config,tfjs_core_1.serialization.SerializationMap.getMap().classNameMap,customObjects,"regularizer")}function getRegularizer(identifier){if(null==identifier)return null;if("string"==typeof identifier){return deserializeRegularizer({className:identifier in exports.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?exports.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[identifier]:identifier,config:{}})}return identifier instanceof Regularizer?identifier:deserializeRegularizer(identifier)}var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("./backend/state"),K=require("./backend/tfjs_backend"),generic_utils_1=require("./utils/generic_utils"),Regularizer=function(_super){function Regularizer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Regularizer,_super),Regularizer}(tfjs_core_1.serialization.Serializable);exports.Regularizer=Regularizer;var L1L2=function(_super){function L1L2(config){var _this=_super.call(this)||this,l1=null==config||null==config.l1?.01:config.l1,l2=null==config||null==config.l2?.01:config.l2;return _this.hasL1=0!==l1,_this.hasL2=0!==l2,_this.l1=state_1.getScalar(l1),_this.l2=state_1.getScalar(l2),_this}return __extends(L1L2,_super),L1L2.prototype.apply=function(x){var _this=this;return tfjs_core_1.tidy(function(){var regularization=tfjs_core_1.zeros([1]);return _this.hasL1&&(regularization=tfjs_core_1.add(regularization,tfjs_core_1.sum(tfc.mul(_this.l1,tfjs_core_1.abs(x))))),_this.hasL2&&(regularization=tfjs_core_1.add(regularization,tfjs_core_1.sum(tfc.mul(_this.l2,K.square(x))))),regularization.asScalar()})},L1L2.prototype.getConfig=function(){return{l1:this.l1.dataSync()[0],l2:this.l2.dataSync()[0]}},L1L2.fromConfig=function(cls,config){return new cls({l1:config.l1,l2:config.l2})},L1L2.className="L1L2",L1L2}(Regularizer);exports.L1L2=L1L2,tfjs_core_1.serialization.registerClass(L1L2),exports.l1=l1,exports.l2=l2,exports.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={l1l2:"L1L2"},exports.serializeRegularizer=serializeRegularizer,exports.deserializeRegularizer=deserializeRegularizer,exports.getRegularizer=getRegularizer},{"./backend/state":215,"./backend/tfjs_backend":216,"./utils/generic_utils":257,"@tensorflow/tfjs-core":62}],256:[function(require,module,exports){"use strict";function normalizeArray(value,n,name){if("number"==typeof value)return generic_utils_1.pyListRepeat(value,n);if(value.length!==n)throw new errors_1.ValueError("The "+name+" argument must be a tuple of "+n+" integers. Received: "+value.length+" elements.");for(var i=0;i<n;++i){var singleValue=value[i];if(!math_utils_1.isInteger(singleValue))throw new errors_1.ValueError("The "+name+" argument must be a tuple of "+n+" integers. Received: "+JSON.stringify(value)+" including a non-integer number "+singleValue)}return value}function convOutputLength(inputLength,filterSize,padding,stride,dilation){if(void 0===dilation&&(dilation=1),null==inputLength)return inputLength;var outputLength,dilatedFilterSize=filterSize+(filterSize-1)*(dilation-1);return outputLength="same"===padding?inputLength:inputLength-dilatedFilterSize+1,Math.floor((outputLength+stride-1)/stride)}function deconvLength(dimSize,strideSize,kernelSize,padding){if(null==dimSize)return null;if("valid"===padding)dimSize=dimSize*strideSize+math_utils_1.max([kernelSize-strideSize,0]);else{if("same"!==padding)throw new errors_1.ValueError("Unsupport padding mode: "+padding+".");dimSize*=strideSize}return dimSize}Object.defineProperty(exports,"__esModule",{value:!0});var errors_1=require("../errors"),generic_utils_1=require("./generic_utils"),math_utils_1=require("./math_utils");exports.normalizeArray=normalizeArray,exports.convOutputLength=convOutputLength,exports.deconvLength=deconvLength},{"../errors":228,"./generic_utils":257,"./math_utils":259}],257:[function(require,module,exports){"use strict";function pyListRepeat(value,numValues){if(Array.isArray(value)){for(var newArray=[],i=0;i<numValues;i++)newArray=newArray.concat(value);return newArray}var newArray=new Array(numValues);return newArray.fill(value),newArray}function assert(val,message){if(!val)throw new errors_1.AssertionError(message)}function count(array,refernce){for(var counter=0,_i=0,array_1=array;_i<array_1.length;_i++){array_1[_i]===refernce&&counter++}return counter}function singletonOrArray(xs){return 1===xs.length?xs[0]:xs}function toList(x){return Array.isArray(x)?x:[x]}function objectListUid(objs){for(var objectList=toList(objs),retVal="",_i=0,objectList_1=objectList;_i<objectList_1.length;_i++){var obj=objectList_1[_i]
;if(null==obj.id)throw new errors_1.ValueError("Object "+obj+" passed to objectListUid without an id");""!==retVal&&(retVal+=", "),retVal+=Math.abs(obj.id)}return retVal}function toSnakeCase(name){var intermediate=name.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),insecure=intermediate.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==insecure[0]?insecure:"private"+insecure}function toCamelCase(identifier){return identifier.length<=1?identifier:-1===identifier.indexOf("_")?identifier:identifier.replace(/[_]+(\w|$)/g,function(m,p1){return p1.toUpperCase()})}function serializeKerasObject(instance){return null===instance||void 0===instance?null:{className:instance.getClassName(),config:instance.getConfig()}}function deserializeKerasObject(identifier,moduleObjects,customObjects,printableModuleName){if(void 0===moduleObjects&&(moduleObjects={}),void 0===customObjects&&(customObjects={}),void 0===printableModuleName&&(printableModuleName="object"),"string"==typeof identifier){var functionName=identifier,fn=void 0;if(functionName in customObjects)fn=customObjects[functionName];else if(functionName in _GLOBAL_CUSTOM_OBJECTS)fn=_GLOBAL_CUSTOM_OBJECTS[functionName];else if(null==(fn=moduleObjects[functionName]))throw new errors_1.ValueError("Unknown "+printableModuleName+": "+identifier+". This may be due to one of the following reasons:\n1. The "+printableModuleName+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+printableModuleName+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");return fn}var config=identifier;if(null==config.className||null==config.config)throw new errors_1.ValueError(printableModuleName+": Improper config format: "+JSON.stringify(config)+".\n'className' and 'config' must set.");var className=config.className,cls=void 0,fromConfig=void 0;if(className in customObjects?(_a=customObjects.get(className),cls=_a[0],fromConfig=_a[1]):className in _GLOBAL_CUSTOM_OBJECTS?(_b=_GLOBAL_CUSTOM_OBJECTS.className,cls=_b[0],fromConfig=_b[1]):className in moduleObjects&&(_c=moduleObjects[className],cls=_c[0],fromConfig=_c[1]),null==cls)throw new errors_1.ValueError("Unknown "+printableModuleName+": "+className+". This may be due to one of the following reasons:\n1. The "+printableModuleName+" is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom "+printableModuleName+" is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().");if(null!=fromConfig){for(var customObjectsCombined={},_i=0,_d=Object.keys(_GLOBAL_CUSTOM_OBJECTS);_i<_d.length;_i++){var key=_d[_i];customObjectsCombined[key]=_GLOBAL_CUSTOM_OBJECTS[key]}for(var _e=0,_f=Object.keys(customObjects);_e<_f.length;_e++){var key=_f[_e];customObjectsCombined[key]=customObjects[key]}config.config.customObjects=customObjectsCombined;for(var backupCustomObjects=__assign({},_GLOBAL_CUSTOM_OBJECTS),_g=0,_h=Object.keys(customObjects);_g<_h.length;_g++){var key=_h[_g];_GLOBAL_CUSTOM_OBJECTS[key]=customObjects[key]}var returnObj=fromConfig(cls,config.config);return _GLOBAL_CUSTOM_OBJECTS=__assign({},backupCustomObjects),returnObj}for(var backupCustomObjects=__assign({},_GLOBAL_CUSTOM_OBJECTS),_j=0,_k=Object.keys(customObjects);_j<_k.length;_j++){var key=_k[_j];_GLOBAL_CUSTOM_OBJECTS[key]=customObjects[key]}var returnObj=new cls(config.config);return _GLOBAL_CUSTOM_OBJECTS=__assign({},backupCustomObjects),returnObj;var _a,_b,_c}function numberCompare(a,b){return a<b?-1:a>b?1:0}function reverseNumberCompare(a,b){return-1*numberCompare(a,b)}function stringToDType(dtype){switch(dtype){case"float32":return"float32";default:throw new errors_1.ValueError("Invalid dtype: "+dtype)}}function stringsEqual(xs,ys){if(null==xs||null==ys)return xs===ys;if(xs.length!==ys.length)return!1;for(var i=0;i<xs.length;++i)if(xs[i]!==ys[i])return!1;return!0}function unique(xs){if(null==xs)return xs;for(var out=[],_i=0,xs_1=xs;_i<xs_1.length;_i++){var x=xs_1[_i];-1===out.indexOf(x)&&out.push(x)}return out}function isObjectEmpty(obj){if(null==obj)throw new errors_1.ValueError("Invalid value in obj: "+JSON.stringify(obj));for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}function checkStringTypeUnionValue(values,label,value){if(null!=value&&values.indexOf(value)<0)throw new errors_1.ValueError(value+" is not a valid "+label+".  Valid values are "+values+" or null/undefined.")}function checkArrayTypeAndLength(x,expectedType,minLength,maxLength){return void 0===minLength&&(minLength=0),void 0===maxLength&&(maxLength=1/0),assert(minLength>=0),assert(maxLength>=minLength),Array.isArray(x)&&x.length>=minLength&&x.length<=maxLength&&x.every(function(e){return typeof e===expectedType})}var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};Object.defineProperty(exports,"__esModule",{value:!0});var errors_1=require("../errors");exports.pyListRepeat=pyListRepeat,exports.assert=assert,exports.count=count,exports.singletonOrArray=singletonOrArray,exports.toList=toList,exports.objectListUid=objectListUid,exports.toSnakeCase=toSnakeCase,exports.toCamelCase=toCamelCase;var _GLOBAL_CUSTOM_OBJECTS={};exports.serializeKerasObject=serializeKerasObject,exports.deserializeKerasObject=deserializeKerasObject,exports.numberCompare=numberCompare,exports.reverseNumberCompare=reverseNumberCompare,exports.stringToDType=stringToDType,exports.stringsEqual=stringsEqual,exports.unique=unique,exports.isObjectEmpty=isObjectEmpty,exports.checkStringTypeUnionValue=checkStringTypeUnionValue,exports.checkArrayTypeAndLength=checkArrayTypeAndLength},{"../errors":228}],258:[function(require,module,exports){"use strict";function printSummary(model,lineLength,positions,printFn){void 0===printFn&&(printFn=console.log);var sequentialLike=isModelSequentialLike(model),toDisplay=["Layer (type)","Output shape","Param #"];sequentialLike?(lineLength=lineLength||65,positions=positions||[.45,.85,1]):(lineLength=lineLength||98,positions=positions||[.33,.55,.67,1]),positions[positions.length-1]<=1&&(positions=positions.map(function(p){return Math.floor(lineLength*p)}));var relevantNodes;if(!sequentialLike){toDisplay.push("Receives inputs"),relevantNodes=[];for(var depth in model.nodesByDepth)relevantNodes.push.apply(relevantNodes,model.nodesByDepth[depth])}printFn("_".repeat(lineLength)),printRow(toDisplay,positions,printFn),printFn("=".repeat(lineLength));for(var layers=model.layers,i=0;i<layers.length;++i)sequentialLike?printLayerSummary(layers[i],positions,printFn):printLayerSummaryWithConnections(layers[i],positions,relevantNodes,printFn),printFn((i===layers.length-1?"=":"_").repeat(lineLength));model.checkTrainableWeightsConsistency();var trainableCount=countTrainableParams(model),nonTrainableCount=variable_utils_1.countParamsInWeights(model.nonTrainableWeights);printFn("Total params: "+(trainableCount+nonTrainableCount)),printFn("Trainable params: "+trainableCount),printFn("Non-trainable params: "+nonTrainableCount),printFn("_".repeat(lineLength))}function countTrainableParams(model){return null!=model.collectedTrainableWeights?variable_utils_1.countParamsInWeights(model.collectedTrainableWeights):variable_utils_1.countParamsInWeights(model.trainableWeights)}function isModelSequentialLike(model){var sequentialLike=!0,nodesByDepth=[],nodes=[];for(var depth in model.nodesByDepth)nodesByDepth.push(model.nodesByDepth[depth]);for(var _i=0,nodesByDepth_1=nodesByDepth;_i<nodesByDepth_1.length;_i++){var depthNodes=nodesByDepth_1[_i];if(depthNodes.length>1||1===depthNodes.length&&depthNodes[0].inboundLayers.length>1){sequentialLike=!1;break}nodes.push.apply(nodes,depthNodes)}if(sequentialLike)for(var _a=0,_b=model.layers;_a<_b.length;_a++){for(var layer=_b[_a],flag=!1,_c=0,_d=layer.inboundNodes;_c<_d.length;_c++){var node=_d[_c];if(-1!==nodes.indexOf(node)){if(flag){sequentialLike=!1;break}flag=!0}}if(!sequentialLike)break}return sequentialLike}function printRow(fields,positions,printFn){void 0===printFn&&(printFn=console.log);for(var line="",i=0;i<fields.length;++i)i>0&&(line=line.slice(0,line.length-1)+" "),line+=fields[i],line=line.slice(0,positions[i]),line+=" ".repeat(positions[i]-line.length);printFn(line)}function printLayerSummary(layer,positions,printFn){var outputShape;try{outputShape=JSON.stringify(layer.outputShape)}catch(err){outputShape="multiple"}printRow([layer.name+" ("+layer.getClassName()+")",outputShape,layer.countParams().toString()],positions,printFn)}function printLayerSummaryWithConnections(layer,positions,relevantNodes,printFn){var outputShape;try{outputShape=JSON.stringify(layer.outputShape)}catch(err){outputShape="multiple"}for(var connections=[],_i=0,_a=layer.inboundNodes;_i<_a.length;_i++){var node=_a[_i];if(!(null!=relevantNodes&&relevantNodes.length>0&&-1===relevantNodes.indexOf(node)))for(var i=0;i<node.inboundLayers.length;++i){var inboundLayer=node.inboundLayers[i].name,inboundLayerIndex=node.nodeIndices[i],inboundTensorIndex=node.tensorIndices[i];connections.push(inboundLayer+"["+inboundLayerIndex+"]["+inboundTensorIndex+"]")}}var name=layer.name,className=layer.getClassName(),firstConnection=0===connections.length?"":connections[0];printRow([name+" ("+className+")",outputShape,layer.countParams().toString(),firstConnection],positions,printFn);for(var i=1;i<connections.length;++i)printRow(["","","",connections[i]],positions,printFn)}Object.defineProperty(exports,"__esModule",{value:!0});var variable_utils_1=require("./variable_utils");exports.printSummary=printSummary},{"./variable_utils":262}],259:[function(require,module,exports){"use strict";function isInteger(x){return x===parseInt(x.toString(),10)}function arrayProd(array,begin,end){null==begin&&(begin=0),null==end&&(end=array.length);for(var prod=1,i=begin;i<end;++i)prod*=array[i];return prod}function toArray1D(array){return array=Array.isArray(array)?new Float32Array(array):array,tfjs_core_1.tensor1d(array)}function min(array){return tfc.min(toArray1D(array)).dataSync()[0]}function max(array){return tfc.max(toArray1D(array)).dataSync()[0]}function sum(array){return tfc.sum(toArray1D(array)).dataSync()[0]}function mean(array){return sum(array)/array.length}function variance(array){var demeaned=tfc.sub(toArray1D(array),tfjs_core_1.scalar(mean(array)));return tfc.sum(tfc.mulStrict(demeaned,demeaned)).dataSync()[0]/array.length}function median(array){var arraySorted=array.slice().sort(function(a,b){return a-b}),lowIdx=Math.floor((arraySorted.length-1)/2),highIdx=Math.ceil((arraySorted.length-1)/2);return lowIdx===highIdx?arraySorted[lowIdx]:(arraySorted[lowIdx]+arraySorted[highIdx])/2}function range(begin,end){if(end<begin)throw new errors_1.ValueError("end ("+end+") < begin ("+begin+") is forbidden.");for(var out=[],i=begin;i<end;++i)out.push(i);return out}Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),errors_1=require("../errors");exports.isInteger=isInteger,exports.arrayProd=arrayProd,exports.min=min,exports.max=max,exports.sum=sum,exports.mean=mean,exports.variance=variance,exports.median=median,exports.range=range},{"../errors":228,"@tensorflow/tfjs-core":62}],260:[function(require,module,exports){"use strict";function isArrayItemInputOrOutputName(key,index,value){return("inboundNodes"===key||"outputLayers"===key||"inputLayers"===key)&&0===index&&"string"==typeof value}function convertPythonicToTs(pythonicConfig,key){if(null===pythonicConfig)return null;if("string"==typeof pythonicConfig)return generic_utils.toCamelCase(pythonicConfig);if("number"==typeof pythonicConfig||"boolean"==typeof pythonicConfig)return pythonicConfig;if(pythonicConfig instanceof Array){for(var tsArray=[],arrayLength=pythonicConfig.length,i=0;i<arrayLength;++i){var item=pythonicConfig[i];isArrayItemInputOrOutputName(key,i,item)?tsArray.push(item):tsArray.push(convertPythonicToTs(item,key))}return tsArray}for(var tsDict={},_i=0,_a=Object.keys(pythonicConfig);_i<_a.length;_i++){var pythonicKey=_a[_i],pythonicValue=pythonicConfig[pythonicKey];if("name"===pythonicKey&&"string"==typeof pythonicValue)tsDict[pythonicKey]=pythonicValue;else{var tsKey=generic_utils.toCamelCase(pythonicKey);tsDict[tsKey]=convertPythonicToTs(pythonicValue,tsKey)}}return tsDict}function convertTsToPythonic(tsConfig,key){if(null===tsConfig||void 0===tsConfig)return null;if("string"==typeof tsConfig)return generic_utils.toSnakeCase(tsConfig);if("number"==typeof tsConfig||"boolean"==typeof tsConfig)return tsConfig;if(tsConfig instanceof Array){for(var pyArray=[],arrayLength=tsConfig.length,i=0;i<arrayLength;++i){var item=tsConfig[i];isArrayItemInputOrOutputName(key,i,item)?pyArray.push(item):pyArray.push(convertTsToPythonic(item,key))}return pyArray}for(var pyDict={},_i=0,_a=Object.keys(tsConfig);_i<_a.length;_i++){var tsKey=_a[_i],tsValue=tsConfig[tsKey],pyKey=generic_utils.toSnakeCase(tsKey);pyDict[pyKey]="name"!==tsKey&&"className"!==tsKey||"string"!=typeof tsValue?convertTsToPythonic(tsValue,tsKey):tsValue}return pyDict}Object.defineProperty(exports,"__esModule",{value:!0});var generic_utils=require("../utils/generic_utils");exports.convertPythonicToTs=convertPythonicToTs,exports.convertTsToPythonic=convertTsToPythonic},{"../utils/generic_utils":257}],261:[function(require,module,exports){"use strict";function isArrayOfShapes(x){return Array.isArray(x)&&Array.isArray(x[0])}function normalizeShapeList(x){return 0===x.length?[]:Array.isArray(x[0])?x:[x]}function getExactlyOneTensor(xs){var x;if(Array.isArray(xs)){if(1!==xs.length)throw new errors_1.ValueError("Expected Tensor length to be 1; got "+xs.length);x=xs[0]}else x=xs;return x}function getExactlyOneShape(shapes){if(Array.isArray(shapes)&&Array.isArray(shapes[0])){if(1===shapes.length)return shapes=shapes,shapes[0];throw new errors_1.ValueError("Expected exactly 1 Shape; got "+shapes.length)}return shapes}Object.defineProperty(exports,"__esModule",{value:!0});var errors_1=require("../errors");exports.isArrayOfShapes=isArrayOfShapes,exports.normalizeShapeList=normalizeShapeList,exports.getExactlyOneTensor=getExactlyOneTensor,exports.getExactlyOneShape=getExactlyOneShape},{"../errors":228}],262:[function(require,module,exports){"use strict";function countParamsInWeights(weights){for(var count=0,_i=0,weights_1=weights;_i<weights_1.length;_i++){var weight=weights_1[_i];0===weight.shape.length?count+=1:count+=weight.shape.reduce(function(a,b){return a*b})}return count}Object.defineProperty(exports,"__esModule",{value:!0}),exports.countParamsInWeights=countParamsInWeights},{}],263:[function(require,module,exports){"use strict";function checkShapesMatch(x,y){if(x.shape.toString()!==y.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(x.shape)+" vs. "+JSON.stringify(y.shape))}function variable(x,dtype,name,constraint){return new LayerVariable(x,dtype,name,!0,constraint)}function zerosVariable(shape,dtype,name){return new LayerVariable(tfc.zeros(shape),dtype,name)}function zerosLike(x,dtype,name){return new LayerVariable(tfc.zerosLike(x),dtype,name)}function onesVariable(shape,dtype,name){var allocated=tfc.ones(shape);return new LayerVariable(allocated,dtype,name)}function onesLike(x,dtype,name){var allocated=tfc.onesLike(x);return new LayerVariable(allocated,dtype,name)}function eyeVariable(size,dtype,name){return new LayerVariable(tfc.eye(size),dtype,name)}function randomUniformVariable(shape,minval,maxval,dtype,seed,name){return void 0===name&&(name="randomUniform"),new LayerVariable(tfc.randomUniform(shape,minval,maxval,dtype),dtype,name)}function truncatedNormalVariable(shape,mean,stddev,dtype,seed,name){if(void 0===mean&&(mean=0),void 0===stddev&&(stddev=1),void 0===name&&(name="truncatedNormal"),"float32"!==(dtype=dtype||"float32")&&"int32"!==dtype)throw new errors_1.NotImplementedError("randomNormal does not support dType "+dtype+".");return new LayerVariable(tfc.truncatedNormal(shape,mean,stddev,dtype,seed),dtype,name)}function randomNormalVariable(shape,mean,stddev,dtype,seed,name){if(void 0===mean&&(mean=0),void 0===stddev&&(stddev=1),void 0===name&&(name="randomNormal"),"float32"!==(dtype=dtype||"float32")&&"int32"!==dtype)throw new errors_1.NotImplementedError("randomNormalVariable does not support dType "+dtype+".");return new LayerVariable(tfc.randomNormal(shape,mean,stddev,dtype,seed),dtype,name)}function update(x,xNew){return x.write(xNew)}function updateAdd(x,increment){return x.write(tfc.add(x.read(),increment))}function updateSub(x,decrement){return x.write(tfc.sub(x.read(),decrement))}function batchGetValue(xs){return xs.map(function(x){return x.read()})}function batchSetValue(variablesAndValues){variablesAndValues.map(function(variableAndValue){variableAndValue[0].write(variableAndValue[1])})}function gradients(lossFn,variables){var variableList=variables.map(function(variable){return variable.read()}),valudAndGrads=tfjs_core_1.variableGrads(lossFn,variableList);return variables.map(function(variable){return valudAndGrads.grads[variable.name]})}Object.defineProperty(exports,"__esModule",{value:!0});var tfc=require("@tensorflow/tfjs-core"),tfjs_core_1=require("@tensorflow/tfjs-core"),state_1=require("./backend/state"),common_1=require("./common"),errors_1=require("./errors"),DEFAULT_VARIABLE_NAME_PREFIX="Variable",LayerVariable=function(){function LayerVariable(val,dtype,name,trainable,constraint){void 0===dtype&&(dtype="float32"),void 0===name&&(name=DEFAULT_VARIABLE_NAME_PREFIX),void 0===trainable&&(trainable=!0),void 0===constraint&&(constraint=null),this.dtype=null==dtype?"float32":dtype,this.shape=val.shape,this.id=state_1.getNextUniqueTensorId(),name=null==name?DEFAULT_VARIABLE_NAME_PREFIX:name,this.originalName=common_1.getScopedTensorName(name),this.name=common_1.getUniqueTensorName(this.originalName),this.trainable=trainable,this.constraint=constraint,this.val=tfc.variable(val,this.trainable,this.name,this.dtype)}return LayerVariable.prototype.read=function(){return this.assertNotDisposed(),this.val},LayerVariable.prototype.write=function(newVal){return this.assertNotDisposed(),checkShapesMatch(this.val,newVal),this.val.id!==newVal.id&&(this.val.assign(newVal),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},LayerVariable.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},LayerVariable.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},LayerVariable}();exports.LayerVariable=LayerVariable,exports.variable=variable,exports.zerosVariable=zerosVariable,exports.zerosLike=zerosLike,exports.onesVariable=onesVariable,exports.onesLike=onesLike,exports.eyeVariable=eyeVariable,exports.randomUniformVariable=randomUniformVariable,exports.truncatedNormalVariable=truncatedNormalVariable,exports.randomNormalVariable=randomNormalVariable,exports.update=update,exports.updateAdd=updateAdd,exports.updateSub=updateSub,exports.batchGetValue=batchGetValue,exports.batchSetValue=batchSetValue,exports.gradients=gradients},{"./backend/state":215,"./common":219,"./errors":228,"@tensorflow/tfjs-core":62}],264:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.version="0.8.5"},{}],265:[function(require,module,exports){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}Object.defineProperty(exports,"__esModule",{value:!0}),__export(require("@tensorflow/tfjs-core")),__export(require("@tensorflow/tfjs-layers")),__export(require("@tensorflow/tfjs-converter"));var tfjs_core_1=require("@tensorflow/tfjs-core"),tfjs_layers_1=require("@tensorflow/tfjs-layers"),tfjs_converter_1=require("@tensorflow/tfjs-converter"),version_1=require("./version");exports.version={"tfjs-core":tfjs_core_1.version_core,"tfjs-layers":tfjs_layers_1.version_layers,"tfjs-converter":tfjs_converter_1.version_converter,tfjs:version_1.version}},{"./version":266,"@tensorflow/tfjs-converter":19,"@tensorflow/tfjs-core":62,"@tensorflow/tfjs-layers":236}],266:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.version="0.13.5"},{}],267:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tensor_ops_1=require("./tensor_ops");exports.inferShape=tensor_ops_1.inferShape,exports.reshape=tensor_ops_1.reshape,exports.validateFitInputs=tensor_ops_1.validateFitInputs,exports.validateMatrix1D=tensor_ops_1.validateMatrix1D,exports.validateMatrix2D=tensor_ops_1.validateMatrix2D,exports.validateMatrixType=tensor_ops_1.validateMatrixType},{"./tensor_ops":268}],268:[function(require,module,exports){"use strict";function inferShape(X){return tf.tensor(X).shape}function validateMatrixType(X,targetTypes){var flatX=lodash_1.flattenDeep(X),xTypes=lodash_1.uniq(flatX.map(function(x){return typeof x})),sortedXTypes=lodash_1.sortBy(xTypes,function(x){return x}),sortedTargetTypes=lodash_1.sortBy(targetTypes,function(x){return x});if(!lodash_1.isEqual(sortedXTypes,sortedTargetTypes))throw new TypeError("Input matrix type of "+JSON.stringify(sortedXTypes)+" does not match with the target types "+JSON.stringify(sortedTargetTypes))}function validateFitInputs(X,y){if(Array.isArray(X)&&0===X.length||Array.isArray(y)&&0===y.length)throw new Error("Input cannot be an empty array");var sampleShape=validateMatrix2D(X),targetShape=validateMatrix1D(y);if(sampleShape[0]!==targetShape[0])throw new TypeError("Number of labels="+targetShape[0]+" does not math number of samples="+sampleShape[0])}function validateMatrix1D(X){var shape=inferShape(X);if(1!==shape.length||0===shape[0])throw new TypeError("The matrix is not 1D shaped: "+JSON.stringify(X)+" of "+JSON.stringify(shape));return shape}function validateMatrix2D(X){var shape=inferShape(X);if(2!==shape.length)throw new TypeError("The matrix is not 2D shaped: "+JSON.stringify(X)+" of "+JSON.stringify(shape));return shape}function reshape(array,sizes){if(!Array.isArray(array))throw new TypeError("The input array must be an array!");if(!Array.isArray(sizes))throw new TypeError("The sizes must be an array!");var deepFlatArray=lodash_1.flattenDeep(array);if(1===sizes.length&&deepFlatArray.length===sizes[0])return deepFlatArray;if(1===sizes.length&&deepFlatArray.length!==sizes[0])throw new TypeError("Target array shape ["+deepFlatArray.length+"] cannot be reshaped into "+sizes);for(var tmpArray2,tmpArray=deepFlatArray,sizeIndex=sizes.length-1;sizeIndex>0;sizeIndex--){var size=sizes[sizeIndex];tmpArray2=[];for(var length_1=tmpArray.length/size,i=0;i<length_1;i++)tmpArray2.push(tmpArray.slice(i*size,(i+1)*size));tmpArray=tmpArray2}return tmpArray}var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var tf=__importStar(require("@tensorflow/tfjs")),lodash_1=require("lodash");exports.inferShape=inferShape,exports.validateMatrixType=validateMatrixType,exports.validateFitInputs=validateFitInputs,exports.validateMatrix1D=validateMatrix1D,exports.validateMatrix2D=validateMatrix2D,exports.reshape=reshape},{"@tensorflow/tfjs":265,lodash:13}],269:[function(require,module,exports){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var _=__importStar(require("lodash")),ops_1=require("../ops"),MathExtra_1=__importDefault(require("../utils/MathExtra")),Imputer=function(){function Imputer(_a){var _b=_a.missingValues,missingValues=void 0===_b?null:_b,_c=_a.strategy,strategy=void 0===_c?"mean":_c,_d=_a.axis,axis=void 0===_d?0:_d,_e=_a.copy,copy=void 0!==_e&&_e,_this=this;this.calcArrayMean=function(matrix,steps){return _.reduce(steps,function(result,step){switch(step){case"flatten":return _.map(result,_.flatten);case"filter":return _.map(result,function(arr){return _.filter(arr,function(z){return z!==_this.missingValues})});case"mean":return _.map(result,_.mean);default:return result}},matrix)},this.missingValues=missingValues,this.strategy=strategy,this.axis=axis,this.copy=copy,this.means=[]}return Imputer.prototype.fit=function(X){void 0===X&&(X=null),ops_1.validateMatrix2D(X);var _X=this.copy?_.clone(X):X,rowLen=MathExtra_1.default.size(_X,0),colLen=MathExtra_1.default.size(_X,1),rowRange=MathExtra_1.default.range(0,rowLen),colRange=MathExtra_1.default.range(0,colLen);if("mean"!==this.strategy)throw new Error("Unsupported strategy "+this.strategy+" was given");if(0===this.axis){var colNumbers=_.map(colRange,function(col){return MathExtra_1.default.subset(_X,rowRange,[col])});this.means=this.calcArrayMean(colNumbers,["flatten","filter","mean"])}else if(1===this.axis){var rowNumbers=_.map(rowRange,function(row){return _.get(_X,"["+row+"]")});this.means=this.calcArrayMean(rowNumbers,["filter","mean"])}},Imputer.prototype.fit_transform=function(X){void 0===X&&(X=null),ops_1.validateMatrix2D(X);var _X=_.clone(X);if("mean"===this.strategy&&0===this.axis)for(var row=0;row<_.size(_X);row++)for(var col=0;col<_.size(_X[row]);col++){var value=_X[row][col];_X[row][col]=value===this.missingValues?this.means[row]:value}else{if("mean"!==this.strategy||1!==this.axis)throw new Error("Unknown transformation with strategy "+this.strategy+" and axis "+this.axis);for(var row=0;row<_.size(_X);row++)for(var col=0;col<_.size(_X[row]);col++){var value=_X[row][col];_X[row][col]=value===this.missingValues?this.means[col]:value}}return _X},Imputer}();exports.Imputer=Imputer},{"../ops":267,"../utils/MathExtra":272,lodash:13}],270:[function(require,module,exports){"use strict";function add_dummy_feature(X,value){if(void 0===X&&(X=null),void 0===value&&(value=1),Array.isArray(X)&&0===X.length)throw new TypeError("X cannot be empty");ops_1.validateMatrix2D(X);var tensorX=tf.tensor2d(X),_a=__read(tensorX.shape,1),nSamples=_a[0],ones=tf.ones([nSamples,1]),sValue=tf.scalar(value),multipledOnes=tf.mul(ones,sValue),hStacked=tf.concat([multipledOnes,tensorX],1);return ops_1.reshape(Array.from(hStacked.dataSync()),hStacked.shape)}function normalize(X,_a){void 0===X&&(X=null);var _b=(void 0===_a?{norm:"l2"}:_a).norm,norm=void 0===_b?"l2":_b;if(Array.isArray(X)&&0===X.length)throw new TypeError("X cannot be empty");ops_1.validateMatrix2D(X);for(var normalizedMatrix=[],i=0;i<X.length;i++){var row=X[i];normalizedMatrix.push([]);var proportion=0;if("l1"===norm)proportion=row.reduce(function(accum,r){return accum+Math.abs(r)},0);else{if("l2"!==norm)throw new Error(norm+" is not a recognised normalization method");proportion=row.reduce(function(accum,r){return accum+Math.pow(r,2)},0),proportion=Math.sqrt(proportion)}for(var k=0;k<row.length;k++){var value=row[k]/proportion;normalizedMatrix[i].push(value)}}return normalizedMatrix}var __read=this&&this.__read||function(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar},__spread=this&&this.__spread||function(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var tf=__importStar(require("@tensorflow/tfjs")),_=__importStar(require("lodash")),ops_1=require("../ops"),MathExtra_1=__importDefault(require("../utils/MathExtra")),permutations_1=require("../utils/permutations");exports.add_dummy_feature=add_dummy_feature;var OneHotEncoder=function(){function OneHotEncoder(){this.calculateStd=function(lst,mean){var deviations=_.map(lst,function(n){return Math.pow(n-mean,2)});return Math.pow(_.sum(deviations)/(lst.length-1),.5)}}return OneHotEncoder.prototype.encode=function(data,_a){var _this=this;void 0===data&&(data=null);var _b=void 0===_a?{dataKeys:null,labelKeys:null}:_a,_c=_b.dataKeys,dataKeys=void 0===_c?null:_c,_d=_b.labelKeys,labelKeys=void 0===_d?null:_d,decoders=[],_dataKeys=dataKeys||_.keys(data[0]);if(_.size(data)<1)throw Error("data cannot be empty!");_.forEach(_dataKeys,function(dataKey){if(!_.has(data[0],dataKey))throw Error("Cannot find "+dataKey+" from data")}),_.forEach(labelKeys,function(labelKey){if(!_.has(data[0],labelKey))throw Error("Cannot find "+labelKey+" from labels")});var transform=function(keys){return _.zip.apply(_,__spread(_.map(keys,function(key){var standardized=_this.standardizeField(key,data),encoded=_.get(standardized,"encoded"),decode=_.get(standardized,"decode");return encoded&&decode?(decoders.push(decode),encoded):standardized})))},features=transform(_dataKeys),labels=transform(labelKeys);return{data:_.map(_.zip(features,labels),_.flattenDeep),decoders:decoders}},OneHotEncoder.prototype.decode=function(encoded,decoders){var _this=this;return _.map(encoded,function(row){return _this.decodeRow(row,decoders)})},OneHotEncoder.prototype.decodeRow=function(row,decoders){for(var i=0,numFieldsDecoded=0,record={};i<row.length;){var decoder=decoders[numFieldsDecoded++];"string"===decoder.type?record[decoder.key]=function(X,ix,decoder){var data=X.slice(ix,ix+decoder.offset);return decoder.lookupTable[_.indexOf(data,1)]}(row,i,decoder):"number"===decoder.type?record[decoder.key]=function(X,ix,decoder){return decoder.std*X[ix]+decoder.mean}(row,i,decoder):"boolean"===decoder.type?record[decoder.key]=function(X,ix){return!!X[ix]}(row,i):record[decoder.key]=row[i],i+=decoder.offset?decoder.offset:1}return record},OneHotEncoder.prototype.standardizeField=function(key,data){var type=typeof data[0][key],values=_.map(data,key);switch(type){case"string":var result=this.buildStringOneHot(type,key,values);return{decode:result.decode,encoded:result.encoded};case"number":var result=this.buildNumberOneHot(type,key,values);return{decode:result.decode,encoded:result.encoded};case"boolean":var result=this.buildBooleanOneHot(type,key,values);return{decode:result.decode,encoded:result.encoded};default:return values}},OneHotEncoder.prototype.buildNumberOneHot=function(type,key,values){var mean=_.mean(values),std=this.calculateStd(values,mean);return{decode:{type:type,mean:mean,std:std,key:key},encoded:_.map(values,function(value){return(value-mean)/std})}},OneHotEncoder.prototype.buildBooleanOneHot=function(type,key,values){return{decode:{type:type,key:key},encoded:_.map(values,function(value){return value?1:0})}},OneHotEncoder.prototype.buildStringOneHot=function(type,key,values){var lookup={},i=0,lookupTable=_.map(_.uniq(values),function(value){return _.set(lookup,value,i++),value}),encoded=_.map(values,function(value){return _.range(0,i).map(function(pos){return _.get(lookup,value)===pos?1:0})});return{decode:{key:key,lookupTable:lookupTable,offset:encoded[0].length,type:type},encoded:encoded}},OneHotEncoder}();exports.OneHotEncoder=OneHotEncoder;var MinMaxScaler=function(){function MinMaxScaler(_a){var _b=(void 0===_a?{featureRange:[0,1]}:_a).featureRange,featureRange=void 0===_b?[0,1]:_b;this.featureRange=featureRange}return MinMaxScaler.prototype.fit=function(X){
void 0===X&&(X=null);var rowMax=tf.tensor(X),rowMin=tf.tensor(X),xShape=ops_1.inferShape(X);if(0===xShape.length||0===xShape[0])throw new TypeError("Cannot fit with an empty value");2===xShape.length&&(rowMax=tf.max(rowMax,0),rowMin=tf.min(rowMin,0)),this.dataMax=tf.max(rowMax).dataSync()[0],this.dataMin=tf.min(rowMin).dataSync()[0],this.featureMax=this.featureRange[1],this.featureMin=this.featureRange[0],this.dataRange=this.dataMax-this.dataMin,this.scale=(this.featureMax-this.featureMin)/this.dataRange,this.baseMin=this.featureMin-this.dataMin*this.scale},MinMaxScaler.prototype.fit_transform=function(X){return this.fit(X),this.transform(X)},MinMaxScaler.prototype.transform=function(X){var _this=this;void 0===X&&(X=null);var transform_single=function(_X){return _X.map(function(x){return x*_this.scale}).map(function(x){return x+_this.baseMin})},shapes=ops_1.inferShape(X);if(2===shapes.length)return X.map(function(z){return transform_single(z)});if(1===shapes.length)return transform_single(X);throw new TypeError("The input shape "+JSON.stringify(shapes)+" cannot be transformed")},MinMaxScaler.prototype.inverse_transform=function(X){var _this=this;return void 0===X&&(X=null),ops_1.validateMatrix1D(X),X.map(function(x){return x-_this.baseMin}).map(function(x){return x/_this.scale})},MinMaxScaler}();exports.MinMaxScaler=MinMaxScaler;var Binarizer=function(){function Binarizer(_a){var _b=void 0===_a?{copy:!0,threshold:0}:_a,_c=_b.copy,copy=void 0===_c||_c,_d=_b.threshold,threshold=void 0===_d?0:_d;this.threshold=threshold,this.copy=copy}return Binarizer.prototype.fit=function(X){if(void 0===X&&(X=null),Array.isArray(X)&&0===X.length)throw new TypeError("X cannot be empty");ops_1.validateMatrix2D(X),console.info("Currently Bianrizer's fit is designed to do nothing")},Binarizer.prototype.transform=function(X){void 0===X&&(X=null);var _X=this.copy?_.clone(X):X;if(Array.isArray(_X)&&0===_X.length)throw new TypeError("X cannot be empty");ops_1.validateMatrix2D(_X);for(var row=0;row<_.size(X);row++)for(var rowValue=_.get(X,"["+row+"]"),column=0;column<_.size(rowValue);column++){var item=_.get(X,"["+row+"]["+column+"]");if(!_.isNumber(item))throw new Error("Value "+item+" is not a number");_X[row][column]=item<=this.threshold?0:1}return _X},Binarizer}();exports.Binarizer=Binarizer;var PolynomialFeatures=function(){function PolynomialFeatures(_a){var _b=(void 0===_a?{degree:2}:_a).degree,degree=void 0===_b?2:_b;if(!Number.isInteger(degree))throw new Error("Degree must be a number");this.degree=degree}return PolynomialFeatures.prototype.transform=function(X){if(void 0===X&&(X=null),Array.isArray(X)&&0===X.length)throw new TypeError("X cannot be empty");ops_1.validateMatrix2D(X);for(var matrix=tf.tensor2d(X),_a=__read(matrix.shape,2),nSamples=_a[0],nFeatures=_a[1],indexCombination=this.indexCombination(nFeatures,this.degree),nOutputFeatures=indexCombination.length,tfOnes=tf.ones([nSamples,nOutputFeatures]),result=ops_1.reshape(Array.from(tfOnes.dataSync()),tfOnes.shape),rowRange=_.range(0,X.length),i=0;i<indexCombination.length;i++){var c=indexCombination[i],colsRange=Array.isArray(c)?c:[c],srcColValues=null!==c?MathExtra_1.default.subset(X,rowRange,colsRange):[],xc=null;xc=0===srcColValues.length?_.fill(rowRange.slice(),1):tf.tensor2d(srcColValues).prod(1).dataSync(),result=MathExtra_1.default.subset(result,rowRange,[i],xc)}return result},PolynomialFeatures.prototype.indexCombination=function(nFeatures,degree){return _.range(0,degree+1).map(function(i){return permutations_1.combinationsWithReplacement(_.range(nFeatures),i)}).reduce(function(sum,cur){return sum.concat(cur)},[])},PolynomialFeatures}();exports.PolynomialFeatures=PolynomialFeatures,exports.normalize=normalize},{"../ops":267,"../utils/MathExtra":272,"../utils/permutations":273,"@tensorflow/tfjs":265,lodash:13}],271:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var data_1=require("./data");exports.add_dummy_feature=data_1.add_dummy_feature,exports.Binarizer=data_1.Binarizer,exports.MinMaxScaler=data_1.MinMaxScaler,exports.normalize=data_1.normalize,exports.OneHotEncoder=data_1.OneHotEncoder,exports.PolynomialFeatures=data_1.PolynomialFeatures;var Imputer_1=require("./Imputer");exports.Imputer=Imputer_1.Imputer},{"./Imputer":269,"./data":270}],272:[function(require,module,exports){"use strict";var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var _=__importStar(require("lodash")),size=function(X,axis){void 0===axis&&(axis=0);var rows=_.size(X);if(0===rows)throw new Error("Invalid input array of size 0!");if(0===axis)return rows;if(1===axis)return _.flowRight(_.size,function(a){return _.get(a,"[0]")})(X);throw new Error("Invalid axis value "+axis+" was given")},subset=function(X,rowsRange,colsRange,replacement){if(void 0===replacement&&(replacement=null),replacement){for(var _X_1=_.cloneDeep(X),i=0;i<rowsRange.length;i++)!function(i){var rowIndex=rowsRange[i];colsRange.forEach(function(col){_X_1[rowIndex][col]=replacement[i]})}(i);return _X_1}for(var result=[],i=0;i<rowsRange.length;i++)!function(i){var rowIndex=rowsRange[i],subSection=[];colsRange.forEach(function(col){subSection.push(X[rowIndex][col])}),result.push(subSection)}(i);return result},range=function(start,stop){if(!_.isNumber(start)||!_.isNumber(stop))throw new Error("start and stop arguments need to be numbers");return _.range(start,stop)},isMatrixOf=function(matrix,_type){if(void 0===_type&&(_type="number"),!isMatrix(matrix))throw Error("Cannot perform isMatrixOf "+_type+" unless the data is matrix");return-1===matrix.map(function(arr){return arr.some(function(x){if("number"===_type)return!_.isNumber(x);throw Error("Cannot check matrix of an unknown type")})}).indexOf(!0)},isMatrix=function(matrix){return!!Array.isArray(matrix)&&(0!==_.size(matrix)&&-1===matrix.map(function(arr){return _.isArray(arr)}).indexOf(!1))},isArrayOf=function(arr,_type){if(void 0===_type&&(_type="number"),"number"===_type)return!arr.some(isNaN);if("string"===_type)return!arr.some(function(x){return!_.isString(x)});throw Error("Failed to check the array content of type "+_type)},euclideanDistance=function(v1,v2){var v1Range=_.range(0,v1.length),total=_.reduce(v1Range,function(sum,i){return sum+Math.pow(v2[i]-v1[i],2)},0);return Math.sqrt(total)},manhattanDistance=function(v1,v2){var v1Range=_.range(0,v1.length);return _.reduce(v1Range,function(total,i){return total+Math.abs(v2[i]-v1[i])},0)},subtract=function(X,y){for(var _X=_.clone(X),rowIndex=0;rowIndex<_X.length;rowIndex++)for(var row=X[rowIndex],colIndex=0;colIndex<row.length;colIndex++){var column=row[colIndex];if(1===y.length){var subs=y[0];_X[rowIndex][colIndex]=column-subs}else{if(y.length!==row.length)throw Error("Dimension of y "+y.length+" and row "+row.length+" are not compatible");var subs=y[colIndex];_X[rowIndex][colIndex]=column-subs}}return _X},covariance=function(X,xMean,y,yMean){if(_.size(X)!==_.size(y))throw new Error("X and y should match in size");for(var covar=0,i=0;i<_.size(X);i++)covar+=(X[i]-xMean)*(y[i]-yMean);return covar},variance=function(X,mean){if(!Array.isArray(X))throw new Error("X must be an array");for(var result=0,i=0;i<_.size(X);i++)result+=Math.pow(X[i]-mean,2);return result},hstack=function(X,y){var stack=[];if(isMatrix(X)&&isMatrix(y))for(var i=0;i<X.length;i++){var xEntity=X[i],yEntity=y[i];stack.push(hstack(xEntity,yEntity))}else{if(!Array.isArray(X)||!Array.isArray(y))throw Error("Input should be either matrix or Arrays");stack=_.concat(X,y),stack=_.flatten(stack)}return stack},isArrayNumPair=function(a,b){return Array.isArray(a)&&_.isNumber(b)},inner=function(a,b){if(_.isNumber(a)&&_.isNumber(b))return a*b;if(isArrayNumPair(a,b))return a.map(function(x){return x*b});if(isArrayNumPair(b,a))return b.map(function(x){return x*a});if(Array.isArray(a)&&Array.isArray(b)&&a.length===b.length){for(var result=0,i=0;i<a.length;i++)result+=a[i]*b[i];return result}if(Array.isArray(a)&&Array.isArray(b)&&a.length!==b.length)throw new Error("Dimensions ("+a.length+",) and ("+b.length+",) are not aligned");throw new Error("Cannot process with the invalid inputs "+a+" and "+b)},math={covariance:covariance,euclideanDistance:euclideanDistance,hstack:hstack,isArrayOf:isArrayOf,inner:inner,isMatrix:isMatrix,isMatrixOf:isMatrixOf,manhattanDistance:manhattanDistance,range:range,subset:subset,size:size,subtract:subtract,variance:variance};exports.default=math},{lodash:13}],273:[function(require,module,exports){"use strict";function _cartesianProductObj(optObj){var keys=_.keys(optObj),opts=_.values(optObj),combs=_cartesianProductOf(opts);return _.map(combs,function(comb){return _.zipObject(keys,comb)})}function _cartesianProductOf(args){var _args=args;return arguments.length>1&&(_args=_.toArray(arguments)),_args=_.map(_args,function(opt){return"string"==typeof opt?_.toArray(opt):opt}),_.reduce(_args,function(a,b){return _.flatten(_.map(a,function(x){return _.map(b,function(y){return _.concat(x,[y])})}))},[[]])}function product(opts){return 1!==arguments.length||_.isArray(opts)?_cartesianProductOf(1===arguments.length?opts:arguments):_cartesianProductObj(opts)}function combinationsWithReplacement(X,n){var _n=n,_X=X;if("string"==typeof _X&&(_X=_.toArray(_X)),0===_n)return null;if(1===_n)return X;_n=_n||X.length;for(var nInds=[],j=0;j<_n;j++)nInds.push(_.keys(_X));var arrangements=product(nInds).filter(function(pair){return pair[0]<=pair[1]});return _.map(arrangements,function(indices){return _.map(indices,function(i){return _X[i]})})}var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var _=__importStar(require("lodash"));exports.combinationsWithReplacement=combinationsWithReplacement},{lodash:13}],274:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],275:[function(require,module,exports){"use strict";module.exports=require("./src/index-minimal")},{"./src/index-minimal":276}],276:[function(require,module,exports){"use strict";function configure(){protobuf.Reader._configure(protobuf.BufferReader),protobuf.util._configure()}var protobuf=exports;protobuf.build="minimal",protobuf.Writer=require("./writer"),protobuf.BufferWriter=require("./writer_buffer"),protobuf.Reader=require("./reader"),protobuf.BufferReader=require("./reader_buffer"),protobuf.util=require("./util/minimal"),protobuf.rpc=require("./rpc"),protobuf.roots=require("./roots"),protobuf.configure=configure,protobuf.Writer._configure(protobuf.BufferWriter),configure()},{"./reader":277,"./reader_buffer":278,"./roots":279,"./rpc":280,"./util/minimal":283,"./writer":284,"./writer_buffer":285}],277:[function(require,module,exports){"use strict";function indexOutOfRange(reader,writeLength){return RangeError("index out of range: "+reader.pos+" + "+(writeLength||1)+" > "+reader.len)}function Reader(buffer){this.buf=buffer,this.pos=0,this.len=buffer.length}function readLongVarint(){var bits=new LongBits(0,0),i=0;if(!(this.len-this.pos>4)){for(;i<3;++i){if(this.pos>=this.len)throw indexOutOfRange(this);if(bits.lo=(bits.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return bits}return bits.lo=(bits.lo|(127&this.buf[this.pos++])<<7*i)>>>0,bits}for(;i<4;++i)if(bits.lo=(bits.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return bits;if(bits.lo=(bits.lo|(127&this.buf[this.pos])<<28)>>>0,bits.hi=(bits.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return bits;if(i=0,this.len-this.pos>4){for(;i<5;++i)if(bits.hi=(bits.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return bits}else for(;i<5;++i){if(this.pos>=this.len)throw indexOutOfRange(this);if(bits.hi=(bits.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return bits}throw Error("invalid varint encoding")}function readFixed32_end(buf,end){return(buf[end-4]|buf[end-3]<<8|buf[end-2]<<16|buf[end-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}module.exports=Reader;var BufferReader,util=require("./util/minimal"),LongBits=util.LongBits,utf8=util.utf8,create_array="undefined"!=typeof Uint8Array?function(buffer){if(buffer instanceof Uint8Array||Array.isArray(buffer))return new Reader(buffer);throw Error("illegal buffer")}:function(buffer){if(Array.isArray(buffer))return new Reader(buffer);throw Error("illegal buffer")};Reader.create=util.Buffer?function(buffer){return(Reader.create=function(buffer){return util.Buffer.isBuffer(buffer)?new BufferReader(buffer):create_array(buffer)})(buffer)}:create_array,Reader.prototype._slice=util.Array.prototype.subarray||util.Array.prototype.slice,Reader.prototype.uint32=function(){var value=4294967295;return function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}}(),Reader.prototype.int32=function(){return 0|this.uint32()},Reader.prototype.sint32=function(){var value=this.uint32();return value>>>1^-(1&value)|0},Reader.prototype.bool=function(){return 0!==this.uint32()},Reader.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var value=util.float.readFloatLE(this.buf,this.pos);return this.pos+=4,value},Reader.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var value=util.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,value},Reader.prototype.bytes=function(){var length=this.uint32(),start=this.pos,end=this.pos+length;if(end>this.len)throw indexOutOfRange(this,length);return this.pos+=length,Array.isArray(this.buf)?this.buf.slice(start,end):start===end?new this.buf.constructor(0):this._slice.call(this.buf,start,end)},Reader.prototype.string=function(){var bytes=this.bytes();return utf8.read(bytes,0,bytes.length)},Reader.prototype.skip=function(length){if("number"==typeof length){if(this.pos+length>this.len)throw indexOutOfRange(this,length);this.pos+=length}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader.prototype.skipType=function(wireType){switch(wireType){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(wireType=7&this.uint32());)this.skipType(wireType);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+wireType+" at offset "+this.pos)}return this},Reader._configure=function(BufferReader_){BufferReader=BufferReader_;var fn=util.Long?"toLong":"toNumber";util.merge(Reader.prototype,{int64:function(){return readLongVarint.call(this)[fn](!1)},uint64:function(){return readLongVarint.call(this)[fn](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[fn](!1)},fixed64:function(){return readFixed64.call(this)[fn](!0)},sfixed64:function(){return readFixed64.call(this)[fn](!1)}})}},{"./util/minimal":283}],278:[function(require,module,exports){"use strict";function BufferReader(buffer){Reader.call(this,buffer)}module.exports=BufferReader;var Reader=require("./reader");(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util=require("./util/minimal");util.Buffer&&(BufferReader.prototype._slice=util.Buffer.prototype.slice),BufferReader.prototype.string=function(){var len=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+len,this.len))}},{"./reader":277,"./util/minimal":283}],279:[function(require,module,exports){"use strict";module.exports={}},{}],280:[function(require,module,exports){"use strict";exports.Service=require("./rpc/service")},{"./rpc/service":281}],281:[function(require,module,exports){"use strict";function Service(rpcImpl,requestDelimited,responseDelimited){if("function"!=typeof rpcImpl)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=rpcImpl,this.requestDelimited=Boolean(requestDelimited),this.responseDelimited=Boolean(responseDelimited)}module.exports=Service;var util=require("../util/minimal");(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function rpcCall(method,requestCtor,responseCtor,request,callback){if(!request)throw TypeError("request must be specified");var self=this;if(!callback)return util.asPromise(rpcCall,self,method,requestCtor,responseCtor,request);if(!self.rpcImpl)return void setTimeout(function(){callback(Error("already ended"))},0);try{return self.rpcImpl(method,requestCtor[self.requestDelimited?"encodeDelimited":"encode"](request).finish(),function(err,response){if(err)return self.emit("error",err,method),callback(err);if(null===response)return void self.end(!0);if(!(response instanceof responseCtor))try{response=responseCtor[self.responseDelimited?"decodeDelimited":"decode"](response)}catch(err){return self.emit("error",err,method),callback(err)}return self.emit("data",response,method),callback(null,response)})}catch(err){return self.emit("error",err,method),void setTimeout(function(){callback(err)},0)}},Service.prototype.end=function(endedByRPC){return this.rpcImpl&&(endedByRPC||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{"../util/minimal":283}],282:[function(require,module,exports){"use strict";function LongBits(lo,hi){this.lo=lo>>>0,this.hi=hi>>>0}module.exports=LongBits;var util=require("../util/minimal"),zero=LongBits.zero=new LongBits(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits.zeroHash="\0\0\0\0\0\0\0\0";LongBits.fromNumber=function(value){if(0===value)return zero;var sign=value<0;sign&&(value=-value);var lo=value>>>0,hi=(value-lo)/4294967296>>>0;return sign&&(hi=~hi>>>0,lo=~lo>>>0,++lo>4294967295&&(lo=0,++hi>4294967295&&(hi=0))),new LongBits(lo,hi)},LongBits.from=function(value){if("number"==typeof value)return LongBits.fromNumber(value);if(util.isString(value)){if(!util.Long)return LongBits.fromNumber(parseInt(value,10));value=util.Long.fromString(value)}return value.low||value.high?new LongBits(value.low>>>0,value.high>>>0):zero},LongBits.prototype.toNumber=function(unsigned){if(!unsigned&&this.hi>>>31){var lo=1+~this.lo>>>0,hi=~this.hi>>>0;return lo||(hi=hi+1>>>0),-(lo+4294967296*hi)}return this.lo+4294967296*this.hi},LongBits.prototype.toLong=function(unsigned){return util.Long?new util.Long(0|this.lo,0|this.hi,Boolean(unsigned)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(unsigned)}};var charCodeAt=String.prototype.charCodeAt;LongBits.fromHash=function(hash){return hash===zeroHash?zero:new LongBits((charCodeAt.call(hash,0)|charCodeAt.call(hash,1)<<8|charCodeAt.call(hash,2)<<16|charCodeAt.call(hash,3)<<24)>>>0,(charCodeAt.call(hash,4)|charCodeAt.call(hash,5)<<8|charCodeAt.call(hash,6)<<16|charCodeAt.call(hash,7)<<24)>>>0)},LongBits.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits.prototype.zzEncode=function(){var mask=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^mask)>>>0,this.lo=(this.lo<<1^mask)>>>0,this},LongBits.prototype.zzDecode=function(){var mask=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^mask)>>>0,this.hi=(this.hi>>>1^mask)>>>0,this},LongBits.prototype.length=function(){var part0=this.lo,part1=(this.lo>>>28|this.hi<<4)>>>0,part2=this.hi>>>24;return 0===part2?0===part1?part0<16384?part0<128?1:2:part0<2097152?3:4:part1<16384?part1<128?5:6:part1<2097152?7:8:part2<128?9:10}},{"../util/minimal":283}],283:[function(require,module,exports){(function(global){"use strict";function merge(dst,src,ifNotSet){for(var keys=Object.keys(src),i=0;i<keys.length;++i)void 0!==dst[keys[i]]&&ifNotSet||(dst[keys[i]]=src[keys[i]]);return dst}function newError(name){function CustomError(message,properties){if(!(this instanceof CustomError))return new CustomError(message,properties);Object.defineProperty(this,"message",{get:function(){return message}}),Error.captureStackTrace?Error.captureStackTrace(this,CustomError):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),properties&&merge(this,properties)}return(CustomError.prototype=Object.create(Error.prototype)).constructor=CustomError,Object.defineProperty(CustomError.prototype,"name",{get:function(){return name}}),CustomError.prototype.toString=function(){return this.name+": "+this.message},CustomError}var util=exports;util.asPromise=require("@protobufjs/aspromise"),util.base64=require("@protobufjs/base64"),util.EventEmitter=require("@protobufjs/eventemitter"),util.float=require("@protobufjs/float"),util.inquire=require("@protobufjs/inquire"),util.utf8=require("@protobufjs/utf8"),util.pool=require("@protobufjs/pool"),util.LongBits=require("./longbits"),util.global="undefined"!=typeof window&&window||void 0!==global&&global||"undefined"!=typeof self&&self||this,util.emptyArray=Object.freeze?Object.freeze([]):[],util.emptyObject=Object.freeze?Object.freeze({}):{},util.isNode=Boolean(util.global.process&&util.global.process.versions&&util.global.process.versions.node),util.isInteger=Number.isInteger||function(value){return"number"==typeof value&&isFinite(value)&&Math.floor(value)===value},util.isString=function(value){return"string"==typeof value||value instanceof String},util.isObject=function(value){return value&&"object"==typeof value},util.isset=util.isSet=function(obj,prop){var value=obj[prop];return!(null==value||!obj.hasOwnProperty(prop))&&("object"!=typeof value||(Array.isArray(value)?value.length:Object.keys(value).length)>0)},util.Buffer=function(){try{var Buffer=util.inquire("buffer").Buffer;return Buffer.prototype.utf8Write?Buffer:null}catch(e){return null}}(),util._Buffer_from=null,util._Buffer_allocUnsafe=null,util.newBuffer=function(sizeOrArray){return"number"==typeof sizeOrArray?util.Buffer?util._Buffer_allocUnsafe(sizeOrArray):new util.Array(sizeOrArray):util.Buffer?util._Buffer_from(sizeOrArray):"undefined"==typeof Uint8Array?sizeOrArray:new Uint8Array(sizeOrArray)},util.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,util.Long=util.global.dcodeIO&&util.global.dcodeIO.Long||util.global.Long||util.inquire("long"),util.key2Re=/^true|false|0|1$/,util.key32Re=/^-?(?:0|[1-9][0-9]*)$/,util.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,util.longToHash=function(value){return value?util.LongBits.from(value).toHash():util.LongBits.zeroHash},util.longFromHash=function(hash,unsigned){var bits=util.LongBits.fromHash(hash);return util.Long?util.Long.fromBits(bits.lo,bits.hi,unsigned):bits.toNumber(Boolean(unsigned))},util.merge=merge,util.lcFirst=function(str){return str.charAt(0).toLowerCase()+str.substring(1)},util.newError=newError,util.ProtocolError=newError("ProtocolError"),util.oneOfGetter=function(fieldNames){for(var fieldMap={},i=0;i<fieldNames.length;++i)fieldMap[fieldNames[i]]=1;return function(){for(var keys=Object.keys(this),i=keys.length-1;i>-1;--i)if(1===fieldMap[keys[i]]&&void 0!==this[keys[i]]&&null!==this[keys[i]])return keys[i]}},util.oneOfSetter=function(fieldNames){return function(name){for(var i=0;i<fieldNames.length;++i)fieldNames[i]!==name&&delete this[fieldNames[i]]}},util.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},util._configure=function(){var Buffer=util.Buffer;if(!Buffer)return void(util._Buffer_from=util._Buffer_allocUnsafe=null);util._Buffer_from=Buffer.from!==Uint8Array.from&&Buffer.from||function(value,encoding){return new Buffer(value,encoding)},util._Buffer_allocUnsafe=Buffer.allocUnsafe||function(size){return new Buffer(size)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./longbits":282,"@protobufjs/aspromise":1,"@protobufjs/base64":2,"@protobufjs/eventemitter":3,"@protobufjs/float":4,"@protobufjs/inquire":5,"@protobufjs/pool":6,"@protobufjs/utf8":7}],284:[function(require,module,exports){"use strict";function Op(fn,len,val){this.fn=fn,this.len=len,this.next=void 0,this.val=val}function noop(){}function State(writer){this.head=writer.head,this.tail=writer.tail,this.len=writer.len,this.next=writer.states}function Writer(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}function writeByte(val,buf,pos){buf[pos]=255&val}function writeVarint32(val,buf,pos){for(;val>127;)buf[pos++]=127&val|128,val>>>=7;buf[pos]=val}function VarintOp(len,val){this.len=len,this.next=void 0,this.val=val}function writeVarint64(val,buf,pos){for(;val.hi;)buf[pos++]=127&val.lo|128,val.lo=(val.lo>>>7|val.hi<<25)>>>0,val.hi>>>=7;for(;val.lo>127;)buf[pos++]=127&val.lo|128,val.lo=val.lo>>>7;buf[pos++]=val.lo}function writeFixed32(val,buf,pos){buf[pos]=255&val,buf[pos+1]=val>>>8&255,buf[pos+2]=val>>>16&255,buf[pos+3]=val>>>24}module.exports=Writer;var BufferWriter,util=require("./util/minimal"),LongBits=util.LongBits,base64=util.base64,utf8=util.utf8;Writer.create=util.Buffer?function(){return(Writer.create=function(){return new BufferWriter})()}:function(){return new Writer},Writer.alloc=function(size){return new util.Array(size)},util.Array!==Array&&(Writer.alloc=util.pool(Writer.alloc,util.Array.prototype.subarray)),Writer.prototype._push=function(fn,len,val){return this.tail=this.tail.next=new Op(fn,len,val),this.len+=len,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer.prototype.uint32=function(value){return this.len+=(this.tail=this.tail.next=new VarintOp((value>>>=0)<128?1:value<16384?2:value<2097152?3:value<268435456?4:5,value)).len,this},Writer.prototype.int32=function(value){return value<0?this._push(writeVarint64,10,LongBits.fromNumber(value)):this.uint32(value)},Writer.prototype.sint32=function(value){return this.uint32((value<<1^value>>31)>>>0)},Writer.prototype.uint64=function(value){var bits=LongBits.from(value);return this._push(writeVarint64,bits.length(),bits)},Writer.prototype.int64=Writer.prototype.uint64,Writer.prototype.sint64=function(value){var bits=LongBits.from(value).zzEncode();return this._push(writeVarint64,bits.length(),bits)},Writer.prototype.bool=function(value){return this._push(writeByte,1,value?1:0)},Writer.prototype.fixed32=function(value){return this._push(writeFixed32,4,value>>>0)},Writer.prototype.sfixed32=Writer.prototype.fixed32,Writer.prototype.fixed64=function(value){var bits=LongBits.from(value);return this._push(writeFixed32,4,bits.lo)._push(writeFixed32,4,bits.hi)},Writer.prototype.sfixed64=Writer.prototype.fixed64,Writer.prototype.float=function(value){return this._push(util.float.writeFloatLE,4,value)},Writer.prototype.double=function(value){return this._push(util.float.writeDoubleLE,8,value)};var writeBytes=util.Array.prototype.set?function(val,buf,pos){buf.set(val,pos)}:function(val,buf,pos){for(var i=0;i<val.length;++i)buf[pos+i]=val[i]};Writer.prototype.bytes=function(value){var len=value.length>>>0;if(!len)return this._push(writeByte,1,0);if(util.isString(value)){var buf=Writer.alloc(len=base64.length(value));base64.decode(value,buf,0),value=buf}return this.uint32(len)._push(writeBytes,len,value)},Writer.prototype.string=function(value){var len=utf8.length(value);return len?this.uint32(len)._push(utf8.write,len,value):this._push(writeByte,1,0)},Writer.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer.prototype.ldelim=function(){var head=this.head,tail=this.tail,len=this.len;return this.reset().uint32(len),len&&(this.tail.next=head.next,this.tail=tail,this.len+=len),this},Writer.prototype.finish=function(){for(var head=this.head.next,buf=this.constructor.alloc(this.len),pos=0;head;)head.fn(head.val,buf,pos),pos+=head.len,head=head.next;return buf},Writer._configure=function(BufferWriter_){BufferWriter=BufferWriter_}},{"./util/minimal":283}],285:[function(require,module,exports){"use strict";function BufferWriter(){Writer.call(this)}function writeStringBuffer(val,buf,pos){val.length<40?util.utf8.write(val,buf,pos):buf.utf8Write(val,pos)}
module.exports=BufferWriter;var Writer=require("./writer");(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util=require("./util/minimal"),Buffer=util.Buffer;BufferWriter.alloc=function(size){return(BufferWriter.alloc=util._Buffer_allocUnsafe)(size)};var writeBytesBuffer=Buffer&&Buffer.prototype instanceof Uint8Array&&"set"===Buffer.prototype.set.name?function(val,buf,pos){buf.set(val,pos)}:function(val,buf,pos){if(val.copy)val.copy(buf,pos,0,val.length);else for(var i=0;i<val.length;)buf[pos++]=val[i++]};BufferWriter.prototype.bytes=function(value){util.isString(value)&&(value=util._Buffer_from(value,"base64"));var len=value.length>>>0;return this.uint32(len),len&&this._push(writeBytesBuffer,len,value),this},BufferWriter.prototype.string=function(value){var len=Buffer.byteLength(value);return this.uint32(len),len&&this._push(writeStringBuffer,len,value),this}},{"./util/minimal":283,"./writer":284}],286:[function(require,module,exports){var alea=require("./lib/alea"),xor128=require("./lib/xor128"),xorwow=require("./lib/xorwow"),xorshift7=require("./lib/xorshift7"),xor4096=require("./lib/xor4096"),tychei=require("./lib/tychei"),sr=require("./seedrandom");sr.alea=alea,sr.xor128=xor128,sr.xorwow=xorwow,sr.xorshift7=xorshift7,sr.xor4096=xor4096,sr.tychei=tychei,module.exports=sr},{"./lib/alea":287,"./lib/tychei":288,"./lib/xor128":289,"./lib/xor4096":290,"./lib/xorshift7":291,"./lib/xorwow":292,"./seedrandom":293}],287:[function(require,module,exports){!function(global,module,define){function Alea(seed){var me=this,mash=Mash();me.next=function(){var t=2091639*me.s0+2.3283064365386963e-10*me.c;return me.s0=me.s1,me.s1=me.s2,me.s2=t-(me.c=0|t)},me.c=1,me.s0=mash(" "),me.s1=mash(" "),me.s2=mash(" "),me.s0-=mash(seed),me.s0<0&&(me.s0+=1),me.s1-=mash(seed),me.s1<0&&(me.s1+=1),me.s2-=mash(seed),me.s2<0&&(me.s2+=1),mash=null}function copy(f,t){return t.c=f.c,t.s0=f.s0,t.s1=f.s1,t.s2=f.s2,t}function impl(seed,opts){var xg=new Alea(seed),state=opts&&opts.state,prng=xg.next;return prng.int32=function(){return 4294967296*xg.next()|0},prng.double=function(){return prng()+1.1102230246251565e-16*(2097152*prng()|0)},prng.quick=prng,state&&("object"==typeof state&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}function Mash(){var n=4022871197;return function(data){data=data.toString();for(var i=0;i<data.length;i++){n+=data.charCodeAt(i);var h=.02519603282416938*n;n=h>>>0,h-=n,h*=n,n=h>>>0,h-=n,n+=4294967296*h}return 2.3283064365386963e-10*(n>>>0)}}module&&module.exports?module.exports=impl:define&&define.amd?define(function(){return impl}):this.alea=impl}(0,"object"==typeof module&&module,"function"==typeof define&&define)},{}],288:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this,strseed="";me.next=function(){var b=me.b,c=me.c,d=me.d,a=me.a;return b=b<<25^b>>>7^c,c=c-d|0,d=d<<24^d>>>8^a,a=a-b|0,me.b=b=b<<20^b>>>12^c,me.c=c=c-d|0,me.d=d<<16^c>>>16^a,me.a=a-b|0},me.a=0,me.b=0,me.c=-1640531527,me.d=1367130551,seed===Math.floor(seed)?(me.a=seed/4294967296|0,me.b=0|seed):strseed+=seed;for(var k=0;k<strseed.length+20;k++)me.b^=0|strseed.charCodeAt(k),me.next()}function copy(f,t){return t.a=f.a,t.b=f.b,t.c=f.c,t.d=f.d,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&("object"==typeof state&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define(function(){return impl}):this.tychei=impl}(0,"object"==typeof module&&module,"function"==typeof define&&define)},{}],289:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this,strseed="";me.x=0,me.y=0,me.z=0,me.w=0,me.next=function(){var t=me.x^me.x<<11;return me.x=me.y,me.y=me.z,me.z=me.w,me.w^=me.w>>>19^t^t>>>8},seed===(0|seed)?me.x=seed:strseed+=seed;for(var k=0;k<strseed.length+64;k++)me.x^=0|strseed.charCodeAt(k),me.next()}function copy(f,t){return t.x=f.x,t.y=f.y,t.z=f.z,t.w=f.w,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&("object"==typeof state&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define(function(){return impl}):this.xor128=impl}(0,"object"==typeof module&&module,"function"==typeof define&&define)},{}],290:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this;me.next=function(){var t,v,w=me.w,X=me.X,i=me.i;return me.w=w=w+1640531527|0,v=X[i+34&127],t=X[i=i+1&127],v^=v<<13,t^=t<<17,v^=v>>>15,t^=t>>>12,v=X[i]=v^t,me.i=i,v+(w^w>>>16)|0},function(me,seed){var t,v,i,j,w,X=[],limit=128;for(seed===(0|seed)?(v=seed,seed=null):(seed+="\0",v=0,limit=Math.max(limit,seed.length)),i=0,j=-32;j<limit;++j)seed&&(v^=seed.charCodeAt((j+32)%seed.length)),0===j&&(w=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,j>=0&&(w=w+1640531527|0,t=X[127&j]^=v+w,i=0==t?i+1:0);for(i>=128&&(X[127&(seed&&seed.length||0)]=-1),i=127,j=512;j>0;--j)v=X[i+34&127],t=X[i=i+1&127],v^=v<<13,t^=t<<17,v^=v>>>15,t^=t>>>12,X[i]=v^t;me.w=w,me.X=X,me.i=i}(me,seed)}function copy(f,t){return t.i=f.i,t.w=f.w,t.X=f.X.slice(),t}function impl(seed,opts){null==seed&&(seed=+new Date);var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&(state.X&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define(function(){return impl}):this.xor4096=impl}(0,"object"==typeof module&&module,"function"==typeof define&&define)},{}],291:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this;me.next=function(){var t,v,X=me.x,i=me.i;return t=X[i],t^=t>>>7,v=t^t<<24,t=X[i+1&7],v^=t^t>>>10,t=X[i+3&7],v^=t^t>>>3,t=X[i+4&7],v^=t^t<<7,t=X[i+7&7],t^=t<<13,v^=t^t<<9,X[i]=v,me.i=i+1&7,v},function(me,seed){var j,X=[];if(seed===(0|seed))X[0]=seed;else for(seed=""+seed,j=0;j<seed.length;++j)X[7&j]=X[7&j]<<15^seed.charCodeAt(j)+X[j+1&7]<<13;for(;X.length<8;)X.push(0);for(j=0;j<8&&0===X[j];++j);for(8==j?X[7]=-1:X[j],me.x=X,me.i=0,j=256;j>0;--j)me.next()}(me,seed)}function copy(f,t){return t.x=f.x.slice(),t.i=f.i,t}function impl(seed,opts){null==seed&&(seed=+new Date);var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&(state.x&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define(function(){return impl}):this.xorshift7=impl}(0,"object"==typeof module&&module,"function"==typeof define&&define)},{}],292:[function(require,module,exports){!function(global,module,define){function XorGen(seed){var me=this,strseed="";me.next=function(){var t=me.x^me.x>>>2;return me.x=me.y,me.y=me.z,me.z=me.w,me.w=me.v,(me.d=me.d+362437|0)+(me.v=me.v^me.v<<4^t^t<<1)|0},me.x=0,me.y=0,me.z=0,me.w=0,me.v=0,seed===(0|seed)?me.x=seed:strseed+=seed;for(var k=0;k<strseed.length+64;k++)me.x^=0|strseed.charCodeAt(k),k==strseed.length&&(me.d=me.x<<10^me.x>>>4),me.next()}function copy(f,t){return t.x=f.x,t.y=f.y,t.z=f.z,t.w=f.w,t.v=f.v,t.d=f.d,t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};return prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(0===result);return result},prng.int32=xg.next,prng.quick=prng,state&&("object"==typeof state&&copy(state,xg),prng.state=function(){return copy(xg,{})}),prng}module&&module.exports?module.exports=impl:define&&define.amd?define(function(){return impl}):this.xorwow=impl}(0,"object"==typeof module&&module,"function"==typeof define&&define)},{}],293:[function(require,module,exports){!function(pool,math){function seedrandom(seed,options,callback){var key=[];options=1==options?{entropy:!0}:options||{};var shortseed=mixkey(flatten(options.entropy?[seed,tostring(pool)]:null==seed?autoseed():seed,3),key),arc4=new ARC4(key),prng=function(){for(var n=arc4.g(chunks),d=startdenom,x=0;n<significance;)n=(n+x)*width,d*=width,x=arc4.g(1);for(;n>=overflow;)n/=2,d/=2,x>>>=1;return(n+x)/d};return prng.int32=function(){return 0|arc4.g(4)},prng.quick=function(){return arc4.g(4)/4294967296},prng.double=prng,mixkey(tostring(arc4.S),pool),(options.pass||callback||function(prng,seed,is_math_call,state){return state&&(state.S&&copy(state,arc4),prng.state=function(){return copy(arc4,{})}),is_math_call?(math[rngname]=prng,seed):prng})(prng,shortseed,"global"in options?options.global:this==math,options.state)}function ARC4(key){var t,keylen=key.length,me=this,i=0,j=me.i=me.j=0,s=me.S=[];for(keylen||(key=[keylen++]);i<width;)s[i]=i++;for(i=0;i<width;i++)s[i]=s[j=mask&j+key[i%keylen]+(t=s[i])],s[j]=t;(me.g=function(count){for(var t,r=0,i=me.i,j=me.j,s=me.S;count--;)t=s[i=mask&i+1],r=r*width+s[mask&(s[i]=s[j=mask&j+t])+(s[j]=t)];return me.i=i,me.j=j,r})(width)}function copy(f,t){return t.i=f.i,t.j=f.j,t.S=f.S.slice(),t}function flatten(obj,depth){var prop,result=[],typ=typeof obj;if(depth&&"object"==typ)for(prop in obj)try{result.push(flatten(obj[prop],depth-1))}catch(e){}return result.length?result:"string"==typ?obj:obj+"\0"}function mixkey(seed,key){for(var smear,stringseed=seed+"",j=0;j<stringseed.length;)key[mask&j]=mask&(smear^=19*key[mask&j])+stringseed.charCodeAt(j++);return tostring(key)}function autoseed(){try{var out;return nodecrypto&&(out=nodecrypto.randomBytes)?out=out(width):(out=new Uint8Array(width),(global.crypto||global.msCrypto).getRandomValues(out)),tostring(out)}catch(e){var browser=global.navigator,plugins=browser&&browser.plugins;return[+new Date,global,plugins,global.screen,tostring(pool)]}}function tostring(a){return String.fromCharCode.apply(0,a)}var nodecrypto,global=this,width=256,chunks=6,rngname="random",startdenom=math.pow(width,chunks),significance=math.pow(2,52),overflow=2*significance,mask=width-1;if(math["seed"+rngname]=seedrandom,mixkey(math.random(),pool),"object"==typeof module&&module.exports){module.exports=seedrandom;try{nodecrypto=require("crypto")}catch(ex){}}else"function"==typeof define&&define.amd&&define(function(){return seedrandom})}([],Math)},{crypto:9}],294:[function(require,module,exports){(function(setImmediate,clearImmediate){function Timeout(id,clearFn){this._id=id,this._clearFn=clearFn}var nextTick=require("process/browser.js").nextTick,apply=Function.prototype.apply,slice=Array.prototype.slice,immediateIds={},nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId),item._idleTimeout=msecs},exports.unenroll=function(item){clearTimeout(item._idleTimeoutId),item._idleTimeout=-1},exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;msecs>=0&&(item._idleTimeoutId=setTimeout(function(){item._onTimeout&&item._onTimeout()},msecs))},exports.setImmediate="function"==typeof setImmediate?setImmediate:function(fn){var id=nextImmediateId++,args=!(arguments.length<2)&&slice.call(arguments,1);return immediateIds[id]=!0,nextTick(function(){immediateIds[id]&&(args?fn.apply(null,args):fn.call(null),exports.clearImmediate(id))}),id},exports.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":274,timers:294}],295:[function(require,module,exports){"use strict";function shuffle(array){for(var counter=array.length,temp=0,index=0;counter>0;)index=Math.floor(Math.random()*counter),counter--,temp=array[counter],array[counter]=array[index],array[index]=temp}function classifyTwoGaussData(numSamples,noise){function genGauss(cx,cy,label){for(var i=0;i<numSamples/2;i++){var x=normalRandom(cx,variance),y=normalRandom(cy,variance);points.push({x:x,y:y,label:label})}}var points=[],varianceScale=d3.scale.linear().domain([0,.5]).range([.5,4]),variance=varianceScale(noise);return genGauss(2,2,1),genGauss(-2,-2,-1),console.log("points",points),points}function regressPlane(numSamples,noise){for(var labelScale=d3.scale.linear().domain([-10,10]).range([-1,1]),points=[],i=0;i<numSamples;i++){var x=randUniform(-6,6),y=randUniform(-6,6),noiseX=randUniform(-6,6)*noise,noiseY=randUniform(-6,6)*noise,label=function(x,y){return labelScale(x+y)}(x+noiseX,y+noiseY);points.push({x:x,y:y,label:label})}return points}function regressGaussian(numSamples,noise){for(var points=[],labelScale=d3.scale.linear().domain([0,2]).range([1,0]).clamp(!0),gaussians=[[-4,2.5,1],[0,2.5,-1],[4,2.5,1],[-4,-2.5,-1],[0,-2.5,1],[4,-2.5,-1]],i=0;i<numSamples;i++){var x=randUniform(-6,6),y=randUniform(-6,6),noiseX=randUniform(-6,6)*noise,noiseY=randUniform(-6,6)*noise,label=function(x,y){var label=0;return gaussians.forEach(function(_a){var cx=_a[0],cy=_a[1],sign=_a[2],newLabel=sign*labelScale(dist({x:x,y:y},{x:cx,y:cy}));Math.abs(newLabel)>Math.abs(label)&&(label=newLabel)}),label}(x+noiseX,y+noiseY);points.push({x:x,y:y,label:label})}return points}function classifySpiralData(numSamples,noise){function genSpiral(deltaT,label){for(var i=0;i<n;i++){var r=i/n*5,t=1.75*i/n*2*Math.PI+deltaT,x=r*Math.sin(t)+randUniform(-1,1)*noise,y=r*Math.cos(t)+randUniform(-1,1)*noise;points.push({x:x,y:y,label:label})}}var points=[],n=numSamples/2;return genSpiral(0,1),genSpiral(Math.PI,-1),points}function classifyCircleData(numSamples,noise){function getCircleLabel(p,center){return dist(p,center)<.5*radius?1:-1}for(var points=[],radius=5,i=0;i<numSamples/2;i++){var r=randUniform(0,.5*radius),angle=randUniform(0,2*Math.PI),x=r*Math.sin(angle),y=r*Math.cos(angle),noiseX=randUniform(-radius,radius)*noise,noiseY=randUniform(-radius,radius)*noise,label=getCircleLabel({x:x+noiseX,y:y+noiseY},{x:0,y:0});points.push({x:x,y:y,label:label})}for(var i=0;i<numSamples/2;i++){var r=randUniform(.7*radius,radius),angle=randUniform(0,2*Math.PI),x=r*Math.sin(angle),y=r*Math.cos(angle),noiseX=randUniform(-radius,radius)*noise,noiseY=randUniform(-radius,radius)*noise,label=getCircleLabel({x:x+noiseX,y:y+noiseY},{x:0,y:0});points.push({x:x,y:y,label:label})}return points}function classifyXORData(numSamples,noise){for(var points=[],i=0;i<numSamples;i++){var x=randUniform(-5,5);x+=x>0?.3:-.3;var y=randUniform(-5,5);y+=y>0?.3:-.3;var noiseX=randUniform(-5,5)*noise,noiseY=randUniform(-5,5)*noise,label=function(p){return p.x*p.y>=0?1:-1}({x:x+noiseX,y:y+noiseY});points.push({x:x,y:y,label:label})}return points}function randUniform(a,b){return Math.random()*(b-a)+a}function normalRandom(mean,variance){void 0===mean&&(mean=0),void 0===variance&&(variance=1);var v1,v2,s;do{v1=2*Math.random()-1,v2=2*Math.random()-1,s=v1*v1+v2*v2}while(s>1);var result=Math.sqrt(-2*Math.log(s)/s)*v1;return mean+Math.sqrt(variance)*result}function dist(a,b){var dx=a.x-b.x,dy=a.y-b.y;return Math.sqrt(dx*dx+dy*dy)}exports.__esModule=!0;var d3=require("d3");exports.shuffle=shuffle,exports.classifyTwoGaussData=classifyTwoGaussData,exports.regressPlane=regressPlane,exports.regressGaussian=regressGaussian,exports.classifySpiralData=classifySpiralData,exports.classifyCircleData=classifyCircleData,exports.classifyXORData=classifyXORData},{d3:11}],296:[function(require,module,exports){"use strict";function reduceMatrix(matrix,factor){if(matrix.length!==matrix[0].length)throw new Error("The provided matrix must be a square matrix");if(matrix.length%factor!=0)throw new Error("The width/height of the matrix must be divisible by the reduction factor");for(var result=new Array(matrix.length/factor),i=0;i<matrix.length;i+=factor){result[i/factor]=new Array(matrix.length/factor);for(var j=0;j<matrix.length;j+=factor){for(var avg=0,k=0;k<factor;k++)for(var l=0;l<factor;l++)avg+=matrix[i+k][j+l];avg/=factor*factor,result[i/factor][j/factor]=avg}}return result}exports.__esModule=!0;var d3=require("d3"),NUM_SHADES=30,HeatMap=function(){function HeatMap(width,numSamples,xDomain,yDomain,container,userSettings){this.settings={showAxes:!1,noSvg:!1},this.numSamples=numSamples;var height=width,padding=userSettings.showAxes?20:0;if(null!=userSettings)for(var prop in userSettings)this.settings[prop]=userSettings[prop];this.xScale=d3.scale.linear().domain(xDomain).range([0,width-2*padding]),this.yScale=d3.scale.linear().domain(yDomain).range([height-2*padding,0]);var tmpScale=d3.scale.linear().domain([0,.5,1]).range(["#f59322","#e8eaeb","#0877bd"]).clamp(!0),colors=d3.range(0,1+1e-9,1/NUM_SHADES).map(function(a){return tmpScale(a)});if(this.color=d3.scale.quantize().domain([-1,1]).range(colors),container=container.append("div").style({width:width+"px",height:height+"px",position:"relative",top:"-"+padding+"px",left:"-"+padding+"px"}),this.canvas=container.append("canvas").attr("width",numSamples).attr("height",numSamples).style("width",width-2*padding+"px").style("height",height-2*padding+"px").style("position","absolute").style("top",padding+"px").style("left",padding+"px"),this.settings.noSvg||(this.svg=container.append("svg").attr({width:width,height:height}).style({position:"absolute",left:"0",top:"0"}).append("g").attr("transform","translate("+padding+","+padding+")"),this.svg.append("g").attr("class","train"),this.svg.append("g").attr("class","test")),this.settings.showAxes){var xAxis=d3.svg.axis().scale(this.xScale).orient("bottom"),yAxis=d3.svg.axis().scale(this.yScale).orient("right");this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(height-2*padding)+")").call(xAxis),this.svg.append("g").attr("class","y axis").attr("transform","translate("+(width-2*padding)+",0)").call(yAxis)}}return HeatMap.prototype.set_xScale=function(number){this.xScale=number},HeatMap.prototype.set_yScale=function(number){this.yScale=number},HeatMap.prototype.updateTestPoints=function(points){if(this.settings.noSvg)throw Error("Can't add points since noSvg=true");this.updateCircles(this.svg.select("g.test"),points)},HeatMap.prototype.updatePoints=function(points){if(this.settings.noSvg)throw Error("Can't add points since noSvg=true");this.updateCircles(this.svg.select("g.train"),points)},HeatMap.prototype.updateBackground=function(data,discretize){var dx=data[0].length,dy=data.length;if(dx!==this.numSamples||dy!==this.numSamples)throw new Error("The provided data matrix must be of size numSamples X numSamples");for(var context=this.canvas.node().getContext("2d"),image=context.createImageData(dx,dy),y=0,p=-1;y<dy;++y)for(var x=0;x<dx;++x){var value=data[x][y];discretize&&(value=value>=0?1:-1);var c=d3.rgb(this.color(value));image.data[++p]=c.r,image.data[++p]=c.g,image.data[++p]=c.b,image.data[++p]=160}context.putImageData(image,0,0)},HeatMap.prototype.updateCircles=function(container,points){var _this=this,xDomain=this.xScale.domain(),yDomain=this.yScale.domain();points=points.filter(function(p){return p.x>=xDomain[0]&&p.x<=xDomain[1]&&p.y>=yDomain[0]&&p.y<=yDomain[1]});var selection=container.selectAll("circle").data(points);selection.enter().append("circle").attr("r",3),selection.attr({cx:function(d){return _this.xScale(d.x)},cy:function(d){return _this.yScale(d.y)}}).style("fill",function(d){return _this.color(d.label)}),selection.exit().remove()},HeatMap}();exports.HeatMap=HeatMap,exports.reduceMatrix=reduceMatrix},{d3:11}],297:[function(require,module,exports){"use strict";exports.__esModule=!0;var d3=require("d3"),AppendingLineChart=function(){function AppendingLineChart(container,lineColors){this.data=[],this.minY=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE,this.lineColors=lineColors,this.numLines=lineColors.length;var node=container.node(),totalWidth=node.offsetWidth,totalHeight=node.offsetHeight,margin={top:2,right:0,bottom:2,left:2},width=totalWidth-margin.left-margin.right,height=totalHeight-margin.top-margin.bottom;this.xScale=d3.scale.linear().domain([0,0]).range([0,width]),this.yScale=d3.scale.linear().domain([0,0]).range([height,0]),this.svg=container.append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),this.paths=new Array(this.numLines);for(var i=0;i<this.numLines;i++)this.paths[i]=this.svg.append("path").attr("class","line").style({fill:"none",stroke:lineColors[i],"stroke-width":"1.5px"})}return AppendingLineChart.prototype.reset=function(){this.data=[],this.redraw(),this.minY=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE},AppendingLineChart.prototype.addDataPoint=function(dataPoint){var _this=this;if(dataPoint.length!==this.numLines)throw Error("Length of dataPoint must equal number of lines");dataPoint.forEach(function(y){_this.minY=Math.min(_this.minY,y),_this.maxY=Math.max(_this.maxY,y)}),this.data.push({x:this.data.length+1,y:dataPoint}),this.redraw()},AppendingLineChart.prototype.redraw=function(){var _this=this;this.xScale.domain([1,this.data.length]),this.yScale.domain([this.minY,this.maxY]);for(var i=0;i<this.numLines;i++)this.paths[i].datum(this.data).attr("d",function(lineIndex){return d3.svg.line().x(function(d){return _this.xScale(d.x)}).y(function(d){return _this.yScale(d.y[lineIndex])})}(i))},AppendingLineChart}();exports.AppendingLineChart=AppendingLineChart},{d3:11}],298:[function(require,module,exports){"use strict";function buildNetwork(networkShape,activation,outputActivation,regularization,inputIds,initZero){for(var numLayers=networkShape.length,id=1,network=[],layerIdx=0;layerIdx<numLayers;layerIdx++){var isOutputLayer=layerIdx===numLayers-1,isInputLayer=0===layerIdx,currentLayer=[];network.push(currentLayer);for(var numNodes=networkShape[layerIdx],i=0;i<numNodes;i++){var nodeId=id.toString();isInputLayer?nodeId=inputIds[i]:id++;var node=new Node(nodeId,isOutputLayer?outputActivation:activation,initZero);if(currentLayer.push(node),layerIdx>=1)for(var j=0;j<network[layerIdx-1].length;j++){var prevNode=network[layerIdx-1][j],link=new Link(prevNode,node,regularization,initZero);prevNode.outputs.push(link),node.inputLinks.push(link)}}}return network}function forwardProp(network,inputs){var inputLayer=network[0];if(inputs.length!==inputLayer.length)throw new Error("The number of inputs must match the number of nodes in the input layer");for(var i=0;i<inputLayer.length;i++){var node=inputLayer[i];node.output=inputs[i]}for(var layerIdx=1;layerIdx<network.length;layerIdx++)for(var currentLayer=network[layerIdx],i=0;i<currentLayer.length;i++){var node=currentLayer[i];node.updateOutput()}return network[network.length-1][0].output}function backProp(network,target,errorFunc){var outputNode=network[network.length-1][0];outputNode.outputDer=errorFunc.der(outputNode.output,target);for(var layerIdx=network.length-1;layerIdx>=1;layerIdx--){for(var currentLayer=network[layerIdx],i=0;i<currentLayer.length;i++){var node=currentLayer[i];node.inputDer=node.outputDer*node.activation.der(node.totalInput),node.accInputDer+=node.inputDer,node.numAccumulatedDers++}for(var i=0;i<currentLayer.length;i++)for(var node=currentLayer[i],j=0;j<node.inputLinks.length;j++){var link=node.inputLinks[j];link.isDead||(link.errorDer=node.inputDer*link.source.output,link.accErrorDer+=link.errorDer,link.numAccumulatedDers++)}if(1!==layerIdx)for(var prevLayer=network[layerIdx-1],i=0;i<prevLayer.length;i++){var node=prevLayer[i];node.outputDer=0;for(var j=0;j<node.outputs.length;j++){var output=node.outputs[j];node.outputDer+=output.weight*output.dest.inputDer}}}}function updateWeights(network,learningRate,regularizationRate){for(var layerIdx=1;layerIdx<network.length;layerIdx++)for(var currentLayer=network[layerIdx],i=0;i<currentLayer.length;i++){var node=currentLayer[i];node.numAccumulatedDers>0&&(node.bias-=learningRate*node.accInputDer/node.numAccumulatedDers,node.accInputDer=0,node.numAccumulatedDers=0);for(var j=0;j<node.inputLinks.length;j++){var link=node.inputLinks[j];if(!link.isDead){var regulDer=link.regularization?link.regularization.der(link.weight):0;if(link.numAccumulatedDers>0){link.weight=link.weight-learningRate/link.numAccumulatedDers*link.accErrorDer;var newLinkWeight=link.weight-learningRate*regularizationRate*regulDer;link.regularization===RegularizationFunction.L1&&link.weight*newLinkWeight<0?(link.weight=0,link.isDead=!0):link.weight=newLinkWeight,link.accErrorDer=0,link.numAccumulatedDers=0}}}}}function forEachNode(network,ignoreInputs,accessor){for(var layerIdx=ignoreInputs?1:0;layerIdx<network.length;layerIdx++)for(var currentLayer=network[layerIdx],i=0;i<currentLayer.length;i++){var node=currentLayer[i];accessor(node)}}function getOutputNode(network){return network[network.length-1][0]}exports.__esModule=!0;var Node=function(){function Node(id,activation,initZero){this.inputLinks=[],this.bias=.1,this.outputs=[],this.outputDer=0,this.inputDer=0,this.accInputDer=0,this.numAccumulatedDers=0,this.id=id,this.activation=activation,initZero&&(this.bias=0)}return Node.prototype.updateOutput=function(){this.totalInput=this.bias;for(var j=0;j<this.inputLinks.length;j++){var link=this.inputLinks[j];this.totalInput+=link.weight*link.source.output}return this.output=this.activation.output(this.totalInput),this.output},Node}();exports.Node=Node;var Errors=function(){function Errors(){}return Errors.SQUARE={error:function(output,target){return.5*Math.pow(output-target,2)},der:function(output,target){return output-target}},Errors}();exports.Errors=Errors,Math.tanh=Math.tanh||function(x){if(x===1/0)return 1;if(x===-1/0)return-1;var e2x=Math.exp(2*x);return(e2x-1)/(e2x+1)};var Activations=function(){function Activations(){}return Activations.TANH={output:function(x){return Math.tanh(x)},der:function(x){var output=Activations.TANH.output(x);return 1-output*output}},Activations.RELU={output:function(x){return Math.max(0,x)},der:function(x){return x<=0?0:1}},Activations.SIGMOID={output:function(x){return 1/(1+Math.exp(-x))},der:function(x){var output=Activations.SIGMOID.output(x);return output*(1-output)}},Activations.LINEAR={output:function(x){return x},der:function(x){return 1}},Activations}();exports.Activations=Activations;var RegularizationFunction=function(){function RegularizationFunction(){}return RegularizationFunction.L1={output:function(w){return Math.abs(w)},der:function(w){return w<0?-1:w>0?1:0}},RegularizationFunction.L2={output:function(w){return.5*w*w},der:function(w){return w}},RegularizationFunction}();exports.RegularizationFunction=RegularizationFunction;var Link=function(){function Link(source,dest,regularization,initZero){this.weight=Math.random()-.5,this.isDead=!1,this.errorDer=0,this.accErrorDer=0,this.numAccumulatedDers=0,this.id=source.id+"-"+dest.id,this.source=source,this.dest=dest,this.regularization=regularization,initZero&&(this.weight=0)}return Link}();exports.Link=Link,exports.buildNetwork=buildNetwork,exports.forwardProp=forwardProp,exports.backProp=backProp,exports.updateWeights=updateWeights,exports.forEachNode=forEachNode,exports.getOutputNode=getOutputNode},{}],299:[function(require,module,exports){"use strict";function ReadDataSet(evt){var files=evt.target.files,file=files[0];reader.onload=function(event){generateData2(reader.result)},reader.readAsText(file)}function scrollTween(offset){return function(){var i=d3.interpolateNumber(window.pageYOffset||document.documentElement.scrollTop,offset);return function(t){scrollTo(0,i(t))}}}function updateBiasesUI(network){nn.forEachNode(network,!0,function(node){d3.select("rect#bias-"+node.id).style("fill",colorScale(node.bias))})}function updateWeightsUI(network,container){for(var layerIdx=1;layerIdx<network.length;layerIdx++)for(var currentLayer=network[layerIdx],i=0;i<currentLayer.length;i++)for(var node=currentLayer[i],j=0;j<node.inputLinks.length;j++){var link=node.inputLinks[j];container.select("#link"+link.source.id+"-"+link.dest.id).style({"stroke-dashoffset":-iter/3,"stroke-width":linkWidthScale(Math.abs(link.weight)),stroke:colorScale(link.weight)}).datum(link)}}function drawNode(cx,cy,nodeId,isInput,container,node){var x=cx-RECT_SIZE/2,y=cy-RECT_SIZE/2,nodeGroup=container.append("g").attr({class:"node",id:"node"+nodeId,transform:"translate("+x+","+y+")"});nodeGroup.append("rect").attr({x:0,y:0,width:RECT_SIZE,height:RECT_SIZE});var activeOrNotClass=state[nodeId]?"active":"inactive";if(isInput){var label=null!=INPUTS[nodeId].label?INPUTS[nodeId].label:nodeId,text=nodeGroup.append("text").attr({class:"main-label",x:-10,y:RECT_SIZE/2,"text-anchor":"end"});if(/[_^]/.test(label)){for(var myRe=/(.*?)([_^])(.)/g,myArray=void 0,lastIndex=void 0;null!=(myArray=myRe.exec(label));){lastIndex=myRe.lastIndex;var prefix=myArray[1],sep=myArray[2],suffix=myArray[3];prefix&&text.append("tspan").text(prefix),text.append("tspan").attr("baseline-shift","_"===sep?"sub":"super").style("font-size","9px").text(suffix)}label.substring(lastIndex)&&text.append("tspan").text(label.substring(lastIndex))}else text.append("tspan").text(label);nodeGroup.classed(activeOrNotClass,!0)}isInput||nodeGroup.append("rect").attr({id:"bias-"+nodeId,x:-BIAS_SIZE-2,y:RECT_SIZE-BIAS_SIZE+3,width:BIAS_SIZE,height:BIAS_SIZE}).on("mouseenter",function(){updateHoverCard(HoverType.BIAS,node,d3.mouse(container.node()))}).on("mouseleave",function(){updateHoverCard(null)});var div=d3.select("#network").insert("div",":first-child").attr({id:"canvas-"+nodeId,class:"canvas"}).style({position:"absolute",left:x+3+"px",top:y+3+"px"}).on("mouseenter",function(){selectedNodeId=nodeId,div.classed("hovered",!0),nodeGroup.classed("hovered",!0),updateDecisionBoundary(network,!1),heatMap.updateBackground(boundary[nodeId],state.discretize)}).on("mouseleave",function(){selectedNodeId=null,div.classed("hovered",!1),nodeGroup.classed("hovered",!1),updateDecisionBoundary(network,!1),heatMap.updateBackground(boundary[nn.getOutputNode(network).id],state.discretize)});isInput&&(div.on("click",function(){state[nodeId]=!state[nodeId],parametersChanged=!0,reset()}),div.style("cursor","pointer")),isInput&&div.classed(activeOrNotClass,!0);var nodeHeatMap=new heatmap_1.HeatMap(RECT_SIZE,DENSITY/10,xDomain,xDomain,div,{noSvg:!0});div.datum({heatmap:nodeHeatMap,id:nodeId})}function drawNetwork(network){var svg=d3.select("#svg");svg.select("g.core").remove(),d3.select("#network").selectAll("div.canvas").remove(),d3.select("#network").selectAll("div.plus-minus-neurons").remove();var co=d3.select(".column.output").node(),cf=d3.select(".column.features").node(),width=co.offsetLeft-cf.offsetLeft;svg.attr("width",width);var node2coord={},container=svg.append("g").classed("core",!0).attr("transform","translate(3,3)"),numLayers=network.length,layerScale=d3.scale.ordinal().domain(d3.range(1,numLayers-1)).rangePoints([118,width-RECT_SIZE],.7),nodeIndexScale=function(nodeIndex){return nodeIndex*(RECT_SIZE+25)
},calloutThumb=d3.select(".callout.thumbnail").style("display","none"),calloutWeights=d3.select(".callout.weights").style("display","none"),idWithCallout=null,targetIdWithCallout=null,cx=RECT_SIZE/2+50,nodeIds=Object.keys(INPUTS),maxY=nodeIndexScale(nodeIds.length);nodeIds.forEach(function(nodeId,i){var cy=nodeIndexScale(i)+RECT_SIZE/2;node2coord[nodeId]={cx:cx,cy:cy},drawNode(cx,cy,nodeId,!0,container)});for(var layerIdx=1;layerIdx<numLayers-1;layerIdx++){var numNodes=network[layerIdx].length,cx_1=layerScale(layerIdx)+RECT_SIZE/2;maxY=Math.max(maxY,nodeIndexScale(numNodes)),addPlusMinusControl(layerScale(layerIdx),layerIdx);for(var i=0;i<numNodes;i++){var node_1=network[layerIdx][i],cy_1=nodeIndexScale(i)+RECT_SIZE/2;node2coord[node_1.id]={cx:cx_1,cy:cy_1},drawNode(cx_1,cy_1,node_1.id,!1,container,node_1);var numNodes_1=network[layerIdx].length,nextNumNodes=network[layerIdx+1].length;null==idWithCallout&&i===numNodes_1-1&&nextNumNodes<=numNodes_1&&(calloutThumb.style({display:null,top:23+cy_1+"px",left:cx_1+"px"}),idWithCallout=node_1.id);for(var j=0;j<node_1.inputLinks.length;j++){var link=node_1.inputLinks[j],path=drawLink(link,node2coord,network,container,0===j,j,node_1.inputLinks.length).node(),prevLayer=network[layerIdx-1],lastNodePrevLayer=prevLayer[prevLayer.length-1];if(null==targetIdWithCallout&&i===numNodes_1-1&&link.source.id===lastNodePrevLayer.id&&(link.source.id!==idWithCallout||numLayers<=5)&&link.dest.id!==idWithCallout&&prevLayer.length>=numNodes_1){var midPoint=path.getPointAtLength(.7*path.getTotalLength());calloutWeights.style({display:null,top:midPoint.y+5+"px",left:midPoint.x+3+"px"}),targetIdWithCallout=link.dest.id}}}}cx=width+RECT_SIZE/2;var node=network[numLayers-1][0],cy=nodeIndexScale(0)+RECT_SIZE/2;node2coord[node.id]={cx:cx,cy:cy};for(var i=0;i<node.inputLinks.length;i++){var link=node.inputLinks[i];drawLink(link,node2coord,network,container,0===i,i,node.inputLinks.length)}svg.attr("height",maxY);var height=Math.max(getRelativeHeight(calloutThumb),getRelativeHeight(calloutWeights),getRelativeHeight(d3.select("#network")));d3.select(".column.features").style("height",height+"px")}function getRelativeHeight(selection){var node=selection.node();return node.offsetHeight+node.offsetTop}function addPlusMinusControl(x,layerIdx){var div=d3.select("#network").append("div").classed("plus-minus-neurons",!0).style("left",x-10+"px"),i=layerIdx-1,firstRow=div.append("div").attr("class","ui-numNodes"+layerIdx);firstRow.append("button").attr("class","mdl-button mdl-js-button mdl-button--icon").on("click",function(){state.networkShape[i]>=8||(state.networkShape[i]++,parametersChanged=!0,reset())}).append("i").attr("class","material-icons").text("add"),firstRow.append("button").attr("class","mdl-button mdl-js-button mdl-button--icon").on("click",function(){state.networkShape[i]<=1||(state.networkShape[i]--,parametersChanged=!0,reset())}).append("i").attr("class","material-icons").text("remove");var suffix=state.networkShape[i]>1?"s":"";div.append("div").text(state.networkShape[i]+" neuron"+suffix)}function updateHoverCard(type,nodeOrLink,coordinates){var hovercard=d3.select("#hovercard");if(null==type)return hovercard.style("display","none"),void d3.select("#svg").on("click",null);d3.select("#svg").on("click",function(){hovercard.select(".value").style("display","none");var input=hovercard.select("input");input.style("display",null),input.on("input",function(){null!=this.value&&""!==this.value&&(type===HoverType.WEIGHT?nodeOrLink.weight=+this.value:nodeOrLink.bias=+this.value,updateUI())}),input.on("keypress",function(){13===d3.event.keyCode&&updateHoverCard(type,nodeOrLink,coordinates)}),input.node().focus()});var value=type===HoverType.WEIGHT?nodeOrLink.weight:nodeOrLink.bias,name=type===HoverType.WEIGHT?"Weight":"Bias";hovercard.style({left:coordinates[0]+20+"px",top:coordinates[1]+"px",display:"block"}),hovercard.select(".type").text(name),hovercard.select(".value").style("display",null).text(value.toPrecision(2)),hovercard.select("input").property("value",value.toPrecision(2)).style("display","none")}function drawLink(input,node2coord,network,container,isFirst,index,length){var line=container.insert("path",":first-child"),source=node2coord[input.source.id],dest=node2coord[input.dest.id],datum={source:{y:source.cx+RECT_SIZE/2+2,x:source.cy},target:{y:dest.cx-RECT_SIZE/2,x:dest.cy+(index-(length-1)/2)/length*12}},diagonal=d3.svg.diagonal().projection(function(d){return[d.y,d.x]});return line.attr({"marker-start":"url(#markerArrow)",class:"link",id:"link"+input.source.id+"-"+input.dest.id,d:diagonal(datum,0)}),container.append("path").attr("d",diagonal(datum,0)).attr("class","link-hover").on("mouseenter",function(){updateHoverCard(HoverType.WEIGHT,input,d3.mouse(this))}).on("mouseleave",function(){updateHoverCard(null)}),line}function updateDecisionBoundary(network,firstTime){if(firstTime){boundary={},nn.forEachNode(network,!0,function(node){boundary[node.id]=new Array(DENSITY)});for(var nodeId in INPUTS)boundary[nodeId]=new Array(DENSITY)}var xScale=d3.scale.linear().domain([0,DENSITY-1]).range(xDomain),yScale=d3.scale.linear().domain([DENSITY-1,0]).range(xDomain),i=0,j=0;for(i=0;i<DENSITY;i++){if(firstTime){nn.forEachNode(network,!0,function(node){boundary[node.id][i]=new Array(DENSITY)});for(var nodeId in INPUTS)boundary[nodeId][i]=new Array(DENSITY)}for(j=0;j<DENSITY;j++){var x=xScale(i),y=yScale(j),input=constructInput(x,y);if(nn.forwardProp(network,input),nn.forEachNode(network,!0,function(node){boundary[node.id][i][j]=node.output}),firstTime)for(var nodeId in INPUTS)boundary[nodeId][i][j]=INPUTS[nodeId].f(x,y)}}}function getLoss(network,dataPoints){for(var loss=0,i=0;i<dataPoints.length;i++){var dataPoint=dataPoints[i],input=constructInput(dataPoint.x,dataPoint.y),output=nn.forwardProp(network,input);loss+=nn.Errors.SQUARE.error(output,dataPoint.label)}return loss/dataPoints.length}function updateUI(firstStep){function humanReadable(n){return n.toFixed(3)}void 0===firstStep&&(firstStep=!1),updateWeightsUI(network,d3.select("g.core")),updateBiasesUI(network),updateDecisionBoundary(network,firstStep);var selectedId=null!=selectedNodeId?selectedNodeId:nn.getOutputNode(network).id;heatMap.updateBackground(boundary[selectedId],state.discretize),d3.select("#network").selectAll("div.canvas").each(function(data){data.heatmap.updateBackground(heatmap_1.reduceMatrix(boundary[data.id],10),state.discretize)}),d3.select("#loss-train").text(humanReadable(lossTrain)),d3.select("#loss-test").text(humanReadable(lossTest)),d3.select("#iter-number").text(function(s){return s.replace(/\B(?=(\d{3})+(?!\d))/g,",")}(function(n){return("000000"+n).slice(-"000000".length)}(iter))),lineChart.addDataPoint([lossTrain,lossTest])}function constructInputIds(){var result=[];for(var inputName in INPUTS)state[inputName]&&result.push(inputName);return result}function constructInput(x,y){var input=[];for(var inputName in INPUTS)state[inputName]&&input.push(INPUTS[inputName].f(x,y));return input}function oneStep(){iter++,trainData.forEach(function(point,i){var input=constructInput(point.x,point.y);nn.forwardProp(network,input),nn.backProp(network,point.label,nn.Errors.SQUARE),(i+1)%state.batchSize==0&&nn.updateWeights(network,state.learningRate,state.regularizationRate)}),lossTrain=getLoss(network,trainData),lossTest=getLoss(network,testData),updateUI()}function getOutputWeights(network){for(var weights=[],layerIdx=0;layerIdx<network.length-1;layerIdx++)for(var currentLayer=network[layerIdx],i=0;i<currentLayer.length;i++)for(var node=currentLayer[i],j=0;j<node.outputs.length;j++){var output=node.outputs[j];weights.push(output.weight)}return weights}function reset(onStartup){void 0===onStartup&&(onStartup=!1),lineChart.reset(),state.serialize(),onStartup||userHasInteracted(),player.pause();var suffix=1!==state.numHiddenLayers?"s":"";d3.select("#layers-label").text("Hidden layer"+suffix),d3.select("#num-layers").text(state.numHiddenLayers),iter=0;var numInputs=constructInput(0,0).length,shape=[numInputs].concat(state.networkShape).concat([1]),outputActivation=state.problem===state_1.Problem.REGRESSION?nn.Activations.LINEAR:nn.Activations.TANH;network=nn.buildNetwork(shape,state.activation,outputActivation,state.regularization,constructInputIds(),state.initZero),lossTrain=getLoss(network,trainData),lossTest=getLoss(network,testData),drawNetwork(network),updateUI(!0)}function drawDatasetThumbnails(){function renderThumbnail(canvas,dataGenerator){canvas.setAttribute("width",100),canvas.setAttribute("height",100);var context=canvas.getContext("2d");dataGenerator(200,0).forEach(function(d){context.fillStyle=colorScale(d.label),context.fillRect(100*(d.x+6)/12,100*(d.y+6)/12,4,4)}),d3.select(canvas.parentNode).style("display",null)}if(d3.selectAll(".dataset").style("display","none"),state.problem===state_1.Problem.CLASSIFICATION)for(var dataset in state_1.datasets){var canvas=document.querySelector("canvas[data-dataset="+dataset+"]"),dataGenerator=state_1.datasets[dataset];renderThumbnail(canvas,dataGenerator)}if(state.problem===state_1.Problem.REGRESSION)for(var regDataset in state_1.regDatasets){var canvas=document.querySelector("canvas[data-regDataset="+regDataset+"]"),dataGenerator=state_1.regDatasets[regDataset];renderThumbnail(canvas,dataGenerator)}}function generateData2(file){var dataSet2=[];dataSet2=file.match(/[^\r\n]+/g);var new_line=dataSet2[0].split(","),values=new Array,label=new Array;delete dataSet2[0],length=new_line.length;for(var i=0;i<length-1;i++)values.push([]);if(dataSet2.forEach(function(line){for(var new_line=line.split(","),i=0;i<length;i++)0!=i?values[i-1].push(+new_line[i]):label.push(new_line[i])}),console.log("values: ",values),console.log("labels: ",label),length>3){var inputElement=document.getElementById("perplexity"),perplexity=inputElement.value,inputElement2=document.getElementById("learningRateTsne"),learningRateTsne=inputElement2.value,inputElement3=document.getElementById("MaxIterationsTsne"),MaxIterationsTsne=inputElement3.value;console.log("perplexity",perplexity),console.log("learningRateTsne",learningRateTsne),console.log("MaxIterationsTsne",MaxIterationsTsne);for(var opt={epsilon:learningRateTsne,perplexity:perplexity,dim:2},tsne=new tsnejs.tSNE(opt),pca_data=[],i=0;i<label.length;i++){for(var tmp=[],j=0;j<length-1;j++)tmp.push(values[j][i].toFixed(1));pca_data.push(tmp)}tsne.initDataRaw(pca_data);for(var k=0;k<100;k++)tsne.step();var Y=tsne.getSolution();console.log("Y",Y),console.log("tsne",tsne)}var minmaxScaler=new preprocessing_1.MinMaxScaler({featureRange:[-6,6]}),final_values=[];final_values.push(minmaxScaler.fit_transform(values[0])),final_values.push(minmaxScaler.fit_transform(values[1]));for(var Mohd_DataSet=[],i=0;i<label.length;i++){var obj={label:label[i],x:final_values[0][i],y:final_values[1][i]};Mohd_DataSet.push(obj)}Math.seedrandom(state.seed);var numSamples=state.problem===state_1.Problem.REGRESSION?NUM_SAMPLES_REGRESS:NUM_SAMPLES_CLASSIFY,generator=state.problem===state_1.Problem.CLASSIFICATION?state.dataset:state.regDataset,data=generator(numSamples,state.noise/100);dataset_1.shuffle(data);var splitIndex=Math.floor(data.length*state.percTrainData/100);trainData=Mohd_DataSet.slice(0,splitIndex),testData=Mohd_DataSet.slice(splitIndex),heatMap.updatePoints(trainData),heatMap.updateTestPoints(state.showTestData?testData:[])}function generateData(firstTime){void 0===firstTime&&(firstTime=!1),firstTime||(state.seed=Math.random().toFixed(5),state.serialize(),userHasInteracted()),Math.seedrandom(state.seed);var numSamples=state.problem===state_1.Problem.REGRESSION?NUM_SAMPLES_REGRESS:NUM_SAMPLES_CLASSIFY,generator=state.problem===state_1.Problem.CLASSIFICATION?state.dataset:state.regDataset,data=generator(numSamples,state.noise/100);dataset_1.shuffle(data);var splitIndex=Math.floor(data.length*state.percTrainData/100);trainData=data.slice(0,splitIndex),testData=data.slice(splitIndex),heatMap.updatePoints(trainData),heatMap.updateTestPoints(state.showTestData?testData:[])}function userHasInteracted(){if(firstInteraction){firstInteraction=!1;var page="index";null!=state.tutorial&&""!==state.tutorial&&(page="/v/tutorials/"+state.tutorial),ga("set","page",page),ga("send","pageview",{sessionControl:"start"})}}function simulationStarted(){ga("send",{hitType:"event",eventCategory:"Starting Simulation",eventAction:parametersChanged?"changed":"unchanged",eventLabel:null==state.tutorial?"":state.tutorial}),parametersChanged=!1}function setPerplexity(val){console.log(val),document.getElementById("valuePerplexity").innerHTML=val}function setLearningRateTsne(val){console.log(val),document.getElementById("valuelearningRateTsne").innerHTML=val}function setMaxIterationsTsne(val){console.log(val),document.getElementById("valueMaxIterationsTsne").innerHTML=val}exports.__esModule=!0;var mainWidth,preprocessing_1=require("machinelearn/preprocessing"),tsnejs=require("./tsne.js"),nn=require("./nn"),heatmap_1=require("./heatmap"),state_1=require("./state"),dataset_1=require("./dataset"),linechart_1=require("./linechart"),d3=require("d3");console.log("nerual network:",nn),document.getElementById("csvFileInput").addEventListener("change",ReadDataSet,!1);var reader=new FileReader;d3.select(".more button").on("click",function(){d3.transition().duration(1e3).tween("scroll",scrollTween(800))});var HoverType,RECT_SIZE=30,BIAS_SIZE=5,NUM_SAMPLES_CLASSIFY=500,NUM_SAMPLES_REGRESS=1200,DENSITY=100;!function(HoverType){HoverType[HoverType.BIAS=0]="BIAS",HoverType[HoverType.WEIGHT=1]="WEIGHT"}(HoverType||(HoverType={}));var INPUTS={x:{f:function(x,y){return x},label:"X_1"},y:{f:function(x,y){return y},label:"X_2"},xSquared:{f:function(x,y){return x*x},label:"X_1^2"},ySquared:{f:function(x,y){return y*y},label:"X_2^2"},xTimesY:{f:function(x,y){return x*y},label:"X_1X_2"},sinX:{f:function(x,y){return Math.sin(x)},label:"sin(X_1)"},sinY:{f:function(x,y){return Math.sin(y)},label:"sin(X_2)"}},HIDABLE_CONTROLS=[["Show test data","showTestData"],["Discretize output","discretize"],["Play button","playButton"],["Step button","stepButton"],["Reset button","resetButton"],["Learning rate","learningRate"],["Activation","activation"],["Regularization","regularization"],["Regularization rate","regularizationRate"],["Problem type","problem"],["Which dataset","dataset"],["Ratio train data","percTrainData"],["Noise level","noise"],["Batch size","batchSize"],["# of hidden layers","numHiddenLayers"]],Player=function(){function Player(){this.timerIndex=0,this.isPlaying=!1,this.callback=null}return Player.prototype.playOrPause=function(){this.isPlaying?(this.isPlaying=!1,this.pause()):(this.isPlaying=!0,0===iter&&simulationStarted(),this.play())},Player.prototype.onPlayPause=function(callback){this.callback=callback},Player.prototype.play=function(){this.pause(),this.isPlaying=!0,this.callback&&this.callback(this.isPlaying),this.start(this.timerIndex)},Player.prototype.pause=function(){this.timerIndex++,this.isPlaying=!1,this.callback&&this.callback(this.isPlaying)},Player.prototype.start=function(localTimerIndex){var _this=this;d3.timer(function(){return localTimerIndex<_this.timerIndex||(oneStep(),!1)},0)},Player}(),state=state_1.State.deserializeState();state.getHiddenProps().forEach(function(prop){prop in INPUTS&&delete INPUTS[prop]});var boundary={},selectedNodeId=null,xDomain=[-6,6],heatMap=new heatmap_1.HeatMap(300,DENSITY,xDomain,xDomain,d3.select("#heatmap"),{showAxes:!0}),linkWidthScale=d3.scale.linear().domain([0,5]).range([1,10]).clamp(!0),colorScale=d3.scale.linear().domain([-1,0,1]).range(["#f59322","#e8eaeb","#0877bd"]).clamp(!0),iter=0,trainData=[],testData=[],network=null,lossTrain=0,lossTest=0,player=new Player,lineChart=new linechart_1.AppendingLineChart(d3.select("#linechart"),["#777","black"]);exports.getOutputWeights=getOutputWeights;var firstInteraction=!0,parametersChanged=!1;drawDatasetThumbnails(),function(){if(null!=state.tutorial&&""!==state.tutorial&&!state.hideText){d3.selectAll("article div.l--body").remove();var tutorial=d3.select("article").append("div").attr("class","l--body");d3.html("tutorials/"+state.tutorial+".html",function(err,htmlFragment){if(err)throw err;tutorial.node().appendChild(htmlFragment);var title=tutorial.select("title");title.size()&&(d3.select("header h1").style({"margin-top":"20px","margin-bottom":"20px"}).text(title.text()),document.title=title.text())})}}(),function(){d3.select("#reset-button").on("click",function(){reset(),userHasInteracted(),d3.select("#play-pause-button")}),d3.select("#play-pause-button").on("click",function(){userHasInteracted(),player.playOrPause()}),player.onPlayPause(function(isPlaying){d3.select("#play-pause-button").classed("playing",isPlaying)}),d3.select("#next-step-button").on("click",function(){player.pause(),userHasInteracted(),0===iter&&simulationStarted(),oneStep()}),d3.select("#data-regen-button").on("click",function(){generateData(),parametersChanged=!0});var dataThumbnails=d3.selectAll("canvas[data-dataset]");dataThumbnails.on("click",function(){var newDataset=state_1.datasets[this.dataset.dataset];newDataset!==state.dataset&&(state.dataset=newDataset,dataThumbnails.classed("selected",!1),d3.select(this).classed("selected",!0),generateData(),parametersChanged=!0,reset())});var datasetKey=state_1.getKeyFromValue(state_1.datasets,state.dataset);d3.select("canvas[data-dataset="+datasetKey+"]").classed("selected",!0);var regDataThumbnails=d3.selectAll("canvas[data-regDataset]");regDataThumbnails.on("click",function(){var newDataset=state_1.regDatasets[this.dataset.regdataset];newDataset!==state.regDataset&&(state.regDataset=newDataset,regDataThumbnails.classed("selected",!1),d3.select(this).classed("selected",!0),generateData(),parametersChanged=!0,reset())});var regDatasetKey=state_1.getKeyFromValue(state_1.regDatasets,state.regDataset);d3.select("canvas[data-regDataset="+regDatasetKey+"]").classed("selected",!0),d3.select("#add-layers").on("click",function(){state.numHiddenLayers>=6||(state.networkShape[state.numHiddenLayers]=2,state.numHiddenLayers++,parametersChanged=!0,reset())}),d3.select("#remove-layers").on("click",function(){state.numHiddenLayers<=0||(state.numHiddenLayers--,state.networkShape.splice(state.numHiddenLayers),parametersChanged=!0,reset())}),d3.select("#show-test-data").on("change",function(){state.showTestData=this.checked,state.serialize(),userHasInteracted(),heatMap.updateTestPoints(state.showTestData?testData:[])}).property("checked",state.showTestData),d3.select("#discretize").on("change",function(){state.discretize=this.checked,state.serialize(),userHasInteracted(),updateUI()}).property("checked",state.discretize),d3.select("#percTrainData").on("input",function(){state.percTrainData=this.value,d3.select("label[for='percTrainData'] .value").text(this.value),generateData(),parametersChanged=!0,reset()}).property("value",state.percTrainData),d3.select("label[for='percTrainData'] .value").text(state.percTrainData);var noise=d3.select("#noise").on("input",function(){state.noise=this.value,d3.select("label[for='noise'] .value").text(this.value),generateData(),parametersChanged=!0,reset()}),currentMax=parseInt(noise.property("max"));state.noise>currentMax?state.noise<=80?noise.property("max",state.noise):state.noise=50:state.noise<0&&(state.noise=0),noise.property("value",state.noise),d3.select("label[for='noise'] .value").text(state.noise),d3.select("#batchSize").on("input",function(){state.batchSize=this.value,d3.select("label[for='batchSize'] .value").text(this.value),parametersChanged=!0,reset()}).property("value",state.batchSize),d3.select("label[for='batchSize'] .value").text(state.batchSize),d3.select("#activations").on("change",function(){state.activation=state_1.activations[this.value],parametersChanged=!0,reset()}).property("value",state_1.getKeyFromValue(state_1.activations,state.activation)),d3.select("#learningRate").on("change",function(){state.learningRate=+this.value,state.serialize(),userHasInteracted(),parametersChanged=!0}).property("value",state.learningRate),d3.select("#regularizations").on("change",function(){state.regularization=state_1.regularizations[this.value],parametersChanged=!0,reset()}).property("value",state_1.getKeyFromValue(state_1.regularizations,state.regularization)),d3.select("#regularRate").on("change",function(){state.regularizationRate=+this.value,parametersChanged=!0,reset()}).property("value",state.regularizationRate),d3.select("#problem").on("change",function(){state.problem=state_1.problems[this.value],generateData(),drawDatasetThumbnails(),parametersChanged=!0,reset()}).property("value",state_1.getKeyFromValue(state_1.problems,state.problem));var x=d3.scale.linear().domain([-1,1]).range([0,144]),xAxis=d3.svg.axis().scale(x).orient("bottom").tickValues([-1,0,1]).tickFormat(d3.format("d"));d3.select("#colormap g.core").append("g").attr("class","x axis").attr("transform","translate(0,10)").call(xAxis),window.addEventListener("resize",function(){var newWidth=document.querySelector("#main-part").getBoundingClientRect().width;newWidth!==mainWidth&&(mainWidth=newWidth,drawNetwork(network),updateUI(!0))}),state.hideText&&(d3.select("#article-text").style("display","none"),d3.select("div.more").style("display","none"),d3.select("header").style("display","none"))}(),generateData(!0),reset(!0),function(){var hiddenProps=state.getHiddenProps();hiddenProps.forEach(function(prop){var controls=d3.selectAll(".ui-"+prop);0===controls.size()&&console.warn("0 html elements found with class .ui-"+prop),controls.style("display","none")});var hideControls=d3.select(".hide-controls");HIDABLE_CONTROLS.forEach(function(_a){var text=_a[0],id=_a[1],label=hideControls.append("label").attr("class","mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"),input=label.append("input").attr({type:"checkbox",class:"mdl-checkbox__input"});-1===hiddenProps.indexOf(id)&&input.attr("checked","true"),input.on("change",function(){state.setHideProperty(id,!this.checked),state.serialize(),userHasInteracted(),d3.select(".hide-controls-link").attr("href",window.location.href)}),label.append("span").attr("class","mdl-checkbox__label label").text(text)}),d3.select(".hide-controls-link").attr("href",window.location.href)}();var btn_perplexity=document.getElementById("perplexity"),inputElement4=document.getElementById("perplexity");btn_perplexity.addEventListener("change",function(e){return setPerplexity(inputElement4.value)});var btn_learningRateTsne=document.getElementById("learningRateTsne"),inputElement5=document.getElementById("learningRateTsne");btn_learningRateTsne.addEventListener("change",function(e){return setLearningRateTsne(inputElement5.value)});var btn_MaxIterationsTsne=document.getElementById("MaxIterationsTsne"),inputElement6=document.getElementById("MaxIterationsTsne");btn_MaxIterationsTsne.addEventListener("change",function(e){return setMaxIterationsTsne(inputElement6.value)})},{"./dataset":295,"./heatmap":296,"./linechart":297,"./nn":298,"./state":300,"./tsne.js":301,d3:11,"machinelearn/preprocessing":271}],300:[function(require,module,exports){"use strict";function getKeyFromValue(obj,value){for(var key in obj)if(obj[key]===value)return key}function endsWith(s,suffix){return s.substr(-suffix.length)===suffix}function getHideProps(obj){var result=[];for(var prop in obj)endsWith(prop,HIDE_STATE_SUFFIX)&&result.push(prop);return result}exports.__esModule=!0;var nn=require("./nn"),dataset=require("./dataset"),HIDE_STATE_SUFFIX="_hide";exports.activations={relu:nn.Activations.RELU,tanh:nn.Activations.TANH,sigmoid:nn.Activations.SIGMOID,linear:nn.Activations.LINEAR},exports.regularizations={none:null,L1:nn.RegularizationFunction.L1,L2:nn.RegularizationFunction.L2},exports.datasets={circle:dataset.classifyCircleData,xor:dataset.classifyXORData,gauss:dataset.classifyTwoGaussData,spiral:dataset.classifySpiralData},exports.regDatasets={"reg-plane":dataset.regressPlane,"reg-gauss":dataset.regressGaussian},exports.getKeyFromValue=getKeyFromValue;var Type;!function(Type){Type[Type.STRING=0]="STRING",Type[Type.NUMBER=1]="NUMBER",Type[Type.ARRAY_NUMBER=2]="ARRAY_NUMBER",Type[Type.ARRAY_STRING=3]="ARRAY_STRING",Type[Type.BOOLEAN=4]="BOOLEAN",Type[Type.OBJECT=5]="OBJECT"}(Type=exports.Type||(exports.Type={}));var Problem;!function(Problem){Problem[Problem.CLASSIFICATION=0]="CLASSIFICATION",Problem[Problem.REGRESSION=1]="REGRESSION"}(Problem=exports.Problem||(exports.Problem={})),exports.problems={classification:Problem.CLASSIFICATION,regression:Problem.REGRESSION};var State=function(){function State(){this.learningRate=.03,this.regularizationRate=0,this.showTestData=!1,this.noise=0,this.batchSize=10,this.discretize=!1,this.tutorial=null,this.percTrainData=50,this.activation=nn.Activations.TANH,this.regularization=null,this.problem=Problem.CLASSIFICATION,this.initZero=!1,this.hideText=!1,this.collectStats=!1,this.numHiddenLayers=1,this.hiddenLayerControls=[],this.networkShape=[4,2],this.x=!0,this.y=!0,this.xTimesY=!1,this.xSquared=!1,this.ySquared=!1,this.cosX=!1,this.sinX=!1,this.cosY=!1,this.sinY=!1,this.dataset=dataset.classifyCircleData,this.regDataset=dataset.regressPlane}return State.deserializeState=function(){function hasKey(name){return name in map&&null!=map[name]&&""!==map[name].trim()}function parseArray(value){return""===value.trim()?[]:value.split(",")}for(var map={},_i=0,_a=window.location.hash.slice(1).split("&");_i<_a.length;_i++){var keyvalue=_a[_i],_b=keyvalue.split("="),name_1=_b[0],value=_b[1];map[name_1]=value}var state=new State;return State.PROPS.forEach(function(_a){var name=_a.name,type=_a.type,keyMap=_a.keyMap;switch(type){case Type.OBJECT:if(null==keyMap)throw Error("A key-value map must be provided for state variables of type Object");hasKey(name)&&map[name]in keyMap&&(state[name]=keyMap[map[name]]);break;case Type.NUMBER:hasKey(name)&&(state[name]=+map[name]);break;case Type.STRING:hasKey(name)&&(state[name]=map[name]);break;case Type.BOOLEAN:hasKey(name)&&(state[name]="false"!==map[name]);break;case Type.ARRAY_NUMBER:name in map&&(state[name]=parseArray(map[name]).map(Number));break;case Type.ARRAY_STRING:name in map&&(state[name]=parseArray(map[name]));break;default:throw Error("Encountered an unknown type for a state variable")}}),getHideProps(map).forEach(function(prop){state[prop]="true"===map[prop]}),state.numHiddenLayers=state.networkShape.length,null==state.seed&&(state.seed=Math.random().toFixed(5)),Math.seedrandom(state.seed),state},State.prototype.serialize=function(){var _this=this,props=[];State.PROPS.forEach(function(_a){var name=_a.name,type=_a.type,keyMap=_a.keyMap,value=_this[name];null!=value&&(type===Type.OBJECT?value=getKeyFromValue(keyMap,value):type!==Type.ARRAY_NUMBER&&type!==Type.ARRAY_STRING||(value=value.join(",")),props.push(name+"="+value))}),getHideProps(this).forEach(function(prop){props.push(prop+"="+_this[prop])}),window.location.hash=props.join("&")},State.prototype.getHiddenProps=function(){var result=[];for(var prop in this)endsWith(prop,HIDE_STATE_SUFFIX)&&"true"===String(this[prop])&&result.push(prop.replace(HIDE_STATE_SUFFIX,""));return result},State.prototype.setHideProperty=function(name,hidden){this[name+HIDE_STATE_SUFFIX]=hidden},State.PROPS=[{name:"activation",type:Type.OBJECT,keyMap:exports.activations},{name:"regularization",type:Type.OBJECT,keyMap:exports.regularizations},{name:"batchSize",type:Type.NUMBER},{name:"dataset",type:Type.OBJECT,keyMap:exports.datasets},{name:"regDataset",type:Type.OBJECT,keyMap:exports.regDatasets},{name:"learningRate",type:Type.NUMBER},{name:"regularizationRate",type:Type.NUMBER},{name:"noise",type:Type.NUMBER},{name:"networkShape",type:Type.ARRAY_NUMBER},{name:"seed",type:Type.STRING},{name:"showTestData",type:Type.BOOLEAN},{name:"discretize",type:Type.BOOLEAN},{name:"percTrainData",type:Type.NUMBER},{name:"x",type:Type.BOOLEAN},{name:"y",type:Type.BOOLEAN},{name:"xTimesY",type:Type.BOOLEAN},{name:"xSquared",type:Type.BOOLEAN},{name:"ySquared",type:Type.BOOLEAN},{name:"cosX",type:Type.BOOLEAN},{name:"sinX",type:Type.BOOLEAN},{name:"cosY",type:Type.BOOLEAN},{name:"sinY",type:Type.BOOLEAN},{name:"collectStats",type:Type.BOOLEAN},{name:"tutorial",type:Type.STRING},{name:"problem",type:Type.OBJECT,keyMap:exports.problems},{name:"initZero",type:Type.BOOLEAN},{name:"hideText",type:Type.BOOLEAN}],State}();exports.State=State},{"./dataset":295,"./nn":298}],301:[function(require,module,exports){var tsnejs=tsnejs||{REVISION:"ALPHA"};!function(global){"use strict";function sign(x){return x>0?1:x<0?-1:0}var assert=function(condition,message){if(!condition)throw message||"Assertion failed"},getopt=function(opt,field,defaultval){return opt.hasOwnProperty(field)?opt[field]:defaultval},return_v=!1,v_val=0,gaussRandom=function(){if(return_v)return return_v=!1,v_val;var u=2*Math.random()-1,v=2*Math.random()-1,r=u*u+v*v;if(0==r||r>1)return gaussRandom();var c=Math.sqrt(-2*Math.log(r)/r);return v_val=v*c,return_v=!0,u*c},randn=function(mu,std){return mu+gaussRandom()*std},zeros=function(n){if(void 0===n||isNaN(n))return[];if("undefined"==typeof ArrayBuffer){for(var arr=new Array(n),i=0;i<n;i++)arr[i]=0;return arr}return new Float64Array(n)},randn2d=function(n,d,s){for(var uses=void 0!==s,x=[],i=0;i<n;i++){for(var xhere=[],j=0;j<d;j++)uses?xhere.push(s):xhere.push(randn(0,1e-4));x.push(xhere)}return x},L2=function(x1,x2){for(var D=x1.length,d=0,i=0;i<D;i++){var x1i=x1[i],x2i=x2[i];d+=(x1i-x2i)*(x1i-x2i)}return d},xtod=function(X){for(var N=X.length,dist=zeros(N*N),i=0;i<N;i++)for(var j=i+1;j<N;j++){var d=L2(X[i],X[j]);dist[i*N+j]=d,dist[j*N+i]=d}return dist},d2p=function(D,perplexity,tol){var Nf=Math.sqrt(D.length),N=Math.floor(Nf);assert(N===Nf,"D should have square number of elements.");for(var Htarget=Math.log(perplexity),P=zeros(N*N),prow=zeros(N),i=0;i<N;i++){for(var betamin=-1/0,betamax=1/0,beta=1,done=!1,num=0;!done;){for(var psum=0,j=0;j<N;j++){var pj=Math.exp(-D[i*N+j]*beta);i===j&&(pj=0),prow[j]=pj,psum+=pj}for(var Hhere=0,j=0;j<N;j++){if(0==psum)var pj=0;else var pj=prow[j]/psum;prow[j]=pj,pj>1e-7&&(Hhere-=pj*Math.log(pj))}Hhere>Htarget?(betamin=beta,betamax===1/0?beta*=2:beta=(beta+betamax)/2):(betamax=beta,betamin===-1/0?beta/=2:beta=(beta+betamin)/2),num++,Math.abs(Hhere-Htarget)<tol&&(done=!0),num>=50&&(done=!0)}for(var j=0;j<N;j++)P[i*N+j]=prow[j]}for(var Pout=zeros(N*N),N2=2*N,i=0;i<N;i++)for(var j=0;j<N;j++)Pout[i*N+j]=Math.max((P[i*N+j]+P[j*N+i])/N2,1e-100);return Pout},tSNE=function(opt){var opt=opt||{};this.perplexity=getopt(opt,"perplexity",30),this.dim=getopt(opt,"dim",2),this.epsilon=getopt(opt,"epsilon",10),this.iter=0};tSNE.prototype={initDataRaw:function(X){var N=X.length,D=X[0].length;assert(N>0," X is empty? You must have some data!"),assert(D>0," X[0] is empty? Where is the data?");var dists=xtod(X);this.P=d2p(dists,this.perplexity,1e-4),this.N=N,this.initSolution()},initDataDist:function(D){var N=D.length;assert(N>0," X is empty? You must have some data!");for(var dists=zeros(N*N),i=0;i<N;i++)for(var j=i+1;j<N;j++){var d=D[i][j];dists[i*N+j]=d,dists[j*N+i]=d}this.P=d2p(dists,this.perplexity,1e-4),this.N=N,this.initSolution()},initSolution:function(){this.Y=randn2d(this.N,this.dim),this.gains=randn2d(this.N,this.dim,1),this.ystep=randn2d(this.N,this.dim,0),this.iter=0},getSolution:function(){return this.Y},step:function(){this.iter+=1;for(var N=this.N,cg=this.costGrad(this.Y),cost=cg.cost,grad=cg.grad,ymean=zeros(this.dim),i=0;i<N;i++)for(var d=0;d<this.dim;d++){var gid=grad[i][d],sid=this.ystep[i][d],gainid=this.gains[i][d],newgain=sign(gid)===sign(sid)?.8*gainid:gainid+.2;newgain<.01&&(newgain=.01),this.gains[i][d]=newgain;var momval=this.iter<250?.5:.8,newsid=momval*sid-this.epsilon*newgain*grad[i][d];this.ystep[i][d]=newsid,this.Y[i][d]+=newsid,ymean[d]+=this.Y[i][d]}for(var i=0;i<N;i++)for(var d=0;d<this.dim;d++)this.Y[i][d]-=ymean[d]/N;return cost},debugGrad:function(){for(var N=this.N,cg=this.costGrad(this.Y),grad=(cg.cost,cg.grad),e=1e-5,i=0;i<N;i++)for(var d=0;d<this.dim;d++){
var yold=this.Y[i][d];this.Y[i][d]=yold+e;var cg0=this.costGrad(this.Y);this.Y[i][d]=yold-e;var cg1=this.costGrad(this.Y),analytic=grad[i][d],numerical=(cg0.cost-cg1.cost)/(2*e);console.log(i+","+d+": gradcheck analytic: "+analytic+" vs. numerical: "+numerical),this.Y[i][d]=yold}},costGrad:function(Y){for(var N=this.N,dim=this.dim,P=this.P,pmul=this.iter<100?4:1,Qu=zeros(N*N),qsum=0,i=0;i<N;i++)for(var j=i+1;j<N;j++){for(var dsum=0,d=0;d<dim;d++){var dhere=Y[i][d]-Y[j][d];dsum+=dhere*dhere}var qu=1/(1+dsum);Qu[i*N+j]=qu,Qu[j*N+i]=qu,qsum+=2*qu}for(var NN=N*N,Q=zeros(NN),q=0;q<NN;q++)Q[q]=Math.max(Qu[q]/qsum,1e-100);for(var cost=0,grad=[],i=0;i<N;i++){for(var gsum=new Array(dim),d=0;d<dim;d++)gsum[d]=0;for(var j=0;j<N;j++){cost+=-P[i*N+j]*Math.log(Q[i*N+j]);for(var premult=4*(pmul*P[i*N+j]-Q[i*N+j])*Qu[i*N+j],d=0;d<dim;d++)gsum[d]+=premult*(Y[i][d]-Y[j][d])}grad.push(gsum)}return{cost:cost,grad:grad}}},global.tSNE=tSNE}(tsnejs),function(lib){"use strict";void 0===module||void 0===module.exports?window.tsnejs=lib:module.exports=lib}(tsnejs)},{}]},{},[299]);
